(function(){function ts(n){var t=n.replace(/\.\w+$/,"").replace(/\W/g,"_").toLowerCase()||"page";return t.match(/^\_/)&&(t=t.substring(1)),t}function e(){return ct&&co=="mouse"}function bc(){return g.width()>g.height()}function kf(){r.sidebar=="Landscape"?bc()?u.removeClass("app-sidebar-undocked"):u.addClass("app-sidebar-undocked"):r.sidebar=="Never"?u.addClass("app-sidebar-undocked"):u.removeClass("app-sidebar-undocked")}function au(n){e()?y.open(n):y.location.href=n}function is(){switch(r.displayDensity){case"Comfortable":return 46;case"Compact":return 40}return 35}function gi(){return(new Date).getTime()}function nr(n){return parseFloat(n.replace(/[A-Za-z]/g,""))}function rs(n){return n.x!=null&&(n.x=Math.ceil(n.x)),n.y!=null&&(n.y=Math.ceil(n.y)),n}function us(n){return String.format("{0} - {1}",yf.QuickFindText,n.get_view().Label)}function vu(n){n.refreshCallback&&(n.refreshCallback(),n.refreshCallback=null)}function yu(n){var t=r.pageTransition!="none";if(arguments.length==0)return t;t||n.removeClass("ui-panel-animate")}function df(n,i){n._hasKey()&&$('<span class="app-btn-more">&nbsp;<\/span>').appendTo(i).attr("title",t.More)}function fs(n,t){n=$(n);n.length&&(n[0].selectionStart=n[0].selectionEnd=t)}function gf(n){kr(n);es(n);$(n._allFields).each(function(){delete this._listOfValues});n._forceSync();n.refreshData();ee()}function kc(n){n.clearFilter();gf(n)}function es(n){var t=(n.get_filter()||[]).slice(0),r=[],u,i=0;for($(n.get_externalFilter()).each(function(){r.push(this.Name)});i<t.length;)u=t[i],Array.indexOf(r,u.match(/^\w+/)[0])!=-1?t.splice(i,1):i++;n.viewProp("filter",t)}function os(){var t=n._menuStrip;return t&&t.strip.is(":visible")}function lr(t){var r=n._menuStrip,i=r&&r.strip,u=n._menuPanel;if(i){var o=$(u).find('li a[rel="external"]'),f=o.parent(),e=$(u).find(".ui-li-divider:not(.app-info):not(.app-copy)");arguments.length==0&&(t=os());t?(i.show(),f.hide(),e.hide()):(i.hide(),f.show(),e.show())}}function ss(n){n.length&&n[n.length-1].text&&n.push({})}function pu(t){t=$(t);causesCalculate=t.attr("data-causes-calculate");causesCalculate&&n.causesCalculate(causesCalculate);var i=n.dataView();i&&!t.is(":checkbox,:radio")&&setTimeout(function(){i.extension().calculate(n.dataView())},200)}function hs(n){var e=$(n.target),t,i,u,r=[],f;t=e.closest(".app-container-scrollable");t.length&&(i=t.next(),u=t.data("data-field"),t.find(":checkbox,:radio").each(function(n){$(this).is(":checked")&&(r.length&&r.push(","),r.push(u.Items[n][0]))}),f=i.val(),i.val(r.join("")),f!=i.val()&&pu(i))}function wu(t,i){t.find(".app-container-scrollable").each(function(){var f=0,e=0,r=$(this),o=parseInt(r.attr("data-columns")),t=r.find("fieldset");if(i){var s=t.find(":input"),c=Math.min(Math.ceil(s.length/(o>1?o:1)),Math.max(Math.ceil(n.screen().height*.45/is()),3)),u,h=[];t.find(":checkbox,:input").checkboxradio("destroy").off("click");t.controlgroup("destroy");s.each(function(n){n%c==0&&(u=$('<fieldset class="app-controlgroup-vertical"/>').appendTo(r),h.push(u));var t=$(this),i=t.prev();i.appendTo(u);t.appendTo(u)});t.remove();t=$(h).controlgroup().find(":checkbox,:radio").checkboxradio();r.find(":checkbox,:radio").on("click",hs)}i||t.each(function(){$(this).height("").find(".ui-checkbox,.ui-radio").width("")});t.each(function(){var n=$(this),t=n.width(),i=n.height();t>f&&(f=t);i>e&&(e=i)});t.each(function(){$(this).height(e).find(".ui-checkbox,.ui-radio").width(f+1)})})}function bu(){try{if(y.getSelection){var n=y.getSelection();n&&n.rangeCount>0&&n.removeAllRanges()}else document.selection&&document.selection.empty()}catch(t){}}function ku(t){var r=n._menuStrip,i=r&&r.strip;i&&(i.hide(),arguments.length==1&&i.attr("data-enabled",t?"true":"false"))}function cs(n,t){t=="Cards"?n.addClass("app-cardview").removeClass("app-grid"):t=="Grid"?n.addClass("app-grid").removeClass("app-cardview"):t=="List"&&n.removeClass("app-cardview app-grid")}function ls(n){n.find("> .app-map").each(function(){var i=$(this),u=n.find("> .app-page-header:visible"),f=n.find("> .app-map-instruction:visible"),r=$(f.length&&f||u.length&&u),e=i.data("data-map"),t,o;i.css("top",r.length?r.position().top+r.outerHeight(!0):0);i.is(":visible")&&e&&(t=e.map,o=t.getCenter(),google.maps.event.trigger(t,"resize"),t.setCenter(o))})}function as(n){n.css({display:"block","z-index":-10});vt(n);n.css({display:"","z-index":""})}function vt(n){var u=i.activePage;n||(n=u);var f=n==u,e=f?n:u,r=e.css("padding-top"),t=e.css("min-height"),l=n.find(".ui-content > .app-tabs"),o=cr&&n.find(cr.fixedTop.selector),s=o&&o.css("position")=="fixed"&&o.outerHeight(),h=cr&&n.find(cr.fixedBottom.selector),c=h&&h.css("position")=="fixed"&&h.outerHeight(),a=0;f?(i.resetActivePageHeight(),t=e.css("min-height")):n.css({"padding-top":r,"min-height":t});t=parseInt(t.substring(0,t.length-2));r=parseInt(r.substring(0,r.length-2));n.find(".app-wrapper").each(function(){var n=$(this),i=l.length?l.outerHeight(!0):0;i&&(t=t-i,r=r+i);s&&(t-=s,r+=s);c&&(t-=c,a+=c);n.css({top:r,bottom:a,"min-height":t});f&&n.css({height:t});ls(n)})}function dc(){return ii?g.width()>=720:g.width()>=768&&g.height()>=704}function gc(){function k(n){return n&&n.match(/Landscape|Always|Never/)}var n=__settings,a=n.mobileDisplayDensity,o=Sys.Browser,v,s,y,h=$("#PageHeader").parent(),l=(h.attr("class")||"").match(/\bpage-theme-(\w+)\b/i),p=$("div[data-content-framework]:first"),w=c("buttonShapes"),b=c("promoteActions"),f;r={mapApiIdentifier:n.mapApiIdentifier,pageTransition:c("pageTransition")||n.transitions||(wi?"fade":"slide"),sidebar:c("sidebar")||k(n.sidebar)||"Landscape",theme:l&&l[1]||c("theme")||n.theme,themeDisabled:l!=null,displayDensity:c("displayDensity")||(e()?n.desktopDisplayDensity:a=="Auto"?dc()?"Compact":"Comfortable":a),labelsInForm:c("labelsInForm")||n.labelsInForm,labelsInList:c("labelsInList")||n.labelsInList,buttonShapes:w!=null?w:n.buttonShapes||!0,promoteActions:b!=null?b:n.promoteActions||!0,initialListMode:c("initialListMode")||n.initialListMode||"SeeAll"};o.agent==o.InternetExplorer&&o.version<=9&&(u.hide(),n&&n.ui?(v=(new Date).getDate()+365,s=new Date,s.setDate(v),y=String.format("appfactorytouchui=false; expires={0}; path=/",s.toUTCString()),document.cookie=y,location.reload(i.path.parseUrl(location.href).hrefNoHash)):alert(t.TouchUINotSupported));rt&&(u.addClass("app-ios"),dr<8&&u.addClass("app-ios7"));wi&&u.addClass("app-android");r.buttonShapes==!1&&u.addClass("app-buttons-text-only");h.is(".Tall")&&u.addClass("app-page-header-hidden");(h.is(".Wide")||p.length&&p.attr("data-sidebar")!="true")&&(r.sidebar="Never",r.sidebarDisabled=!0);$(document).trigger($.Event("appinit"));i.defaultPageTransition=r.pageTransition;kf();r.displayDensity||(r.displayDensity=e()?"Compact":"Comfortable");u.addClass(ye(r.theme));u.addClass(pe(r.displayDensity));r.labelsInForm=="AlignedRight"&&u.addClass("app-labelsinform-alignedright");r.labelsInList=="DisplayedAbove"&&u.addClass("app-labelsinlist-displayedabove");e()&&(f=Sys.CultureInfo.CurrentCulture.dateTimeFormat,$.datepicker.setDefaults({prevText:"",nextText:"",monthNames:f.MonthNames,monthNamesShort:f.AbbreviatedMonthNames,dayNames:f.DayNames,dayNamesShort:f.AbbreviatedDayNames,dayNamesMin:f.ShortestDayNames,firstDay:f.FirstDayOfWeek,constrainInput:!1,showOtherMonths:!0,changeMonth:!0,changeYear:!0}),$.datepicker.parseDate=function(n,t){var i=$(this._lastInput).attr("data-format-string")||"{0:d}";return Date.tryParseFuzzyDate(t,i)},$.datepicker.formatDate=function(n,t){var r=$(this._lastInput),u=r.attr("data-format-string")||"{0:d}",i=Date.tryParseFuzzyDate(r.val(),u);return i&&(t.setHours(i.getHours()),t.setMinutes(i.getMinutes()),t.setSeconds(i.getSeconds())),String.localeFormat(u,t)})}function vs(n){var t;if(bf!=!1&&!l&&(t=n.find(".ui-collapsible:visible .ui-collapsible-heading:not(.ui-collapsible-heading-collapsed):first").parent().find(":input:first").first(),t.length)){var i=t.closest(".app-wrapper"),h=i.offset().top,r=i.scrollTop(),f=i.height(),u=t.offset().top+r-h,o=t.outerHeight(!0);function s(){e()&&(ht(),t.focus(),t[0].select&&t[0].select())}u<r||u+o>r+f?(l=!0,br(i,u-(f-o)/2,function(){l=!1;s()})):s()}}function ne(n){return(n.metaKey||n.ctrlKey)&&n.shiftKey}function ys(n){var i=!1,t;return n.is("span")&&n.get(0).scrollWidth-n.innerWidth()>0&&(t=$('<div class="ui-content app-popup-message"/>').html(n.text()).popup({history:!1,arrow:"b,t",overlayTheme:"b",positionTo:"origin",afteropen:function(){},afterclose:function(){fi(t)}}).popup("open",{x:n.offset().left+n.outerWidth()/2,y:n.offset().top}).on("vclick",function(){return ut(t),!1}),i=!0),i}function tr(t){n.tabs("fit",{page:t})}function du(n){$(n).find(".app-wrapper").each(function(){var n=$(this),t=n.data("scroll-top");t&&n.scrollTop()!=t&&n.scrollTop(t)});$(n).find(".app-echo-inner").each(function(){var n=$(this),t=n.data("scroll-left");n.parent().is(":visible")&&t&&n.scrollLeft()!=t&&n.scrollLeft(t)})}function te(n){$(n).find(".app-wrapper").each(function(){var n=$(this);n.data("scroll-top",n.scrollTop())});$(n).find(".app-echo-inner").each(function(){var n=$(this);n.parent().is(":visible")&&n.data("scroll-left",n.scrollLeft())})}function ie(n){function e(n){while(n.css("display")=="none"&&n.length)n=n.next();return n}var o=n.scrollTop(),s=n.height(),h=o+s,t=e(n.find("*:first")),u=t.length==0?0:Math.ceil(t.position().top-(t.is("ul")&&t.find("li:first").length?parseInt(t.find("> li:first").css("margin-top").replace("px","")):0)),i=n.find("> *:last"),r=i.is("ul")&&i.find("li:first").length?i.find("> li:last"):i,c=r.position().top,f=Math.ceil(c+r.outerHeight()+parseInt(r.css("margin-top").replace("px",""))+(ii?0:+parseInt(r.css("margin-bottom").replace("px","")))+parseInt(i.css("margin-bottom").replace("px",""))),l=-1*(u-f);return{top:u,height:h,maxHeight:l,firstTop:u,lastBottom:f}}function ar(n){var t=n.find(".ui-panel-inner"),i,r,u;if(t.length)t.on("scroll keydown keyup",function(){l||i||(i=!0,r=t.scrollTop(),ni=!0,u=setInterval(function(){var n=t.scrollTop();n!=r?r=n:(clearInterval(u),i=!1,ni=!1,t.data("scroll-stop-time",new Date))},200))})}function nl(n){wrapper=n.find(".ui-panel-inner").off("scroll keydown keyup")}function re(n,t){function y(n){r.data("scroll-dir",n);$(document).trigger($.Event("scrolldir.app",{relatedTarget:r}))}var r=n.find(".app-wrapper:first"),s,h,f,u,c,a,v,o;if(!r.length){if(s=n.find(".ui-content"),h=s.contents(),r=$('<div class="app-wrapper"/>').appendTo(s),t!=!1)r.on("wheel DOMMouseWheel mousewheel",function(n){if(f&&"deltaY"in n.originalEvent){var i=r.data("scroll-dir"),t=n.originalEvent.deltaY>0?"down":"up";t!=i&&y(t)}}).on("touchstart",function(){rt&&dr<8&&(o=!1,ti=!0)}).on("touchmove",function(){rt&&(a=gi(),v=r.scrollTop())}).on("touchend",function(){if(rt&&dr<8){var t=gi()-a,n=r.scrollTop(),i=Math.abs(v-n);t>0&&i/t>.25||n<0||n>r.height()?o=!0:ti=!1}}).on("scroll",function(){if(!l)if(f){var e=r.data("scroll-dir"),n=r.scrollTop(),t=n<u?"up":n==u?"none":"down";(t!=e||r.scrollTop()<i.getScreenHeight())&&y(t)}else f=!0,u=r.scrollTop(),$(document).trigger($.Event("scrollstart.app",{relatedTarget:r})),ni=!0,c=setInterval(function(){var n=r.scrollTop();n!=u?u=n:(clearInterval(c),f=!1,ni=!1,r.data("scroll-stop-time",new Date),$(document).trigger($.Event("scrollstop.app",{relatedTarget:r})),o&&(o=!1,ti=!1))},200)});e()&&r.attr("tabindex",0);$('<div class="app-page-header"><h2/><h1/><\/div>').appendTo(r);h.appendTo(r)}return r}function f(t){n.activeLink(t)}function o(n,t){n=$(n);n.is(".app-btn-more")?(n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");eu="link";t()},ou)):(f(n),setTimeout(function(){f();eu="link";n&&n.is(".app-btn")&&(eu="toolbar");t()},ou))}function ps(n,t){if(t||(t=n.find(".app-stub,.app-stub-main")),t.length){var i=Math.ceil(t.offset().top),r=Math.ceil(n.offset().top),u=n.height();i>r&&(i>r+u?t.height(""):t.height(u-(i-r)))}}function ue(){it();n.promo(!1);u.find("> *").hide()}function fe(){kt&&kt._updateLastActivity()}function ee(){i.activePage.find(".dv-heading").removeClass("app-disabled")}function gu(){return pf||(pf=$("#app-sidebar")),pf}function oe(){return gu().is(":visible")}function se(n){hu&&(clearTimeout(hu),hu=null);n&&(cu=null)}function he(t){return su?!0:n.causesCalculate()?(su=setInterval(function(){n.causesCalculate()||(clearInterval(su),su=null,t())},100),!0):!1}function st(n,t){n&&(he(function(){st(n,t)})||(n.callback?n.callback(n.context,t):n.href&&(y.location.href=n.href)))}function vr(n){var t=i.activePage;t&&t.find(".dv-load-at-top").css("visibility",n?"hidden":"");l=n}function a(){var n=i.activePage;return n?n.attr("id"):"_"}function ws(n){return n?n.toJSON().slice(0,10):null}function bs(n){return n?new Date(n.getTime()-n.getTimezoneOffset()*6e4).toJSON().slice(0,19):null}function tl(n){return n?ks(n+"T00:00:00"):null}function ks(n){var t=n?new Date(n.substring(0,4),parseInt(n.substring(5,7))-1,n.substring(8,10),n.substring(11,13),n.substring(14,16),0,0):null;return t!=null&&(t=new Date(t.getTime()-t.getTimezoneOffset()*6e4)),t}function yt(t){var f=16,e=r.displayDensity;e=="Compact"?f==14:e=="Condensed"&&(f=12);$(t||i.activePage.find(".app-listview")).each(function(){var e=$(this),p=e.parent(),k=e.closest(".ui-page"),it,st="w"+Math.ceil((g.width()-(oe()?gu().outerWidth():0))/f/5)*5,i=ko[st],rt,ht,ct,lt,at,c="app-width",a=e.attr("data-yardstick-class"),o=u.find("#app-yardstick"),d=e.is(".app-grid"),w=p.is(".app-echo-inner"),vt=w||p.is(".app-map-info"),nt,ut;if((!i&&!vt||w&&d)&&(o.length||(o=$('<ul id="app-yardstick" class="app-listview"><li class="dv-item"><a><span>1<\/span><\/a><\/li><li><a class="dv-item">2<\/a><\/li><li><a class="dv-item">3<\/a><\/li><\/ul>').appendTo(u).listview()),w&&d&&(p=p.closest(".app-wrapper")),o.appendTo(p).show(),rt=o.find("li:first"),it=k.css("display"),it!="block"&&k.css("display","block"),ct=rt.outerWidth(),o.addClass("app-cardview"),ht=rt.outerWidth(),o.removeClass("app-cardview"),o.addClass("app-grid"),lt=firstSpanPadding=o.find("span:first"),at=parseInt(lt.css("margin-left").replace("px","")),o.removeClass("app-grid"),it!="block"&&k.css("display",""),o.appendTo(u).hide(),i={card:Math.ceil(ht/f/5)*5,list:Math.ceil(ct/f/5)*5,columnPadding:at,grid:{}},ko[st]=i),c+=!d&&vt?Math.ceil(e.width()/f/5)*5:e.is(".app-cardview")?i.card:i.list,c!=a&&(a&&e.removeClass(a),e.addClass("app-yardstick "+c).attr("data-yardstick-class",c)),d&&(nt=n.pageInfo(w?e.closest(".app-echo").attr("data-for"):k.attr("id")),ut=nt.id+"_"+nt.dataView._viewId,!i.grid[ut])){i.grid[ut]=!0;var b=nt.dataView,dt=b._fields,gt=b._allFields,s=[],r,v,yt=3,h=0,y=i.list*f,ft=4*f+i.columnPadding,t,tt=new Sys.StringBuilder;$(dt).each(function(){var t=this,n=gt[this.AliasIndex];t.Hidden||t.OnDemand||(r=n.Columns,n.ItemsStyle=="CheckBoxList"?r=80:r>80?r=80:r||(n.Type=="String"?(r=30,n.Len>0&&n.Len<r&&(r=n.Len)):r=15),h+=r,v=0,t.tagged("item-aside")?v=1:t.tagged("item-count")?v=2:(t.tagged("item-para")&&yt++,v=t.tagged("item-desc")?yt:100),s.push({className:String.format("gc_{0}_{1}_{2}",b._id,b._viewId,n.Name),cols:r,priority:v,type:n.Type}))});var l=s[0],et=l.cols,pt,wt,ot=!0,bt=0,ni=b._hasKey();s.reverse();l.priority=0;function kt(){h-=l.cols-et;l.cols=et;l.cols/h*y<ft&&(l.cols=Math.floor(ft/y*h),h+=l.cols-et)}kt();function ti(){$(s).each(function(n){var r,i;if(t=this,!t.hidden&&(t.width=t.cols/h*y,t.width<ft)){for(r=0;r<n&&t.priority>1||r<s.length&&t.priority<2;)if(i=s[r++],t!=i&&!i.hidden&&i.priority>=t.priority&&i.priority>1)return i.hidden=!0,ot=!0,h-=i.cols,!1;t.priority>1&&(t.hidden=!0,h-=t.cols)}})}while(ot)ot=!1,ti();$(s).each(function(){this.hidden||bt++});bt<2&&s.length>0&&(kt(),$(s.reverse()).each(function(){return t=this,t.hidden?(t.hidden=!1,h+=t.cols,!1):void 0}));pt=h;y-=w?32:16;$(s).each(function(){t=this;t.hidden?tt.appendFormat(".app-grid.app-width{0} .{1}, .app-grid-header.app-width{0} .{1} {{display:none!important;}}",i.list,t.className):tt.appendFormat(".app-grid.app-width{0} .{1}, .app-grid-header.app-width{0} .{1} {{width:{2}%;}}",i.list,t.className,(t.cols/pt-i.columnPadding/y-(t==l&&ni?22/y:0))*100);tt.appendLine()});wt=tt.toString();$("<style>").appendTo($("head")).text(wt)}e.find("li.app-yardstick").each(function(){var n=$(this);c="app-width"+i.list;a=n.attr("data-yardstick-class");c!=a&&(a&&n.removeClass(a),n.addClass(c).attr("data-yardstick-class",c))})})}function il(){var r=n.pageInfo(),t,i;r&&(t=r.dataView,i=t&&t.extension(),i&&t.get_isGrid()&&(wf=!0,i.executeInContext("Eye",null,!1)))}function si(n,t){return t&&n.addClass("app-width"+t),n}function nt(t){var i=n._menuButton;if(arguments.length==0)return i.is("."+vi);i&&n.toolbar().is(":visible")&&(t=="off"?i.removeClass(vi):t?i.addClass(vi):setTimeout(function(){i.removeClass(vi)},500))}function ui(){nt(!0);g.one("beforeunload pagehide",function(){nt(!1)})}function ds(){var i=n._menuButton,r,u;i&&n.toolbar().is(":visible")&&(r=n.toolbar(),u=a(),u=="Main"||n._pages.length&&u==n._pages[0].id&&n._pages[0].home?(i.removeClass("ui-icon-back ui-icon-bars "+vi).addClass("ui-icon-bars").attr({href:"#app-btn-menu",title:t.Menu}),r.removeClass("app-has-history")):(i.removeClass("ui-icon-bars "+vi).addClass("ui-icon-back").attr({href:"#app-back",title:t.Back}),r.addClass("app-has-history")))}function gs(n){n.length&&(bo[a()+"_"+n.attr("id")]=n.find(".ui-panel-inner").scrollTop())}function rl(n){n.length&&n.find(".ui-panel-inner").scrollTop(bo[a()+"_"+n.attr("id")]||0)}function ce(n,t){var u=n._fields,f=n._allFields,r=!0,i;t.is(":empty")||t.wrapInner('<span class="app-grid-desc"/>');i=$('<div class="app-grid-header"/>').appendTo(t);$(u).each(function(){var l=this,t=f[l.AliasIndex],u,s,o,a,y,h,v,c;l.Hidden||l.OnDemand||(u=$("<span><\/span>").addClass(String.format("gc_{0}_{1}_{2}",n._id,n._viewId,t.Name)).text(t.HeaderText).attr("title",t.HeaderText).attr("data-field-name",t.Name).appendTo(i),s=bt(n,t.Name),o=n.get_fieldFilter(t,!0),s?(h=$('<span class="app-icon app-indicator"><\/span>').appendTo(u).attr("title",ci(t,s)),s.toLowerCase()=="asc"?u.addClass(o?"app-filter-asc":"app-sort-asc"):u.addClass(o?"app-filter-desc":"app-sort-desc")):o&&(h=$('<span class="app-icon app-indicator"><\/span>').appendTo(u),u.addClass("app-filter-on")),o&&($(n._filter).each(function(){var n=this;if(n.startsWith(t.Name+":"))return a=n,!1}),a&&e()&&(y=n._filter,n._filter=[a],v=h.attr("title"),c=n.extension().filterStatus(!0),v&&c.match(/\.\s*$/)&&(c+=" "+v+"."),h.attr("title",c),n._filter=y)),r&&(r=!1,df(n,i)))})}function nf(n,t,i,r,u){var e=n._fields,o=n._allFields,f;$(e).each(function(e){var l=this,h=o[l.AliasIndex],a=h.itemColumnClass||String.format("gc_{0}_{1}_{2}",n._id,n._viewId,h.Name),c=$("<span><\/span>").appendTo(r).addClass(a),s;l.Hidden||l.OnDemand||(h.itemColumnClass||(h.itemColumnClass=a),s=t[h.Index],s=h.text(s,!1),e==0&&(i!=null&&(s=String.format("{0}. {1}",i,s)),df(n,r)),u?(f=u?u[e]:null,f&&(s=t[l.Index],s=String.localeFormat(l.DataFormatString||"{0:n0}",s),c.text(s),$('<div class="app-static-text"/>').text(f).insertBefore(c.contents()),c.attr("title",h.HeaderText+"\n"+f+" "+s))):(h.HtmlEncode?c.text(s):c.html(s),c.attr("title",s)))})}function ir(n,t,i,r,u,f){var o=n._allFields,y=f.is("a"),v=$("<h3>").appendTo(f),p=o[i.heading],e,s,h,c,l,a;if(i.thumb!=null)if(e=t[i.thumb],e&&e.toString().match(/^null/))u.addClass("ui-li-has-thumb");else var w=n.resolveClientUrl(n.get_appRootPath()),b=o[i.thumb],k=$('<img class="ui-li-thumb"/>').appendTo(f).attr({src:String.format("{0}blob.ashx?{1}=t|{2}",w,b.OnDemandHandler,e)});e=t[i.heading];e=p.text(e);y&&f.attr("title",e);p.HtmlEncode?v.text(e):v.html(e);r&&$('<span class="app-item-number"/>').insertBefore(v.contents()).text(r+". ");i.aside!=null&&(u.addClass("app-li-has-aside"),s=si($('<p class="ui-li-aside"/>').appendTo(f),i.asideRwd),h=o[i.aside],e=t[i.aside],e=h.text(e),h.HtmlEncode?s.text(e):s.html(e),i.asideLabel&&si($('<span class="app-item-label"/>').insertBefore(s.contents()).text(h.HeaderText),i.asideLabelRwd));i.count!=null&&(s==null||i.desc.length)&&(c=si($('<span class="ui-li-count"/>').appendTo(f),i.countRwd),l=o[i.count],e=t[i.count],e=l.text(e),l.HtmlEncode?c.text(e):c.html(e),i.countLabel&&si($('<span class="app-item-label"/>').insertBefore(c.contents()).text(l.HeaderText),i.countLabelRwd));i.desc.length&&(a=$('<p class="app-para"/>').appendTo(f),$(i.desc).each(function(n){var s=this,r=o[s],v=i.descLabels[n],c=i.descLabelsRwd[n],y=i.descPara[n],h,l=r.HeaderText,u;y&&(a=$('<p class="app-para"/>').appendTo(f).insertAfter(a));e=t[s];u=si($('<span class="app-item-desc"/>').appendTo(a),i.descRwd[n]);e=r.text(t[s]);r.HtmlEncode&&r.TextMode!=3?u.text(e):u.html(e);h=u.contents();v&&(si($('<span class="app-item-label-before"/>').insertBefore(h.first()).text(l),c),si($('<span class="app-item-label-after"/>').insertAfter(h.last()).text(l),c))}));y&&df(n,f)}function le(n,t,i){var h=".app-listview li a.app-selected:first,.app-wrapper .app-map",u=n._lookupInfo?n._id:n._parentDataViewId||n._id,r=$("#"+u).find(h),f,e=$app.find(u),s,o,c;return r.length||(r=$("#"+n._id+"_echo .app-echo-inner .app-selected"),u=n._id,e=n),r.length||(u=n._filterSource,r=$("#"+u).find(h),e=$app.find(u)),r.length&&(f=$('<li class="app-li-card">'),t&&f.appendTo(t),r.is(".app-selected")?(s=r.data("data-context"),s&&(o=s.row)):(c=r.data("data-map"),c&&(o=e.extension().commandRow())),o&&(ir(e,o,e.extension().itemMap(),null,f,f),i!=!1&&(contextDataView=$app.find(u),$('<span class="app-li-corner">').appendTo(f.addClass("app-li-has-corner")).text(contextDataView.get_view().Label)),r.parent().is(".app-li-has-aside")&&f.addClass("app-li-has-aside"))),f}function et(t,r){var f,u,e,s,h,o,c="";if(r)u=r.closest(".ui-page");else{if(u=i.activePage,!u)return;r=u.find(".app-page-header")}if(s=r.find("h1"),h=r.find("h2"),e=u.attr("data-page-header")!="false",typeof t=="boolean")t&&e?r.show():(r.hide(),u.attr("data-page-header","false"));else return f=r.data("data-text"),t?(f&&typeof f!="string"&&typeof t=="string"&&(f[1]=t,t=f),r.data("data-text",t)):t=f,t&&(typeof t=="string"?o=t:(o=t[0],c=t[1])),r.attr("data-locked")!="true"&&(s.text(o),h.text(c)),t!=n.title()&&e?r.show():(r.hide(),e&&u.attr("data-page-header","false")),t}function ae(n){b();var t=Math.ceil(g.width()*.9);t>800&&(t=800);n.css({maxWidth:t})}function nh(r,u){function d(){(s||e.length>0&&!r.get_useCase())&&(s&&u.parent().addClass("app-page-tasks"),f=$('<ul data-role="listview" data-inset="true" data-shadow="false" class="app-listview app-listview-static"/>').appendTo(u),r&&(w=le(r,f,s)))}function g(){s&&(e.length&&e.push({}),e.push({text:t.Settings,icon:"gear",callback:function(){n.contextScope("_taskAssistant");we()}}))}var e=[],c,p=n.pageInfo(r&&r._id),s=!r,f,w,l=!1,v,k="eye",nt,y,h;if(r||(r=p&&p.dataView),u||(u=n.content("taskassistant"),c=u.closest(".ui-page"),c.find(".app-page-header").remove(),c.addClass("app-page-tasks app-page-scrollable"),u.find('ul[data-role="listview"]').listview("destroy").remove(),n.tabs("destroy",{container:c}),as(c)),r&&(n.contextScope(r._id),n.navContext(e,!s),n.contextScope(null),e.length&&e[0].icon=="back"&&(e=e.splice(1)),d(),s&&(r.get_isInserting()?(v="Entering",k="plus"):r.get_isEditing()?(v="Editing",k="edit"):r._lookupInfo&&(v="Lookup")),!1&&n.renderContext(f,e,function(n){var t=n.navigateTo=="detail";return t&&(l=!0),t}),s&&(l&&$('<li data-role="list-divider">').appendTo(f),nt=$("<li>").appendTo(f).attr("data-icon",k),resumeLink=$('<a href="#"/>').appendTo(nt).text(t["Resume"+(v||(r.get_isForm()?"Viewing":"Browsing"))]),$('<p class="app-item-desc"/>').appendTo(resumeLink).text(p.text),g(),l=!0,n.renderContext(f,e,function(n){return l&&(l=!1,$('<li data-role="list-divider"/>').appendTo(f)),!n.navigateTo&&(n.callback||n.href)&&n.icon!="dots"&&(!n.command||!n.command.match(/^(Eye|SideBar)$/))})),f&&!s)){h=[];function tt(){n.tabs("create",{tabs:h,className:"app-tabs-echo",change:function(){ot()}})}$(e).each(function(){var i=this,t,n;i.navigateTo=="detail"&&(n=i.activator,n&&n.type=="Tab"&&($(h).each(function(){if(n.text==this.text)return t=this,!1}),t||(y!=n.container&&(y&&(tt(),h=[]),y=n.container),t={text:n.text,content:[]},h.push(t))),echo=th(this.context,f.parent()),t&&t.content.push(echo))});y&&tt()}if(s&&!r&&(g(),d(),n.renderContext(f,e)),f){f.listview().on("vclick",function(n){b();var t=$(n.target).closest("a").andSelf("a"),r=t.data("context-action"),u=i.navigate.history.stack;return t.length&&!ne(n)&&o(t,function(){a()=="taskassistant"?(di=function(){du(i.activePage);setTimeout(function(){st(r)},100)},u[u.length-1].transition="none",history.go(-1)):st(r)}),!1});f.find(".ui-btn-icon-right").toggleClass("ui-btn-icon-right ui-btn-icon-left");yt(f)}s&&f&&f.find("li:first").length&&(h=[{text:ao.Tasks,content:$('#taskassistant ul[data-role="listview"]')},{text:t.History,content:$()},{text:t.Favorites,content:$()}],n.tabs("create",{tabs:h,className:"ui-header-fixed app-tabs-tasks",id:"tasks",placeholder:u}),i.changePage("#taskassistant",{changeHash:!0,transition:"slidedown"}));s||!w||w.next().length||f.off().listview("destroy").remove()}function rr(n){n.find("a").data("data-context",null);n.find('ul[data-role="listview"]').listview("destroy").remove()}function th(i,r){var u=$('<div class="app-echo"/>').appendTo(r).attr({id:i+"_echo","data-for":i}),s,f=$('<div class="app-echo-toolbar"><h3><\/h3><a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-dots ui-btn-icon-notext app-btn-more"/><div class="app-echo-controls"><\/div><span class="app-echo-see-all"><span><\/span><a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-carat-r ui-btn-icon-notext"/><\/span><\/div>').appendTo(u).on("vclick","a",function(t){var r=$(t.target);return pt(r)&&!n.busy()&&o(r,function(){r.is(".ui-icon-carat-r")?n.changePage(i):r.is(".ui-icon-dots")&&n.showContextMenu({scope:i})}),!1});f.find(".ui-icon-dots").attr("title",t.More).css("visibility","hidden");f.find("h3").on("vclick",function(t){var r=$(t.target).closest("h3"),u=[],f=n.contextScope();r.addClass("app-selected");o(r,function(){n.contextScope(i);wh(u,!1);n.contextScope(f);li({anchor:r,items:u,iconPos:"left",y:r.offset().top+r.outerHeight()})})});f.find(".ui-icon-carat-r").attr("title",t.SeeAll);f.find(".app-echo-see-all span").html(t.SeeAll).on("vclick",function(t){var r=$(t.target).addClass("app-selected");setTimeout(function(){r.removeClass("app-selected");n.changePage(i)},ou)});f.find(".app-echo-controls").on("vclick",".ui-btn",function(t,r){function e(){var r=f.context&&f.context.group,e=[],t;r?(t=n.pageInfo(i).dataView,ff(r.Id,t,e,t.extension().commandRow()),li({items:e,anchor:u,iconPos:"left",defaultIcon:"carat-r",scope:t._id})):f.callback()}var u=$(t.target).closest("a"),f=u.data("data-context");return u.length&&!n.busy()&&(r!=!1?n.callWithFeedback(u,e):e()),!1});return $('<div class="app-echo-instruction"><\/div>').appendTo(u).hide(),s=$('<div class="app-echo-inner"><\/div>').appendTo(u).hide().on("vclick taphold",function(t){var r=$(t.target),f=r.closest("a"),y,h,c,l,p=t.type,a=p!="taphold"&&!t.ctrlKey,w=f.is(".dv-action-see-all"),v;return f.length&&!f.is(".app-divider")&&pt(r,p)&&(!w||a)&&!n.busy()&&o(r,function(){w?n.changePage(i):(n.contextScope(i),y=n.pageInfo(i),h=y.dataView,c=h.extension(),l=f.data("data-context"),v=f.is(".app-selected"),h._hasKey()?(u.find(".app-echo-inner .app-selected").removeClass("app-selected"),a?f.addClass("app-selected"):v?f.removeClass("app-selected"):f.addClass("app-selected"),n.dataViewUILinks(h).removeClass("app-selected"),a?(c.tap(l,"none"),pr(h,u),r.is(".app-btn-more")?io(r):c.tap(l)):(v?c.clearSelection():c.tap(l,"none"),pr(h,u),s.find(".app-listview.app-grid").length&&!e()&&r.is("span")&&ys(r))):n.infoView(h,!0,l.row),n.contextScope(null))}),r.closest(".app-grid-header").length?void 0:!1}),$('<div class="app-echo-footer"><\/div>').appendTo(u),ih(u),f.find("h3").text(n.pageInfo(i).text),e()&&u.find(".app-echo-inner").attr("tabindex",0),u}function ot(t){var f,u,r,e=0;t?i.activePage.find(".app-echo-toolbar").each(function(){f=$(this).parent();u=f.attr("data-for");r=n.pageInfo(u);r.echoId&&!r.dataView._busy()&&yr(r.echoId)}):ni||l||ti||n.callWhenVisible(".app-echo:visible",function(t){setTimeout(function(){u=t.attr("data-for");r=n.pageInfo(u);!r.dataView||r.dataView._busy()||r.dataView.get_isForm()||(r.echoInitialized?r.echoChanged&&yr(r.echoId):(r.echoId=t.attr("id"),n.pageInit(r.id,!1)&&yr(r.id+"_echo")))},e);e+=50});i.activePage.find(".app-echo-controls.app-stale").each(function(){var t=$(this).closest(".app-echo"),i=t.attr("id"),r=n.pageInfo(i.substring(0,i.length-5));pr(r.dataView,t)})}function ih(n){var t=r.displayDensity;t!="Condensed"&&(t=="Comfortable"&&g.width()/16<31?n.addClass("app-density-compact"):t=="Compact"&&g.width()/14<31&&n.addClass("app-density-condensed"))}function yr(r){var wt;if(!ti){var c=$("#"+r).removeClass("app-density-condensed app-density-compact"),it=c.parent(),u=c.find(".app-echo-inner").show(),ot=u.next().hide(),ni=c.attr("data-for"),w=n.pageInfo(ni),o=w.dataView,k=o._totalRowCount,f=o.extension(),v=f.visibleDataRows(0),st=f.itemMap(),h,ut=o.get_showRowNumber()==!0,ht=$(c).find(".app-echo-toolbar"),ii=ht.find(".app-echo-controls"),ri=ht.find(".app-echo-see-all"),d=ht.find("h3").empty().text(o.get_view().Label||w.text),bt=u.prev(),ct=f.instruction(!1),kt,ui=i.getScreenHeight(),g=it.height()*.55,lt,l,s,at,nt,vt,b,dt=o.get_selectedKey().length>0,ft,rt=f.aggregates();if(!c.is(":visible")){w.echoChanged=!0;return}if(w.echoChanged=!1,ih(c),!v){o.goToPage(0,!0);f.echoCallback=function(){f.echoCallback=null;yr(r)};return}if(k&&($("<span> (<\/span>").appendTo(d),$('<span class="app-echo-count"><\/span>').appendTo(d).text(k),$("<span>)<\/span>").appendTo(d),e()&&d.attr("title",d.text())),w.echoInitialized||(w.echoInitialized=!0,w.refreshed=!1),c.css("padding-bottom",""),nt=it.find(".app-stub,.app-stub-main"),nt.length||(nt=$("<div><\/div>").appendTo(it).addClass("app-stub"+(a()=="Main"?"-main":""))),nt.height(nt.outerHeight()+u.outerHeight(!0)),ct&&(v.length||ct.match(/"app-filter"/))?bt.html(ct).show():bt.hide(),lt=u.scrollLeft(),rr(u),u.empty(),v.length)if(u.removeClass("app-no-scrolling app-horizontal-scrolling"),o._filterSource||it.find(".app-echo:visible").length!=1||(g=ui-u.offset().top-(nr(c.css("padding-top"))+nr(c.css("padding-bottom")))),l=v.length,f.viewStyle()=="Grid")u.addClass("app-no-scrolling").height(""),rr(u),h=$('<ul class="app-listview app-grid" data-role="listview"/>').appendTo(u),y=$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(h),ce(o,y),$(v).each(function(n){var t=this,u=n+1,i=$('<li data-icon="false" class="dv-item"/>').appendTo(h),r=$("<a/>").appendTo(i).data("data-context",{row:this.slice(0),pageIndex:0});return nf(o,t,ut?u:null,r),o.rowIsSelected(t)&&(b=t,r.addClass("app-selected")),n==0&&(h.listview(),g-=i.prev().outerHeight(!0)+1,s=Math.ceil(g/(i.outerHeight(!0)+1)),rt&&(s-=2)),s<l&&s-2==n?!1:void 0}),rt&&(y=$('<li data-icon="false" class="dv-item"/>').appendTo(h),y.prev().addClass("app-followed-by-aggregates"),p=$('<a class="app-divider app-calculated"/>').appendTo(y),nf(o,rt,null,p,f.aggregateLabels())),(s<l||l<k)&&(at=p=$('<a class="dv-action-see-all"/>').appendTo($("<li/>").appendTo(h)).text(t.SeeAll)),yt(h.listview().listview("refresh")),at&&at.toggleClass("ui-btn-icon-right ui-btn-icon-left");else{var h=$('<ul class="app-listview" data-role="listview"/>').hide().appendTo(u),y=$('<li data-icon="false"/>').appendTo(h),p=$("<a/>").appendTo(y),pt,et,gt;if(rt&&(gt=f.aggregateLabels(),ot.show().empty(),$(o._fields).each(function(n){var r=this,f=o._allFields[r.AliasIndex],u=gt[n],t,i,e;u&&(t=rt[r.Index],t=String.localeFormat(r.DataFormatString||"{0:n0}",t),i=$('<a class="ui-btn ui-inline app-calculated app-btn-static"/>').appendTo(ot),$('<span class="app-calculated-label"/>').text(f.HeaderText).appendTo(i),e=$('<span class="app-calculated-value"/>').text(t).appendTo(i),$('<div class="app-static-text"/>').text(u).insertBefore(e.contents()),i.attr("title",f.HeaderText+"\n"+u+" "+t))}),i.activePage.find(".app-echo:visible").length==1&&c.prev().is(".app-page-header")&&(g-=ot.outerHeight())),ir(o,v[0],st,ut?1:null,y,p),h.listview().show(),pt=y.outerHeight(!0),et=Math.floor(u.innerWidth()/y.outerWidth(!0)),s=Math.floor(g/pt),s<1&&(s=1),et*s>=v.length&&(s=Math.ceil(v.length/et),u.addClass("app-no-scrolling")),k>l&&(l=l-l%s,et*s>=l&&u.addClass("app-no-scrolling")),u.is(".app-no-scrolling")||(u.addClass("app-horizontal-scrolling"),e()&&(s=Math.floor(g/pt),s<1&&(s=1))),rr(u),$(v).each(function(n){if(n>=l)return!1;h&&n%s!=0||(h=$('<ul class="app-listview" data-role="listview"/>').appendTo(u),uf(o,h));var r=this,e=n+1,f=$('<li data-icon="false" class="dv-item"/>').appendTo(h),i=$("<a/>").appendTo(f).data("data-context",{row:this.slice(0),pageIndex:0});ir(o,r,st,ut?e:null,f,i);n==l-1&&l<k&&(i.find("p,img,span").css("visibility","hidden"),i.addClass("dv-action-see-all").find("h3").text(t.SeeAll),f.attr("data-icon","carat-r"));o.rowIsSelected(r)&&(b=r,i.addClass("app-selected"))}),l>s&&(wt=s-l%s,wt<s))while(wt-->0)y=$('<li data-icon="false" class="dv-item"/>').appendTo(h),p=$("<a/>").appendTo(y),ir(o,v[0],st,ut?1:null,y,p),p.css("visibility","hidden");s==k&&h.addClass("app-list-one-column");yt(u.find("ul").listview());h=u.find("ul:first");h.length&&(kt=u[0].offsetHeight-u[0].clientHeight,u.height(h.height()+kt+8));p=u.find(".app-selected");p.length&&(vt=p.offset().left-u.offset().left+p.outerWidth(),vt>u.width()&&(lt=vt-p.outerWidth()));u.scrollLeft(lt)}else $('<div class="app-echo-empty"/>').appendTo(u.height("")).text(tt.NoRecords);c.prev().is(".app-echo")||c.next().is(".app-echo")||c.css("padding-bottom",0);ps(it,nt);dt?(b||(v=f.visibleDataRows(f.pageIndex()),$(v).each(function(){var n=this;if(o.rowIsSelected(n))return b=n,!1})),b?f.commandRow()!=b&&(f.clearSelection(),f.tap(b,"none")):f.clearSelection()):f.commandRow()&&f.clearSelection();w.echoRefreshCallback&&(w.echoRefreshCallback(),w.echoRefreshCallback=null);pr(o,c,dt,ii,d,ri);f._checkedAutoSelect||(f._checkedAutoSelect=!0,setTimeout(function(){ft=f._autoSelect;f._autoSelect=null;ft&&!n.busy()&&(w.echoChanged=!0,n.contextScope(o._id),f.tap(ft.row,ft.action),n.contextScope(null))}))}}function pr(t,i,r,u,f,e){function c(n){return n.offset().left+n.outerWidth()>d+y-1}var h,s;if(r==null&&(r=t.get_selectedKey().length>0),!u){if(i||(i=$("#"+t._id+"_echo")),!i.length)return;u=i.find(".app-echo-toolbar .app-echo-controls");f=u.parent().find("h3");e=u.next()}var w=[],l=[],b=f.next().css("visibility",""),a=b.offset().left+b.outerWidth(),v=e.offset().left,k,d,y,o=[],p=[];if(a==0&&v==0)u.addClass("app-stale");else if(v-a>=28){if(u.find(".ui-btn").data("data-context",null),u.hide().contents().remove(),k=n.contextScope(),n.contextScope(t._id),t.extension().context(w,["ActionBar"]),n.contextScope(k),$(w).each(function(){var n=this;n.system?n.icon=="search"&&l.push(n):n.text&&l.push(n)}),$(l).each(function(){var n=this,t=$('<a class="ui-btn"/>').appendTo(u).data("data-context",n);n.icon=="dots"?t.addClass("app-has-children ui-corner-all ui-mini").text(n.text):(t.addClass("ui-mini ui-btn-icon-left ui-corner-all ui-icon-"+(n.icon||"carat-r")).attr("title",n.text),n.icon=="search"?t.toggleClass("ui-btn-icon-left ui-btn-icon-notext ui-mini "):t.text(n.text))}),y=v-a-nr(u.css("marginRight")),u.width(y).show(),d=u.offset().left,u.find(".ui-btn").each(function(){var n=$(this);n.is(".ui-btn-icon-left")&&p.push(n);c(n)&&o.push(n)}),o.length)for(p.reverse();o.length;){if(h=o[0],s=c(h),s&&(h.is(".ui-btn-icon-left")&&(h.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),s=c(h)),s&&$(p).each(function(){var n=this;if(o.indexOf(n)==-1&&n.is(".ui-btn-icon-left")&&(n.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),s=c(h),!s))return!1}),s)){$(o).each(function(){this.hide()});break}o.splice(0,1)}$('<a class="ui-btn ui-btn-icon-notext ui-corner-all"/>').appendTo(u).css("visibility","hidden")}else u.hide()}function ul(){var n=ni||l;return n==!0}function pt(n,t){var i;if(ni||l)return!1;if(rt||!1)if(i=$(n).closest("a"),i.data("scroll-check")==!0)i.data("scroll-check",!1);else{ti=!1;var r=i.closest(".app-wrapper,.ui-panel-inner"),u=r.data("scroll-stop-time"),e=r.scrollTop();return u&&gi()-u.getTime()>5e3?!0:(i.data("scroll-check",!0),setTimeout(function(){t||(t="vclick");e==r.scrollTop()?($(n).is(".app-btn-more")?n:i).trigger(t):(pt(i,t),f())},10),!1)}return!0}function wr(n){setTimeout(function(){$("div.ui-panel-open").panel("close",n!=!0)},ou)}function w(t,i,r){i||(i=450);or&&(clearTimeout(or),or=null);t||(or=setTimeout(function(){if(l)w(t,100,r);else{or=null;yt();var i=gu(),u=n.contextScope();gs(i);n.contextScope(null);n.refreshContextMenu(i);n.contextScope(u);n.refreshMenuStrip();r&&r()}},i))}function hi(n,t){if(vf||(vf=__settings.appInfo.replace(/\W/g,"_")),n=vf+location.pathname.replace(/\W/g,"_")+"_"+n,arguments.length==1)return c(n);c(n,t)}function c(n,t){if(arguments.length==1){if(typeof Storage!="undefined")try{return t=localStorage[n],t!=null&&(t=JSON.parse(t)),t}catch(i){}return null}if(typeof Storage!="undefined")if(t==null)localStorage.removeItem(n);else try{localStorage[n]=JSON.stringify(t)}catch(i){}}function rh(n,t){var r={text:t,resolved:!0,description:null,type:null},i=n.attr("data-activator"),e,u,o,f;return i||(o=n.closest("div[data-activator]"),i=o.attr("data-activator"),i&&(n=o,e=n.parent(),u=e.attr("id"),u||(u="aid"+vc++,e.attr("id",u)),r.container=u)),i||(i=$(n).prev(".DataViewHeader").text()),i&&i!="false"?(f=uc.exec(i),f?(r.text=f[4]||f[2],r.type=f[1]):r.text=i):r.resolved=!1,r.description=n.attr("data-activator-description"),r}function tf(n,t){return(t?n.tagged("action-call"):n.tagged("action-call","field-call"))||n.Name.match(oc)&&(!t||!n.tagged("action-call-disabled"))}function rf(n,t){return(t?n.tagged("action-email"):n.tagged("action-email","field-email"))||n.Name.match(sc)&&!(t||!n.tagged("action-email-disabled"))}function uh(n,t){return(t?n.tagged("action-url"):n.tagged("action-url","field-url"))||n.Name.match(hc)&&(!t||!n.tagged("action-url-disabled"))}function fl(n,t){return t?n.tagged("action-location"):n.tagged("action-location","map-address")&&!n.tagged("action-location-disabled")}function el(n){var t=n.ItemsStyle;return!String.isNullOrEmpty(t)&&t!="CheckBoxList"}function uf(n,t){(n.get_isTagged("thumb-person")||n._controller.match(/\b(emp|acc|user|usr|person|cust)/i)&&!n.get_isTagged("thumb-standard"))&&t.addClass("app-thumb-person")}function br(n,t,i){l=!0;n.animate({scrollTop:t},"swing",function(){l=!1;i&&i()})}function fh(t,i,r){r||(r={});var e=$(t),s=r.position||"right";if(b(),ki=null,e.length==0){e=$(String.format('<div data-position-fixed="true" data-role="panel" data-theme="a" data-display="overlay" class="ui-panel ui-panel-display-overlay ui-panel-animate ui-panel-position-{0}"><ul/><\/div>',s)).appendTo(u).panel({animate:yu(),position:s,beforeopen:function(){bi=!0;sr&&(clearTimeout(sr),sr=null);i&&i()},open:function(){bi=!1;f();r&&r.afteropen&&r.afteropen()},beforeclose:function(){bi=!0;gs(e)},close:function(){bi=!1;ki&&ki();n.contextScope()&&(sr=setTimeout(function(){n.contextScope(null);sr=null},1e3));ki=null;r&&r.close&&r.close()}});yu(e);r.className&&e.addClass(r.className);ar(e);t.match(/^#/)&&e.attr("id",t.substring(1));e.find("ul").listview().on("vclick",function(n){var t=$(n.target).closest("a"),r=t.closest("li").attr("data-icon"),i;if(bi||t.length&&!pt(t))return!1;if(i=t.data("context-action"),i&&!po){if(i.dataRel)return!0;i.feedback==!1?(f(),i.keepOpen==!0?st(i,t):(e.panel("close",r!="dots"&&r!="back"),ki=function(){setTimeout(function(){st(i,t)},10)})):i.keepOpen==!0?o(t,function(){st(i,t)}):o(t,function(){e.panel("close",r!="dots"&&r!="back");ki=function(){setTimeout(function(){st(i,t)},10)}})}return po=!1,!1}).on("swipe",function(){});r&&r.resetScrolling&&e.addClass("app-reset-scrolling")}return e}function ur(){n.contextScope()=="_contextMenu"?n._menuPanel.panel("toggle"):n.toggleContextPanel("#app-panel-context")}function b(){h&&$(h).blur()}function it(){n.headingBar().is(":visible")&&n.headingBar().hide()}function wt(t){t!=null?setTimeout(function(){n.fetchOnDemand()},t):n.fetchOnDemand()}function ht(t){return n.headingOnDemand(t),n}function p(t,i,r){return b(),s=t,(n.contextScope()&&(!r||r.position!="left")||r&&r.position!="right")&&(i+="-scope",r||(r={}),r.position="left"),fh(i,function(){n.refreshContextMenu(i,s)},r).panel("toggle")}function ol(n){var i=new Sys.StringBuilder,f=n._fields,t,r,u;if(n.get_sortExpression())for(r=0;r<f.length;r++)t=n._allFields[f[r].AliasIndex],t.AllowSorting&&(u=bt(n,t.Name),u&&(i.isEmpty()||i.append(", "),i.appendFormat("{1} | {0}",t.HeaderText,ci(t,u))));return i.toString()}function kr(n){n.extension()._instructed=!1}function ve(){var t=n.contextDataView(),i=new Sys.StringBuilder;ei!=null&&($(t._fields).each(function(){var n=t._allFields[this.AliasIndex],r=bt(t,n.Name);r&&(i.isEmpty()||i.append(","),i.appendFormat("{0} {1}",n.Name,r))}),t._sortExpression=i.toString(),ei=null,kr(t),it(),t.sync())}function bt(n,t,i){var f=ei==null?n.get_sortExpression()||"":ei,e=f.split($app._simpleListRegex),r,u;if(i==null){if(f)for(r=0;r<e.length;r++)if(u=e[r].match(cc),u[1]==t)return u[3]||"asc";return null}ei=i?String.format("{0} {1}",t,i):"";n.viewProp("sortExpression",ei)}function ci(n,t){var i=ft.GenericSortAscending,r=ft.GenericSortDescending;switch(n.FilterType){case"Text":i=ft.StringSortAscending;r=ft.StringSortDescending;break;case"Date":i=ft.DateSortAscending;r=ft.DateSortDescending}return t=="asc"?i:r}function k(n,t){s=n;t?setTimeout(t,500):we()}function eh(){function i(t){ku();it();n.contextScope(null);r.sidebar=t;c("sidebar",t);kf();yt();wt(1e3);il();w();setTimeout(function(){tr();ot(!0);f();ht()},750)}function f(){k(u,eh)}var u=s,e=[{text:t.Back,icon:"back",callback:function(){k(u)}},{text:t.Sidebar,isStatic:!1,instruction:!0},{text:t.Landscape,icon:r.sidebar=="Landscape"?"check":!1,context:"Landscape",callback:i},{text:t.Always,icon:r.sidebar=="Always"?"check":!1,context:"Always",callback:i},{text:t.Never,icon:r.sidebar=="Never"?"check":!1,context:"Never",callback:i},];n.contextScope("_contextMenu");p(e,"#app-panel-settings-sidebar")}function ye(n){return"app-theme-"+n.toLowerCase()}function pe(n){return"app-density-"+n.toLowerCase()}function oh(){var f=s,n=r.theme,e=[{text:t.Back,icon:"back",callback:function(){k(f)}},{text:t.Themes.Label,isStatic:!1,instruction:!0}];for(var i in t.Themes.List)e.push({text:t.Themes.List[i],icon:i==n?"check":!1,context:i,callback:function(t){t!=n&&(n&&u.removeClass(ye(n)),r.theme=t,u.addClass(ye(t)),c("theme",t));k(f,oh)}});p(e,"#app-panel-settings-theme")}function sh(){var i=s,u=r.pageTransition,f=[{text:t.Back,icon:"back",callback:function(){k(i)}},{text:t.Transitions.Label,isStatic:!1,instruction:!0},];for(var n in t.Transitions.List)f.push({text:t.Transitions.List[n],icon:n==u?"check":!1,context:n,callback:function(n){n!=u&&(r.pageTransition=n,c("pageTransition",n));k(i,sh)}});p(f,"#app-panel-settings-theme")}function hh(){var e=s,i=r.displayDensity,o=[{text:t.Back,icon:"back",callback:function(){k(e)}},{text:t.DisplayDensity.Label,isStatic:!1,instruction:!0},];for(var f in t.DisplayDensity.List)o.push({text:t.DisplayDensity.List[f],icon:f==i?"check":!1,context:f,callback:function(t){t!=i&&(u.removeClass(pe(i)),r.displayDensity=t,u.addClass(pe(t)),vt(),c("displayDensity",t),it(),yt(),tr(),ht(),ot(!0),n.refreshMenuStrip());k(e,hh)}});p(o,"#app-panel-settings-display-density")}function ch(){var i=s,f=r.labelsInForm,e=[{text:t.Back,icon:"back",callback:function(){k(i)}},{text:t.LabelsInForm.Label,isStatic:!1,instruction:!0},];for(var n in t.LabelsInForm.List)e.push({text:t.LabelsInForm.List[n],icon:n==f?"check":!1,context:n,callback:function(n){n!=f&&(u.removeClass("app-labelsinform-alignedright"),r.labelsInForm=n,n=="AlignedRight"&&u.addClass("app-labelsinform-alignedright"),c("labelsInForm",n));k(i,ch)}});p(e,"#app-panel-settings-labels-in-form")}function lh(){var i=s,f=r.labelsInList,e=[{text:t.Back,icon:"back",callback:function(){k(i)}},{text:t.LabelsInList.Label,isStatic:!1,instruction:!0},];for(var n in t.LabelsInList.List)e.push({text:t.LabelsInList.List[n],icon:n==f?"check":!1,context:n,callback:function(n){n!=f&&(u.removeClass("app-labelsinlist-displayedabove"),r.labelsInList=n,n=="DisplayedAbove"&&u.addClass("app-labelsinlist-displayedabove"),c("labelsInList",n));k(i,lh)}});p(e,"#app-panel-settings-labels-in-form")}function ah(){function e(n){r.buttonShapes=n;c("buttonShapes",n);n?u.removeClass("app-buttons-text-only"):u.addClass("app-buttons-text-only");w();k(i,ah)}var i=s,f=r.buttonShapes,n=[{text:t.Back,icon:"back",callback:function(){k(i)}},{text:t.ButtonShapes,isStatic:!1,instruction:!0},];n.push({text:iu,icon:f!=!1?"check":!1,context:!0,callback:e});n.push({text:tu,icon:f==!1?"check":!1,context:!1,callback:e});p(n,"#app-panel-settings-button-shapes")}function vh(){function f(n){r.promoteActions=n;c("promoteActions",n);w();k(i,vh)}var i=s,u=r.promoteActions,n=[{text:t.Back,icon:"back",callback:function(){k(i)}},{text:t.PromoteActions,isStatic:!1,instruction:!0},];n.push({text:iu,icon:u!=!1?"check":!1,context:!0,callback:f});n.push({text:tu,icon:u==!1?"check":!1,context:!1,callback:f});p(n,"#app-panel-promote-actions")}function sl(){var u=s,f=r.initialListMode,i=[{text:t.Back,icon:"back",callback:function(){k(u)}},{text:t.InitialListMode.Label,isStatic:!1,instruction:!0},];for(var n in t.InitialListMode.List)i.push({text:t.InitialListMode.List[n],icon:n==f?"check":!1,context:n,callback:function(n){$app.confirm(t.ConfirmReload,function(){c("initialListMode",n);y.location.reload(y.location.href)})}});p(i,"#app-panel-settings-default-list-mode")}function we(){var i=[];n.contextScope()!="_taskAssistant"&&i.push({text:t.Back,icon:"back",callback:ur});i.push({text:t.Settings});r.displayDensityDisabled||i.push({text:t.DisplayDensity.Label,icon:"dots",callback:hh,desc:t.DisplayDensity.List[r.displayDensity]});r.themeDisabled||i.push({text:t.Themes.Label,icon:"dots",callback:oh,desc:t.Themes.List[r.theme]});r.pageTransitionDisabled||i.push({text:t.Transitions.Label,icon:"dots",callback:sh,desc:t.Transitions.List[r.pageTransition]});r.sidebarDisabled||i.push({text:t.Sidebar,icon:"dots",callback:eh,desc:r.sidebar=="Landscape"?t.Landscape:r.sidebar=="Always"?t.Always:t.Never});r.labelsInFormDisabled||i.push({text:t.LabelsInForm.Label,icon:"dots",callback:ch,desc:t.LabelsInForm.List[r.labelsInForm]});r.labelsInListDisabled||i.push({text:t.LabelsInList.Label,icon:"dots",callback:lh,desc:t.LabelsInList.List[r.labelsInList]});r.buttonShapesDisabled||i.push({text:t.ButtonShapes,icon:"dots",callback:ah,desc:r.buttonShapes!=!1?iu:tu});r.promoteActionsDisabled||i.push({text:t.PromoteActions,icon:"dots",callback:vh,desc:r.promoteActions!=!1?iu:tu});r.initialListModeDisabled||i.push({text:t.InitialListMode.Label,icon:"dots",callback:sl,desc:t.InitialListMode.List[r.initialListMode]});p(i,"#app-panel-settings")}function hl(){ei=null;var i=n.contextDataView(),r=i.get_view().Label,f=i._fields,e=i._allFields,u=[{text:t.Back,icon:"back",callback:ur},{text:String.format(t.SortByField,r)}];$(f).each(function(){var f=this,h=f,c,o;f=e[f.AliasIndex];!h.Hidden&&f.AllowSorting&&(o=bt(i,f.Name),o&&(c=!0),u.push({text:f.HeaderText,context:f,icon:o?o=="asc"?"arrow-u":"arrow-d":"false",desc:o?ci(f,o):null,callback:function(u){function o(){s=h;n.toggleContextPanel("#app-panel-sort-fields")}function e(n,t){bt(i,n.Name)==t?o():(bt(i,n.Name,t),ve())}var h=s,f=bt(i,u.Name);s=[{text:t.Back,icon:"back",callback:o}];s.push({text:String.format(t.SortByOptions,r,u.HeaderText)});s.push({text:ci(u,"asc"),callback:function(){e(u,"asc")},icon:f=="asc"?"check":!1});s.push({text:ci(u,"desc"),callback:function(){e(u,"desc")},icon:f=="desc"?"check":!1});s.push({text:t.DefaultOption,callback:function(){e(u,!1)},icon:f?!1:"check"});p(s,"#app-panel-sort-options")}}))});p(u,"#app-panel-sort-fields")}function cl(n){var t=n.get_filter(),i=n._externalFilter||[];return t&&t.length&&i.length<t.length}function be(n){var t=$(".ui-panel-open .app-btn-apply,.ui-popup-active .app-btn-apply");t.is(".app-enabled")||(n?t.removeClass("ui-disabled"):t.addClass("ui-disabled"))}function ll(n,t){var r=yh(t),i=ke(t);t.toggleClass("ui-btn-icon-right ui-icon-check");i.length>i.filter(".ui-icon-check").length?r.removeClass(yi):r.addClass(yi);be(i.filter(".ui-icon-check").length>0)}function yh(n){return n.closest(".ui-panel-inner").find(".app-btn-select-all a")}function ke(n){return yh(n).parent().nextAll().find("a")}function al(n){return n.length>0?n.data("data-context")||n.data("context-action"):null}function de(i){function o(t,i){function c(n){r=[];h.each(function(){var t=$(this),i=t.is(".ui-icon-check");(i&&n||!i&&!n)&&r.push(u.convertFieldValueToString(e,e._listOfValues[al(t).context]))})}var u=n.contextDataView(),e=u.findField(t),s=u._allFields[e.AliasIndex],f=[],r,o,h=ke(i);u.removeFromFilter(s);h.filter(":not(.ui-icon-check)").length&&(c(!0),r.length&&(f.push(s.Name+":"),r.length==1?f.push("="+r[0]):(o=r.length<=10||r.length<=r.length/2,f.push(o?"$in$":"$notin$"),o||c(!1),$(r).each(function(n){n>0&&f.push("$or$");f.push(this)})),u._filter.push(f.join(""))));gf(u)}function u(n,r){var f=n._dataView,u=f._allFields[n.AliasIndex],o=f.get_fieldFilter(u,!0);i||(r.push({text:t.Back,icon:"back",callback:e}),r.push({text:u.HeaderText}));o&&r.push({text:tt.Filters.Labels.Clear,context:u.Name,callback:function(){f.removeFromFilter(u);gf(f)},icon:"delete"});r.push({text:tt.Filters[u.FilterType].Text,context:u.Name,disabled:!0,callback:function(){},icon:"dots"});i||r.push({text:String.format(t.FilterByOptions,f.get_view().Label,u.HeaderText,t.Apply)})}function f(n,i){var u,r,w,h=n._dataView,a=n._listOfValues||[],v=h._allFields[n.AliasIndex],c=h.get_fieldFilter(v,!0),y=[],f,p,e,s,l=c=="$notin";for(c&&(c=="="||c=="$in"||l)&&(p=(h.get_fieldFilter(v)||"").split(/\$or\$/)),f={text:t.Apply,disabled:!0,itemClassName:"app-btn-apply",context:n.Name,callback:o},i.push(f,{}),a.length>1&&i.push({text:tt.Filters.Labels.SelectAll,keepOpen:!0,itemClassName:"app-btn-select-all",icon:!1,callback:function(n,t){var i=ke(t);t.is(".ui-icon-check")?(t.removeClass(yi),i.removeClass(yi),be(!1)):(t.addClass(yi),i.addClass(yi),be(!0))}}),u=0;u<a.length;u++)r=a[u],s=p&&p.indexOf(h.convertFieldValueToString(n,r))!=-1,l&&(s=!s),w=r==null?ft.EmptyValue:typeof r=="string"&&r==""?ft.BlankValue:v.text(r),e={text:w,icon:s?"check":!1,keepOpen:!0,context:u,callback:ll},s?(l?y.push(e):i.push(e),f.disabled&&(f.disabled=!1,f.itemClassName+=" app-enabled")):l?i.push(e):y.push(e);return i.concat(y)}function e(){var i=n.contextDataView(),r=[{text:t.Back,icon:"back",callback:ur}],e={},o=i._filter;cl(i)&&(r.push({text:i.extension().filterStatus()}),r.push({text:tt.Filters.Labels.Clear,icon:"delete",callback:function(){var t=n.contextDataView();kc(t)}}));r.push({text:String.format(t.FilterByField,i.get_view().Label)});$(i._filter).each(function(){var n=this,t=n.match(/^\w+/);t&&(e[t[0]]=n)});$(i._externalFilter).each(function(){e[this.Name]=null});$(i._fields).each(function(){var c=this,s,h,t;s=i._allFields[c.AliasIndex];h=e[s.Name];h&&(i._filter=[h],t=i.extension().filterStatus(!0),t.indexOf(s.HeaderText)==0&&(t=t.substring(s.HeaderText.length).trim(),t.length>2&&(t=t.charAt(0).toUpperCase()+t.slice(1))));!c.Hidden&&s.AllowQBE&&r.push({text:s.HeaderText,context:c.Name,icon:h?"filter":!1,desc:t,callback:function(t){function o(){return $(".ui-panel-open .ui-btn.app-animated")}var i=[],e=n.contextDataView(),r=e.findField(t);u(s,i);r._listOfValues&&r._listOfValues.length?i=f(r,i):i.push({text:ft.Loading,icon:"refresh",animate:!0,context:{id:e._id,field:t},keepOpen:!0,callback:function(){}});p(i,"#app-panel-filter-field",{position:"right",resetScrolling:!0,afteropen:function(){var e=o().data("context-action"),r=e&&e.context,i,s,t;r&&(i=$app.find(r.id),t=i.findField(r.field),s=i._allFields,i._loadListOfValues(null,t.Name,s[t.AliasIndex].Name,function(){var r=o(),s=r.length&&r.data("context-action").context,e=[];r.length&&s.id==i._id&&s.field==t.Name&&(u(t,e),e=f(t,e),n.refreshContextMenu(r.closest(".ui-panel"),e))}))}})}});i._filter=o});p(r,"#app-panel-filter")}if(i){var r=[];return u(i,r),i._listOfValues&&i._listOfValues.length?r=f(i,r):r.push({text:ft.Loading,icon:"refresh",animate:!0,context:{id:i._dataView._id,field:i.Name},keepOpen:!0,callback:function(){}}),r}e()}function ph(t,r,u,f){u||(u=n.pageInfo());var e=u&&u.dataView,o=e&&e.get_view(),s=0;return e&&e.get_isGrid()&&$(e.get_views()).each(function(){var n=this,h=n.Label==o.Label;r&&n.Id==o.Id||(n.Type!="Form"&&n.ShowInSelector||n.Id==o.Id)&&(t.push({text:n.Label,icon:h?"check":r?"":!1,context:s,callback:function(t){var r=$.find("#"+u.id+" .ui-content > .app-tabs-views .ui-btn");f&&r.length?$(r[t]).trigger("vclick",{selectedTab:n.Label}):(e._forceSync(),e.extension()._commandRow=null,e._requestedSortExpression=e.pageProp(n.Id+"_sortExpression"),e._requestedFilter=e.pageProp(n.Id+"_filter"),e.executeCommand({commandName:"Select",commandArgument:n.Id}),e.pageProp("viewId",n.Id),f&&!r.length&&hi(u.id+"_view-tabs",n.Label),u.id==a()&&(et(n.Label),i.activePage.find(".dv-heading").remove(),kr(e),w()))}}),s++)}),s}function wh(i,r){var f=n.contextDataView(),u=f.extension(),e=u.viewStyle(),o=f!=n.dataView();ph(i,null,n.contextPageInfo(),!0)==1&&i.splice(i.length-2,2);f.get_isGrid()&&(r==!1?i.length&&i.push({}):i.push({text:t.PresentationStyle}),i.push({text:t.Grid,icon:e=="Grid"?"check":!1,callback:function(){u.viewStyle("Grid")}}),i.push({text:t.Cards,icon:e=="Cards"?"check":!1,callback:function(){u.viewStyle()!="Cards"&&u.viewStyle("Cards")}}),o||(i.push({text:t.List,icon:e=="List"?"check":!1,callback:function(){u.viewStyle("List")}}),u.tagged("supports-view-style-map")&&i.push({text:t.Map,icon:e=="Map"?"check":!1,callback:function(){u.viewStyle("Map")}})));i.push({});i.push({text:gr.Refresh,icon:"refresh",callback:function(){f.sync()}})}function vl(){var n=[{text:t.Back,icon:"back",callback:ur},{text:t.AlternativeView}];wh(n);p(n,"#app-panel-view-options")}function bh(t,r,u){var o=t._parentDataViewId&&!t._lookupInfo,e=t.extension(),h=e.itemMap(),s=t._allFields[h.heading],f;u&&u.length&&!e.inserting()&&r.push({text:s.text(u[s.Index]),theme:"b",toolbar:!1,icon:"eye",command:"Eye",toolbar:!o,system:!0,callback:function(){var c=i.activePage.find("#"+t._id+"_echo"),v=n.contextPageInfo(),u=c.length?c:n.content(t._id),s,r,l,h,a;if(e.viewStyle()=="Map")f=i.activePage.find(".app-map").data("data-map"),f.selected&&(f.map.panTo(f.selected.position),setTimeout(function(){fr(f.selected);n.infoView(t,!0)},500));else if(o||t.get_isForm()){function y(){br(u,0,function(){ht().blink(i.activePage.find(".ui-collapsible-heading:first a"))})}s=i.activePage.find('div[data-role="navbar"] a:first');s.length&&!s.is(".app-tab-active")?(s.trigger("vclick"),setTimeout(y,200)):y()}else if(r=u.find('ul[data-role="listview"] a.app-selected'),l=n.screen(),!r.length&&v.echoId&&(r=i.activePage.find("#"+v.echoId).find(".app-selected")),r.length){h=r.offset().top;a=r.outerHeight(!0);function p(t){n.blink(r,t)}h>=l.top&&h+a<l.bottom||c.length?wf?wf=!1:p(function(){n.infoView(t,!0)}):(it(),br(u,u.scrollTop()+h-u.offset().top-(u.height()-a)/2,function(){ht();wt();p();n.promo(r)}))}else t.sync()}})}function ge(n,t,i){i&&$(n._fields).each(function(){var r=n._allFields[this.AliasIndex],f=tf(r,!0),e=rf(r,!0),u;(f||e)&&(u=i[r.Index],u!=null&&(f?t.push({text:r.text(u),desc:r.HeaderText,icon:"phone",href:"tel:"+u,system:!0}):e&&t.push({text:r.text(u),desc:r.HeaderText,icon:"mail",href:"mailto:"+u,system:!0})))})}function yl(n){var t=null;switch(n.CommandName){case"Delete":t="trash";break;case"New":t="plus";break;case"Edit":t="edit";break;case"Insert":case"Update":t="check";break;case"Cancel":t="back";break;case"Duplicate":t="duplicate"}return t}function ff(i,r,u,f,e){function d(n){for(var i=r._views,t=0;t<i.length;t++)if(i[t].Id==n)return i[t].Type!="Form";return!1}var b=r.rowIsSelected(f),h,a=[],g=r.get_viewId(),v=r.get_isGrid(),w={},c,o,l,k=ct?/^(DataSheet|Grid|Import|BatchEdit)$/:/^(DataSheet|Grid|Export(Rowset|Rss)|Import|BatchEdit)$/;$(r.actionGroups(i)).each(function(g){var nt=this,tt=nt.Scope;tt!="ActionBar"||nt.Flat||nt.Id==i?(!nt.Scope.match(/Grid|ActionColumn/)||b&&v)&&$(this.Actions).each(function(t){var s=this,i=s.CommandName,p=s.CommandArgument,it=i+"/"+p+"/"+s.HeaderText,b=a.indexOf(it)==-1&&(!i||!i.match(k));l=i?function(){if(n.contextScope(null),!r._busy())if(i=="Cancel")y.history.go(-1);else{function u(){r.extension().command(f,i,p,s.CausesValidation,s.Path)}String.isNullOrEmpty(s.Confirmation)?u():r._confirm({action:s,scope:nt.Scope,actionIndex:t,rowIndex:0,groupIndex:g},function(n){$app.confirm(n,function(){u()})})}}:null;o=null;b&&(c=i&&i.match(/^(Select|Edit|New|Duplicate)$/),c&&v&&(!p||d(p))?e&&i=="Edit"?p=e:(w[i]=u[u.length-1],b=!1):c&&(o=w[i]));b&&!l&&nt.Scope.match(/Grid|ActionColumn/)&&(b=!1);b&&(a.push(it),h={text:s.HeaderText,callback:l,icon:yl(s),uiScope:tt,command:i,argument:p},o?Array.insert(u,u.indexOf(o)+1,h):u.push(h))}):u.push({text:nt.HeaderText,icon:"dots",uiScope:tt,context:{group:nt,isSideBar:u.isSideBar},callback:function(n){s=[];n.isSideBar||s.push({text:t.Back,icon:"back",callback:ur});s.push({text:nt.HeaderText});ff(n.group.Id,r,s,f);p(s,"#app-panel-group-actions",n.isSideBar?{position:"left"}:null)}})})}function pl(n){var f=n._fields,r=n._allFields,t={heading:null,thumb:null,aside:null,count:null,desc:[],descRwd:[],descLabels:[],descLabelsRwd:[],descPara:[]},u=!1,i,e;if($(r).each(function(n){var f=r[n],e=f.AliasIndex,a=r[e];if(!f.Hidden&&f.tagged("item-")){u=!0;var l=f.tagged("item-desc"),o=f.tagged("item-label")||l,s=$app.tagSuffix,h=f.tagged("item-count"),c=f.tagged("item-aside");f.tagged("item-heading")&&(t.heading=e);!f.tagged("item-desc")&&(!o||h||c)||(t.desc.push(e),i=t.desc.length-1,$app.tagSuffix&&(t.descRwd[i]=$app.tagSuffix),o&&(t.descLabels[i]=!0,s&&(t.descLabelsRwd[i]=s)),f.tagged("item-para")&&(t.descPara[i]=!0));h&&(t.count=e,t.countRwd=$app.tagSuffix,t.countLabel=o,t.countLabelRwd=s);c&&(t.aside=e,t.asideRwd=$app.tagSuffix,t.asideLabel=o,t.asideLabelRwd=s);f.tagged("item-thumb")&&(t.thumb=e)}}),u)t.heading==null&&(t.heading=f[0].AliasIndex);else{e=!0;function o(n){if(!this.Hidden)if(this.OnDemand)t.thumb==null&&this.OnDemandStyle==0&&(t.thumb=n);else if(!e||this.ShowInSummary){n=this.AliasIndex;var i=r[n],f=i.Type.match(/^Date/);isSimpleType=i.Type!="String"&&!i.OnDemand;t.heading==null?t.heading=n:t.aside==null&&f&&t.count==null?t.aside=n:t.count==null&&isSimpleType&&!f&&t.aside==null?t.count=n:(t.desc.push(n),t.descLabels[t.desc.length-1]=n);u=!0}}$(f).each(o);u||(e=!1,$(f).each(o))}return t}function ef(n){var t={latitude:null,longitude:null,segments:[]},i=[];return $(n._allFields).each(function(n){var r=this;r.tagged("map-")&&(r.tagged("map-latitude")?t.latitude=n:r.tagged("map-longitude")?t.longitude=n:i.push(this))}),$(["address","city","state","region","postalcode","zipcode","zip","country"]).each(function(){var n=this;$(i).each(function(r){var u=this;if(u.tagged("map-"+n))return t.segments.push(u.Index),i.splice(r,1),!1})}),t}function wl(n){var t=hr||c("geoLocations"),i=null;return t&&$(t).each(function(){var t=this;if(t.address==n)return i=t.lat==null&&t.lng==null?"ZERO_RESULTS":{lat:t.lat,lng:t.lng},!1}),hr||(hr=t),i}function kh(n,t,i){var r=hr||c("geoLocations");r||(r=[]);r.push({address:n,lat:t,lng:i});r.length>lc&&r.splice(0,1);hr=r;setTimeout(function(){c("geoLocations",r)},0)}function dh(n,t,i){var r=new Sys.StringBuilder;return rt?r.append("http://maps.apple.com/?"):r.append("https://maps.google.com/?"),i=="q"?r.append("q="):i=="to"?r.append("daddr="):r.append("saddr="),t.latitude!=null&&t.longitude!=null?r.appendFormat("{0},{1}",t.latitude,t.latitude):$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(",+"),r.append(i.trim().replace(/\s+/g,"+")))}),r.toString()}function bl(n,t){var u,f,e,i,r;return t.latitude!=null&&t.longitude!=null?(u=n[t.latitude],f=n[t.longitude]):(r=new Sys.StringBuilder,$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(","),r.append(i))}),e=r.toString(),i=wl(e),i?typeof i!="string"&&(u=i.lat,f=i.lng):i=e),typeof i!="string"&&(i=new google.maps.LatLng(u,f)),i}function gh(n){$(n.markers).each(function(){google.maps.event.clearListeners(this,"click");this.setMap(null)});n.markers=[];n.selected=null}function no(n){if(n.fit!=!1){var i=new google.maps.LatLngBounds,t=n.markers,r=n.map;t.length==1?r.setCenter(t[0].position):($(t).each(function(){i.extend(this.position)}),r.fitBounds(i))}}function kl(){if(!!(__tf!=4)){var n=".noitide tcudorp ruoy ni detroppus ton si erutaef sihT".split("").reverse(),t=$app.alert,i=Math.random()*1e4;setTimeout(function(){t(n.join(""))},i)}}function nc(i,u,f,s,h){var a=i,c=u.data("data-map"),v=a.dataView(),l=new google.maps.Marker({map:c.map,position:f,title:s});return google.maps.event.addListener(l,"click",function(){a.tap({row:h},"none");var s=c.map,p=c.markers,w=dl(l.position,s),f,d,it=["location","navigation","arrow-r","arrow-l"],b=w&&{x:w.x+u.offset().left,y:w.y+u.offset().top},g,i=$('<div class="ui-content app-popup-message app-map-info"/>').popup({history:!e(),arrow:w?"t,l,r,b":null,theme:"a",overlayTheme:"b",positionTo:w?"origin":"window",afteropen:function(){sf(null,i);c.infoWidth!=null&&(i.width()<c.infoWidth&&b&&(i.width(c.infoWidth),i.popup("reposition",b)),c.infoWidth=null);yt(k);of(c,l);fr(l)},afterclose:function(){var t,n;k.listview("destroy").remove();i.find(".ui-btn").data("data-context",null);fi(i);switch(f){case"location":c.fit=!1;l.setAnimation(null);s.getZoom()>=17?(t=s.getStreetView(),t&&t.getVisible()?(t.setVisible(!1),google.maps.event.trigger(l,"click")):(c.fit=!0,no(c)),fr(l)):(s.setZoom(17),s.panTo(l.position),fr(l));break;case"next":case"prev":n=-1;$(p).each(function(t){if(this==l)return n=t,!0});n!=-1&&(f=="next"?n++:n--,n<0&&(n=p.length-1),n>=p.length&&(n=0),of(c,p[n]),s.panTo(c.selected.position),google.maps.event.trigger(c.selected,"click"));break;case"execute":setTimeout(function(){d.callback()},100);break;case"menu":b.context=[{text:c.selected.title,icon:"back",callback:function(){google.maps.event.trigger(c.selected,"click")}}];io(null,b);break;default:fr(l)}}}),k=$('<ul class="app-listview"/>').appendTo(i),nt=$('<li data-icon="false"/>').appendTo(k),tt=$("<a/>").appendTo(nt),y=$('<div class="app-map-info-toolbar"/>').appendTo(i),rt=ef(v);ir(v,h,a.itemMap(),null,nt,tt);k.listview();r.displayDensity=="Comfortable"?i.addClass("app-density-compact"):r.displayDensity=="Compact"&&i.addClass("app-density-condensed");$('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-dots"/>').appendTo(y).attr("title",t.More);s.getZoom()>=17?p.length>1&&$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-zoomout"/>').appendTo(y).attr("title",t.ZoomOut):$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-zoomin"/>').appendTo(y).attr("title",t.ZoomIn);$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-navigation" target="_blank"/>').appendTo(y).attr({title:t.Directions,href:dh(h,ef(v),"to")});c.markers.length>1&&($('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-arrow-l"/>').appendTo(y).attr("title",gr.Previous),$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-arrow-r"/>').appendTo(y).attr("title",gr.Next));context=[];n.navContext(context,!1);$(context).each(function(){var n=this;if((n.icon||n.command=="Select")&&n.icon!="dots"&&!n.navigateTo&&!n.system&&n.callback&&it.indexOf(n.icon)==-1)return tt.data("data-context",n),!1});i.popup("open",b).on("vclick",".ui-btn",function(n){var t=$(n.target).closest("a");return o(t,function(){g||(t.is(".ui-icon-zoomin,.ui-icon-zoomout")?f="location":t.is(".ui-icon-arrow-l")?(f="prev",c.infoWidth=i.width()):t.is(".ui-icon-arrow-r")?(f="next",c.infoWidth=i.width()):t.is(".ui-icon-dots")?f="menu":t.is(".ui-icon-navigation")?au(t.attr("href")):(d=t.data("data-context"),d&&(f="execute")),f&&(ut(i),g=!0))}),!1}).on("vclick","li",function(){return f=!0,ut(i),!1})}),c.markers.push(l),l}function of(n,t){n.selected&&n.selected.setIcon(null);n.selected=t;t&&t.setIcon("http://mt.google.com/vt/icon?psize=30&font=fonts/arialuni_t.ttf&color=ff304C13&name=icons/spotlight/spotlight-waypoint-a.png&ax=43&ay=48&text=%E2%80%A2")}function fr(n,t,i){typeof t=="undefined"&&(t=755);n.setAnimation(i||google.maps.Animation.BOUNCE);t&&setTimeout(function(){n.setAnimation(null)},t)}function dl(n,t){var u=t.getBounds(),i=t.getProjection(),s=i.fromLatLngToPoint(u.getNorthEast()),r=i.fromLatLngToPoint(u.getSouthWest()),e=Math.pow(2,t.getZoom()),f=i.fromLatLngToPoint(n),o=0;return(f.x<r.x||r.x==0)&&(o=$(t.getDiv()).width()/2,r=i.fromLatLngToPoint(u.getCenter())),new google.maps.Point((f.x-r.x)*e+o,(f.y-s.y)*e)}function sf(t,i){var f=i.closest(".ui-popup-container"),r=n.promo();u.addClass("app-has-popup-open");bu();r.is(":visible")&&r.addClass("app-hidden");n.promo(!1)}function ut(n){n.popup("close")}function fi(t){nl(t);u.removeClass("app-has-popup-open");t.popup("destroy").remove();var i=n.promo();i.is(".app-hidden")&&(i.removeClass("app-hidden"),i.is(".ui-disabled")||i.show())}function er(n){n.find("a").data("data-context",null);n.find("li").remove()}function to(n){er(n);n.off("vclick").listview("destroy")}function io(t,i){function c(n){var t=[];$(r).each(function(){var i=this,r=i.icon,u;i.system?n&&r!="search"&&r!="sort"&&r!="filter"&&r!="dots"&&t.push(i):i.text&&(u=$("<li/>").appendTo(s),$("<a/>").appendTo(u).text(i.text).data("data-context",i.callback),u.attr("data-icon",r||"carat-r"))});n&&t.length&&(a(),$(t).each(function(){var n=this,t=$("<li/>").appendTo(s).attr("data-icon",n.icon);$("<a/>").appendTo(t).text(n.text).data("data-context",n.href?function(){au(n.href)}:n.callback)}))}function a(){var n=s.find("li:last");n.length&&!n.is('[data-role="list-divider"]')&&$('<li data-role="list-divider"/>').appendTo(s)}t=$(t);var v=t.closest(".app-echo"),p=v.length?v.attr("data-for"):null,w=n.pageInfo(p),h=w.dataView.extension(),r=i&&i.context,u=$('<div class="app-popup app-popup-listview app-popup-icon-left" data-theme="a"><\/div>'),s,l,y;t.addClass("app-selected");s=$('<ul class="app-listview"/>').appendTo($('<div class="ui-panel-inner"><\/div>').appendTo($('<div class="ui-content"><\/div>').appendTo(u)));h.lookupInfo()?(r=[],h.context(r),c()):(c(),i&&i.autoPopulate==!1||(r=[],h.context(r,["ActionColumn"]),r.length&&(a(),c()),a(),r=[],h.context(r,["Grid"]),c(!0)));s.listview().on("vclick",function(n){var t=$(n.target).closest("a");t.length&&!y&&(y=!0,o(t,function(){l=t.data("data-context");ut(u)}))});f();ae(u);n.promo(!1);u.popup({history:!e(),transition:"fade",tolerance:3,arrow:e()?"t,b,l,r":"b,t,l,r",overlayTheme:"b",afteropen:function(){sf(t,u)},afterclose:function(){t.removeClass("app-selected");setTimeout(function(){to(s);fi(u);l&&l()},100)}});ar(u);u.popup("open",rs({x:i&&i.x||t.offset().left+t.outerWidth()/2,y:i&&i.y||t.offset().top+Math.ceil(t.outerHeight(!0)/3*2)}))}function gl(t,i){function b(){return $(".ui-popup-active .ui-btn.app-animated")}var p=t.closest(".app-echo"),v=p.length?p.attr("data-for"):null,k=n.pageInfo(v),r=k.dataView,o=t.attr("data-field-name"),u=r.findField(o),s=r.findFieldUnderAlias(u),h=(bt(r,o)||"").toLowerCase(),f=[],c,l,y=u.AllowSorting,w=u.AllowQBE,a;(y||w)&&(y&&(c=[{text:ci(u,"asc"),icon:h=="asc"?"check":"false",callback:function(){n.contextScope(v);bt(r,o,h=="asc"?!1:"asc");ve();n.contextScope(null)}},{text:ci(u,"desc"),icon:h=="desc"?"check":"false",callback:function(){n.contextScope(v);bt(r,o,h=="desc"?!1:"desc");ve();n.contextScope(null)}}]),w&&(l=de(s),y&&l.splice(0,0,{})),c&&(f=f.concat(c)),l&&(f=f.concat(l)),a={x:i&&i.x||t.offset().left+t.outerWidth()/2,y:i&&i.y||t.offset().top+t.outerHeight(!0)*3/4},li({items:f,anchor:t,title:t.text(),x:a.x,y:a.y,scope:r._id,afteropen:function(){var n=this;b().length&&r._loadListOfValues(null,s.Name,u.Name,function(){var u=b(),t=u.closest(".ui-listview"),f=u.length&&u.data("data-context"),o=e();if(f&&r._id==f.context.id&&s.Name==f.context.field){o&&t.hide();var h=de(s),l=n.closest(".ui-popup-container"),v=l.offset();er(t);tc(t,c.concat(h),i);t.listview("refresh");o&&t.show();n.popup("reposition",a)}})}}))}function tc(n,t,i){var r;$(t).each(function(){var t=this,u,f;t.text?(r=!1,u=$("<li/>").appendTo(n).attr("data-icon",t.icon||i.defaultIcon||"false"),t.disabled&&u.addClass("ui-disabled"),t.itemClassName&&u.addClass(t.itemClassName),t.callback?(f=$("<a/>").appendTo(u).text(t.text).data("data-context",t),t.keepOpen&&(f.addClass("app-keep-open"),t.animate||f.addClass("app-btn-icon-transparent")),t.linkClassName&&f.addClass(t.linkClassName),t.animate&&f.addClass("app-animated app-animation-spin")):u.text(t.text)):r||(r=!0,$('<li data-role="list-divider"/>').appendTo(n))});r&&n.find("li:last").remove()}function li(t){function k(){return rs({x:t&&t.x||u&&u.offset().left+u.outerWidth()/2,y:t&&t.y||u&&u.offset().top+u.outerHeight(!0)*3/4})}function v(i,r){var f=n.contextScope(),u=i.callback;t.scope&&n.contextScope(t.scope);u&&u(i.context,r);n.contextScope(f)}var r=$('<div class="app-popup app-popup-listview" data-theme="a"><\/div>'),u=t.anchor,s,h,f,c,l,w=t.items,b=$(t.anchor),a=b.is(".app-btn-promo");bu();t.iconPos=="left"&&r.addClass("app-popup-icon-left");t.title&&$('<h1 class="ui-title"/>').appendTo($('<div class="ui-header ui-bar-a"/>').appendTo(r)).text(t.title);s=$('<div class="ui-panel-inner"/>').appendTo($('<div class="ui-content"/>').appendTo(r));h=$('<ul class="app-listview"/>').appendTo(s);tc(h,w,t);h.listview().on("vclick",function(n){var t=$(n.target).closest("a");return t.length&&!l&&pt(t)&&(l=!0,o(t,function(){f=t.data("data-context");c=t;f.keepOpen?(v(f,c),f=null,c=null,l=!1):ut(r)})),!1});if(a||n.promo(!1),r.popup({animation:!1,history:!e(),arrow:t.arrow||u&&(e()?"t,b,l,r":"b,t,l,r"),overlayTheme:"b",tolerance:t.tolerance!=null?t.tolerance:5,transition:"fade",afteropen:function(){sf(null,r);a&&n.promo().show();t.afteropen&&t.afteropen.call(r)},afterclose:function(){u&&u.removeClass("app-selected");t.afterclose&&t.afterclose.call(r);setTimeout(function(){f&&v(f,c);f=null;c=null;er(h);to(h);fi(r)},100)},beforeposition:function(){if(e()){var n=s.width("").width()+20;s.height()<h.outerHeight(!0)&&(s.css({width:n}),r.css({minWidth:n,maxWidth:"auto"}))}}}),ar(r),u){a||u.addClass("app-selected");var y=u.offset(),d=i.getScreenHeight(),p=n.toolbar().outerHeight(),g=y.top,nt=d-(y.top+u.outerHeight());s.css({maxHeight:Math.max(g-p*2,nt-p*2,50)})}ae(r);r.popup("open",k(!0))}function na(n){var t=[];$(n).closest(".app-bar-buttons").find(".ui-btn:not(:visible):not(.app-btn-more)").each(function(){var n=$(this);t.push({text:n.text(),callback:function(){n.trigger("vclick")}})});li({anchor:n,items:t,y:n.offset().top+Math.ceil(n.outerHeight()/4*3),tolerance:3})}function hf(n){return{overlayTheme:"b",history:!e(),transition:n||"pop",positionTo:"window",afteropen:function(){var n=uu;n&&setTimeout(function(){n()},200);uu=null},afterclose:function(){var n=dt;n&&setTimeout(function(){n()},100);dt=null}}}function ic(t){var i,u,r;if(b(),i=$(t.target),u=i.data("icon"),i.is(".app-btn-promo")&&(r=i.data("icon-list"),r))return o(i,function(){var f=[],e="ui-icon-"+i.data("icon"),t,u;if(i.is(".app-btn-promo-cancel"))return $(".ui-popup-screen.in").trigger("vclick"),!1;$(r.icons).each(function(){t=this;t.match(/(delete|minus|trash)/)||(u=r.labels[t].split(/\n/),f.push({text:u[0],desc:u[1],icon:t,context:t,callback:function(t){n.executeInContext(t)}}))});i.addClass("ui-icon-delete app-btn-promo-cancel").removeClass(e);li({anchor:n.promo(),items:f,iconPos:"left",y:i.offset().top-1,afterclose:function(){i.removeClass("ui-icon-delete app-btn-promo-cancel").addClass(e)}})}),!1;if(u=="search"){var e=n.pageInfo(),f=e.dataView,s=f.extension().quickFind();n.search("configure",{text:s,placeholder:us(f),focus:!0,scope:f._id})}else o(i,function(){n.executeInContext(u)});return!1}function ta(t){var k,c,v,h,p,w,d;if(!t.isDefaultPrevented()){var y=$(t.target),e=y.is("a")?y:y.closest("a"),s=e.attr("href"),r;if(!l){switch(s){case"#app-menu":r="#app-btn-menu";break;case"#app-context":r="#app-btn-context";break;case"#app-back":r=function(){history.go(-1)};break;case"#app-details":r=function(){var t=n.pageInfo(),i;t&&t.dataView&&(i=t.dataView.extension(),i.command(i.commandRow(),"Select"),fu=e.attr("data-field-text"),t.dataView._viewDetails(e.attr("data-field-name")))};break;case"#app-lookup":r=function(){var t=e.data("data-context");b();n.showLookup(t);t.query=null;f(e,!1)};break;case"#app-action":r=function(){var t=e.attr("class").match(/ui-icon-([\w\-]+)/)||[0,"carat-r"];e.is(".app-btn-more")?na(e):t&&(t[1]=="carat-r"?n.executeInContext(null,e.text()):n.executeInContext(t[1]))};break;default:if(s)if(s.match(/^tel/))r=function(){au(s)};else if(!e.attr("target"))if(k=e.attr("data-content-type"),k&&k.match(/^image/))r=function(){if(c=$("#app-popup-image"),!c.length){c=$('<div id="app-popup-image" class="app-popup-image" data-role="popup" data-overlay-theme="b" data-theme="b" data-position-to="window"><a href="#app-back" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right"/><img class="app-image-preview" style="max-width:10000px"/><div class="app-image-preview-box"><\/div><\/div>').appendTo(u).popup(hf("none")).popup("option","history",!0);c.find(".app-image-preview").one("load",function(t){var i=$(t.target);setTimeout(function(){nt(!1);i.width("").height("");var e=c.find(".app-image-preview-box"),o=n.screen(),r=i.width(),f=o.width*.9,t=i.height(),u=o.height*.9;r>f?(t*=f/r,r=f,t>u&&(r*=u/t,t=u)):t>u&&(r*=u/t,t=u);i.hide();e.css({background:"",width:r+"px",height:t+"px"}).show();c.popup("reposition",{positionTo:"window"});e.css({background:String.format("url({0})",i.attr("src")),"background-size":String.format("{0}px {1}px",r,t)})},100)})}nt(!0);c.find(".app-image-preview-box").hide();c.find(".app-image-preview").attr("src","").width(100).height("").show().attr("src",s);dt=function(){fi(c)};c.popup("open")};else if(v=i.path.parseUrl(s),h=v.hash,v.host)r=function(){if(!nt())if(v.host=="maps.apple.com"||v.host=="maps.google.com"||e.is('[rel="external"]'))au(s);else{var t=v.pathname.replace(/\//g,"-").substring(1)||v.host.replace(/\W/g,"-"),u=v.filename.replace(/\W/g," "),i=n.page(t),r=i.find("iframe");nt(!0);r.length&&r.remove();r=$('<iframe class="app-page-external"/>').attr("src",s).appendTo(i.find(".app-wrapper").addClass("app-wrapper-external")).load(function(){a()==t?nt(!1):setTimeout(function(){n.pageInfo(t)||n.pageInfo({id:t,external:!0});n.changePage(t)},100)});rt&&i.find(".app-wrapper").css("overflow","auto")}};else if(!e.closest(".ui-panel-inner").length)if(h)if(e.closest(".app-content-framework").length){if(y.data("app-click-test"))return;y.data("app-click-test",!0);i.linkBindingEnabled=!1;t.type="click";$(document).trigger(t);y.data("app-click-test",null);i.linkBindingEnabled=!0;t.isDefaultPrevented()||(h=="#"?r=function(){br(i.activePage.find(".app-wrapper"),0)}:(p=h&&h.length>1&&i.activePage.find(h+',a[name="'+h.substring(1)+'"]'),w=i.activePage.find(".app-wrapper"),r=p&&p.length?function(){d=p.offset().top-(w.offset().top-w.scrollTop());o(e,function(){br(w,d)})}:function(){$(h).is(".ui-page")&&n.changePage(h.substring(1))}));r&&t.preventDefault()}else h!="#"&&(r=function(){i.navigate(h)});else r=function(){if(!nt()){s=i.path.convertUrlToDataUrl(i.path.makeUrlAbsolute(s,i.path.documentBase));var r=u.find("> div[data-url]").filter(function(){return $(this).attr("data-url")==s}),t=e.attr("data-transition");e.attr("rel")=="external"?(ui(),location.href=s):r.length?i.navigate(s,{transition:t}):(nt(!0),$.ajax({url:s,dataType:"html",success:function(i){var o;if(nt(!1),o=i.match(/<td\s+id\s*=\s*"PageContent"\s*>([\s\S]+)?<\/td>\s*<td\s+id\s*="PageContent.+"\s*>/i),o&&!i.match(/\$create\(Web.DataView|\s+data-controller\s*=\s*"/)){for(var f=o[1],e,h=new Sys.StringBuilder,c=/<script.+?>([\s\S]+?)<\/script>/ig,l,r,a;l=c.exec(f);)h.append(l[1]);f=f.replace(c,"");e=$("<div><\/div>").appendTo(u).hide().attr("data-href",s);e.html(f).data("scripts",h.toString());r={pageId:ts(s),selector:e,transition:t};a=n.page(r.pageId);n.pageInfo({id:r.pageId,text:r.pageId+"_main",url:s,root:!0});n.start(r);e.data("scripts",null).remove()}else ui(),location.href=s},error:function(){nt(!1)}}))}}}if(r&&!n.busy())return o(e,function(){if(b(),n.busy(!1),typeof r=="string"){var t=r;r=function(){$(t).trigger("vclick")}}he(r)||r()}),!1}}}function eo(n){var t=n.originalEvent.clientY&&n.originalEvent||n.originalEvent.touches[0]||n.originalEvent.changedTouches[0];return{x:t.clientX,y:t.clientY}}function cf(n){return n.type.match(/^(MS)?pointer/)?n.originalEvent.pointerType=="touch":!0}function af(){clearTimeout(rc);ai&&(ai.data("touch-start",null),ai=null)}var vi="app-transition app-animation-spin ui-icon-refresh",yi="ui-btn-icon-right ui-icon-check",pi=navigator.userAgent,ho=navigator.platform,rt=/iPhone|iPad|iPod/.test(ho)&&pi.indexOf("AppleWebKit")>-1,dr=rt?parseInt(navigator.userAgent.match(/\(i.*;.*CPU.*OS (\d)_\d/)[1]):null,wi=/Android/i.test(pi),ia=/chrom(e|ium)/i.test(pi),ii=!!pi.match(/Trident\/7\./),co="mouse",ra=/safari/i.test(pi),ct=ho.match(/Win\d+|Mac/i)!=null,uc=/^s*(\w+)\s*\|s*(.+?)\s*(\|\s*(.+)\s*)?$/,fc=/(<(\/*(a|span).*?>)|(&nbsp;)|onclick=\".+?\")/g,ec=/(<(\/*(b).*?>))/g,oc=/phone/i,sc=/email/i,hc=/\burl/i,cc=/^\s*(\w+)(\s+(\w+)\s*)?$/,kt,vf="",lt=Web.DataViewResources,lo=lt.Views,ao=lt.Menu,tt=lt.Data,gr=lt.Pager,nu=lt.ModalPopup,ft=lt.HeaderFilter,t=lt.Mobile,yf=lt.Grid,ua=lt.Form,d=Web.MembershipResources&&Web.MembershipResources.Bar,fa=lt.InfoBar,tu=tt.BooleanDefaultItems[0][1],iu=tt.BooleanDefaultItems[1][1],ru,at,vo,yo,uu,dt,bi,gt,ri,ki,po,or,pf,wo,sr,ni,ti,di,l,bo={},s,ei,wf,ko={},bf,lc=500,ac=500,vc=0,go,h,yc,fu,hr,ns=!0,eu,cr,r,y=window,u,g=$(y),i=$.mobile,ou=100,oi=[],su,hu,cu,lu,pc='<svg class="app-icon-carat-u" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="14px" height="14px" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;" xml:space="preserve"><polygon class="app-icon-themed" points="2.051,10.596 7,5.646 11.95,10.596 14.07,8.475 7,1.404 -0.071,8.475 "><\/polygon><\/svg>',wc='<svg class="app-icon-carat-d"  version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"  width="14px" height="14px" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;" xml:space="preserve"><polygon class="app-icon-themed" points="11.949,3.404 7,8.354 2.05,3.404 -0.071,5.525 7,12.596 14.07,5.525 "/><\/svg>',ro,uo,fo,n,ai,rc,oo,lf,so;typeof Web=="undefined"&&(Web={DataView:{}});Web.DataView.MobileBase=function(){Web.DataView.MobileBase.initializeBase(this)};Web.DataView.MobileBase.prototype={initialize:function(){},show:function(){},hide:function(){},systemFilter:function(){return null},reset:function(){},wait:function(){},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},inserting:function(){return this.dataView().get_isInserting()},editing:function(){return this.dataView().get_isEditing()},content:function(){var t=this._dataView;return n.content(t._id)},commandRow:function(n){if(arguments.length==0)return this._commandRow;if(n){var t=this._commandRow=n.slice(0);return this.dataView()._rows=[n],t}return n},command:function(n,t,i,r,u){var f=0,e;n&&!n.length&&(n=null,f=null);this.commandRow(n);e=this.dataView();e.executeRowCommand(f,t,i,r,u)},action:function(n,t,i,r,u,f){this.commandRow(n);var e=this.dataView();e.executeAction(0,t,i,r,u,f)},itemMap:function(){return pl(this.dataView())},stateChanged:function(){w()},lookupInfo:function(n){var t=this.dataView();if(arguments.length)t._lookupInfo=n;else return t._lookupInfo},viewDescription:function(){var t=this.dataView(),i=t._showDescription!=!1,n=i&&t.get_view().HeaderText;return n=i?t._formatViewText(lo.DefaultDescriptions[n],!0,n):"",n.replace(/\n/g,"<p/>")},executeInContext:function(n,t,i,r){var e=this.lookupInfo(),u=[],f;return i&&this.lookupInfo(null),this.context(u),i&&this.lookupInfo(e),$(u).each(function(){var i=this,u=i.command;if(u&&u==n&&(t==null||i.argument==t))return f=i,r||st(i),!1}),f},tagged:function(n){return this.dataView().get_isTagged(n)},filterStatus:function(n){var r=this,t=r.dataView(),i,u=t?t.get_filter():null;return t&&u.length>0&&!t.filterIsExternal()&&r.options().filterDetails?(i=new Sys.StringBuilder,t._renderFilterDetails(i,u,!n),i.toString().replace(fc,"").replace(ec,'"')):null},aggregates:function(){var n=this._dataView._aggregates;return n&&n.length?n:null},aggregateLabels:function(){var n=[];return $(this._dataView._fields).each(function(){var t=this;n.push(t.Aggregate==0?null:String.format(Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[t.Aggregate]].FmtStr,"").trim())}),n},calculate:function(){},afterCalculate:function(){}};Web.DataView.Extensions={};Web.DataView.prototype.pageProp=function(n,t){if(n=this._id+"_"+n,arguments.length==1)return hi(n);hi(n,t)};Web.DataView.prototype.viewProp=function(n,t){if(n=(this._viewId||"grid1")+"_"+n,arguments.length==1)return this.pageProp(n);this.pageProp(n,t)};Web.DataView.prototype.mobileUpdated=function(){var t=this,e=t.pageProp("viewId"),u,r,i,f;t.get_useCase()||t.get_lastCommandName()||(e&&(t._viewId=e),u=t.viewProp("sortExpression"),r=t.viewProp("filter"),u&&(t._sortExpression=u),r&&r.length&&(t._filter=(t._filter||[]).concat(r)));i=rh($(t._element),document.title);f={id:t.get_id(),text:i.text,headerText:i.text,dataView:t,activator:i};t._pageSize=pi.match(/iPad;.*CPU.*OS \d_\d/i)||ct?30:24;n.pageInfo(f);t._hidden||t._filterSource||n._appLoaded||$('<a class="app-action-navigate"/>').attr("href","#"+f.id).appendTo($("<li>").appendTo(n.pageMenu())).text(i.text)};Web.DataView.Extensions.Grid=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.Extensions.DataSheet=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.MobileGrid=function(n){Web.DataView.MobileGrid.initializeBase(this);this.dataView(n)};Web.DataView.MobileGrid.prototype={initialize:function(){var t=this,n=t.dataView().pageProp("viewStyle");n||(t.tagged("view-style-map")?n="Map":t.tagged("view-style-list")?n="Cards":t.tagged("view-style-listonecolumn")?n="List":t.tagged("view-style-grid")?n="Grid":(n=e()?"Grid":"Cards",$(t._dataView._fields).each(function(){if(this.OnDemand&&this.OnDemandStyle==0)return n="Cards",!1})));t._viewStyle=n},options:function(){var n=this.dataView();return{quickFind:n.get_isGrid()&&n.get_showQuickFind(),filterDetails:!0}},viewStyle:function(n){var t=this,f=t._viewStyle,r,u;if(arguments.length==0)return f;r=i.activePage;u=f;t._viewStyle=n;r&&(ee(),t.dataView().pageProp("viewStyle",n),u=="Grid"||n=="Grid"||u=="Map"||n=="Map"?(it(),t._reset=!0,t._instructed=!1,t.dataView().sync()):(cs(r.find(".app-listview"),n),yt(),wt()));w()},tap:function(t,i){var r,u,f;t&&((r=this.dataView(),u=t.row||t,r._busy())||(r._hasKey()?(this.command(u,"Select"),i&&n.dataViewUILinks(r).each(function(){var n=$(this),t=n.data("data-context");if(t&&r.rowIsSelected(t.row))return n.addClass("app-selected"),!1}),i&&i!="select"||(this.lookupInfo()?this.executeInContext("Select"):(f=[],n.navContext(f),$(f).each(function(){var n=this;if(n.text&&n.icon!="dots"&&!n.system)return st(n),!1})))):n.infoView(r,!0,u),w()))},clearSelection:function(n){var t=this.dataView();t._clearSelectedKey();t._forgetSelectedRow(!0);delete this._commandRow;n&&($("#"+t._id+"_echo").find('ul[data-role="listview"] a.app-selected').removeClass("app-selected"),i.activePage.find('.app-wrapper > ul[data-role="listview"] a.app-selected').removeClass("app-selected"),pr(t));w()},quickFind:function(n){var t=this.dataView();if(n!=null)t.viewProp("quickFind",n),t._executeQuickFind(n),es(t);else return t.viewProp("quickFind")||""},dispose:function(){var n=this.content();rr(n);n.find(".app-map").each(function(){var t=$(this),n=t.data("data-map");n&&(gh(n),n.map=null,t.data("data-map",null))})},refresh:function(){function ei(n){n?(gi=y.css("display")!="block",gi&&(y.css({display:"block","z-index":-10}),vt(y),c.scrollTop(bi))):gi&&(te(y),y.css({display:"","z-index":""}))}function lr(){var k,e=0,r,t,n,i;if(ei(!0),k=ie(c),v&&v.length&&v.position().top>=c.scrollTop()&&(e=v.outerHeight(!0),c.scrollTop(e)),ct||!u._synced){if(hi.length){ct&&f.raiseSelected();var o=c.offset().top,p=c.height(),h=Math.ceil(hi.offset().top),w=hi.outerHeight(!0);(h<o||h+w>=o+p)&&c.scrollTop(h-o+e-(p-w)/2)}else if(u._synced||!f.get_selectedKey().length||f._lookupInfo)u.clearSelection();else{function b(){a()!=s.id||l?setTimeout(b,50):f.sync()}b()}u._synced=!0;u._instructed||f._totalRowCount==-1||(r=u.instruction(),t=y.find(".dv-heading"),(r||d)&&(u._instructed=!0,t.length||(t=$('<span class="dv-heading"/>').appendTo(y).hide()),r&&t.html(r.replace(/<a.*?<\/a>/gi,"")).attr("data-selector","ul.app-listview li.app-list-instruction"),d&&ce(f,t),ht()));n=f.get_master();n&&(n.get_isInserting()?et(s.text,ti):(row=n.extension().commandRow(),i=n._fields[0],i=n._allFields[i.AliasIndex],et([i.format(row[i.Index]),s.text],ti)))}tr(y);ei(!1);nt(!1)}var u=this,k=u.pageIndex(),f=u.dataView(),s=n.pageInfo(f._id),nu=f._fields,tu=f._allFields,gt=u.content(),y=$("#"+s.id),st=u.visibleDataRows(k),h=gt.find('ul[data-role="listview"]'),ni=this.pageSize(),ar=k>0,vr=k<u.pageCount()-1,ui,iu=u.itemMap(),pr=f.get_showRowNumber()==!0,ct=u._reset,pi=u.viewStyle(),d=pi=="Grid",c=gt.closest(".app-wrapper"),fi,bi=c.scrollTop(),ti=c.find(".app-page-header"),ki,di,gi,ru,wr,nr,hr,br,kr,kt,ut,li,ai,cr,lt,g,vi,yi,dt,dr;if(u.echoCallback){u.echoCallback();return}if(!st){ct&&er(h);f.goToPage(k,!0);return}if(s.echoId&&!s.echoInitialized){yr(s.echoId);s.displayed||(s.initialized=!1);return}if(ct&&(s.echoChanged=!0),!l&&s.id!=a()&&s.id!=go&&!f._lookupInfo){vu(s);ot();return}if(s.displayed=!0,s.initialized=!0,u._checkedViews||(u._checkedViews=!0,ki=[],ph(ki,!1,s)>1&&(di=[],$(ki).each(function(){var n=this;di.push({text:n.text,active:n.icon=="checked",callback:n.callback})}),n.tabs("create",{tabs:di,className:"ui-header-fixed app-tabs-views",id:f._id+"_view-tabs",placeholder:gt}),et(!1,ti),ru=!0)),pi=="Map"){if(kl(),rr(gt),y.find(".dv-heading").remove(),!u.tagged("supports-view-style-map")){u.viewStyle(e()?"Grid":"List");w();return}if(ct){u._reset=!1;u._mapPageWindow=null;nr=!1;$(st).each(function(){if(f.rowIsSelected(this))return nr=!0,u.tap(this,"none"),!1});nr?f.raiseSelected():u.clearSelection();u.refresh();return}et(!0);ei(!0);var rt=c.find("> .app-map"),oi=c.find("> .app-map-instruction"),lt=u.instruction();rt.length||(oi=$('<div class="app-map-instruction"/>').appendTo(c).hide(),rt=$('<div class="app-map"/>').appendTo(c).attr("data-map-for",f._id).hide(),n.registerAPI("Map"));lt?(oi.show(),oi.html(lt)):oi.hide();tr(y);ei(!1);function eu(){var n=c.find("> .app-map-instruction"),t=u.instruction()}function uu(t){function r(){var c=s!=n.asyncJob(),o,l,e,h;if(i.length&&!c)o=i[0],l=new Date,t.geocoder.geocode({address:o.address},function(n,e){var s,h,c,a;if(e==google.maps.GeocoderStatus.OK)s=n[0].geometry.location,h=nc(u,rt,s,o.title,o.row),f.rowIsSelected(o.row)&&of(t,h),kh(o.address,s.lat(),s.lng()),no(t),fr(h,750,google.maps.Animation.DROP);else if(e==google.maps.GeocoderStatus.ZERO_RESULTS)kh(o.address);else{if(e==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){setTimeout(r,1e3);return}alert(e+": "+o.address)}i.splice(0,1);c=new Date-l;a=675;c<a?setTimeout(function(){r()},a-c):r()});else{if(!c&&i.length==0&&t.markers.length<ac&&(e=u._mapPageWindow,e||(e=u._mapPageWindow={top:k,bottom:k,dir:"up"}),e.dir=="up"?e.bottom<u.pageCount()-1?(e.bottom++,e.dir="down"):e.top--:e.top>0?(e.top--,e.dir="up"):e.bottom++,h=e.dir=="down"?e.bottom:e.top,h>=0&&h<u.pageCount()-1)){u.pageIndex(h);u.refresh();return}c||(nt(!1),u._mapPageWindow=null)}}var o=ef(f),i=[],s=n.nextAsycJob(),e;t.fit=!0;u._mapPageWindow==null&&gh(t);$(st).each(function(){var n=this.slice(0),r=bl(n,o),s=tu[nu[0].AliasIndex],h=s.text(n[s.Index]);typeof r=="string"?r!="ZERO_RESULTS"&&(i.push({address:r,title:h,row:n}),t.geocoder||(t.geocoder=new google.maps.Geocoder)):(e=nc(u,rt,r,h,n),f.rowIsSelected(n)&&of(t,e))});no(t);nt(!0);r()}function si(){var t=rt.data("data-map");t?(rt.show(),ls(c),uu(t)):n.supports("Map")?(t={map:new google.maps.Map(rt.get(0),{zoom:8}),geocoder:null,markers:[]},rt.data("data-map",t).show(),u.refresh()):setTimeout(si,100)}s.requiresInitCallback?(s.initCallback=function(){var t=u._autoSelect;u._autoSelect=null;t&&!n.busy()&&u.tap(t.row,t.action);si()},s.requiresInitCallback=!1,n.navigate(s.id)):s.requiresReturnCallback?(s.returnCallback=function(){si()},s.requiresReturnCallback=!1):si();u._reset=!1;vu(s);return}c.find("> .app-map, > .app-map-instruction").hide();this._mapPageWindow=null;ii||(fi=$('<div class="app-scrollable-cover"/>').appendTo(c.parent()).css({position:"absolute",left:c.offset().left,top:c.offset().top,width:c.outerWidth(),height:c.outerHeight(),zIndex:2,backgroundColor:wi?"transparent":"#fff"}));h.length||(h=$('<ul data-role="listview" class="app-listview"/>').appendTo(gt).listview().on("taphold",function(n,t){if(t&&(n=t),ul())return!1;if(!f._busy()){var r=$(n.target),i=r.closest("a"),l=i.data("data-context"),c=f.multiSelect()&&!1;return i.closest("li").is(".dv-item")&&!i.is(".app-divider")&&(i.is(".app-selected")?(i.removeClass("app-selected"),c||(u.clearSelection(),u.lookupInfo()?o(i,function(){u.executeInContext("Clear")}):o(i,function(){}))):f._hasKey()&&(c||h.find("a.app-selected").removeClass("app-selected"),i.addClass("app-selected"),u.tap(l,"none"),s.echoChanged=!0,o(i,function(){})),ui=!0),d&&!e()&&r.is("span")&&ys(r),!1}}).on("vclick",function(t){function e(n){f._busy()||(u._loadAtTop=!n,u.pageIndex(u.pageIndex(n?"bottom":"top")+(n?1:-1)),u.refresh())}var r=$(t.target),i=r.closest("a");if(i.length&&!i.is(".app-divider")&&!ne(t)){if(i.is(".dv-load-at-bottom"))e(!0);else if(i.is(".dv-load-at-top:visible"))it(),setTimeout(function(){e(!1)},50);else{if(ui){ui=!1;return}if(!pt(r)||n.busy())return!1;if(t.ctrlKey)return h.trigger("taphold",t),ui=!1,!1;if(i.is(".dv-action-none"))return!1;f.multiSelect()&&!1?h.find("a.app-selected:first").length&&(i.is(".app-selected")?i.removeClass("app-selected"):i.addClass("app-selected")):o(r,function(){if(!f.multiSelect()||!0){var n=i.data("data-context");n?f._hasKey()?(h.find("a.app-selected").removeClass("app-selected"),i.addClass("app-selected"),r.is(".app-btn-more")?(u.tap(n,"none"),io(r)):(u.tap(n),s.echoChanged=!0)):u.tap(n):i.is(".dv-action-refresh")?f.sync():i.is(".dv-action-new")&&u.executeInContext("New",null,!1)}})}return!1}}),uf(f,h));cs(h,pi);ct&&(bi=0,er(h));var p=h.find("li.dv-item"),at=p.length>ni*2,bt=h.find("li:last"),v,ur=k*ni,b=u._loadAtTop,hi,ri,or,sr=bt&&bt.length&&bt.prev(),fu=sr&&sr.position().top,ci;(ar&&bt.length==0||at&&!b&&!h.find("li.dv-load-at-top-parent").length)&&(ti.hide(),v=$(String.format('<li data-icon="false" class="dv-load-at-top-parent"><a class="dv-load-at-top"><p>{0}<\/p><\/a><\/li>',ft.Loading)),at?(v.insertBefore(p.get(0)),ar=!0):v.appendTo(h));b?(v=h.find("li:first"),ri=v.length&&v.next(),or=ri&&ri.position().top,st=st.slice(0).reverse()):bt.remove();$(st).each(function(n){var t=this,i=$('<li class="dv-item" data-icon="false"/>'),e=b?ur+ni-n:ur+n+1,r=$("<a/>").appendTo(i).data("data-context",{row:this.slice(0),pageIndex:k});f.rowIsSelected(t)&&(r.addClass("app-selected"),u.commandRow()||(f._forgetSelectedRow(!0),u.command(t,"Select")));d?nf(f,t,pr?e:null,r):ir(f,t,iu,pr?e:null,i,r);b?i.insertAfter(v):i.appendTo(h)});(vr&&!b||at&&b&&!h.find("li.dv-load-at-bottom-parent").length)&&(bt=g=$(String.format('<li data-icon="false" class="dv-load-at-bottom-parent""><a href="#" class="dv-load-at-bottom"><p>{0}<\/p><\/a><\/li>',ft.Loading)).appendTo(h));b&&k==0&&v.remove();f._totalRowCount||(ci=$('<li data-icon="refresh"><a class="dv-action-refresh"><p/><\/a><\/li>').appendTo(h).find("a"),ci.attr("title",gr.Refresh).find("p").text(tt.NoRecords));vr||(hr=u.aggregates(),hr&&d&&f._totalRowCount>0&&(br=$('<li data-icon="false" class="dv-item"/>').appendTo(h),kr=$('<a class="app-divider app-calculated"/>').appendTo(br),nf(f,hr,null,kr,u.aggregateLabels())),r.promoteActions?wr=!0:(kt=u.executeInContext("New",null,!1,!0),kt&&(li=$('<li class="dv-action-new">').appendTo(h).attr("data-icon",kt.icon),ut=$('<a class="dv-action-new"/>').appendTo(li).attr("title",t.LookupNewAction),d?$("<p>").appendTo(ut).text(kt.text):($("<h3>").appendTo(ut),ai=li.prev(),ai.is(".dv-item")&&(ut.html(ai.find("a").html()).find("p,img,span").css("visibility","hidden"),ai.is(".ui-li-has-thumb")&&li.addClass("ui-li-has-thumb")),ut.find("h3").text(kt.text),f._totalRowCount||$("<p>").appendTo(ut.html("")).text(kt.text)))));ur==0&&(et(!0),cr=h.find("li:first"),f._lookupInfo||(parentDataView=f.get_parentDataView()||$app.find(f.get_filterSource()),parentDataView&&(g=le(parentDataView),g&&(parentDataView.get_showInSummary()&&y.addClass("app-has-summary"),g.addClass("app-yardstick"),uf(parentDataView,g),g.insertBefore(cr)))),lt=u.instruction(),(lt||d)&&(g=$('<li data-role="list-divider" class="app-list-instruction"/>').insertBefore(cr),lt&&g.html(lt),d&&!!f._totalRowCount&&ce(f,g)));at&&(b?(p=p.slice(ni*(wi?2:2)),p.find("a").data("data-context",null),p.remove(),h.find("li.dv-action-new").remove()):(ti.hide(),vi=$(String.format('<li style="clear:left;height:{0}px"><\/li>',i.getScreenHeight()*10)).appendTo(h),h.find("li.app-list-instruction").remove(),h.find("li.app-li-card").remove(),p=p.slice(0,ni),p.find("a").data("data-context",null),p.remove()));h.listview("refresh");wr&&h.find("li.dv-item:last").addClass("app-has-promo");yt(h);h.appendTo(c);at?b?(yi=ri.position().top,dt=c.scrollTop(),c.scrollTop(dt+yi-or)):(dr=sr.position().top,dt=c.scrollTop(),c.scrollTop(dt+dr-fu)):b?(yi=ri.position().top,dt=c.scrollTop(),c.scrollTop(dt+yi-or)):c.scrollTop(bi);vi&&setTimeout(function(){vi.prev().addClass("ui-last-child");vi.remove()},100);hi=h.find("a.app-selected:first");d&&(ci&&ci.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),ut&&ut.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"));s.requiresInitCallback?(lr(),s.initCallback=function(){var t=u._autoSelect;u._autoSelect=null;t&&!n.busy()&&u.tap(t.row,t.action);wt(200)},s.requiresInitCallback=!1,n.navigate(s.id)):s.requiresReturnCallback?(lr(),s.returnCallback=function(){wt(200)},s.requiresReturnCallback=!1):(lr(),wt(200));fi&&(wi&&at?setTimeout(function(){fi.remove()},300):fi.remove());u._reset=!1;u._loadAtTop=null;vu(s)},reset:function(){var f=this.dataView(),t=n.pageInfo(f._id),e="#"+t.id,r=i.navigate.history,u;this._reset=!0;$(r.stack).each(function(n){return n>r.activeIndex?!1:this.hash==e?(u=!0,!1):void 0});u||(t.initialized=!1,t.echoInitialized=!1,t.echoId=!1)},visibleDataRows:function(n){var u=this._dataView,f=this.pageCount(),i=u._cachedPages,t,r;if(i)for(t=0;t<i.length;t++)if(r=i[t],r.index==n)return r.rows;return null},pageIndex:function(n){var t=this._dataView,i,r;if(typeof n=="string")return n=="bottom"&&(i=this.content().parent().find("ul li.dv-item:last a").data("data-context"),i)?i.pageIndex:n=="top"&&(r=this.content().parent().find("ul li.dv-item:first a").data("data-context"),r)?r.pageIndex:t.get_pageIndex();if(n==null)return t.get_pageIndex();t.set_pageIndex(n)},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageSize:function(){var n=this._dataView;return n.get_pageSize()},instruction:function(n){var u=this.lookupInfo(),e=this.dataView(),i=this.viewDescription()||"",f=this.filterStatus(),r;return u&&(i=String.format(u.field.ItemsDescription||t.LookupInstruction,u.aliasField.HeaderText),u.value&&(r=u.text,r&&r.length>50&&(r=r.substring(0,50)+"..."),i+=String.format(t.LookupOriginalSelection,r))),n!=!1&&(i||f)&&e._totalRowCount>1&&(i&&(i+=" "),i+=String.format(t.ShowingItemsInfo,e._totalRowCount)),f&&(i&&(i+=" "),i+=String.format('<span class="app-filter">{0}<\/span>',f)),i},context:function(u,o){var l=this,h=l.dataView(),y=h.extension(),a=h._totalRowCount,b=h.get_view().Label,k=h.get_sortExpression(),c=l.commandRow()||[],s=this.lookupInfo(),v=c&&c.length,w;if(a!=-1)if(u.push({text:b,count:a,theme:"b",icon:"dots",system:!0,toolbar:!1,callback:vl}),h.get_showQuickFind()&&(a>1||h.get_filter().length>h.get_externalFilter().length)&&u.push({text:yf.PerformAdvancedSearch,icon:"search",toolbar:!1,system:!0,callback:function(){n.search("configure",{scope:h._id,text:y.quickFind(),placeholder:us(h),focus:!0})}}),u.push({text:t.Sort,icon:"sort",desc:ol(h),toolbar:!1,system:!0,callback:hl}),u.push({text:t.Filter,icon:"filter",desc:y.filterStatus(!0),toolbar:!1,system:!0,callback:de}),s&&s.value==null||u.push({}),bh(h,u,c),s?i.activePage.find(".dv-heading.app-disabled").length&&!oe()&&u.push({text:v?l.instruction():null}):ge(h,u,c),s){function p(n,t,i){function p(){o.siblings("input:text").focus()}it();var o=$("#"+s.pageId+" .app-field-"+s.field.Name),a=s.field.Copy,v,u,c,l,y;if(s.value=n,s.text=t,y=o.val(),o.val(n),o.prev().text(s.text),n&&a)for(v=/(\w+)\s*=\s*(\w+)/g,u=v.exec(a);u;)copyFieldInput=$("#"+s.pageId+" .app-field-"+u[1]),c=h.findField(u[2]),copyFieldInput.length&&(c?(n=i[c.AliasIndex],t=c.text(n)):(n=null,t=tt.NullValueInForms),copyFieldInput.is(":input")?(copyFieldInput.val(t),l=copyFieldInput.data("format"),l&&(l.value=n,l.text=t),copyFieldInput.prev().is(".app-lookup")&&copyFieldInput.prev().text(t).data("link-text",null)):(copyFieldInput.text(t),u=s.field._dataView.extension()._editors[u[1]],u&&(u.value=n,u.text=t))),u=v.exec(a);vr(!0);di=function(){e()?r.pageTransition=="none"?p():setTimeout(p,200):setTimeout(function(){f(o.prev())},200);y!=o.val()&&pu(o)};setTimeout(function(){history.go(-1)},100)}v&&u.push({text:t.LookupSelectAction,icon:"check",command:"Select",callback:function(){var i=s.field.ItemsDataValueField,r=s.field.ItemsDataTextField,e=n.pageInfo(),t=e.dataView,u,f;i||$(t._allFields).each(function(){if(this.IsPrimaryKey)return i=this.Name,!1});r||$(t._allFields).each(function(){var n=this;if(!n.Hidden&&!n.OnDemand)return r=n.Name,!1});u=t.findField(i);f=t.findField(r);p(c[u.Index],c[f.Index],c)}});s.value&&u.push({text:t.UnSelect,icon:"delete",command:"Clear",callback:function(){p(null,tt.NullValueInForms)}});String.isNullOrEmpty(s.field.ItemsNewDataView)||u.push({text:t.LookupNewAction,icon:"plus",command:"New",callback:function(){l.executeInContext("New",s.field.ItemsNewDataView,!0)}});u.push({});v&&!s.field.tagged("lookup-details-hidden")&&u.push({text:t.LookupViewAction,callback:function(){Web.DataView._defaultUseCase="ObjectRef";l.executeInContext("Select","editForm1",!0)}});ge(h,u,c)}else o||(o=["Grid","ActionColumn","ActionBar"]),o.length==1&&o[0]=="Grid"&&$(h._views).each(function(){var n=this;if(n.Type=="Form"&&n.Id.match(/edit/))return w=n.Id,!1}),ff(o,h,u,c,w)}};Web.DataView.Extensions.Form=function(n){return new Web.DataView.MobileForm(n)};Web.DataView.MobileForm=function(n){Web.DataView.MobileForm.initializeBase(this);this.dataView(n)};Web.DataView.MobileForm.prototype={initialize:function(){this._editors={};this._initRow()},_initRow:function(){var n=this.dataView(),t=this.inserting()?n._newRow:n._rows[0];return n._mergeRowUpdates(t),this.commandRow(t)},reset:function(){this._reset=!0;this._initRow()},options:function(){return{quickFind:!1,filterDetails:!1}},dispose:function(){this._dispose()},_dispose:function(t){var i=this.content(),u,o,r,f,e;this._newValues=null;i.find('input[data-input-type="datepicker"]').datepicker("destroy");i.find('select[data-role="slider"]').slider("destroy").remove();i.find("select").selectmenu("destroy");u=i.find(".app-container-scrollable").data("data-field",null).find("fieldset");u.find(":checkbox,:input").off("click").checkboxradio("destroy");u.controlgroup("destroy");for(o in this._editors)r=this._editors[o],r.field=null,r.originalField=null,$(r.item).remove(),delete r.item,$(r.label).remove(),delete r.label,$(r.readers).remove(),delete r.readers,$(r.writers).remove(),delete r.writers;this._editors={};i.find("div.app-status-bar, div.app-bar-buttons,div.app-stub,div.app-form-grid").remove();f=i.parent().find('div[data-role="header"]');f.find('div[data-role="navbar"]').navbar("destroy").remove();f.toolbar("destroy").remove();rr(i);e=i.find(".ui-collapsible-set");e.find(".ui-collapsible-heading a").off();e.remove();i.find(".app-echo").each(function(){var i=$(this).attr("data-for"),t=n.pageInfo(i);t&&(t.echoId=null,t.echoInitialized=!1)});i.find(".app-echo,.app-echo-toolbar").remove();n.tabs("destroy",{container:i});t&&w()},viewStyle:function(){return"Form"},refresh:function(){function st(n){bar=t.find(".app-bar-buttons:eq(1)");n?bar.removeClass("app-bar-buttons-hidden"):t.find(".ui-collapsible:visible .ui-collapsible-heading:not(.ui-collapsible-heading-collapsed)").length?bar.removeClass("app-bar-buttons-hidden"):bar.addClass("app-bar-buttons-hidden")}function kt(n,t){if(arguments.length==2)r.viewProp("categoryState"+n,t);else return r.viewProp("categoryState"+n)==!0}function hi(){}function ci(){ft&&h.length&&(lt=h.outerWidth(),at=h.offset().left,d=g.width(),oe()&&(d-=$("#app-sidebar").outerWidth()),at+lt+20>d&&ht.scrollLeft(h.is(".Last")?at+lt-d+(h.outerWidth(!0)-h.find(".Self").outerWidth()):at-(d-lt)/2));wt(200);setTimeout(function(){vs(t)},100)}var u=this,r=u.dataView(),e=n.pageInfo(r._id),li=r._fields,pt=r._allFields,ii=r._categories,t=u.content(),a,ri=[],f,v,y,ut,ai=u.itemMap(),ft,bt=this.inserting(),vi=this._reset,ui,p=r.get_showActionButtons(),fi=r._confirmContext,w=$("#"+e.id),k=w.find(".app-page-header"),ei,ht,h,lt,at,d,nt,vt,tt,dt,gt,ti;e.headerText=fi&&fi.WindowTitle||r.get_view().Label;bt&&k.attr("data-locked","false").data("data-text",null);et(e.headerText,k);t.closest(".ui-page").addClass("app-form-page");vi&&(u._dispose(),u._commandRow=null);ui=u._editors;a=u.commandRow()||u._initRow()||[];ft=r.statusBar();ft&&(ht=$('<div class="app-status-bar"/>').html(ft).appendTo(t),h=ht.find(".Current"),ct||ht.css("overflow-x","auto"));nt=$app.find(r.get_filterSource());nt&&(tt=le(nt),tt&&(tt=tt.appendTo(t),nt.get_showInSummary()&&w.addClass("app-has-summary"),vt=$('<ul data-role="listview" class="app-listview"/>').appendTo(t),uf(nt,vt),tt.appendTo(vt),yt(vt.listview())));dt=u.viewDescription();dt&&(gt=$('<ul data-role="listview" class="app-list-instruction"/>').appendTo(t),$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(gt).html(dt),gt.listview());(p=="TopAndBottom"||p=="Top")&&$('<div class="app-bar-buttons"/>').appendTo(t);bt||(y=pt[pt[ai.heading].AliasIndex],y=y.text(a[y.Index],!1));var it=4,c=0,rt=0,oi,ni,s=[],si=0,yi=0;$(ii).each(function(){var n=this;f!=n.Tab&&(f=n.Tab,c=0,rt=0,firstCategory=!0,si++);(firstCategory||n.NewColumn)&&c++;f&&(s[si-1]=c);firstCategory=!1});s.length?$(s).each(function(n){var i=this;i>it&&(i=it);s[n]=i==1?null:$("<div><\/div>").appendTo(t).addClass("app-form-grid ui-grid-"+String.fromCharCode(97+i-2))}):c>1&&(c>it&&(c=it),oi=$("<div><\/div>").appendTo(t).addClass("app-form-grid ui-grid-"+String.fromCharCode(97+c-2)));f=null;v=oi;$(ii).each(function(n){var i=this;f&&f.text==i.Tab||(f={text:i.Tab,content:[]},s.length&&(v=s[yi++]),rt=0,ni=null,ri.push(f));v&&(f.content.length||f.content.push(v),(rt==0||this.NewColumn)&&rt<it&&(ni=$("<div>").appendTo(v).addClass("ui-block-"+String.fromCharCode(97+rt++))));var l=$('<div class="ui-collapsible-set ui-group-theme-inherit"><\/div>').appendTo(ni||t),w=$('<div class="ui-collapsible ui-collapsible-themed-content ui-first-child ui-last-child"><\/div>').appendTo(l.addClass("app-category-"+i.Id)),d=r._processTemplatedText(a,i.Description),g=r._formatViewText(lo.DefaultCategoryDescriptions[d],!0,d),p,nt,e=$('<h3 class="ui-collapsible-heading"/>').appendTo(w),h=$('<a class="ui-collapsible-heading-toggle ui-btn ui-btn-a"/>').appendTo(e).text(i.HeaderText),c=$('<div class="ui-collapsible-content ui-body-a" aria-hidden="false"><\/div>').appendTo(w);$(pc).appendTo(h);$(wc).appendTo(h);v||f.content.push(l);p=$('<ul data-role="listview" data-theme="a" data-inset="false" class="app-formview"/>').appendTo(c);String.isNullOrEmpty(g)||$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(p).html(g.replace(/\n/g,"<p/>"));$(li).each(function(){var n=this,r=n,o,u,t,f,e;n.CategoryIndex==i.Index&&(n=pt[n.AliasIndex],o=a[r.Index],u=n.text(a[n.Index],!1),bt||nt||(nt=!0,t=et(null,k),$('<span class="dv-object-identifier"/>').text(y).appendTo(h).hide(),typeof t=="string"&&(t=[0,t]),t[0]=y,et(t,k),k.attr("data-locked","true")),f=$('<li class="ui-field-contain"/>').appendTo(p),e=$('<label class="app-static-label"/>').appendTo(f).text(n.HeaderText),n.AllowNulls||e.addClass("app-required"),ui[r.Name]={field:n,originalField:r,item:f,label:e,value:o,originalValue:a[r.Index],text:u,trimmedText:n.trim(u),readers:[],writers:[]})});l.find("ul").listview();h.on("vclick",function(t,i){function f(){e.toggleClass("ui-collapsible-heading-collapsed");s?(c.show(),r.find(".dv-object-identifier").hide().closest(".ui-collapsible").find(".dv-heading").removeClass("app-disabled"),st(!0),b(),u.inserting()||kt(n,!1),ot()):(c.hide(),u.inserting()||kt(n,!0),st(),hi(),b(),ot())}var r=$(this),s=e.is(".ui-collapsible-heading-collapsed");i==!1?f():o(r,f)});(i.Collapsed||kt(n))&&(e.addClass("ui-collapsible-heading-collapsed"),c.hide());i.HeaderText||e.hide().closest(".ui-collapsible").addClass("app-divider")});n.tabs("create",{id:r._id+"_tabset",tabs:ri,className:"app-tabs-form",change:function(n){b();wu(t);$(n.content).each(function(){this.find("textarea").textinput("refresh")});st()}});$(s).each(function(n){var i=s[n];i&&i.appendTo(t)});(p=="TopAndBottom"||p=="Bottom")&&$('<div class="app-bar-buttons"/>').appendTo(t);ut=[];u.context(ut);p!="None"&&n.refreshAppButtons(ut,{buttonBars:t.find(".app-bar-buttons"),toolbar:!1});nh(r,t);ei=$('<div class="app-stub"/>').appendTo(t);t.find(".app-echo").length&&ei.height(i.getScreenHeight()*.6);u.stateChanged();u._reset=!1;e.requiresInitCallback?(ti=w.css("display")!="block",ti&&w.css({display:"block","z-index":-10}),hi(),st(),wu(t),p!="None"&&n.refreshAppButtons(ut,{buttonBars:t.find(".app-bar-buttons"),toolbar:!1}),tr(w),ti&&w.css({display:"","z-index":""}),e.requiresInitCallback=!1,l=!1,e.initCallback=ci,n.navigate(e.id)):ci();vu(e)},collect:function(){var t=this,f=[],n,h=t.dataView(),c=h._allFields,s=this.commandRow(),o=t.inserting(),r,u;return s?($(c).each(function(){var h=this,c=i.activePage.find("*.app-field-"+h.Name+":input"),l;h.OnDemand||(r=s[h.Index],n={Name:h.Name,OldValue:o?null:r,NewValue:r,Modified:o&&r!=null},n.ReadOnly=h.ReadOnly&&!(h.IsPrimaryKey&&o),c.length?(n.NewValue=c.is("select")?c.find("option:selected").data("value"):c.val().trim(),ii||e()||h.Type.match(/^Date/)&&(n.NewValue=h.TimeFmtStr?ks(n.NewValue):tl(n.NewValue)),n.Modified=!0):(l=t._editors[h.Name],l?(n.NewValue=l.value,n.Modified=!0):(u=t._newValues,u&&h.Name in u&&(n.NewValue=u[h.Name],n.Modified=!0))),f.push(n))}),f):f},_readWrite:function(){function w(n,t){$(n).each(function(){t?f.item.children().length==1&&this.appendTo(f.item):this.detach()})}function b(){y=at+"_"+i.Name+"_Input";ot.attr("for",y);r.appendTo(p).attr("id",y).addClass(g);i.Len&&r.attr("maxlength",i.Len);i.Watermark&&r.attr("placeholder",i.Watermark);ht&&r.attr("data-causes-calculate",ht)}var v=this,l=v.dataView(),at=l._id,et=v.editing(),fi=v.inserting(),vt=v._editors,yt,u,s,f,i,o,pt,ot,p,gt=v.itemMap(),c,r,y,h,g,ni=v.content(),wt=ni.find(".ui-collapsible ul"),a,st,bt={},ht,ti,kt,nt,k,lt,d;et?wt.addClass("app-form-editing"):wt.removeClass("app-form-editing");$(l._allFields).each(function(){var n=this;n.Calculated&&n.ContextFields&&$(n.ContextFields.split(/\s*,\s*/)).each(function(){l.findField(this)&&(bt[this]=!0)})});for(yt in vt)if(f=vt[yt],i=f.field,o=f.originalField,ot=f.label,p=f.item,u=f.value,s=f.text,et||(s=f.trimmedText),g="app-field-"+i.Name,c=o.ItemsStyle,ht=o.CausesCalculate||bt[o.Name]?o.Name+"."+l._id+".app":null,!et||o.isReadOnly()||i.OnDemand)ot.attr("for",""),w(f.writers,!1),f.readers.length?w(f.readers,!0):(h=$('<div class="ui-input-text ui-body-inherit ui-corner-all app-static-text"/>').appendTo(p),fieldText=$("<div>").appendTo(h).addClass(g),f.readers.push(h),i.Index==gt.heading&&p.addClass("dv-heading"),i.OnDemand?!u||u.match(/^null/)?fieldText.text(tt.NullValueInForms):(lt=l.resolveClientUrl(l.get_appRootPath()),d=$('<a rel="external"/>').appendTo(fieldText).attr("href",String.format("{0}blob.ashx?{1}=o|{2}",lt,i.OnDemandHandler,s)),i.OnDemandStyle==0?($('<img class="app-image-thumb">').appendTo(d).attr("src",String.format("{0}blob.ashx?{1}=t|{2}&_nocrop",lt,i.OnDemandHandler,s)),d.attr("data-content-type","image")):(d.text(tt.BlobDownloadLink).addClass("ui-btn ui-btn-icon-left ui-icon-arrow-d ui-btn-inline ui-mini ui-shadow ui-corner-all").appendTo(fieldText.parent()),e()&&d.attr("target","_blank"),fieldText.remove())):(i.htmlEncode()?fieldText.html(s):fieldText.text(s),a=null,tf(i,!0)&&u?a=$('<a class="ui-btn-right ui-btn ui-icon-phone ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr("href","tel:"+u):rf(i,!0)&&u?a=$('<a class="ui-btn-right ui-btn ui-icon-mail ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr("href","mailto:"+u):uh(i,!0)&&u?a=$('<a class="ui-btn-right ui-btn ui-icon-eye ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr({href:u}):fl(i,!0)&&u?a=$('<a class="ui-btn-right ui-btn ui-icon-location ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr({href:dh(v.commandRow(),ef(l),"q")}):el(o)&&o.ItemsDataController&&u&&!o.tagged("lookup-details-hidden")&&(a=$('<a href="#app-details" class="ui-btn-right ui-btn ui-icon-carat-r ui-btn-icon-notext ui-shadow ui-corner-all app-btn"/>').appendTo(fieldText).attr("data-field-name",o.Name).attr("data-field-text",i.HeaderText+" - "+l.get_view().Label)),a&&a.attr("title",i.HeaderText+":\n"+u))),w(f.writers,!1);else if(w(f.readers,!1),f.writers.length)w(f.writers,!0);else{if(String.isNullOrEmpty(c))st=!1,k=i.Rows>1,r=k?$("<textarea/>"):$('<input type="text" />'),k?(r.attr("rows",i.Rows),(ct||!rt||!0)&&r.attr("data-autogrow","false"),ii&&r.css("white-space","pre-wrap")):i.TextMode==1?r.attr("type","password"):i.Type=="String"?tf(i)?r.attr("type","tel"):rf(i)?r.attr("type","email"):uh(i)&&r.attr("type","url"):i.Type.match(/^Date/)?(r.addClass("app-input-date"),ii||e()?st=!0:i.TimeFmtStr?(r.attr("type","datetime-local"),s=bs(u)):(r.attr("type","date"),s=ws(u))):i.Type!="TimeSpan"&&r.data("format",{type:"number",value:u,text:u==null?"":s,field:i}),b(),r.val(u==null?"":s),h=r.textinput({clearBtn:!k,clearBtnText:t.ClearText}),k?h.textinput("refresh"):ct&&h.parent().find(".ui-input-clear").attr("tabindex",-1),st&&$(r).attr({"data-input-type":"datepicker","data-format-string":i.DataFormatString}).datepicker();else if(pt=i,i=o,g="app-field-"+i.Name,u=f.originalValue,c=="Lookup"||c=="AutoComplete")r=$('<input type="hidden"/>').val(u),b(),h=$("<div>").appendTo(p),r.appendTo(h),ti=$('<input type="text" class="app-lookup-input"/>').insertBefore(r).attr("id",y),kt=$('<a href="#app-lookup" class="ui-btn ui-icon-carat-r ui-btn-icon-right ui-corner-all app-lookup"/>').insertBefore(r).text(s).data("data-context",{field:o,aliasField:pt,value:u,text:s,pageId:at}),ct&&kt.attr("tabindex",-1);else if(c=="CheckBox")r=$('<select data-role="slider">'),nt=0,$(o.Items).each(function(){var n=this[0],t=this[1],i=$("<option>").attr("value",n!=null?n.toString():"").data("value",n).text(t).appendTo(r);t.length>nt&&(nt=t.length)}),b(),r.val(u!=null?u.toString():""),h=r.slider(),r.next().css("width",nt+2+"em");else if(c=="CheckBoxList"||c=="RadioButtonList"||c=="ListBox"){r=$('<input type="hidden"/>');b();r.val(u!=null?u.toString():"").attr("data-field",i.Name);var it=c=="CheckBoxList",ut,ft,dt=[],ri=u!=null?u.toString().split(/\s*,\s*/):[],ui=Math.min(Math.ceil(i.Items.length/(i.Columns>1?i.Columns:1)),Math.max(Math.ceil(n.screen().height*.45/is()),3));ut=$('<div class="app-container-scrollable"/>').attr("data-columns",i.Columns);$(i.Items).each(function(n){n%ui==0&&(ft=$('<fieldset class="app-controlgroup-vertical"/>').appendTo(ut),dt.push(ft));var t=this,r=$("<input/>").attr({id:y+n,type:it?"checkbox":"radio"}).appendTo(ft),f=$("<label/>").attr("for",y+n).appendTo(ft).text(t[1]);it||r.attr("name",y);i.HtmlEncode||f.html(t[1]);(it&&ri.indexOf(t[0])!=-1||!it&&t[0]==u)&&r.attr("checked","true")});ut.insertBefore(r).data("data-field",i);$(dt).controlgroup().find(":checkbox,:radio").checkboxradio();ut.find(":checkbox,:radio").on("click",hs);h=r}else r=$("<select>").addClass("app-lookup"),$(o.Items).each(function(){var n=this[0],t=this[1],i=$("<option>").attr("value",n!=null?n.toString():"").data("value",n).text(t).appendTo(r)}),b(),r.val(u!=null?u.toString():""),h=r.selectmenu();f.item.children().each(function(n){n>0&&f.writers.push($(this))})}},stateChanged:function(){var n=this,r=n.dataView(),t=n.content(),u=n.editing(),i;n._readWrite();n.calculate(r);u&&(i=t.find(".ui-collapsible:visible .ui-collapsible-heading"),i.filter(":not(.ui-collapsible-heading-collapsed)").length||i.first().find(".ui-btn").trigger("vclick",!1),vs(t));t.closest(".ui-page:visible").length&&wu(t);w()},context:function(n){var t=this,i=t.dataView(),r=t.commandRow(),u=t.editing();bh(i,n,r);u||ge(i,n,r);ff(["Form","ActionBar"],i,n,r)},calculate:function(t){var o=this,i,u,f,r,s;if(typeof t=="string")i=n.dataView(),u=i.findField(t),u&&i._raiseCalculate(u,u);else{i=t;f=n.page(i._id);function e(){r||(r=[],$(i._collectFieldValues()).each(function(){var n=this,t=i.findField(n.Name);r[t.Index]=n.Modified?n.NewValue:n.OldValue}))}$(i._expressions).each(function(){var u=this,s,o,t,n;u.Scope==3&&(e(),s=i._evaluateJavaScriptExpressions([u],r,!1),o=f.find(".app-field-"+u.Target),o.length&&(t=o.closest(".ui-field-contain"),s?t.show():t.hide(),n=t.closest("ul").find("> li").removeClass("ui-first-child ui-last-child").filter(":visible"),n.length&&($(n[0]).addClass("ui-first-child"),$(n[n.length-1]).addClass("ui-last-child"))))});$(i._expressions).each(function(){var u=this,o,n,t;u.Scope==2&&(e(),o=i._evaluateJavaScriptExpressions([u],r,!1),n=f.find(".app-category-"+u.Target),n.length&&(o?n.show().removeClass("app-hidden"):n.hide().addClass("app-hidden"),n.closest(".app-form-grid").length&&(t=n.parent(),t.find("> .ui-collapsible-set:not(.app-hidden)").length?t.show().removeClass("app-hidden"):t.hide().addClass("app-hidden"))))});f.find(".app-form-grid").each(function(){var n=$(this),t=n.find("> div:not(.app-hidden)"),i=n.attr("class").replace(/ui-grid-\w+/,"").trim();t.length==0?n.hide():(i+=" ui-grid-"+(t.length==1?"solo":String.fromCharCode(97+t.length-2)),n.attr("class")!=i&&n.attr("class",i),n.css("display",""),t.each(function(n){var i=$(this),t="ui-block-"+String.fromCharCode(97+n);i.attr("class")!=t&&$(this).attr("class",t)}))});$(i._expressions).each(function(){var t=this,u,n;t.Scope==5&&(n=i.findField(t.Target),n&&(n._originalTextMode==null&&(n._originalTextMode=n.TextMode),e(),u=i._evaluateJavaScriptExpressions([t],r,!1),n.isReadOnly()!=u&&(n.TextMode=u?4:n._originalTextMode,s=!0)))});s&&o._readWrite();o._refreshButtons()}},afterCalculate:function(t){var i=this,r=i.dataView(),u=$("#"+r._id);n.causesCalculate(!1);$(t).each(function(){var s=this,o=i._editors[s.Name],t,h,f,l,a,c,n,y,v;o?(f=o.originalField,c=f.ItemsStyle,t=o.value=s.NewValue,s.NewValue==null?(h=o.text=tt.NullValueInForms,o.trimmedText=o.text):(h=o.text=f.format(s.NewValue,!1),o.trimmedText=f.trim(o.text)),n=u.find(".app-field-"+f.Name),n.length&&(n.is("div")?f.htmlEncode()?n.text(o.trimmedText):n.html(o.trimmedText):c=="Lookup"||c=="AutoComplete"?n.val(t!=null?t.toString():"").prev().data("data-context").value=t:c=="CheckBox"?(n.val(t!=null?t.toString():""),n.slider("refresh")):c=="CheckBoxList"||c=="RadioButtonList"||c=="ListBox"?$(f.Items).each(function(i){if(this[0]==t){var r=n.prev();return r.find(":input:eq("+i+")").trigger("click"),r.find(":checkbox,:radio").checkboxradio("refresh"),!1}}):c?(n.next().val(t!=null?t.toString():""),n.next().selectmenu("refresh")):(l=n.data("format"),l&&(l.value=t,l.text=t==null?"":h),f.Type.match(/^Date/)&&(ii||e()||(h=f.TimeFmtStr?bs(t):ws(t))),n.is(":focus")&&l?n.val(t==null?"":t):n.val(t==null?"":h)))):(i._newValues||(i._newValues={}),i._newValues[s.Name]=s.NewValue,f=r.findField(s.Name),f&&(a=r.findFieldUnderAlias(f),a!=f&&(n=u.find(".app-field-"+a.Name),n.length&&(y=n.prev(),h=s.NewValue==null?tt.NullValueInForms:f.format(s.NewValue,!1),v=y.text(h).data("data-context"),v&&(v.text=h)))))});i._refreshButtons()},_refreshButtons:function(){var n;$(this.dataView()._actionGroups).each(function(){return $(this.Actions).each(function(){if(this._whenClientScript)return n=!0,!1}),n?!1:void 0});n&&w()}};Web.DataView.alert=function(t,i){function s(){r.popup("open")}var e;typeof t!="string"&&(t=t.toString());ro=i;var r=$("#app-popup-alert"),h=a(),f=$("div.ui-popup-active div:first");if(r.length==0){r=$(String.format('<div id="app-popup-alert" class="app-popup app-popup-alert" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" aria-level="1">{0}<\/h1><\/div><div role="main" class="ui-content"><div class="app-popup-text"><\/div><div class="app-popup-buttons"><a href="#" class="ui-btn ui-corner-all ui-mini">{1}<\/a><\/div><\/div><\/div>',n.appName(),nu.Close)).appendTo(u).popup(hf());r.find("a").on("vclick",function(){return f.length?(dt=function(){f.popup("open")},uu=ro):dt=ro,o(this,function(){ut(r)}),!1})}e=r.find(".app-popup-text");t.match(/<\w+/)?e.html(t):e.text(t);f.length?(dt=s,ut(f)):s()};Web.DataView.confirm=function(t,i,r){function h(){f.popup("open")}var s;typeof t!="string"&&(t=t.toString());uo=i;fo=r;var f=$("#app-popup-confirm"),c=a(),e=$("div.ui-popup-active div:first");if(f.length==0){f=$(String.format('<div id="app-popup-confirm" class="app-popup app-popup-confirm" data-role="popup" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" arial-level="1">{0}<\/h1><\/div><div role="main" class="ui-content"><div class="app-popup-text"><\/div><div class="app-popup-buttons"><a href="#" class="app-btn-confirm ui-btn ui-corner-all ui-mini">{1}<\/a><a href="#" class="ui-btn ui-corner-all ui-mini">{2}<\/a><\/div><\/div><\/div>',n.appName(),nu.OkButton,nu.CancelButton)).appendTo(u).popup(hf());f.find("a").on("vclick",function(n){var t=$(n.target).is(".app-btn-confirm");return dt=e.length?function(){e.popup("open");uu=t?uo:fo}:t?uo:fo,o(this,function(){ut(f)}),!1})}s=f.find(".app-popup-text");t.match(/<\w+/)?s.html(t):s.text(t);e.length?(dt=h,ut(e)):h()};$app.showMessage=function(n){n&&this.alert(n)};Web.Menu.headerIterators=[];Web.Menu.footerIterators=[];Web.Menu.prototype.initialize=function(){Web.Menu.callBaseMethod(this,"initialize")};Web.Menu.prototype.dispose=function(){};Web.Menu.prototype.updated=function(){Web.Menu.callBaseMethod(this,"updated");n&&this.mobileUpdated()};Web.Menu.prototype.mobileUpdated=function(){var s,h,e,i,r;if(Web.Menu.MainMenuId||(Web.Menu.MainMenuId=this.get_id(),Web.Menu.MainMenuElemId=this._element.id),s=this.get_nodes(),s){h=$("a#app-btn-context").on("vclick",function(){return b(),o(h,function(){n.showContextMenu({scope:""})}),!1});Web.Menu.footerIterators.unshift(function(){if($(this).is(".level0")){var i=$("<a/>").text(t.Settings).appendTo($('<li data-icon="gear" data-theme="b"/>').appendTo(this)).on("vclick",function(){ri||f(i);gt=function(){n.contextScope("_contextMenu");we()};wr(!0)});return!0}});e=$("a#app-btn-menu");e.on("vclick",function(){function o(t){setTimeout(function(){f();os()?n._menuPanel.panel("toggle"):r.panel("toggle")},t)}return(b(),f(e,!1),b(),e.attr("href")=="#app-back")?(setTimeout(function(){f();history.go(-1)},200),!1):(i?o(200):setTimeout(function(){var k,e,s,l,a,v,p,w,h,b,c;f();k=$('div[data-role="page"]');e=$();n._menuPanel=i=$('<div id="app-panel-menu" data-role="panel" data-position="left" data-position-fixed="true" data-display="overlay" data-theme="b" class="app-nav-panel"/>').appendTo(u);s=$('<ul data-role="listview"><li data-role="list-divider" data-theme="a" class="app-info"><span class="appname"/><p class="welcome"/><\/li><\/ul>').appendTo($('<div class="ui-panel-inner">').appendTo(i));l=i.find('li[data-role="list-divider"]');l.find(".appname").text(n.appName());a=Web.Menu.headerIterators;v=Web.Menu.footerIterators;a.length==0?l.find(".welcome").hide():$(a).each(function(){this.call(s)&&(p=!0)});p&&$('<li data-role="list-divider" data-theme="b"/>').appendTo(s);w=$find(Web.Menu.MainMenuId).get_nodes();h=-1,function d(n,i,f,o,s){var c="level"+s;f.addClass(c);o.addClass(c);e=e.add(f);$(n).each(function(n){var i=this,l=i.url,a,c,e,p;if(i.children){$(i.children).each(function(){this.selected&&(a=!0)});var v=f.attr("id"),y=v+"-"+n,w=l;l="#";c=$('<div data-role="panel" data-position="left" data-position-fixed="true" data-theme="b" data-display="overlay" class="app-nav-panel"/>').appendTo(u).attr("id",y);e=$('<ul data-role="listview" data-theme="b"/>').appendTo($('<div class="ui-panel-inner"/>').appendTo(c));$("<a>").appendTo($('<li data-icon="arrow-u" data-theme="b"/>').appendTo(e)).attr({"data-for":v}).text(t.UpOneLevel);$('<li data-role="list-divider" data-theme="b"/>').appendTo(e);$('<a rel="external" class="app-btn-icon-transparent"/>').appendTo($("<li>").appendTo(e).attr({"data-theme":i.selected&&!a?"a":"b","data-icon":i.selected&&!a?"check":"false"})).attr("href",w).text(i.title);i.selected&&s>h&&(r=c,h=s);d(i.children,i,c,e,s+1)}i.selected&&s>h&&(r=f,h=s);p=$('<a rel="external" class="app-btn-icon-transparent"/>').appendTo($("<li>").appendTo(o).attr({"data-icon":i.children?"dots":i.selected?"check":"false","class":i.children?"menu-item menu-parent":"menu-item","data-theme":i.selected?"a":"b"})).attr({href:l,title:i.description}).text(i.title);i.children&&p.attr("data-for",y)})}(w,null,i,s,0);b=e.find("ul").each(function(){var n=$(this),t;$(v).each(function(){this.call(n)&&(t||(t=!0,$('<li data-role="list-divider" data-theme="b"/>').insertBefore(n.find("li:last"))))})});c=$("#PageFooterBar");c.length&&$('<li data-role="list-divider" class="app-wrap app-copy" data-theme="b"/>').appendTo(s);b.listview().on("vclick","a",function(n){var t=$(n.target),i=t.attr("data-for"),u=t.attr("href");return pt(t)?(ri||(f(t),!i&&u&&ui()),gt||(gt=function(){setTimeout(function(){i?(r=$("#"+i),o()):y.location.href=u},200)}),wr(i!=null),!1):!1}).on("swipe",function(){ri=!0});c.length&&s.find(".app-wrap").html(c.html());lr();i=e.panel({animate:yu(),beforeopen:function(){},open:function(){r=$(this)},beforeclose:function(){},close:function(){!ri&&gt&&gt();gt=null;ri=!1}});yu(i);ar(i);r||(r=e.slice(0,1));o(250)},200),!1)});$('div[data-app-role="sitemap"]').attr("class","app-site-map").each(function(){function u(){var n=$('<li><a href="#" rel="external"/><\/li>').appendTo(i).find("a");$("#app-welcome").length&&!r?n.attr("href","#app-welcome").text(d.LoginButton):kt.loginStatus(n)}var e=$(this),i=$('<ul data-inset="false" />').appendTo(e),r=kt&&kt.loggedIn();kt&&!r&&u(),function h(n,t,i){$(n).each(function(){var n=$("<li/>").appendTo(t).addClass("app-depth"+i);this.url?$("<a/>").appendTo(n).attr({href:this.url,rel:"external"}).text(this.title):$("<span><\/span>").appendTo(n).text(this.title);this.children&&h(this.children,t,i+1)})}(s,i,1);kt&&r&&u();i.listview().on("vclick",'a[rel="external"]',function(t){var i=$(t.target),r=i.attr("href"),u=r.match(/^#/);return pt(i)?(u||ui(),o(i,function(){u?n.changePage(r.substring(1)):(f(i,!1),y.location.href=r)}),!1):!1}).filterable({filterPlaceholder:t.FilterSiteMap})})}};typeof Web.Membership!="undefined"&&(Web.Membership.prototype.initialize=function(){var i=this,r=i.get_authenticationEnabled(),u=i.get_displayMyAccount(),e=i.loggedIn();Web.Menu.headerIterators.push(function(){var l=$(this),a=i.get_cultures(),u,y,r,h,c;if(!String.isNullOrEmpty(a)&&!(__tf!=4)){var o={value:"Detect,Detect",text:d.AutoDetectLanguageOption,selected:!1},v=[o];$(a.split(/;/)).each(function(){if(this.length){var n=this.split("|"),t={value:n[0],text:n[1],selected:n[2]=="True"};v.push(t);t.selected&&(o=t)}});y=$("<a/>").text(o.text).appendTo($('<li data-icon="location" data-theme="b"/>').appendTo(l)).on("vclick",function(){return ri||f(y),gt=function(){s=[{text:t.Back,icon:"back",callback:function(){n._menuPanel.panel("toggle")}},{text:d.ChangeLanguageToolTip,instruction:!0}];$(v).each(function(n){var t=this;s.push({text:t.text,icon:n==0?"":t.selected?"check":!1,context:t,callback:function(n){i.changeCulture(n.value)}});n==0&&s.push({})});p(s,"#app-panel-languague",{position:"left"})},wr(!0),!1});u=!0}if(r=this.find(".welcome"),e)h=i.get_welcome(),String.isNullOrEmpty(h)?r.hide():r.html(String.localeFormat(h,i.get_user(),new Date));else if(i._allowLoginInMenu){r.hide();c=$("<a/>").text(d.LoginLink).appendTo($('<li data-icon="lock" data-theme="b"/>').appendTo(l));c.on("vclick",function(){ri||f(c);gt=function(){f();i.showLogin()};wr()});u=!0}return u});e&&(u||r)&&Web.Menu.footerIterators.push(function(){var n=!1,t;if(u&&$(this).is(".level0")&&!1&&($(String.format("<li>{0}<\/li>",d.MyAccount)).appendTo(this),n=!0),r){t=$("<a/>").text(d.LogoutLink).appendTo($('<li data-icon="power" data-theme="b"/>').appendTo(this));t.on("vclick",function(){ri||f(t);gt=function(){ue();i.logout()};wr()});n=!0}return n})},Web.Membership.prototype.dispose=function(){},Web.Membership.prototype.updated=function(){if(kt=this,fe(),this.get_idleTimeout())$(document).on("awake.app",function(){return!kt.idle()});this.idleInterval(!0);n&&this.mobileUpdated()},Web.Membership.prototype._idle=function(){b();var n=this;n.idleInterval(!1);$app.alert(d.UserIdle,function(){ue();n.logout()})},Web.Membership.prototype.loginStatus=function(n){var t=this,i=t.loggedIn(),r=$(n).text(i?d.LogoutLink:d.LoginLink).on("vclick",function(){return o(r,function(){i?(ue(),t.logout()):t.showLogin()}),!1})},Web.Membership.prototype.mobileUpdated=function(){function i(){l?setTimeout(i,200):n.loggedIn()||t!=a()||n.showLogin()}var n=this,t,r;$(document).on("start.app",function(){n._allowLoginInMenu=n.get_displayLogin();!r&&location.href.match(/(\?|&)ReturnUrl=/)&&n._allowLoginInMenu&&(t=a(),setTimeout(i,1e3))});this.loginStatus('a[data-app-role="loginstatus"]')},Web.Membership.prototype.showLogin=function(){var t=this._loginDialog,r,i;if(!t){this._login_CompletedHandler=Function.createDelegate(this,this._login_Completed);this._method_FailureHandler=Function.createDelegate(this,this._method_Failure);t=this._loginDialog=$(String.format('<div id="app-popup-login" data-role="popup" data-theme="a" data-overlay-theme="a" class="app-popup app-popup-login"><div role="banner" class="ui-header ui-bar-a"><h1 class="ui-title" role="heading" aria-level="1">{6}<\/h1><\/div><div role="main" class="ui-content"><div><label for="UserName">{1} {2}<\/label><\/div><input type="text" id="UserName" placeholder="{3}"/><input type="password" id="Password" placeholder="{4}"/>{5}<div class="app-popup-buttons"><a href="#" class="login-button ui-btn ui-corner-all ui-mini">{7}<\/a><\/div><\/div><\/div>',d.HelpCloseButton,d.LoginLink,d.LoginText,d.UserName.replace(/:/,""),d.Password.replace(/:/,""),this.get_displayRememberMe()?String.format('<label for="RememberMe"><input type="checkbox" id="RememberMe" />{0}<\/label>',d.RememberMe):"",n.appName(),d.LoginButton)).appendTo(u).popup(hf());r=this;this._userName=t.find("input:text").textinput().get(0);this._password=t.find("input:password").textinput().get(0);this._rememberMe=t.find("input:checkbox").checkboxradio().get(0);i=t.find("a.login-button").on("vclick",function(){return b(),o(i,function(){f(i,!1);r.login()}),!1});t.find("input").on("keydown",function(n){if(n.which==13)return b(),setTimeout(function(){i.trigger("vclick")},200),!1})}t.popup("open")});Web.Mobile=function(){var n=this;n._asyncJob=0;n._pageMap={};n._pages=[];n._toolbar=$("#app-bar-tools");n._actionButton=$(".app-btn-promo");n._toolbarButtons=n._toolbar.find(".app-btn");n._title=n._toolbar.find("h1");n._headingBar=$("#app-bar-heading");n._menuButton=$("#app-btn-menu");n._contextButton=$("#app-btn-context");n._modalDataViews=[];n._modalStack=[]};Web.Mobile.prototype={settings:function(){return r},appName:function(){return $("#PageHeaderBar").text()},height:function(){var n=g.height();return navigator.userAgent.match(/Mobile.+Safari/)&&!navigator.userAgent.match(/Chrome/)&&(n+=60),n},page:function(n){var t;if(n||(n="Main"),t=$("#"+n),t.length==0){t=$(String.format('<div data-role="page" id="{0}"><div data-role="content"/><\/div>',n)).appendTo(u).page();var r=i.activePage,f=r.css("min-height"),e=r.css("padding-top"),o=this.pageInfo(n);re(t);vt(t)}return t},activeLink:function(n,t){$(i.activeClickedLink).is(".app-tab-active")||i.removeActiveLinkClass(!0);n&&(n=$(n).closest("a"),n.is(".app-btn-static")||(n.addClass("ui-btn-active"),(t==null||t)&&(i.activeClickedLink=n)))},blink:function(n,t){f(n);setTimeout(function(){f();setTimeout(function(){f(n);setTimeout(function(){f();t&&t()},200)},200)},200)},content:function(n){var t=this.page(n),i=t.find('div[data-role="content"] .app-wrapper:last');return i.length?i:t.find('div[data-role="content"]')},showContextPanel:function(n,t,i){p(n,"#"+t,i)},toggleContextPanel:function(n){this.contextScope()&&(n+="-scope");$(n).panel("toggle")},causesCalculate:function(n){if(arguments.length==0)return oi.length?oi[0]:null;n==!1?(oi.length&&oi.splice(0,1),lu=null):oi.push(n)},callAfterCalculate:function(n){he(n)},callWithFeedback:function(n,t){o(n,t)},dataView:function(){var n=this.pageInfo();return n?n.dataView:null},prevPageInfo:function(){var t=i.navigate.history.stack,r,u;return t.length>1&&(r=t[t.length-2].pageUrl,r&&(u=n.pageInfo(r))),u},pageInfo:function(n){if(n?n.selector!=null&&n.length!=null&&(n=n.attr("id")||""):n=a(),typeof n=="string")return this._pageMap[n];if(n)this._pageMap[n.id]=n,n.dataView&&n.dataView._id&&(this._pageMap[n.dataView._id]=n),this._pages.push(n);else return null},dataViewUIPage:function(n){return $("#"+n._id)},dataViewUILinks:function(n){return this.dataViewUIPage(n).find('ul[data-role="listview"] li a')},unloading:function(){ui()},listPopup:function(n){li(n)},promo:function(n,t){function f(){i.is(".ui-disabled")||!r.promoteActions?i.hide():$(".ui-popup-active").length?i.hide().addClass("app-hidden"):i.show()}var i=this._actionButton,u;if(arguments.length==0)return i;if(typeof n=="boolean")n?f():i.hide();else if(typeof n=="string")return u=i.data("icon"),u&&i.removeClass("ui-icon-"+u),i.addClass("ui-icon-"+n).data("icon",n).attr("title",t),n.match(/(delete|minus|trash)/)?(i.hide().addClass("ui-disabled"),!1):(i.removeClass("ui-disabled"),f(),!0)},toolbar:function(n){var t=this._toolbar;return typeof n=="boolean"?n?t.show():t.hide():typeof n=="string"&&this._title.text(n),t},search:function(i,r){function c(){if(ru=$(".ui-title,#app-btn-menu,.app-btn-cluster-right").hide(),at=n._toolbar.find("#app-controls-find"),at.length==0){at=$('<div id="app-controls-find" class="app-bar-search"><form><label for="app-text-search" class="ui-hidden-accessible">Search:<\/label><input type="search" id="app-text-search" data-role="search" placeholder="Quick Find - Products" data-mini="true"/><a href="#" class="ui-btn-right ui-btn ui-icon-back ui-btn-icon-notext ui-shadow ui-corner-all"/><\/form><\/div>').insertBefore(n._toolbar.find(".ui-title"));n._searchInput=u=at.find("input").textinput({mini:!0,clearBtnText:t.ClearText}).attr("type","text").keydown(function(n){if(n.which==27)return u.blur(),!1}).blur(function(){ku(!0);setTimeout(function(){f();ru.show();at.hide();w();var t=n.dataView();t&&t._totalRowCount==-1&&t.sync()},200)});u.parent().find(".ui-input-clear").on("vmousedown",function(){return fs(u,0),$(this).trigger("click"),!1});at.find("form").submit(function(){return u.blur(),h(u.val()),!1});var i=at.find("a:last").attr("title",nu.CancelButton).on("vclick",function(){return o(i,function(){u.blur()}),!1})}u.attr("data-scope",r.scope)}function h(t){var f=n.pageInfo(u.attr("data-scope")||r.scope),i=f.dataView,e=i.extension();i._busy()||(kr(i),e.quickFind(t),n.toolbar(n.title()),ee())}var u=$(n._searchInput).attr("data-scope",r.scope),e=r&&r.text,s;if(i=="configure")r.focus?(c(),at.show(),ku(!1),r.placeholder&&u.attr("placeholder",r.placeholder),e?(u.val(e),s=u.parent().find("a"),e?s.removeClass("ui-input-clear-hidden"):s.addClass("ui-input-clear-hidden")):u.val(""),u.focus().select()):(ru&&ru.show(),at&&at.hide(),typeof e!="undefined"&&u.val(e)),u.attr("data-scope",r.scope);else if(i=="execute")h(r.text);else return u.val()},headingBar:function(){return this._headingBar},enumerateFields:function(n,t,i,r){var u=n._allFields,f=i==null;r||(r=n.extension().commandRow());f?(i=[],$(u).each(function(){this.ShowInSummary&&!this.Hidden&&i.push(this)})):t.push({text:n.get_view().Label,theme:"a",isStatic:!1,instruction:!0});$(i).each(function(){var i=u[this.AliasIndex],f=r[i.Index],e=i.text(f);i.OnDemand?i.OnDemandStyle==0&&f&&!f.match(/^null/)&&t.push({src:String.format("{0}blob.ashx?{1}=t|{2}",n.resolveClientUrl(n.get_appRootPath()),i.OnDemandHandler,f),desc:i.HeaderText,display:"before"}):tf(i)&&f?t.push({text:e,desc:i.HeaderText,href:"tel:"+e,icon:"phone"}):rf(i)&&f?t.push({text:e,desc:i.HeaderText,href:"mailto:"+e,icon:"mail"}):t.push({text:e,desc:i.HeaderText,isStatic:!0,display:"before"})})},infoView:function(n,i,r){var e=[],s=i?"left":null,o,f,u;for(i||e.push({text:t.Back,callback:ur,icon:"back"});n;)o=n.extension().itemMap(),f=n._allFields,u=[f[o.heading]],$(o.desc).each(function(){u.push(f[this])}),$(n._fields).each(function(){this.Hidden||u.indexOf(f[this.AliasIndex])!=-1||u.push(this)}),this.enumerateFields(n,e,u,r),n=$app.find(n._filterSource);p(e,"#app-panel-info-view"+(s?"-standalone":""),{position:s,className:"app-panel-info-view"})},modalDataView:function(n){var t=this,i,r;n?(i=t.pageInfo(n),r=t.page(n),fu&&(i.text=fu,fu=null),i.dataView._lookupInfo||(r.is("app-modal-page")||r.addClass("app-modal-page app-form-page"),i.dataView._isModal=!0),t._modalDataViews.push(n),t.changePage(n)):($(t._modalStack).each(function(n){var i=this,r=$("#"+i.id),u=i.dataView;u.dispose();r.page("destroy").remove();n=t._modalDataViews.indexOf(i.id);t._modalDataViews.splice(n,1);n=t._pages.indexOf(i);t._pages.splice(n,1)}),t._modalStack=[])},unloadPage:function(n,t){var i=this.pageInfo(n),u;if(i&&(u=this._modalDataViews.indexOf(i.id),u>=0)){var e=i.dataView,o=$app.find(e._parentDataViewId),r=this.pageInfo(t),f=r?this._modalDataViews.indexOf(r.id):-1;(r&&o==r.dataView||t.attr("id")=="Main"||f>=0&&u>f)&&this._modalStack.indexOf(i)==-1&&this._modalStack.push(i)}},busy:function(n){var t=this,i=t._busy==!0;if(arguments.length==1)t._busy=n;else return i?!0:(t._busy=!0,setTimeout(function(){t._busy=!1},900),!1)},executeInContext:function(t,i){var r=[];n.navContext(r);$(r).each(function(){var r=this;if(t&&r.icon==t||!t&&r.text==i)return n.busy()||st(r),!1})},navigate:function(t){setTimeout(function(){n.changePage(t)},300)},changePage:function(n,t){var h=i.activePage,c;if(it(),vr(!0),this.pageInit(n)){c=this.page(n).css("padding-top",h.css("padding-top"));var s=r.pageTransition,u=this.pageInfo(n),l=u.home?"fade":u.transition||s,a=i.navigate.history,e,f,o;f=u.replaceUrl;i.changePage("#"+n,{changeHash:!(t==!1)&&!u.home,transition:l});e=a.stack;o=e[e.length-1];f&&(u.replaceUrl=null,absUrl=i.path.makeUrlAbsolute(f,i.path.documentBase),$("#"+n).attr("data-url",f),i.navigate.navigator.squash(f),o.url=absUrl);u.home&&(o.transition=s)}},title:function(){var t=a(),n=this.pageInfo(t),i=n&&n.dataView;return document.title},navContext:function(i,r){var f=this,e=f.contextPageInfo(),v=e,u=e&&e.dataView,h=u,o=h&&h.extension(),a=u&&u.get_useCase(),s=u&&u.extension(),c=!0,l=-1;s&&(r||s&&s.context(i),e.dataView._parentDataViewId&&(e=f.pageInfo(e.dataView._parentDataViewId),u=e.dataView,l--));!o||o.inserting()||o.lookupInfo()||$(f._pages).each(function(){var o=this,e=o.dataView,v=e&&e.extension(),s,h=!1;e&&(s=!e._hidden&&!e._parentDataViewId,s&&(u&&u._filterSource?(s=$app.find(u._filterSource)==e,h=s,s||(s=$app.find(e._filterSource)==u)):s=e._filterSource?$app.find(e._filterSource)==u:!1));!s||a||o.external||(c&&(r||i.push({}),c=!1),h&&!f.contextScope()&&i.push({text:f._masterHeading,desc:o.text,icon:"info",callback:function(){n.infoView(e,eu=="toolbar")},system:!0}),f.contextScope()&&h||i.push({text:h?t.Back:o.text,icon:h?"back":null,count:h?null:v&&!v._reset?e._totalRowCount:null,callback:h?function(){y.history.go(l)}:function(){f.changePage(o.id)},system:!0,navigateTo:h?"master":"detail",context:o&&o.id,activator:o&&o.activator}))})},refreshAppButtons:function(f,e){var a=this,et=a._title.offset().left+a._title.outerWidth()-1,c,o,p=[],l,s=[],w={search:yf.PerformAdvancedSearch},v=[],nt,tt,k,it,rt,y=n.dataView(),d=0,h,ut=e&&e.buttonBars||i.activePage.find(".app-bar-buttons"),ft,g,b;if((!e||e.toolbar)&&(f.length?a._contextButton.show():a._contextButton.hide(),a._toolbarButtons.each(function(){c=$(this);c.show();c.offset().left>et&&p.push(c);c.hide()}),l=p.length,l>0)){for($(f).each(function(){var n=this;o=n.icon;showOnToolbar=n.toolbar!=!1&&o!="dots"&&o!="back";o&&(o=="search"?rt=!0:o=="refresh"?tt=!0:o=="phone"?nt=!0:o=="mail"?it=!0:o=="eye"&&showOnToolbar?k=!0:showOnToolbar&&s.indexOf(o)==-1?s.push(o):o=null,o&&(w[o]=n.text+(n.desc?"\n"+n.desc:"")))}),it&&s.push("mail"),nt&&s.push("phone"),k&&s.push("eye"),tt&&s.push("refresh"),s.length&&y.get_isGrid()&&!y.get_isEditing()&&r.promoteActions?n.promo(s[0],w[s[0]])&&(n.promo().data("icon-list",k?{icons:s.slice().reverse(),labels:w}:null),v.push(s[0]),s.splice(0,1)):n.promo(!1),rt&&(s.length<l?s.push("search"):s[l-1]="search"),s.length<l&&(d=l-s.length),h=0;h<d;h++)$(p[h]).hide();while(h<l)c=$(p[h]),o=s[h-d],ft=c.data("icon"),c.removeClass("ui-icon-"+ft).addClass("ui-icon-"+o).data("icon",o).show(),c.attr("title",w[o]),v.push(o),h++;y&&y.get_searchOnStart()&&(y.set_searchOnStart(!1),setTimeout(function(){$(".app-btn.ui-icon-search").trigger("vclick")},500))}for(ut.length&&ut.each(function(){var i=$(this),n,e,s,r,o,h;if(i.is(":visible"))if(i.children().remove(),g)i.append(g.html());else if(g=i,b||(b=[],$(f).each(function(){var n=this,t=n.icon;!n.system&&t!="dots"&&n.text&&n.uiScope=="Form"&&b.push(n)})),$(b).each(function(){var n=this;$('<a href="#app-action" class="ui-btn ui-corner-all ui-mini"/>').text(n.text).appendTo(i)}),r=i.width(),n=i.find(".ui-btn:last"),n.length&&n.position().left+n.outerWidth()>r&&(i.find(".ui-btn").css("min-width","8em"),n.length&&n.position().left+n.outerWidth()>r)){if(i.find(".ui-btn").css("min-width","4em"),n.length&&n.position().left+n.outerWidth()>r)for(e=$('<a href="#app-action" class="ui-btn ui-corner-all ui-mini app-btn-more"/>').html("&nbsp;").attr("title",t.More).appendTo(i);n.length&&e.position().left+e.outerWidth()>r;)n=n.hide().prev();u.is(".app-buttons-text-only")||(o=0,s=i.find(".ui-btn:visible").each(function(){o+=$(this).outerWidth(!0)}),h=Math.ceil((r-o)/(s.length-(e?1:0))),i.find(".ui-btn:visible:not(.app-btn-more)").each(function(){var n=$(this);n.width(n.width()+h)}))}});v.length;)for(h=0;h<f.length;)f[h].icon==v[0]?(f.splice(h,1),v.splice(0,1)):h++},endModalState:function(t,r,u){var f=this.pageInfo(t._id),e=this.pageInfo(r._id);f.refreshCallback=function(){history.go(-1)};di=function(){it();i.navigate.history.clearForward();n.modalDataView();var r=t.get_parentDataView(),e;r&&(e=n.pageInfo(r._id),e.echoChanged=!0,r.get_isEditing()||(e.initCallback=function(){r.sync()}));u&&(f.echoInitialized!=null&&f.id!=a()?f.echoRefreshCallback=u:u())};nt(!0);f.requiresReturnCallback=!0;t.sync()},renderContext:function(n,t,i){var r=!1;$(t).each(function(){var e,h;if(!i||i(this)){var t=this,u=$("<li>").attr({"data-icon":t.icon,"data-theme":t.theme||"a"}).appendTo(n),f,o=!1,s;t.callback||t.dataRel?(f=$('<a href="#"/>').appendTo(u).text(t.text).data("context-action",t),t.count!=null&&$('<span class="ui-li-count"/>').appendTo(f).text(t.count),t.dataRel&&f.attr("data-rel",t.dataRel)):t.href?(u.attr("data-icon",t.icon),f=$('<a href="#" rel="external"/>').appendTo(u).text(t.text).data("context-action",t).attr("href",t.href)):t.isStatic?u.html(t.text):t.src?$('<img class="ui-li-thumb"/>').appendTo(u.addClass("ui-li-has-thumb")).attr({src:t.src}):(r?u.remove():(s=u.attr("data-role","list-divider").html(t.text),!t.isStatic&&t.text&&t.instruction!=!1&&s.addClass("app-list-instruction")),r=!0,o=!0);o||(r=!1);t.desc&&(e=t.display=="before",e&&$('<p class="app-item-desc app-item-desc-before"/>').insertBefore((f?f:u).contents()).text(t.desc),h=$('<p class="app-item-desc"/>').appendTo(f?f:u).text(t.desc),e&&h.addClass("app-item-desc-after"));t.wrap&&u.addClass(t.callback?"app-wrap-text":"app-wrap");t.disabled&&u.addClass("ui-disabled");t.itemClassName&&u.addClass(t.itemClassName);t.linkClassName&&f.addClass(t.linkClassName);t.keepOpen&&(f.addClass("app-keep-open"),t.animate||f.addClass("app-btn-icon-transparent"));t.animate&&f.addClass("app-animated app-animation-spin")}})},tabs:function(n,r){function e(){var s=r.tabs,c=r.placeholder||$(s[0].content[0]),n=$('<div class="app-tabs ui-header ui-bar-inherit"/>').insertBefore(c).addClass(r.className),t=$('<div class="ui-navbar"/>').appendTo(n),l=$("<ul/>").appendTo(t).addClass("ui-grid-"+String.fromCharCode(97+s.length-2)),h=s[0].text,e;r.id||(r.id=c.attr("id"),r.id&&(r.id+="_tabs"));r.id&&(n.attr("id",r.id),h=hi(r.id)||h);$(s).each(function(n){var t=this,i=$('<a class="ui-btn"/>').appendTo($("<li/>").addClass("ui-block-"+String.fromCharCode(97+n)).appendTo(l)).text(t.text);t.active=t.text==h;t.active&&i.addClass("ui-btn-active app-tab-active")});t.on("vclick",function(h){var c=$(h.target).closest("a"),g=t.find(".app-tab-active"),a=n.parent(),l=a.find(".app-stub,.app-stub-main"),p=arguments.length!=2?null:arguments[1].selectedTab,w=e||p||c.text(),k=i.activePage,v,y=0,d,b;if(p&&(e=p),c.length)if(!e&&c.is(".app-tab-more"))t.find(".ui-btn").removeClass("ui-btn-active"),o(c,function(){c.addClass("ui-btn-active");b=[];$(r.tabs).each(function(n){var i=this;b.push({text:i.text,icon:i.active?"check":!1,wrap:!0,context:{text:i.text,index:n},linkClassName:"app-btn-icon-transparent",callback:function(n){c.removeClass("ui-btn-active");e=n.text;$(t.find(".ui-btn")[n.index]).trigger("vclick")}})});li({items:b,anchor:c,afterclose:function(){setTimeout(function(){c.removeClass("ui-btn-active");t.find(".app-tab-active").addClass("ui-btn-active")},50)}})});else{if(t.find(".ui-btn").removeClass("app-tab-active ui-btn-active"),c.addClass("app-tab-active ui-btn-active"),$(s).each(function(){var n=this;n.active&&(w==n.text&&(d=!0),$(n.content).each(function(){y+=$(this).outerHeight(!0)}));n.active=n.text==w;n.active&&(v=n)}),d){e=null;return}hi(r.id,w);y&&l.length&&l.offset().top+l.outerHeight()-y<a.offset().top+a.height()&&l.height(y+l.outerHeight());te(k);f(n);e&&(e=null,u(n));v.callback&&v.callback();r.change&&(ti=!1,r.change(v),du(k));ps(a,l)}return!1});n.data("data-tabs",r.tabs);f(n);u(n,!1)}function s(n){n||(n=r.container?r.container.find(".app-tabs"):i.activePage.find(".app-wrapper .app-tabs"));n.data("data-tabs",null).remove()}function f(n){n||(n=i.activePage.find(".app-wrapper .app-tabs"));$(n).each(function(){$($(this).data("data-tabs")).each(function(){var n=this;$(n.content).each(function(){n.active?$(this).removeClass("app-tab-hidden"):$(this).addClass("app-tab-hidden")})})})}function u(n,u){n||(n=(r&&r.page||i.activePage).find(".app-tabs"));$(n).each(function(){function a(t){i.attr("class","ui-grid-"+String.fromCharCode(97+n.length-2));t&&(v.width("").show(),i.css("max-width","").width(""),n.removeClass("app-tab-active app-tab-more ui-btn-active ui-last-child"),$(o.removeClass("app-tabs-expanded").data("data-tabs")).each(function(t){var i=this,r=$(n[t]).text(i.text);i.active&&r.addClass("ui-btn-active app-tab-active")}))}var o=$(this),i=o.find("ul"),r,v=i.find("li"),n=i.find(".ui-btn"),e=!0,h=0,s=0,c=!0,l,f;for(a(u!=!1);n.length>2&&e;)if(e=!1,n.each(function(){var n=this,t;n.scrollWidth>n.offsetWidth&&(e=!0,t=n.scrollWidth-n.offsetWidth+nr($(n).css("padding-right")),h+=t)}),e){if(i.parent().width()-i.outerWidth()>h){o.addClass("app-tabs-expanded");f=[];n.each(function(){var n=this,t=$(n),i=t.parent();n.scrollWidth>n.offsetWidth?f.push(n.scrollWidth+nr(t.css("padding-right"))):f.push(i.width());s+=f[f.length-1]});i.css("max-width",s).width(s);n.each(function(n){$(this).parent().width(f[n])});break}c?c=!1:(r=$(n[n.length-1]),l=r.is(".app-tab-active"),r.parent().hide(),n=n.slice(0,n.length-1),a());r=$(n[n.length-1]);r.text(t.More).addClass("app-tab-more ui-last-child");l&&r.addClass("ui-btn-active app-tab-active")}else break})}switch(n){case"create":r.tabs&&r.tabs.length>1&&e(r);break;case"destroy":s();break;case"fit":u()}},refreshMenuStrip:function(){var r=this._menuStrip,s=r&&r.strip,b=this._title,k=b.offset().left+b.outerWidth(),d=this._toolbar.find(".app-btn-cluster-right .ui-btn:visible").first(),p=(d.length?d.offset().left:this._toolbar.outerWidth())-10,w,c,v,h,g,l,u,nt,tt,it,f;if(!s){r=this._menuStrip={strip:$('<div class="app-menu-strip"/>').appendTo(this.toolbar())};s=r.strip;c=$("<ul/>");for(it in Web.Menu.Nodes){w=Web.Menu.Nodes[it];break}for(f=0;f<w.length;f++){var a=w[f],u=$("<li/>").appendTo(c),rt=$('<a class="ui-btn"/>').appendTo(u).text(a.title).attr({title:a.description}).data("data-node",a);a.children&&rt.addClass("app-has-children");a.selected&&rt.addClass("app-selected")}r.links=c.find(".ui-btn");r.items=r.links.parent();r.more=$('<a class="ui-btn app-has-children"/>').appendTo($("<li/>").appendTo(c)).text(t.More);function ft(n){n.url&&(n.target?y.open(n.url,n.target):y.location.href=n.url)}c.appendTo(s).on("vclick",function(t){var r=$(t.target).closest(".ui-btn"),f=r.is(".app-selected"),u=r.data("data-node"),h=u&&u.url&&!u.children;return r.length==0?!1:(h&&ui(),o(r,function(){if(h)ft(u);else{f||r.addClass("app-selected");var t=$('<div class="app-popup app-popup-listview app-popup-menu" data-theme="a"/>'),o=$('<div class="ui-panel-inner"/>').appendTo($('<div class="ui-content"/>').appendTo(t)),a=$('<ul class="app-listview"/>').appendTo(o),l,v,c,y=1;function p(n,t){if(n.title){var i=$('<li data-icon="false"/>').addClass("app-depth"+t).appendTo(a),r=$("<a/>").appendTo(i).text(n.title).attr("title",n.description).data("data-context",n);n.selected&&(v=r)}$(n.children).each(function(){p(this,t+1)})}u||(y=0,u={children:[]},s.find("li:hidden a").each(function(){u.children.push($(this).data("data-node"))}));p(u,y);v&&v.addClass("app-selected app-btn-icon-transparent").parent().attr("data-icon","check");a.listview().on("vclick",function(i){var r=$(i.target).closest(".ui-btn");return pt(r)&&n.callWithFeedback(r,function(){l=r.data("data-context");ut(t)}),!1});t.popup({history:!e(),transition:"fade",tolerance:3,arrow:"t,l,r,b",overlayTheme:"b",positionTo:r,beforeposition:function(){var u=i.getScreenHeight(),f=n.toolbar().outerHeight(),s=t.outerHeight(!0),r;s>=u-f&&(o.css("height",u-f*2.25),e()&&(r=o.width()+20,o.css({width:r}),t.css({minWidth:r,maxWidth:"auto"})))},afteropen:function(){sf(null,t)},afterclose:function(){f||r.removeClass("app-selected");l&&l.url&&ui();setTimeout(function(){to(a);fi(t);o.off();l&&ft(l)},100)}});ar(t);ae(t);t.popup("open").closest(".ui-popup-container").css("marginTop",nr(r.css("fontSize"))*2/3);c=o.find(".ui-btn.ui-icon-check").parent();c.length&&c.position().top+c.outerHeight()-1>o.outerHeight()&&o.scrollTop(c.position().top-(o.outerHeight()-c.outerHeight())/2)}}),!1)})}if(l=p-k,l!=s.data("tested-width")||!s.is(":visible"))if(s.data("tested-width",l),l>=50&&s.attr("data-enabled")!="false")for(lr(!0),s.width(l).css({left:k}),v=r.items,h=r.more.removeClass("app-selected").parent(),h.hide(),v.show(),f=v.length-1;f>=0;f--){if(u=$(v[f]),tt=u.outerWidth(),nt=u.offset().left,nt+tt-1>=p&&(h.show(),g=h.outerWidth(),u.hide()),u.is(":hidden")&&u.find(".app-selected").length&&r.more.addClass("app-selected"),!h.is(":visible")||h.offset().left+g-1<p){f<=1&&!u.is(":visible")&&lr(!1);break}else u.hide(),u.find(".app-selected").length&&r.more.addClass("app-selected");if(f<=1){lr(!1);break}}else lr(!1)},refreshSideBar:function(i,r){function v(){s=!1;ss(r);h!="Grid"&&r.push({text:t.Grid,icon:"grid",callback:function(){e.viewStyle("Grid")}});h!="Cards"&&h!="List"&&r.push({text:t.Cards,icon:"bullets",callback:function(){e.viewStyle("Cards")}});h!="Map"&&e.tagged("supports-view-style-map")&&r.push({text:t.Map,icon:"location",callback:function(){e.viewStyle("Map")}});ss(r)}var y=this,p=gu().find(".ui-panel-inner"),c=n.pageInfo(),u=c&&c.dataView,f=u&&u.get_parentDataView(u),o=[],l=$(".TaskBox.About .Inner .Value"),a=f&&!f._parentDataViewId,s=u&&u.get_isGrid(),e=u&&u.extension(),h=s&&e.viewStyle();if(a){for(u=f;u;)u.get_showInSummary()&&!u.get_isInserting()&&u.extension().commandRow()&&o.unshift(u),u=$app.find(u._filterSource);$(o).each(function(){n.enumerateFields(this,r)});r.length&&(u=o[o.length-1],r.push({text:u.get_view().Label,icon:"info",callback:function(){n.infoView(u,!0)}}),r.push({}))}$(i).each(function(){var n=this;["back","check","info"].indexOf(n.icon)!=-1||n.system&&n.toolbar==!1||n.icon=="eye"&&(!f||f.get_showInSummary())||(n.text||r.length)&&(n.navigateTo&&s&&v(),n.theme=null,r.push(n))});s&&v();l.length&&a!=!1&&r.push({text:l.html(),isStatic:!0,wrap:!0})},contextPageInfo:function(){return n.pageInfo(this._contextScope)},refreshContext:function(){w()},contextScope:function(n){if(arguments.length==0)return this._contextScope;this._contextScope=n},contextDataView:function(){return this.contextPageInfo().dataView},showContextMenu:function(t){var i="#app-panel-context";t&&(this.contextScope(t.scope),t.scope&&(i+="-scope",t.position="left"));fh(i,function(){n.refreshContextMenu(i)},t).panel("toggle")},refreshContextMenu:function(n,i){var o=this,r=$(n),f=r.find("ul"),a=f.outerHeight(),h,c,e=r.is(".app-sidebar"),s,l;if(e&&!r.is(":visible")){i=[];o.navContext(i);o.refreshAppButtons(i);return}for(e&&(c=$("<div><\/div>").appendTo(u).css({"z-index":2e3,position:"absolute",left:0,top:r.css("top"),width:r.outerWidth(),height:g.height(),"background-color":"#fff"})),a&&(h=$("<div><\/div>").height(a).insertAfter(f)),er(f),f.find("a").data("context-action",null),f.find("li").remove(),i||(i=[],i.isSideBar=e,o.navContext(i)),e&&(o.refreshAppButtons(i),l=[],this.refreshSideBar(i,l),i=l),s=$.Event(e?"sidebar.app":"contextmenu.app"),s.context=i,s.panel=r,$(document).trigger(s);i.length&&!i[i.length-1].text&&!i[i.length-1].src;)i.splice(i.length-1);i.length||e||i.push({text:t.EmptyContext});this.renderContext(f,i);f.listview("refresh");e&&f.find("a.ui-btn-icon-right").removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left");f.find("li.app-wrap").addClass("ui-li-static ui-body-a").find("a").attr({"class":""});r.is(".app-reset-scrolling")?r.find(".ui-panel-inner").scrollTop(0):rl(r);h&&h.remove();c&&c.remove()},masterDetailStatus:function(n){var u=this.pageInfo(n),t,i;if(u!=null&&(t=u.dataView,t&&t._filterSource&&(i=$app.find(t._filterSource),i))){var f=i.extension(),e=f.itemMap(),s=i._allFields,o=f.commandRow(),r;e&&o&&(r=s[e.heading],v=o[r.Index],v=r.text(v),this._masterHeading=v)}},focus:function(t,r){var y=this,a=i.activePage,u=a.find(".app-field-"+t),f,e,o,c,s=$(".app-popup-message"),h=a.find(".app-tabs-form"),l,v;s.length||u.length&&(f=u.closest("li"),u.attr("type")=="hidden"&&(u=f.find('input[type="text"]')),h.length&&(l=n.dataView(),v=l.findField(t),$(l._categories).each(function(){var n=this;if(n.Index==v.CategoryIndex)return h.find(".ui-btn").each(function(){var t=$(this);if(n.Tab==t.text())return t.is(".ui-btn-active")||t.trigger("vclick"),!1}),!1})),u.closest(".ui-collapsible").find(".ui-collapsible-heading-collapsed .ui-btn").trigger("vclick",!1),o=y.screen(),e=f.offset().top,(e<o.top||e+f.outerHeight()>o.bottom-(h.length?h.outerHeight():0))&&(c=e-(o.height-f.outerHeight())/2,g.scrollTop(c>0?c:0)),s=$('<div class="ui-content app-popup-message"/>').html(r).popup({history:!1,arrow:"t,b",overlayTheme:"b",positionTo:u,afteropen:function(){},afterclose:function(){fi(s);u.focus()}}).popup("open").on("vclick",function(){return ut(s),!1}))},showLookup:function(n){var l=this.pageInfo(),o=l.dataView,t=n.field,s=t._dataView,h=s.get_contextFilter(t,s.extension().collect()),i,r,f,e=n.query,c=n.aliasField.HeaderText;this.modalDataView();i=n.field.ItemsDataController.toLowerCase();$find(i)&&(i+=Sys.Application.getComponents().length);e&&hi(i+"_"+(hi(i+"_viewId")||t.ItemsDataView||"grid1")+"_filter",[String.format("_quickfind_:~%js%{0}",Sys.Serialization.JavaScriptSerializer.serialize(e))]);r=$create(Web.DataView,{id:i,baseUrl:o.get_baseUrl(),servicePath:o.get_servicePath(),controller:t.ItemsDataController,viewId:t.ItemsDataView,externalFilter:s.get_contextFilter(t,h),externalFilter:h,filterSource:h.length>0?"Context":null,showSearchBar:!0,showFirstLetters:t.ItemsLetters,searchOnStart:t.SearchOnStart,description:t.ItemsDescription},null,null,$("<div>").hide().appendTo(u).attr("id",i+"Placeholder")[0]);f=this.pageInfo(r._id);e&&r.viewProp("quickFind",e);f.headerText=n.value?[n.text,c]:c;f.resolved=!0;r._lookupInfo=n;n.value==null||t.ItemsValueSyncDisabled||(r._syncKey=[n.value],r._selectedKey=[n.value]);r._parentDataViewId=o._id;this.modalDataView(f.id)},pageInit:function(n,t){var i=this.pageInfo(n),r,u;return i==null?!1:(r=i.dataView,u=i.initialized||!i.dataView&&i.initialized!=!1,r&&r._busy())?!1:(i.initialized||(i.initialized=!0,r&&(i.requiresInitCallback=!0,t!=!1&&nt(!0),i.refreshed==!1?(i.refreshed=!0,r.extension().refresh()):r._loadPage())),u)},pageShow:function(n){var t;if(i.activePage&&(i.activePage.find("[data-role='navbar'] a.app-tab-active").addClass("ui-btn-active"),t=this.pageInfo(n),t!=null)){var r=t.dataView,u=r?r.extension():null,f=this._modalStack.indexOf(t);f>=0&&this._modalStack.splice(f,1);t.initialized||(t.initialized=!0,r&&r._loadPage());u&&u._reset&&u.refresh()}},screen:function(){var n=i.window.scrollTop(),t=this.toolbar().outerHeight(),r=i.getScreenHeight();return{top:n+t,bottom:n+i.getScreenHeight(),height:r-t,width:g.width()}},callWhenVisible:function(n,t){i.activePage.find(n).each(function(){var n=$(this),i=n.offset().top,u=i+n.outerHeight(),e=n.closest(".app-wrapper"),r=e.offset().top,f=r+e.height()-1;(r<=i&&i<=f||r<=u&&u<=f||i<=r&&f<=u)&&t(n)})},asyncJob:function(){return this._asyncJob},nextAsycJob:function(){return++this._asyncJob},supports:function(n){switch(n){case"Map":return this._supportsMap==!0}return!1},registerAPI:function(n){var t=this,i="https://maps.googleapis.com/maps/api/js?&v=3.exp&sensor=false&callback=appFactoryCallback";r.mapApiIdentifier&&!y.location.host.match(/^localhost\b/)&&(i+="&"+r.mapApiIdentifier);n!="Map"||t._mapApiRegistered||(t._mapApiRegistered=!0,y.appFactoryCallback=function(){y.appFactoryCallback=null;t._supportsMap=!0;$(document).trigger($.Event("appmapinit"))},$('<script type="text/javascript"/>').attr("src",i).appendTo(u))},fetchOnDemand:function(){function n(n){n.trigger("vclick")}return ti||(this.callWhenVisible(".dv-load-at-bottom",n),this.callWhenVisible(".dv-load-at-top",n)),this},headingOnDemand:function(n){var o=this,t=i.activePage.find(".dv-heading"),f=t.attr("data-selector"),e=f?i.activePage.find(f):t.find(".app-static-text"),r=o.headingBar(),s,c=!0,u,a;if(!l&&(e.length||f))if(n===!1)u=r.find(".app-grid-header"),u.length?u.is(".app-disabled")||r.slideUp("fast",function(){a=u.parent();u.detach();a.empty();u.appendTo(a);r.slideDown("fast");u.addClass("app-disabled");u=t.find(".app-grid-header").detach();t.empty();u.appendTo(t)}):(t.addClass("app-disabled"),r.slideUp("fast")),c=!1;else if(!t.is(".app-disabled")&&!h){var p=o.screen(),w=Math.ceil(e.length?e.offset().top+(f?1:0):-1),v,y=i.activePage.find("> .ui-content > .app-tabs");w<p.top&&(f||e.height()>0)&&(r.is(":visible")?c=!1:(s=r.css("top",o.toolbar().outerHeight()+(y.length?y.outerHeight():0)-1+"px").find("span.app-bar-text"),f?(s.html(t.html()).css("white-space","normal"),v=t.prev().find(".app-yardstick").attr("data-yardstick-class"),v&&s.find(".app-grid-header").attr("class","app-grid-header "+v)):s.text(e.text()).css("white-space",""),r.find("span.app-bar-label").text(e.closest("li").find("label:first").text()),c=!1,r.show()))}return c&&r.hide(),o},wait:function(){},start:function(t){function g(n){return $(n).each(function(){return this.url&&this.url.toLowerCase()==location.pathname.toLowerCase()?(h=this,!1):this.children&&(g(this.children),h)?(this.selected=!0,!1):void 0}),null}function tt(){var n=t&&$(t.selector).data("scripts");n&&eval(n);$(document).trigger($.Event("start.app"));setInterval(function(){oi.length&&!lu&&(lu=oi[0],$(document).trigger($.Event("calculate.app"),lu))},300)}function it(){n.tabs("create",{tabs:a,className:"app-tabs-echo",change:function(){ot()}})}var k,h,d;if(t||this._appLoaded&&this._pageCreated){i.ignoreContentEnabled=!0;var f=n.pageMenu(t&&t.pageId),w=0,s,b=$(t&&t.selector||"#PageContent"),e=b.attr("data-href"),p=b.find('div[data-app-role="page"]').each(function(i){var r=$(this),s=r.attr("data-content-framework");s&&r.attr("data-enhance","false");r=$(this).attr({"data-role":"page","data-app-role":null}).addClass("app-page-scrollable").appendTo(u);var a=r.attr("data-page-header"),h=rh(r),o={text:(a!="false"?a:"")||h.text||n.title(),description:h.description,activator:h,url:e,transition:t&&t.transition},c=r.attr("id")||ts(e||location.pathname)+(i>0||e?i+1:""),v,l;o.headerText=o.text;r.find('div[data-role="content"]').contents().wrapAll('<div class="app-page-content'+(s?" app-content-framework app-"+s:"")+'"/>');r.page();r.attr("id",c);o.id=c;n.pageInfo(o);l=re(r,!1).find(".app-page-content");s&&(r.attr("data-page-header","false"),$app.configureFramework(s,l,function(n){cr=n}));l.find(".carousel").on("swipeleft swiperight",function(n){$(n.target).closest(".carousel").find((n.type=="swipeleft"?".right":".left")+".carousel-control").trigger("click")});h.text&&(w++,v=$('<a class="app-action-navigate" />').attr("href","#"+c).text(h.text).appendTo($("<li/>").appendTo(f)),o.description&&$("<p/>").appendTo(v).text(o.description));as(r)});p.length&&(s=p.first(),w==0&&s.attr("data-activator")!="false"&&$('<a class="app-action-navigate" />').attr("href","#"+s.attr("id")).text(s.attr("data-page-header")||ao.SeeAlso).appendTo($("<li/>").appendTo(f)),f.is(".ui-listview")&&f.listview().listview("refresh"));for(d in Web.Menu.Nodes){k=Web.Menu.Nodes[d];break}t||g(k);h&&!p.length&&f.find("a").length==0&&$(h.children).each(function(){$('<a rel="external"/>').attr("href",this.url).appendTo($("<li/>").appendTo(f)).text(this.title)});var rt=this,o=t?n.page(t.pageId):i.activePage,c=o.find("a.app-action-navigate"),ut=location.href.match(/#(.+)$/),f,l,a=[],v,nt=this._pages[0];c.length==1&&(r.initialListMode=="SeeAll"||!nt.dataView||nt.dataView.get_lastCommandName()||y.location.href.match(/_controller=.+_commandName=.+/))?$(this._pages).each(function(){var n=this,t=n.dataView;return go=t&&t._id,(!e||n.url==e&&!n.root)&&(!t||!t._hidden)?(e||(n.home=!0,e=i.path.documentBase.pathname),tt(),i.navigate.history.clearForward(),e&&(n.replaceUrl=e),rt.changePage(n.id),!1):void 0}):o.attr("id")=="Main"&&(c.length&&o.find('a[rel="external"]').parent().remove(),c.show(),re(o),o.addClass("app-page-scrollable"),et(document.title),l=o.find(".app-wrapper"),$(c).each(function(){var u=$(this),f=u.attr("href"),r=f&&n.pageInfo(f.substring(1)),i,e,t;r&&r.dataView&&(t=r.activator,t&&t.type=="Tab"&&($(a).each(function(){if(this.text==t.text)return i=this,!1}),i||(v!=t.container&&(v&&(it(),a=[]),v=t.container),i={text:t.text,content:[]},a.push(i))),e=th(r.id,l),i&&i.content.push(e),u.parent().remove())}),v&&it(),f=n.pageMenu(),f.find('a.app-action-navigate,a[rel="external"]').length?f.listview().show():f.remove(),vt(),l.find(".app-tabs").length>1&&$('<div class="app-stub-main"/>').appendTo(l),tt(),ot(),n.content().focus(),ds());t||setTimeout(function(){ns=!1},500)}},pageMenu:function(n){var r=this,i=this.content(n),t=i.find("ul.app-page-menu");return t.length||(t=$('<ul data-role="listview" data-inset="false" class="app-page-menu"/>').appendTo(i).hide().on("vclick",function(n){var t=$(n.target),i,u;return t.is("a")||(t=t.closest("a")),t.length&&(i=t.attr("href"),u=i.match(/^#/),u||ui(),o(t,function(){u?r.changePage(i.substring(1)):(f(t,!1),y.location.href=i)})),!1})),t},initialize:function(){function c(){var n=gi(),t;if(n-o>2500){if(t=$.Event("awake.app"),$(document).trigger(t),t.isDefaultPrevented())return;n=gi()}o=n;setTimeout(c,1250)}var l=this,o=gi(),t=i.path.parseUrl(location.href),r=t&&t.hash,u,s=$("head");gc();r&&(r.match(/\W/)||!$(r).length)&&(i.navigate.history.initialDst="",u=i.navigate.history.stack[0],u.url=t.hrefNoHash,u.hash="");rt?$('<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black'+(dr>=8?"-translucent":"")+'"/><link rel="apple-touch-icon" href="../touch/logo-icon.png"/>').appendTo(s):wi&&$('<meta name="mobile-web-app-capable" content="yes"/><link rel="icon" sizes="196x196" href="../touch/logo-icon.png"/>').appendTo(s);setTimeout(c,10);__settings.appInfo.match(/\|$/)||$("#app-welcome").remove();$(document).on("change",":input",function(n){var t=$(n.target),i=t.attr("data-passive-value");(i==null||i!=t.val())&&pu(t);i!=null&&t.attr("data-passive-value",null)}).on("keydown",":input",function(n){var t=$(n.target),i=t.attr("data-causes-calculate");i&&(cu==null&&(cu=t.val()),se(),hu=setTimeout(function(){cu!=t.val()&&(t.attr("data-passive-value",t.val()),pu(t));se(!0)},4e3))}).on("focus",":input",function(t){var i=$(t.target),s=i.parent(),r=i.data("format"),o,u;i.is("#app-text-search")||(h=i,f(),i.is(".app-lookup-input")&&i.next().addClass("ui-focus"),it(),r&&(o=i.val(),o&&r.type=="number"&&(i.val(r.value),u=i.val().length,i.get(0).setSelectionRange(u,u)),rt?setTimeout(function(){i.attr("type",r.type)},200):i.attr("type",r.type)),e()||(clearTimeout(vo),n.toolbar().css("position","absolute"),$(".app-sidebar").css("position","absolute")))}).on("blur",":input",function(t){var r,f,u,o=$(t.target),i=o.data("format");(se(!0),h)&&(h.is(".app-lookup-input")&&(f=h.data("link-text"),r=h.data("link-text",null).next().removeClass("ui-focus"),f&&(r.toggleClass("ui-icon-carat-r ui-icon-search").removeClass("app-transparent"),setTimeout(function(){r.data("link-text")&&r.text(f)},2500)),u=h.val().trim(),u&&(r.text(u).data("data-context").query=u),h.val("")),h=null,i&&(i.value=o.val(),i.value=i.value?parseFloat(i.value):null,i.text=i.value==null?"":i.field.text(i.value,!1),o.attr("type","text").val(i.text)),e()||(vo=setTimeout(function(){h||(n.toolbar().css("position",""),$(".app-sidebar").css("position",""))},1e3)))}).on("touchstart","a.app-lookup",function(){if(h){var n=h.val().trim();n&&h.next().text(n).removeClass("app-transparent")}}).on("touchend","a.app-lookup",function(){b()}).on("keydown",function(n){var t=n.which,r,i;if(t==13&&!$(n.target).is("textarea")&&h)return h.is(".app-lookup-input")&&(r=h.val().trim(),(r.length||ct)&&(h.next().data("data-context").query=r,h.next().trigger("vclick"))),h.blur(),!1;if(!h&&(t==13||t==32||t==27)&&(i=$(".ui-popup-active .app-popup"),i.length)){if(i.is(".app-popup-alert"))return i.find(".ui-btn").trigger("vclick"),!1;if(i.is(".app-popup-confirm")&&t!=32)return i.find(t==13?".app-btn-confirm":".ui-btn:not(.app-btn-confirm)").trigger("vclick"),!1}}).on("keyup",".app-lookup-input",function(n){var t=$(n.target),i=t.next();t.data("link-text")||setTimeout(function(){t.val()!=""&&(t.data("link-text",i.text()),i.html("&nbsp;").toggleClass("ui-icon-carat-r ui-icon-search app-transparent"))},10)})}},function(){var h,r,k,d,c,v;$.event.special.swipe.scrollSupressionThreshold=100;var g=/\b_touch_(\w+)=(\w+)\b/g.exec(location.href),y=i.focusPage;i.focusPage=function(n){y(n);vt(n);du(n)};i.resetActivePageHeight=function(t){var r=$("."+i.activePageClass);typeof t=="number"&&t--;t=t||i.getScreenHeight();t-=n.toolbar().outerHeight(!0);r.css("min-height",t)};u=$("body");ct&&u.addClass("app-desktop");ii&&navigator.maxTouchPoints>0&&(u.addClass("app-ms-tablet").removeClass("app-desktop"),co="touch");$("form:first").hide();var e=$('<div id="app-bar-tools" data-role="header" data-position="fixed" data-theme="a" class="app-bar-tools"/>"').appendTo(u),p=$('<div data-role="page" id="Main"/>').appendTo(u),s='<a href="#" class="ui-btn-right app-btn ui-btn ui-btn-icon-notext ui-shadow ui-corner-all"/>',nt=$('<a class="ui-btn ui-btn-a ui-btn-icon-notext app-btn-promo"/>').hide().appendTo(u).on("vclick",ic);$('<div data-role="content" class="app-content-main"/>"').appendTo(p);$('<a data-role="button" href="#" id="app-btn-menu" class="ui-btn ui-btn-icon-notext ui-shadow ui-corner-all ui-icon-bars app-animation-spin">Site Map<\/a>').appendTo(e);h=$('<h1 class="ui-title"/>').appendTo(e);r=$('<div class="app-btn-cluster-right"/>').appendTo(e);h.on("vclick",function(){l||$(".app-popup-message").length||(h.addClass("app-header-active"),setTimeout(function(){h.removeClass("app-header-active");a()=="taskassistant"?history.go(-1):nh()},200))});$(s).appendTo(r);$(s).appendTo(r);$(s).appendTo(r);$(s).appendTo(r);$(s).appendTo(r);$('<a href="#" id="app-btn-context" data-icon="dots" data-iconpos="notext" data-role="button" class="ui-btn-right app-btn-context"/>').appendTo(r).attr("title",t.More).hide();k=$('<div id="app-bar-heading" class="app-bar-heading ui-overlay-shadow"><span class="app-bar-label"/><span class="app-bar-text"/><\/div>').appendTo(u).hide().on("vclick",function(n){if(!$(n.target).closest(".app-grid-header").length)return ht(!1),w(),!1});d=e.find(".app-btn").data("icon","gear").on("vclick",ic);e.toolbar();c=$('<div id="app-sidebar" class="ui-panel ui-panel-fixed ui-body-a app-sidebar"><div class="ui-panel-inner"><ul/><\/div><\/div>').appendTo(u);v=c.find("ul");v.listview().on("vclick",function(t){if(bi||!pt(t.target))return!1;b();var i=$(t.target).closest("a"),r=i.data("context-action");if(i.length){if(r)return n.busy()||o(i,function(){st(r)}),!1;f(i,!1)}})}();n=$app.mobile=new Web.Mobile;n.activeLinkBlacklist=".ui-slider-handle";u.on("pagebeforeload",function(n,t){n.preventDefault();setTimeout(function(){location.replace(t.toPage)},200)}).on("pagecontainershow",function(){function i(){di&&(di(),di=null,t&&t.returnCallback&&(t.returnCallback(),t.returnCallback=null))}vr(!1);ds();ht();wt(100);setTimeout(function(){ot()},200);w();var t=n.pageInfo();t?t.initCallback?(t.initCallback(),t.initCallback=null):i():a()=="Main"&&i()}).on("pagecontainercreate",function(){n._shown||setTimeout(function(){n.start();n._shown=!0},100)}).on("pagecontainerbeforeshow",function(t,r){var e=i.activePage,f=n.pageInfo();n.toolbar(n.title());u.is(".app-page-header-hidden")?et(!1):et(f&&f.headerText||f&&f.dataView&&f.dataView.get_view().Label||document.title);n.pageShow(a());n.unloadPage(r.prevPage,e);fe();n.contextScope(null)}).on("pagecontainerbeforehide",function(t,i){if(l=!0,i.nextPage){var r=n.pageInfo(i.nextPage.attr("id"));r&&n.masterDetailStatus(r.id)}}).on("pagecontainerbeforetransition",function(){n.promo(!1);te(i.activePage)}).on("pagecontainertransition",function(){r&&(vr(!1),vt(),r.pageTransition=="none"&&du(i.activePage),ct&&$(i.activePage).find(".app-wrapper").focus())});$(document).ready(function(){n.initialize()}).on("calculate.app",function(t,i){var i=i.split(/\./),r;if(i[i.length-1]=="app")return r=n.pageInfo(i[1]).dataView,r.extension().calculate(i[0]),!1}).on("touchstart MSPointerDown pointerdown",function(t){if(!h&&cf(t)){if(l){t.preventDefault();return}lf=h==null;var r=$(t.target),i=r.closest("a"),u=oo=eo(t);r.closest(".app-echo").length&&(lf=!1);i.length&&(ai=i.data("touch-start",u),i.is(n.activeLinkBlacklist)||(i.parent().is("li")?rc=setTimeout(function(){ai&&f(ai,!1)},200):f(i,!1)))}}).on("touchmove MSPointerMove pointermove",function(n){if(cf(n)){var r,t=$(n.target),u=$(ai),e=t.closest(".ui-panel-inner,.app-wrapper"),i=eo(n),o=u.length&&u.data("touch-start"),s;if(rt&&(t.closest(".app-tabs,.app-map-info").length||t.closest(".app-bar-tools").length&&!t.closest(".ui-btn").length)){n.preventDefault();return}if(lf){if(lf=!1,e.length&&(i.y>oo.y?r=e.scrollTop()==0:i.y<oo.y&&(s=ie(e),r=s.height>=s.maxHeight-1)),r){af();f();n.preventDefault();rt&&(ti=!1);return}if(t.is(".ui-panel-dismiss,.ui-popup-screen,.app-scrollable-cover")){n.preventDefault();return}}u.length&&(o&&(Math.abs(o.x-i.x)>0||Math.abs(o.y-i.y)>0)&&f(),af())}}).on("touchend MSPointerUp pointerup",function(n){if(cf(n)){var t=$(n.target).closest("a"),r=eo(n),i=t.length&&t.data("touch-start");t.length&&(!i||Math.abs(i.x-r.x)>0||Math.abs(i.y-r.y)>0)&&n.preventDefault();af()}}).on("touchcancel MSPointerCancel pointercancel",function(n){cf(n)&&(f(),af())}).on("scrollstart.app",function(){fe()}).on("scrolldir.app scrollstop.app",function(t){if(t.relatedTarget){var f=$(t.relatedTarget),u=f.data("scroll-dir"),r=t.relatedTarget.find("ul:first").is(".app-grid"),i=r?n.headingBar().find(".app-grid-desc"):null;u=="up"?(r&&i.length&&!i.is(":visible")&&i.show(),ht()):u=="down"&&(r&&t.relatedTarget.scrollTop()!=0?r&&(i.length&&i.is(":visible")&&i.hide(),ht()):it());t.type=="scrollstop"&&(clearInterval(yo),yo=setTimeout(function(n){var t=ie(n);t.top<=0&&t.height<=t.maxHeight+1&&(wt(),ot())},250,t.relatedTarget))}}).on("contextmenu MSHoldVisual selectstart",function(n){e()||$(n.target).is(":input")||n.preventDefault()}).one("pagecreate","#Main",function(){n._pageCreated=!0}).on("pagebeforechange",function(t,i){if(typeof i.toPage=="string"&&i.toPage.match(/^http/))return(vr(!1),ns&&a()=="Main"&&location.href==i.toPage)?!1:void 0;if(i.options.deferred){var e=n.pageInfo(),f=$(i.toPage),r=n.pageInfo(f.attr("id")),u=r&&r.dataView;r&&!i.toPage.prevObject||(it(),extension=u&&u.extension(),n.search("configure",{allow:extension?extension.options().quickFind:!1}))}}).on("vmousedown",".app-static-label",function(){yc=h}).on("dblclick",".app-yardstick",function(n){if(ne(n)){bu();var i=$(n.currentTarget).attr("class").match(/app-width(\d+)/),t=$('<div class="ui-content app-popup-message"/>').text(String.format("Item Width: {0}em",i[1])).popup({history:!1,arrow:"b,t",x:n.clientX,y:n.clientY,overlayTheme:"b",afteropen:function(){},afterclose:function(){fi(t)}}).popup("open").on("vclick",function(){return ut(t),!1});return!1}}).on("dblclick",".app-static-text",function(t){var f;if(!ni&&(bu(),f=n.pageInfo(),f)){var r=f.dataView,e=r?r._allFields:null,u=$(t.target).attr("class").match(/(app-field-(\w+))/);return u&&r&&(bf=!1,r.extension().executeInContext("Edit",null,!0),setTimeout(function(){$(e).each(function(){if(e[this.AliasIndex].Name==u[2])return u=this.Name,!1});var n=i.activePage.find("*:input.app-field-"+u),t=n.parent().find(".app-lookup-input"),r=t.length?t:n;r.focus().select();bf=!0},500)),!1}}).on("vclick","a",ta).on("vclick",".app-grid-header > span:not(.app-btn-more)",function(n){var t=$(n.target),i={x:n.pageX,y:null};return t.is(".app-indicator")&&(t=t.parent()),t.addClass("ui-btn-active"),i.x&&(i.y=t.offset().top+t.outerHeight()*.75),setTimeout(function(){t.removeClass("ui-btn-active");gl(t,i)},200),!1}).on("keydown keypress",function(t){var y=$(t.target),l=n._toolbar,e,o=t.which,r,a,s,c,v,u;if((t.type!="keydown"||o==27)&&!h&&!y.is("#app-text-search")&&(e=String.fromCharCode(o),(e.match(/[\w\-\"]/)||o==27)&&(s=i.activePage.find(".app-wrapper"),s.length&&(c=s.offset().top,v=c+s.height()-1,i.activePage.find(".app-echo-controls .ui-btn.ui-icon-search").each(function(){var n=$(this),t;if(n.is(":visible")&&(t=n.offset().top,t>=c&&t<v-75))return r=n,u=$app.find(n.closest(".app-echo").attr("data-for")),!1})),r||(r=l.find(".ui-icon-search:visible"),u=n.dataView()),r.length))){if(o==27)if(u.extension().quickFind())u.extension().quickFind(""),kr(u);else return!1;else r.trigger("vclick",!1),a=l.find("#app-text-search"),fs(a.val(e),e.length);return f(r),setTimeout(function(){f()},200),!1}});g.on("resize",function(){so||(so=!0,ku(),$(".app-echo-controls").hide(),n._toolbarButtons.hide())}).on("throttledresize",function(){so=!1;kf();$(".ui-panel-dismiss").height(i.getScreenHeight());e()&&vt();w(!1,null,function(){it();ht();tr()});wt();clearTimeout(wo);wo=setTimeout(function(){var r=i.activePage.find(".app-wrapper"),t;wu(r,!0);ot(!0);ot(!1);n.refreshMenuStrip();t=a();$(n._pages).each(function(){var n=this;n.echoId&&n.id!=t&&$("#"+n.echoId+" .app-echo-controls").addClass("app-stale")})},1e3);var t=$(".ui-popup");t.is(".app-popup-message,.app-popup-listview")?ut(t):t.popup("reposition",{positionTo:"window"});ni=!1}).on("orientationchange",function(){setTimeout(function(){h||vt();setTimeout(function(){h||vt()},500)},500)});Sys.Application.add_init(function(){});Sys.Application.add_load(function(){n._appLoaded=!0});Web.DataView.MobileGrid.registerClass("Web.DataView.MobileGrid",Web.DataView.MobileBase);Web.DataView.MobileForm.registerClass("Web.DataView.MobileForm",Web.DataView.MobileBase)})()