function _body_hideLayoutContainers(){var n,t;if(Web.DataView._layoutContainers)for(n=0;n<Web.DataView._layoutContainers.length;n++)t=Web.DataView._layoutContainers[n],t.width!="100%"&&Sys.UI.DomElement.setVisible($get(t.id),!1)}function _body_resizeLayoutContainers(){var i=Web.DataView._layoutContainers,f,e,s,r,t,n;if(i&&i.length!=0&&(f=$get("PageContent"),f)){var o=$app.bounds(f),v=$app.paddingBox(f),y=$app.borderBox(f),p=$app.marginBox(f);for(o.width-=v.horizontal+y.horizontal+p.horizontal,e=i[i.length-1].rowIndex;e>=i[0].rowIndex;){for(s=0,r=0;r<i.length;r++)if(t=i[r],t.rowIndex==e&&!String.isNullOrEmpty(t.width)&&(n=$get(t.id),n)){var h=$app.paddingBox(n),c=$app.borderBox(n),l=$app.marginBox(n),a=t.width.match(/(\d+)(%|px|)/),u=a[2]!="%"?parseFloat(a[1]):Math.floor(o.width*parseFloat(a[1])/100);s+=u;u-=h.horizontal+c.horizontal+l.horizontal;t.width!="100%"?(n.style.width=u+"px",Sys.UI.DomElement.setVisible(n,!0)):$(n).removeClass("LayoutContainer").addClass("RowContainer")}if(s<o.width)for(r=0;r<i.length;r++)t=i[r],t.rowIndex==e&&String.isNullOrEmpty(t.width)&&(n=$get(t.id),n&&(h=$app.paddingBox(n),c=$app.borderBox(n),l=$app.marginBox(n),u=Math.floor((o.width-s)/t.peersWithoutWidth),u-=h.horizontal+c.horizontal+l.horizontal,u<1&&(u=1),n.style.width=u+"px",Sys.UI.DomElement.setVisible(n,!0)));e--}}}function _body_keydown(n){var t,i;if(n.keyCode==Sys.UI.Key.enter&&Web.DataView._focusedItemIndex!=null){if(t=$find(Web.DataView._focusedDataViewId),t&&t._get_focusedCell())return;i=$get(Web.DataView._focusedDataViewId+"_Item"+Web.DataView._focusedItemIndex);i&&i.tagName=="INPUT"&&i.type=="text"&&i==n.target&&(n.preventDefault(),n.stopPropagation(),t=$find(Web.DataView._focusedDataViewId),t&&t._valueChanged(Web.DataView._focusedItemIndex))}}function _body_resize(){Web.DataView._resizeInterval&&clearInterval(Web.DataView._resizeInterval);Web.DataView._resizing||Web.DataView._resized?$closeHovers():(Web.DataView._resizeInterval=setInterval(function(){_body_performResize()},10),_body_hideLayoutContainers(),_body_resizeLayoutContainers());Web.DataView._resized=!1}function _body_scroll(){var n=$getSideBar(),u,t,f;if(n){var i=$app.scrolling(),e=$common.getClientBounds(),r=$common.getBounds(n);n._originalTop==null&&(n._originalTop=r.y);u=n._originalTop;t=0;Web.DataView.MessageBar&&(f=$common.getBounds(Web.DataView.MessageBar._element),u+=t=f.height);i.y>n._originalTop&&r.height+4<=e.height&&i.x==0?(n.style.width=r.width+"px",Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<=6?(n.style.top=4+i.y+t+"px",n.style.position="absolute"):(n.style.top=4+t+"px",n.style.position="fixed")):(n.style.top="",n.style.width="",n.style.position="")}}function _body_createPageContext(n){var t=$get("PageContent");if(t){var r=$common.getBounds(t),u=$common.getPaddingBox(t),f=$common.getBorderBox(t),i={height:r.height-u.vertical-f.vertical,scrolling:$app.scrolling()};return n!=!1&&(Web.DataView._pageContext=i),i}}function _body_performResize(){var n,u,l,t,f,r,a,e,o,s,i,h;if(Web.DataView._resizeInterval&&clearInterval(Web.DataView._resizeInterval),Web.DataView._resizeInterval=null,$closeHovers(),n=$get("PageContent"),n&&!$app.mobile){if(u=$common.getClientBounds(),l=$common.getClientBounds(),Web.DataView.MessageBar&&(t=Web.DataView.MessageBar._element,$common.getVisible(t)&&(f=$common.getPaddingBox(t),t.style.width=l.width-f.horizontal+"px",r=t.childNodes[0],r.style.height="",a=$common.getBounds(r),e=Math.ceil(u.height*.15),a.height>e&&(r.style.height=e+"px",r.style.overflow="auto"),f=Sys.UI.DomElement.getBounds(t),o=Web.DataView.OriginalBodyTopOffset+f.height,document.body.style.paddingTop=o+"px",s=$get("Membership_Login"),s&&(s.style.marginTop=o+"px"))),Web.DataView._resizing=!0,i=Web.DataView._pageContext,i==null?i=_body_createPageContext(!1):Web.DataView._pageContext=null,h=$app.scrolling(),h.y==0&&(n.style.height="10px"),_body_resizeLayoutContainers(),typeof __cothost=="undefined"){var v=$app.bounds(n),y=$app.paddingBox(n),p=$app.borderBox(n),w=Web.Menu.MainMenuElemId?$get(Web.Menu.MainMenuElemId):null,b=w?$common.getBorderBox(w):null,k=$get("PageFooterContent"),d=$get("PageFooterBar"),c=h.y+u.height-v.y-(d?d.offsetHeight:0)-(k?k.offsetHeight:0)-p.vertical-y.vertical-(b?b.vertical:0);v.height<c&&Sys.Browser.agent==Sys.Browser.Opera&&(c+=p.vertical+y.vertical);i.scrolling.y==0||Web.DataView._numberOfContainers<2?n.style.height=document.body.offsetHeight>u.height?"":c+"px":(n.style.height=i.height+"px",scrollTo(0,i.scrolling.y))}_body_scroll();Web.DataView._resizing=!1;Web.DataView._resized=!0}}function $createDataView(n,t,i){var u={id:t+"Extender",controller:t,baseUrl:"./",servicePath:"Services/DataControllerService.asmx"},r;if(i)for(r=0;r<i.length;r++)u[i[r].name]=i[r].value;$create(Web.DataView,u,null,null,$get(n))}function updateACT(){Sys.Extended&&typeof AjaxControlToolkit=="undefined"&&(AjaxControlToolkit=Sys.Extended.UI);Web.AutoComplete.registerClass("Web.AutoComplete",AjaxControlToolkit.AutoCompleteBehavior);Sys.Browser.WebKit={};navigator.userAgent.indexOf("WebKit/")>-1&&(Sys.Browser.agent=Sys.Browser.WebKit,Sys.Browser.version=parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]),Sys.Browser.name="WebKit");Sys.Browser.agent==Sys.Browser.InternetExplorer||Sys.Browser.agent==Sys.Browser.Firefox||Sys.Browser.agent==Sys.Browser.Opera||Sys.Extended||($common.old_getBounds=$common.getBounds,$common.getBounds=function(n){var i=$common.old_getBounds(n),t=$app.scrolling();return(t.y||t.x)&&(i.x+=t.x,i.y+=t.y),i});AjaxControlToolkit.CalendarBehavior&&!AjaxControlToolkit.CalendarBehavior.prototype.old_show&&(AjaxControlToolkit.CalendarBehavior.prototype.old_show=AjaxControlToolkit.CalendarBehavior.prototype.show,AjaxControlToolkit.CalendarBehavior.prototype.show=function(){function i(){r.position({my:"left "+(t?"bottom":"top"),at:"left "+(t?"top":"bottom"),of:n})}this.old_show();var r=$(this._container).zIndex(100100),n=$(this._element),t=n.parent().find(".Error:visible").length||n.closest("div.Item").find(".Error:visible").length;i();setTimeout(i,10)},AjaxControlToolkit.CalendarBehavior.prototype.old_raiseDateSelectionChanged=AjaxControlToolkit.CalendarBehavior.prototype.raiseDateSelectionChanged,AjaxControlToolkit.CalendarBehavior.prototype.raiseDateSelectionChanged=function(){this.old_raiseDateSelectionChanged();this._element.focus()});AjaxControlToolkit.TabContainer&&!AjaxControlToolkit.TabContainer.prototype.old_set_activeTabIndex&&(AjaxControlToolkit.TabContainer.prototype.old_set_activeTabIndex=AjaxControlToolkit.TabContainer.prototype.set_activeTabIndex,AjaxControlToolkit.TabContainer.prototype.set_activeTabIndex=function(n){var t=this.get_activeTabIndex();this._headerAssigned||(this._headerAssigned=!0,Sys.UI.DomElement.addCssClass(this._element.getElementsByTagName("div")[0],"tab-header"));this.old_set_activeTabIndex(n);n!=t&&_body_performResize()});AjaxControlToolkit.AutoCompleteBehavior&&!AjaxControlToolkit.AutoCompleteBehavior.prototype.old_dispose&&(AjaxControlToolkit.AutoCompleteBehavior.prototype.old_dispose=AjaxControlToolkit.AutoCompleteBehavior.prototype.dispose,AjaxControlToolkit.AutoCompleteBehavior.prototype.dispose=function(){this.old_dispose();this._completionListElement&&(this._completionListElement.parentNode.removeChild(this._completionListElement),delete this._completionListElement)},AjaxControlToolkit.AutoCompleteBehavior.prototype.old__handleFlyoutFocus=AjaxControlToolkit.AutoCompleteBehavior.prototype._handleFlyoutFocus,AjaxControlToolkit.AutoCompleteBehavior.prototype._handleFlyoutFocus=function(){this._completionListElement&&this.old__handleFlyoutFocus()},AjaxControlToolkit.AutoCompleteBehavior.prototype.old_showPopup=AjaxControlToolkit.AutoCompleteBehavior.prototype.showPopup,AjaxControlToolkit.AutoCompleteBehavior.prototype.showPopup=function(){var u,i,n,r,f,e;if(this.old_showPopup(),Sys.UI.DomElement.getVisible(this._completionListElement)){if(u=$app.scrolling(),this._completionListElement.style.height="",Sys.UI.DomElement.addCssClass(this._completionListElement,"CompletionList"),this._completionListElement.style.width="",this._completionListElement.style.zIndex=200100,i=$common.getClientBounds(),n=$common.getBounds(this._completionListElement),n.width>i.width/3&&(n.width=i.width/3),r=this._element,Sys.UI.DomElement.containsCssClass(r.parentNode,"Input"))while(!Sys.UI.DomElement.containsCssClass(r.parentNode,"AutoCompleteFrame"))r=r.parentNode;var t=$common.getBounds(r),o=$common.getBorderBox(this._completionListElement),s=$common.getPaddingBox(this._completionListElement);n.width<=t.width&&(this._completionListElement.style.width=t.width-o.horizontal-s.horizontal+"px");n=$common.getBounds(this._completionListElement);n.x!=t.x&&(n.x=t.x,this._completionListElement.style.left=n.x+"px");n.y!=t.y&&(n.y=t.y+t.height-1,this._completionListElement.style.top=n.y+"px");n.x+n.width>i.width&&(this._completionListElement.style.left=i.width-n.width+"px");bound=$common.getBounds(this._completionListElement);f=t.y-u.y;e=i.height-(t.y+t.height-u.y);bound.height<=e||e>=f?n.y+n.height-u.y>i.height&&(this._completionListElement.style.height=i.height-(n.y-u.y)-4+"px",this._completionListElement.style.overflow="auto"):f<n.height?(this._completionListElement.style.top=t.y-f+"px",this._completionListElement.style.height=f+"px",this._completionListElement.style.overflow="auto"):this._completionListElement.style.top=t.y-n.height+3+"px"}},AjaxControlToolkit.ModalPopupBehavior&&!AjaxControlToolkit.ModalPopupBehavior.prototype.old__attachPopup&&(AjaxControlToolkit.ModalPopupBehavior.prototype.old__attachPopup=AjaxControlToolkit.ModalPopupBehavior.prototype._attachPopup,AjaxControlToolkit.ModalPopupBehavior.prototype._attachPopup=function(){this.old__attachPopup();this._dropShadowBehavior&&(this._dropShadowBehavior.set_Width(4),(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)&&this._dropShadowBehavior.set_Rounded(!0))}))}function $hoverTab(n,t){while(n&&n.tagName!="TD")n=n.parentNode;n&&(t?(Sys.UI.DomElement.addCssClass(n,"Active"),n.focus()):Sys.UI.DomElement.removeCssClass(n,"Active"))}function $getSideBar(){var t=$get("PageContentSideBar"),n,i;if(!t)return null;for(n=0;n<t.childNodes.length;n++)if(i=t.childNodes[n],i.className=="SideBarBody")return i;return null}function $dvget(n,t,i,r){for(var f,o,s,h=Sys.Application.getComponents(),c="_"+n,e=null,u=0;u<h.length;u++)if(f=h[u],f._id==n||Web.DataView.isInstanceOfType(f)&&(f._id.endsWith(c)||f._controller==n&&(!t||f.get_viewId()==t))){e=f;break}if(e){if(i){if(o=e.findField(i),o){if(r){if(element=$get(e._id+"_ItemContainer"+o.Index),element)for(u=0;u<element.childNodes.length;u++)if(s=element.childNodes[u],s.className=="Value")return s}else return $get(e._id+"_Item"+o.Index);return element}return null}return e}return null}function _field_prepareDataFormatString(n,t){if(t.DataFormatString&&t.DataFormatString.indexOf("{")==-1&&(t.DataFormatString="{0:"+t.DataFormatString+"}"),t.DataFormatString&&(t.DataFormatString=n.resolveClientUrl(t.DataFormatString)),t.Type.startsWith("DateTime"))if(t.DataFormatString){var u=t.DataFormatString.match(/{0:(g)}/i),i,r;u&&(i=Sys.CultureInfo.CurrentCulture.dateTimeFormat,t.DateFmtStr="{0:"+i.ShortDatePattern+"}",t.TimeFmtStr="{0:"+(u[1]=="g"?i.ShortTimePattern:i.LongTimePattern)+"}");r=Web.DataView.dateFormatStrings[t.DataFormatString];r&&(t.DataFormatString="{0:"+r+"}");t.DateFmtStr&&(t.DataFmtStr=t.DataFormatString)}else t.DataFormatString="{0:d}"}function _field_format(n){try{return n!=null&&this.Type=="TimeSpan"&&this.DataFormatString&&this.FormatOnClient&&typeof n=="string"&&(n=Date.tryParseFuzzyTime(n,!1)),n==null?"null":this.FormatOnClient&&!String.isNullOrEmpty(this.DataFormatString)?String.localeFormat(this.DataFormatString,n):n.toString()}catch(t){throw new Error(String.format("\nField: {0}\nData Format String: {1}\n{2}",this.Name,this.DataFormatString,t.message));}}function _field_isReadOnly(){return this.TextMode==4||this.ReadOnly}function _field_isNumber(){return Array.indexOf(["SByte","Byte","Int16","Int32","UInt32","Int64","Single","Double","Decimal","Currency"],this.Type)}function _field_htmlEncode(){return this.HtmlEncode&&this.TextMode!=3&&this.TextMode!=4}function _field_trim(n){var t=this,i=Web.DataViewResources.Data;return t.Type=="String"&&n!=null&&n.length>i.MaxReadOnlyStringLen&&!(t.TextMode==3||t.TextMode==2)&&(n=n.substring(0,i.MaxReadOnlyStringLen)+"..."),n&&t.TextMode==3&&(n=n.replace(/(\r?\n)/g,"<br/>")),n}function _field_text(n,t){var r=this,i,e=Web.DataViewResources.Data,o=r.DynamicItems?r.DynamicItems:r.Items,f,u,l;if(o.length==0)i=String.isBlank(n)?e.NullValueInForms:r.format(n);else if(r.ItemsStyle=="CheckBoxList"){var h=n?n.split(","):[],s=new Sys.StringBuilder,c=!0;for(f=0;f<o.length;f++)u=o[f],l=u[0]==null?"":u[0].toString(),Array.contains(h,l)&&(c?c=!1:s.append(", "),s.append(u[1]));i=s.toString();i=h.length==0?e.NullValueInForms:i}else n==null?i=e.NullValueInForms:(u=r._dataView._findItemByValue(r,n),i=u[1]);return r.TextMode==1&&(i="**********"),t!=!1&&(i=r.trim(i)),i}function __designer(){return typeof __designerMode!="undefined"}function __evalEvent(n){var t=this.getAttribute("on"+n+"2"),i;return String.isNullOrEmpty(t)?!0:(i=!0,t=t.replace(/(^|;)return /g,";returnResult="),eval(t),i)}Type.registerNamespace("Web");Web.DataViewMode={View:"View",Lookup:"Lookup"};Web.DynamicExpressionScope={Field:0,ViewRowStyle:1,CategoryVisibility:2,DataFieldVisibility:3,DefaultValues:4,ReadOnly:5,Rule:6};Web.AutoHideMode={Nothing:0,Self:1,Container:2};Web.DynamicExpressionType={RegularExpression:0,ClientScript:1,ServerExpression:2,CSharp:3,VisualBasic:4,Any:4};Web.DataViewAggregates=["None","Sum","Count","Avg","Max","Min"];Web.FieldSearchMode={Default:0,Required:1,Suggested:2,Allowed:3,Forbidden:4};Web.PageState={};Web.PageState._init=function(){if(!this._state){var n=$get("__COTSTATE");this._state=n==null||String.isNullOrEmpty(n.value)?{}:Sys.Serialization.JavaScriptSerializer.deserialize(n.value)}};Web.PageState._save=function(){var n=$get("__COTSTATE");n!=null&&(n.value=Sys.Serialization.JavaScriptSerializer.serialize(this._state))};Web.PageState.read=function(n){return this._init(),this._state[n]};Web.PageState.write=function(n,t){this._init();this._state[n]=t;this._save()};Sys.StringBuilder.prototype.appendFormat=function(){this.append(String._toFormattedString(!1,arguments))};String.isNullOrEmpty=function(n){return n==null||n.length==0};String.isBlank=function(n){return n==null||typeof n=="string"&&n.match(Web.DataView._blankRegex)!=null};String._wordTrimRegex=/(\S{16})\S+/g;String._tagRegex=/<\/?\w.*?>/g;String.trimLongWords=function(n,t){var r,e;if(n==null)return n;if(r=this._wordTrimRegex,t!=null&&(r=new RegExp(String.format("(\\S{{{0}}})\\S+",t),"g")),e=n.replace(r,"$1..."),n.match(String._tagRegex)){for(var u=new Sys.StringBuilder,o=String._tagRegex,i=o.exec(n),f=0;i;)tag=i[0],i.index>0&&u.append(n.substring(f,i.index).replace(r,"$1...")),f=i.index+tag.length,u.append(tag),i=o.exec(n);f<n.length&&u.append(n.substring(f));e=u.toString()}return e};String.htmlEncode=function(n){return typeof n=="string"&&n.match(Web.DataView._htmlTest)?n:Web.DataView.htmlEncode(n)};String.isJavaScriptNull=function(n){return n=="%js%null"||n=="null"};String.jsNull="%js%null";Web.DataView=function(n){Web.DataView.initializeBase(this,[n]);this._controller=null;this._viewId=null;this._servicePath=null;this._baseUrl=null;this._pageIndex=-1;this._pageSize=Web.DataViewResources.Pager.PageSizes[0];this._sortExpression=null;this._filter=[];this._externalFilter=[];this._categories=null;this._fields=null;this._allFields=null;this._rows=null;this._totalRowCount=0;this._firstPageButtonIndex=0;this._pageCount=0;this._views=[];this._actionGroups=[];this._selectedKey=[];this._selectedKeyFilter=[];this._lastCommandName=null;this._lastViewId=null;this._lookupField=null;this._filterFields=null;this._filterSource=null;this._mode=Web.DataViewMode.View;this._lookupPostBackExpression=null;this._domFilterSource=null;this._selectedKeyList=[];this._pageSizes=Web.DataViewResources.Pager.PageSizes};Web.DataView.htmlEncode=function(n){return n!=null&&typeof n!="string"&&(n=n.toString()),n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):n};Web.DataView.htmlAttributeEncode=function(n){return n!=null&&typeof n=="string"?n.replace(/\x27/g,"&#39;").replace(/\x22/g,"&quot;"):n};Web.DataView.isIE6=this._ie6=Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<7;Web.DataView.prototype={get_controller:function(){return this._controller},set_controller:function(n){this._controller=n},useCase:function(n){return this.get_useCase()==n},get_useCase:function(){return this._useCase},set_useCase:function(n){this._useCase=n},get_viewId:function(){!this._viewId&&this._views.length>0&&(this._viewId=this._views[0].Id);var n=this._viewId;return n||(n=""),n},set_viewId:function(n){this._viewId=n},get_newViewId:function(){return this._newViewId},set_newViewId:function(n){this._newViewId=n},get_servicePath:function(){return this._servicePath},set_servicePath:function(n){this._servicePath=this.resolveClientUrl(n);Web.DataView._servicePath||(Web.DataView._servicePath=n)},get_baseUrl:function(){return this._baseUrl},set_baseUrl:function(n){n=="~"&&(n="/");this._baseUrl=n;Web.DataView._baseUrl||(Web.DataView._baseUrl=n)},get_siteUrl:function(){var t=this.get_servicePath(),n=t.match(/(^.+?\/)\w+\/\w+\.asmx/);return n?n[1]:""},resolveClientUrl:function(n){return n?n.replace(/~\x2f/g,this.get_baseUrl()):null},get_hideExternalFilterFields:function(){return this._hideExternalFilterFields!=!1},set_hideExternalFilterFields:function(n){this._hideExternalFilterFields=n},get_backOnCancel:function(){return this._backOnCancel==!0},set_backOnCancel:function(n){this._backOnCancel=n},get_confirmContext:function(){return this._confirmContext},set_confirmContext:function(n){this._confirmContext=n},get_startCommandName:function(){return this._startCommandName},set_startCommandName:function(n){this._startCommandName=n},get_startCommandArgument:function(){return this._startCommandArgument},set_startCommandArgument:function(n){this._startCommandArgument=n},get_exitModalStateCommands:function(){return this._exitModalStateCommands},set_exitModalStateCommands:function(n){this._exitModalStateCommands=n},get_showActionBar:function(){var n=this.extension(),t;return n?(t=n.options(),t.actionBar==!0):this._showActionBar!=!1},set_showActionBar:function(n){this._showActionBar=n},get_showActionButtons:function(){var n=this._showActionButtons;return n==null&&(n="TopAndBottom",this._showActionButtons=n),n},set_showActionButtons:function(n){this._showActionButtons=n},get_showSearchBar:function(){return this._showSearchBar==!0&&!(__tf!=4)},set_showSearchBar:function(n){this._showSearchBar=n},get_searchOnStart:function(){return this._searchOnStart==!0},set_searchOnStart:function(n){this._searchOnStart=n;n&&this.set_searchBarIsVisible(!0)},get_searchBarIsVisible:function(){return this._searchBarIsVisible==!0},set_searchBarIsVisible:function(n){this._searchBarIsVisible=n},get_showModalForms:function(){return $app.mobile?!0:this._showModalForms==!0},set_showModalForms:function(n){this._showModalForms=n},get_showDescription:function(){var n=this.extension(),t;return n?(t=n.options(),t.description==!0):this._showDescription!=!1},set_showDescription:function(n){this._showDescription=n},get_showFirstLetters:function(){return this._showFirstLetters==!0},set_showFirstLetters:function(n){this._showFirstLetters=n},get_autoSelectFirstRow:function(){return this._autoSelectFirstRow==!0},set_autoSelectFirstRow:function(n){this._autoSelectFirstRow=n},get_autoHighlightFirstRow:function(){return this._autoHighlightFirstRow==!0},set_autoHighlightFirstRow:function(n){this._autoHighlightFirstRow=n},get_refreshInterval:function(){return this._refreshInterval},set_refreshInterval:function(n){this._refreshInterval=(__tf!=4)?0:n},get_showViewSelector:function(){return this._showViewSelector!=!1},set_showViewSelector:function(n){this._showViewSelector=n},get_showPager:function(){var n=this._showPager;return n==null||n==!0?(n="Bottom",this._showPager=n):n==!1&&(n="None"),n},set_showPager:function(n){this._showPager=n},get_showPageSize:function(){return this._showPageSize!=!1},set_showPageSize:function(n){this._showPageSize=n},get_selectionMode:function(){return this._selectionMode},set_selectionMode:function(n){this._selectionMode=n},multiSelect:function(){return this._selectionMode=="Multiple"},get_cookie:function(){return this._cookie},set_cookie:function(n){this._cookie=n},get_pagerButtonCount:function(n){if(!this._pagerButtonCount||n){var t=Web.DataViewResources.Pager.PageButtonCount;this.get_pageCount()>t&&(t=t-3,t<5&&(t=5));this._pagerButtonCount=t}return this._pagerButtonCount},get_pageIndex:function(){return this._pageIndex},set_pageIndex:function(n){if(this._pageIndex=n,n>=0){var t=this.get_pagerButtonCount();n>=this._firstPageButtonIndex+t?this._firstPageButtonIndex=n:n<this._firstPageButtonIndex&&(this._firstPageButtonIndex-=t,n<this._firstPageButtonIndex&&(this._firstPageButtonIndex=n));this._firstPageButtonIndex<0&&(this._firstPageButtonIndex=0);this.get_pageCount()-this._firstPageButtonIndex<t&&(this._firstPageButtonIndex=this.get_pageCount()-t);this._firstPageButtonIndex<0&&(this._firstPageButtonIndex=0)}n==-2&&(this._pageOffset=0)},get_pageOffset:function(){return this.get_isDataSheet()?this._pageOffset==null?0:this._pageOffset:0},set_pageOffset:function(n){this._pageOffset=n},get_categoryTabIndex:function(){return this._categoryTabIndex},set_categoryTabIndex:function(n){n!=this._categoryTabIndex&&(this._categoryTabIndex=n,this._updateTabbedCategoryVisibility(),n!=-1&&(this._modalPopup&&(this._resizeContainerBounds(),this._modalPopup.show()),_body_performResize(),this.get_isEditing()&&(this._focusedFieldName=null,this._focus())))},get_enabled:function(){return this._enabled==null?!0:this._enabled},set_enabled:function(n){this._enabled=n},get_showInSummary:function(){return this._showInSummary},set_showInSummary:function(n){this._showInSummary=n},get_summaryFieldCount:function(){return this._summaryFieldCount},set_summaryFieldCount:function(n){this._summaryFieldCount=n},get_showLEVs:function(){return this._showLEVs},set_showLEVs:function(n){this._showLEVs=n},get_tag:function(){return this._tag},set_tag:function(n){this._tag=n},get_pageSize:function(){return this._pageSize},set_pageSize:function(n){this._pageSize=n;this._pageOffset=0;delete this._viewColumnSettings;Array.indexOf(this._pageSizes,n)==-1&&(this._pageSizes=Array.clone(this._pageSizes),Array.insert(this._pageSizes,0,n));this._fields!=null&&this.refreshData()},get_sortExpression:function(){return this._sortExpression},set_sortExpression:function(n){if(n&&n.length!=0){var t=n.match(/^(\w+)\s*((asc|desc)|$)/i);this._sortExpression=t&&t[2].length==0?String.isNullOrEmpty(this._sortExpression)||this._sortExpression.match(/^(\w+)\s*/)[1]!=t[1]?n+" asc":this._sortExpression.endsWith(" asc")?n+" desc":n+" asc":n}else this._sortExpression=null},set_id:function(n){this._id||(this._id=n)},get_appId:function(){return this._id},set_appId:function(n){$app.mobile&&(this._id=n)},get_appFilterSource:function(){return this._filterSource},set_appFilterSource:function(n){$app.mobile&&(this._filterSource=n)},get_filterSource:function(){return this._filterSource},set_filterSource:function(n){this._filterSource||(this._filterSource=n)},get_filterFields:function(){return this._filterFields},set_filterFields:function(n){this._filterFields=n},get_visibleWhen:function(){return this._visibleWhen},set_visibleWhen:function(n){this._visibleWhen=n},get_showQuickFind:function(){return this._showQuickFind!=!1},get_quickFindText:function(){return String.isNullOrEmpty(this._quickFindText)?Web.DataViewResources.Grid.QuickFindText:this._quickFindText},set_quickFindText:function(n){this._quickFindText=n},get_quickFindElement:function(){return $get(this.get_id()+"_QuickFind")},set_showQuickFind:function(n){this._showQuickFind=n},get_showRowNumber:function(){return this._showRowNumber==!0},set_showRowNumber:function(n){this._showRowNumber=n},get_filter:function(){var r,f,t,i,u,n;if(this.get_lookupField()==null&&(this.get_pageIndex()==-1&&!this._allFields||this._externalFilter.length>0&&this._filter.length==0)){if(this.get_domFilterSource())for(this._externalFilter=[],r=this.get_filterFields().split(Web.DataView._simpleListRegex),f=this.get_domFilterSource().value.split(Web.DataView._simpleListRegex),t=0;t<r.length;t++)Array.add(this._externalFilter,{Name:r[t],Value:f[t]});else if(i=Web.DataView._commandLine.match(/\?([\s\S]+)/),i&&this.get_filterSource()!="None"&&this.get_filterSource()==null&&!this.get_useCase())for(this._externalFilter=[],u=/(\w+)=([\S\s]*?)(&|$)/g,n=u.exec(i[1]);n;)n[1]!="ReturnUrl"&&Array.add(this._externalFilter,{Name:n[1],Value:n[2].length==0?String.jsNull:decodeURIComponent(n[2])}),n=u.exec(i[1]);this.applyExternalFilter(this.get_isModal()||($app.mobile||this.useCase("$app"))&&this._filter)}else this.get_filterSource()=="Context"&&this._externalFilter.length>0&&this.applyExternalFilter(!0);return this._startupFilter&&(this.readContext("disableStartFilter")!=!0&&(Array.addRange(this._filter,this._startupFilter),this.writeContext("disableStartFilter",!0)),this._startupFilter=null),this._filter},set_filter:function(n){this._filter=n},get_startupFilter:function(){return this._startupFilter},set_startupFilter:function(n){this._startupFilter=n},get_externalFilter:function(){return this._externalFilter},set_externalFilter:function(n){this._externalFilter=n?n:[]},get_ditto:function(){return this._ditto},set_ditto:function(n){this._ditto=n},get_modalAnchor:function(){return this._modalAnchor},set_modalAnchor:function(n){this._modalAnchor=n},get_description:function(){return this._description},set_description:function(n){this._description=n},get_isModal:function(){return this._modalPopup!=null||this._isModal},get_categories:function(){return this._categories},get_fields:function(){return this._fields},get_rows:function(){return this._rows},get_selectedRow:function(){var n=this.extension();return n?this._selectedRow:this._rows?this._rows[this._selectedRowIndex!=null?this._selectedRowIndex:0]:[]},get_pageCount:function(){return this._pageCount},get_aggregates:function(){return this._aggregates},get_views:function(){return this._views},actionGroups:function(n){var s=[],h=this._actionGroups,i,r,u,t,e,f,o;for(typeof n=="string"&&(n=[n]),u=0;u<n.length;u++)for(o=n[u],i=0;i<h.length;i++)if(t=h[i],f=null,t.Scope==o||t.Id==o)for(r=0;r<t.Actions.length;r++)e=t.Actions[r],this._isActionAvailable(e)&&(f||s.push(f={Scope:t.Scope,HeaderText:t.HeaderText,Flat:t.Flat,Id:t.Id,Actions:[]}),f.Actions.push(e));return s},actions:function(n){var t=this.actionGroups(n);return t.length?t[0].Actions:null},get_actionGroups:function(n,t){for(var r,u,f,e=[],i=0;i<this._actionGroups.length;i++)if(this._actionGroups[i].Scope==n){if(r=this._actionGroups[i],u=t?r:null,!t)for(f=0;f<r.Actions.length;f++)if(this._isActionAvailable(r.Actions[f])){u=this._actionGroups[i];break}u&&Array.add(e,u)}return e},get_actions:function(n,t){for(var r,u=[],i=0;i<this._actionGroups.length;i++)if(this._actionGroups[i].Scope==n)if(r=this._actionGroups[i],t)Array.addRange(u,r.Actions);else return r.Actions;return u},get_action:function(n){for(var t,i,u,f=n.split(/\//),r=0;r<this._actionGroups.length;r++)if(t=this._actionGroups[r],t.Id==f[0])for(i=0;i<t.Actions.length;i++)if(u=t.Actions[i],u.Id==f[1])return u;return null},get_selectedKey:function(){return this._selectedKey},set_selectedKey:function(n){this._selectedKey=n},get_selectedKeyFilter:function(){return this._selectedKeyFilter},set_selectedKeyFilter:function(n){this._selectedKeyFilter=n},_get_selectedValueElement:function(){return $get(String.format("{0}_{1}_SelectedValue",this.get_id(),this.get_controller()))},get_selectedValue:function(){var t=this.readContext("SelectedValue"),n;return t?t:(n=this._get_selectedValueElement(),n?n.value:"")},set_selectedValue:function(n){if(!this._hasSearchAction){this.writeContext("SelectedValue",n.toString());var t=this._get_selectedValueElement();t&&(t.value=n!=null?n:"")}},get_keyRef:function(){var i=this.get_selectedKey(),t,n;if(!i)return null;for(t="",n=0;n<this._keyFields.length;n++)n>0&&(t+="&"),t=String.format("{0}{1}={2}",t,this._keyFields[n].Name,i[n]);return t},get_showIcons:function(){return this._icons!=null&&this._lookupField==null||this.get_showRowNumber()},get_showMultipleSelection:function(){return this.multiSelect()&&this._hasKey()},get_sysColCount:function(){var n=0;return this.get_showIcons()&&n++,this.get_showMultipleSelection()&&n++,this.get_isDataSheet()&&n++,n},_createRowKey:function(n){for(var r,u=this._rows[n],t="",i=0;i<this._keyFields.length;i++)r=this._keyFields[i],t.length>0&&(t+=","),t+=u[r.Index].toString();return t},toggleSelectedRow:function(n){for(var e,f,r,i,t,o,s=n!=null?n:0,h=n!=null?n:this._rows.length-1,c=$get(this.get_id()+"_ToggleButton"),u=s;u<=h;u++)if(e=this._createRowKey(u),f=Array.indexOf(this._selectedKeyList,e),f!=-1&&Array.removeAt(this._selectedKeyList,f),r=n==null?c.checked:f==-1,r&&Array.add(this._selectedKeyList,e),i=$get(this.get_id()+"_CheckBox"+u),i){for(i.checked=r,r?$(i).addClass("Selected"):$(i).removeClass("Selected"),t=i;t&&t.tagName!="TR";)t=t.parentNode;r?$(t).addClass("MultiSelectedRow"):$(t).removeClass("MultiSelectedRow")}this._skipCellFocus=this.get_isDataSheet();this.set_selectedValue(this._selectedKeyList.join(";"));o=$get(this.get_id()+"$SelectionInfo");o&&(o.innerHTML=this._selectedKeyList.length==0?"":String.format(Web.DataViewResources.Pager.SelectionInfo,this._selectedKeyList.length));n>=0?this.executeRowCommand(n,"Select"):this.delayedRefresh()},delayedRefresh:function(n,t){if(t||(t=1e3),n)delete this._delayedRefreshTimer,this._isBusy||Web.DataView._navigated||Sys.Application._disposing||this.refresh(!0);else{this._delayedRefreshTimer&&clearTimeout(this._delayedRefreshTimer);var i=this;this._delayedRefreshTimer=setTimeout(function(){i.delayedRefresh(!0)},t)}},get_view:function(n){if(n||(n=this.get_viewId()),!this._view||this._view.Id!=n)for(var t=0;t<this._views.length;t++)if(this._views[t].Id==n){this._view=this._views[t];break}return this._view},get_viewType:function(n){var t=this.get_view(n),i;return this._viewTypes&&(i=this._viewTypes[t?t.Id:n],i!=null)?i:t?t.Type:null},get_isGrid:function(n){var t=this.get_viewType(n);return t=="Grid"||t=="DataSheet"},get_isForm:function(n){var t=this.get_viewType(n);return t=="Form"},get_isDataSheet:function(n){var i=this.get_viewType(n),t;return __tf!=4?!1:(this._viewTypes&&(t=this._viewTypes[this.get_viewId()],t!=null&&(i=t)),i=="DataSheet")},get_isChart:function(){return this.get_viewType()=="Chart"},get_lastViewId:function(){return this._lastViewId},set_lastViewId:function(n){this._lastViewId=n},get_lastCommandName:function(){return this._lastCommandName},set_lastCommandName:function(n){this._lastCommandName=n;this._lastCommandArgument=null;$closeHovers()},get_lastCommandArgument:function(){return this._lastCommandArgument},set_lastCommandArgument:function(n){this._lastCommandArgument=n},get_isEditing:function(){var t=this,n=t._lastCommandName,i=t._editing;return(n=="New"||n=="Edit"||n=="BatchEdit"||n=="Duplicate")&&i==null||i==!0},get_isInserting:function(){return this._lastCommandName=="New"||this._lastCommandName=="Duplicate"},get_lookupField:function(){return this.get_mode()==Web.DataViewMode.View?this._lookupField:this._fields[0]},set_lookupField:function(n){this._lookupField=n},get_lookupContext:function(){var n=this.get_lookupField();return n?{FieldName:n.Name,Controller:n._dataView.get_controller(),View:n._dataView.get_viewId()}:null},get_mode:function(){return this._mode},set_mode:function(n){this._mode=n},get_lookupValue:function(){return this._lookupValue},set_lookupValue:function(n){this._lookupValue=n},get_lookupText:function(){return this._lookupText},set_lookupText:function(n){this._lookupText=n},get_lookupPostBackExpression:function(){return this._lookupPostBackExpression},set_lookupPostBackExpression:function(n){this._lookupPostBackExpression=n},get_domFilterSource:function(){return this._domFilterSource},set_domFilterSource:function(n){this._domFilterSource=n},get_showDetailsInListMode:function(){return this._showDetailsInListMode!=!1},set_showDetailsInListMode:function(n){this._showDetailsInListMode=n},get_autoHide:function(){return!String.isNullOrEmpty(this.get_visibleWhen())&&this._autoHide==Web.AutoHideMode.Nothing?Web.AutoHideMode.Self:this._autoHide==null?Web.AutoHideMode.Nothing:this._autoHide},set_autoHide:function(n){this._autoHide=n},get_transaction:function(){return this._transaction},set_transaction:function(n){this._transaction=n},initialize:function(){Web.DataView.callBaseMethod(this,"initialize");this._bodyKeydownHandler=Function.createDelegate(this,this._bodyKeydown);this._filterSourceSelectedHandler=Function.createDelegate(this,this._filterSourceSelected);this._quickFindHandlers={focus:this._quickFind_focus,blur:this._quickFind_blur,keydown:this._quickFind_keydown};this._checkMaxLengthHandler=function(n){var t=parseInt(this.getAttribute("maxlength"));this.value.length>t&&(this.value=this.value.substr(0,t),n.preventDefault(),n.stopPropagation())}},dispose:function(){Sys.Application._disposing||($(this._element).find("iframe").remove(),this._detachBehaviors());var n=this.extension();n&&n.dispose&&n.dispose();this._wsRequest=null;this._stopInputListener();this._disposeModalPopup();this._disposeFieldFilter();this._disposeSearchBarExtenders();this._disposeImport();this._disposeFields();this._lookupField=null;this._parentDataView=null;this._bodyKeydownHandler=null;this._filterSourceSelectedHandler=null;this._restoreEmbeddedViews();delete this._container;Web.DataView.callBaseMethod(this,"dispose")},get_master:function(){var n=this.get_filterSource();return n?Web.DataView.find(n):null},tag:function(n){this._tag=(this._tag||"")+","+n},untag:function(n){if(this._tag){var t=this._tag.split(","),i=Array.indexOf(t,n);i>=0&&t.splice(i,1);this._tag=t.join()}},get_isTagged:function(n){return this._tag&&Array.contains(this._tag.split(Web.DataView._simpleListRegex),n)},updated:function(){var i,e,r,n,c,t,u,f,o,s,h;if(Web.DataView.callBaseMethod(this,"updated"),this._controller){if(this.get_servicePath().startsWith("http")&&this.set_baseUrl(this.get_siteUrl()),i=this.get_selectedValue(),i.length>0&&(this.set_autoHighlightFirstRow(!1),this.set_autoSelectFirstRow(!1),this.multiSelect()?this._selectedKeyList=i.split(";"):(this._selectedKey=i.split(","),this._pendingSelectedEvent=!0)),this._container==null&&(this.get_element().innerHTML="",this._container=document.createElement("div"),this.get_element().appendChild(this._container),$(this._container).addClass("DataViewContainer"),e=this._element.id,r=e.split(/_/),Sys.UI.DomElement.addCssClass(this._container,r?r[r.length-1]:e),this.get_showActionBar()||$(this._container).addClass("ActionBarHidden"),this.get_showDescription()||$(this._container).addClass("DescriptionHidden")),this.get_filterSource()&&this.get_filterSource()!="Context"?(n=this.get_master(),n?(this._hasParent=!0,n.add_selected(this._filterSourceSelectedHandler),this.get_transaction()=="Supported"&&(String.isNullOrEmpty(n.get_transaction())||(this.set_transaction(n.get_transaction()!="Supported"?n.get_transaction():null),this._forceVisible=this.get_transaction()&&n.get_isInserting())),n._pendingSelectedEvent&&!$app.mobile?(this._source=n,c=this,this._afterUpdateTimerId=setInterval(function(){c._afterUpdate()},250)):this._forceVisible||(this._hidden=!0)):(n=$get(this.get_filterSource()),n&&$addHandler(n,"change",this._filterSourceSelectedHandler),this.set_domFilterSource(n)),this._externalFilter.length==0&&this._createExternalFilter(),this._filter.length==0&&(this._source||this.applyExternalFilter())):(this._hidden=!this._evaluateVisibility(),this._hidden&&this._updateLayoutContainerVisibility(!1)),this.get_transaction()=="Supported"&&this.set_transaction(null),$app.mobile||!this.get_modalAnchor()||this.get_isModal()||this._initializeModalPopup(),n!=null&&this.get_autoHide()!=Web.AutoHideMode.Nothing&&this._updateLayoutContainerVisibility(!1),this.get_startCommandName()=="UseTransaction"&&(this._usesTransaction=!0,this.set_startCommandName(null)),this.get_startCommandName()=="DetectTransaction")if(this.get_transaction())this.set_startCommandName(null);else{n&&Web.DataView.isInstanceOfType(n)&&(n.remove_selected(this._filterSourceSelectedHandler),clearInterval(this._afterUpdateTimerId));return}(t=(Web.DataView.get_commandLine()||"").replace(/#.+?$/,""),u=t.match(/_commandName=(.+?)&_commandArgument=(.*?)(&|$)/),!u||!(String.isNullOrEmpty(this.get_startCommandName())||__designer())||this.get_filterSource()||this.get_isModal()||this.get_lookupField()||(f=t.match(/_controller=(\w+)/),o=t.match(/_view=(\w+)/),f&&f[1]!=this.get_controller()||o&&o[1]!=this.get_view()?this._filterSource||(this._visibleWhen="false",this._updateLayoutContainerVisibility(!1)):(this._trySecondCommand=!String.isNullOrEmpty(f),this.set_startCommandName(u[1]),this.set_startCommandArgument(u[2]),String.isNullOrEmpty(this._viewId)||(this._replaceTriggerViewId=this._viewId),this._skipTriggeredView=!0,s=t.match(/\b_sync=(.+?)(&|$)/),s&&(this._syncKey=s[1].split(",")))),this.useCase("$app"))||(h=$app.mobile,this.get_startCommandName()?(this.set_searchOnStart(!1),this.set_lastCommandName(this.get_startCommandName()),this.set_lastCommandArgument(this.get_startCommandArgument()),this.get_startCommandName().match(/New|Edit|Select/)&&this.set_viewId(this.get_startCommandArgument()),this.set_startCommandName(null),this.set_startCommandArgument(null),this._rows=[],h||this._loadPage()):this.loadPage(),h&&this.mobileUpdated())}},_afterUpdate:function(){if((!this._delayedLoading||!this._source._pendingSelectedEvent)&&!this._source._isBusy){clearInterval(this._afterUpdateTimerId);var n=this._source;this._source=null;this._filterSourceSelected(n,Sys.EventArgs.Empty,!0)}},dataAttr:function(n,t,i){var r=$(n),u="data-"+t;if(i)r.attr(u,i);else return i=r.attr(u),i||(i=r.attr("factory:"+t)),i},_updateLayoutContainerVisibility:function(n){var t,r,u,f,i,e,o,h,a,c,l,s;if($app.mobile){this._hidden=!n;return}if(this._forceVisible&&(n=!0),t=this._element.parentNode,String.isNullOrEmpty(t.getAttribute("data-visibility-controller"))&&t.setAttribute("data-visibility-controller",this.get_id()),r=String.isNullOrEmpty(this.dataAttr(t,"activator"))?null:this.dataAttr(t,"activator").match(/^\s*(\w+)\s*\|\s*(.+?)\s*(\|\s*(.+)\s*)?$/),this.get_autoHide()==Web.AutoHideMode.Self){for(this._element.style.display=n?"":"none",n||(n=$(this._element).siblings().is(":visible")),u=t.parentNode.childNodes[0];u.tagName!="DIV";)u=u.nextSibling;if(r&&r[1]=="Tab"&&Sys.UI.DomElement.containsCssClass(u,"TabBar")){if(t.getAttribute("data-visibility-controller")==this.get_id()){for(f=-1,i=0;i<t.parentNode.childNodes.length;i++)if(e=t.parentNode.childNodes[i],e.className&&Sys.UI.DomElement.containsCssClass(e,"TabBody")&&f++,t==e)break;if(f!=-1&&(o=u.getElementsByTagName("td"),h=o[f],h.style.display=n?"":"none",!n&&Sys.UI.DomElement.containsCssClass(h,"Selected")))for(a=u.getElementsByTagName("a"),i=0;i<o.length;i++)if($common.getVisible(o[i])){$find(t.parentNode.id+"$ActivatorMenu").select(i,a[i]);break}}}else this.dataAttr(t,"hidden",!n)}else for(r&&r[1]=="SideBarTask"&&this.dataAttr(t,"hidden",!0);t;){if(!String.isNullOrEmpty(this.dataAttr(t,"flow"))){t.style.display=n?"":"none";break}t=t.parentNode}if(c=$get("PageContentSideBar"),c&&r)for(l=c.getElementsByTagName("a"),i=0;i<l.length;i++)if(s=l[i],Sys.UI.DomElement.containsCssClass(s.parentNode,"Task")&&s.innerHTML==r[2]){s.parentNode.style.display=n?"":"none";break}Web.DataView._loaded&&_body_performResize()},loadPage:function(){if(!$app.mobile){var n=this.get_isDisplayed();this._showWait(!n);this.get_mode()==Web.DataViewMode.View&&!this.get_lookupField()&&(this._delayedLoading=!n)?Array.contains($app._delayedLoadingViews,this)||(Array.add($app._delayedLoadingViews,this),$app._startDelayedLoading()):this._source||this._loadPage()}},get_isDisplayed:function(){if(this._hidden)return!1;var t=this.get_element(),n;if(!t)return!1;for(n=t&&t.parentNode;n!=null;){if(n.getAttribute&&n.tagName!="TABLE"&&this.dataAttr(n,"activator")&&!n._activated||n.style&&n.style.display=="none")return!1;n=n.parentNode}return!0},goToPage:function(n,t){this._isBusy||(t&&(this._pageOffset=0),this.set_pageIndex(n),this._loadPage())},sort:function(n){this._isBusy||(this._clearCache(),this.get_sortExpression()==n&&(n=""),this.set_sortExpression(n),this.get_selectedKey().length>0?(this._saveViewVitals(),this._sync()):(this.set_pageIndex(0),this._loadPage()))},applyFilterByIndex:function(n,t){if(t==-1)this.removeFromFilterByIndex(n);else{var i=this._allFields[n],r=this.findFieldUnderAlias(i);this.applyFilter(i,t>=0?"=":null,t>=0?r._listOfValues[t]:null)}},findFieldUnderAlias:function(n){if(n.Hidden)for(var t=0;t<this._allFields.length;t++)if(this._allFields[t].AliasIndex==n.Index)return this._allFields[t];return n},removeFromFilterByIndex:function(n){n==-1?this.removeQuickFind():(field=this._allFields[n],this.removeFromFilter(field));this.sync()},removeQuickFind:function(){var n=this;$(n._filter).each(function(t){this.match(/^_quickfind_\:\~/)&&n._filter.splice(t,1)})},removeFromFilter:function(n){for(var t=0;t<this._filter.length;t++)if(this._filter[t].match(/^(\w+):/)[1]==n.Name){Array.removeAt(this._filter,t);break}},clearFilter:function(){for(var n,r,i,t=0;t<this._allFields.length;t++)n=this._allFields[t],r=this.findFieldUnderAlias(n),this.filterOf(n)==null||this.filterIsExternal(n.Name)||this.removeFromFilter(n);i=this.get_quickFindElement();i!=null?(i.value="",this.quickFind()):(this.set_quickFindText(null),this._executeQuickFind(null))},beginFilter:function(){this._filtering=!0},endFilter:function(){this._filtering=!1;this.refreshData()},applyFilter:function(n,t,r){this._clearCache();this.removeFromFilter(n);t==":"?r&&this._filter.push(n.Name+":"+r):t&&this._filter.push((t=="~"?"_quickfind_":n.Name)+":"+t+this.convertFieldValueToString(n,r));var u=this._filter.length==1&&this._filter[0].match(/(\w+):/)[1]==n.Name;for(n=this.findFieldUnderAlias(n),i=0;i<this._allFields.length;i++)u&&this._allFields[i].Name==n.Name||(this._allFields[i]._listOfValues=null);this._filtering!=!0&&this._sync()},applyExternalFilter:function(n){var i,r,t;for(n&&this._filter||(this._filter=[]),this._selectedRowIndex=null,i=0;i<this._externalFilter.length;i++){if(r=this._externalFilter[i],n)for(t=0;t<this._filter.length;t++)if(this._filter[t].startsWith(r.Name+":=")){Array.removeAt(this._filter,t);break}Array.add(this._filter,r.Name+":="+r.Value)}},applyFieldFilter:function(n,t,i,r){var u,f,e;if(n==null&&(n=this._filterFieldIndex),t||(t=this._filterFieldFunc),u=this._allFields[n],this.removeFromFilter(u),$(this._allFields).each(function(){this._listOfValues=null}),f=String.format("{0}:",u.Name,u.Type),i&&i[0]==Web.DataViewResources.HeaderFilter.EmptyValue&&(i[0]=String.jsNull),i)if(t=="$between")f+="$between$"+this.convertFieldValueToString(u,i[0])+"$and$"+this.convertFieldValueToString(u,i[1])+'\0';else for(e=0;e<i.length;e++)f+=t+(t.startsWith("$")?"$":"")+this.convertFieldValueToString(u,i[e])+'\0';else f+=t+'$\0';f.indexOf('\0')>0&&Array.add(this._filter,f);r||this.refreshData();this._forgetSelectedRow(!0)},get_fieldFilter:function(n,t){for(var u,i,r=0;r<this._filter.length;r++)if(u=this._filter[r].match(/(\w+):(\*|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*)/),u[1]==n.Name)return t?(i=u[2],i.startsWith("$")?i.substring(0,i.length-1):i):u[4];return null},_createFieldInputExtender:function(n,t,i,r){var u=null;return t.Type.startsWith("DateTime")?(u=$create(AjaxControlToolkit.CalendarBehavior,{id:String.format("{0}_{1}Calendar{2}_{3}",this.get_id(),n,t.Index,r),button:i.nextSibling},null,null,i),u.set_format(t.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])):t.AllowQBE&&t.Type=="String"&&t.AllowAutoComplete!=!1&&(u=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0}:{1},{2}",n,this.get_id(),t.Name),delimiterCharacters:";",id:String.format("{0}_{1}AutoComplete{2}_{3}",this.get_id(),n,t.Index,r),minimumPrefixLength:t.AutoCompletePrefixLength==0?1:t.AutoCompletePrefixLength,serviceMethod:"GetListOfValues",servicePath:this.get_servicePath(),useContextKey:!0,enableCaching:n!="SearchBar",typeCssClass:n},null,null,i),u._updateClearButton()),u},showFieldFilter:function(n,t,i){var u,r,h,f,e,c,s,o,a,l;for(this._filterExtenders||(this._filterExtenders=[]),u=this._allFields[n],r=this.get_fieldFilter(u),r&&(h=r.match(/^([\s\S]*?)(\0|$)/),h&&(r=h[1])),r=r&&!String.isJavaScriptNull(r)?r.split(Web.DataView._listRegex):[""],this._filterFieldIndex=n,this._filterFieldFunc=t,f=this._filterElement=document.createElement("div"),f.id=this.get_id()+"$FieldFilter",f.className="FieldFilter",e=new Sys.StringBuilder,c=u.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;<\/a>':"",e.appendFormat('<div class="Field"><div class="Label"><span class="Name">{0}<\/span> <span class="Function">{1}<\/span><\/div><div class="Value"><input type="text" value="{2}"/>{3}<\/div><\/div>',u.HeaderText,i.toLowerCase(),Web.DataView.htmlAttributeEncode(u.format(this.convertStringToFieldValue(u,r[0]))),c),t=="$between"&&e.appendFormat('<div class="Field"><div class="Label"><span class="Function">{0}<\/span><\/div><div class="Value"><input type="text" value="{1}"/>{2}<\/div><\/div>',Web.DataViewResources.Data.Filters.Labels.And,Web.DataView.htmlAttributeEncode(r[1]?u.format(this.convertStringToFieldValue(u,r[1])):""),c),e.appendFormat('<div class="Buttons"><button onclick="$find(\'{0}\').closeFieldFilter(true);return false">{1}<\/button><button onclick="$find(\'{0}\').closeFieldFilter(false);return false">{2}<\/button><\/div>',this.get_id(),Web.DataViewResources.ModalPopup.OkButton,Web.DataViewResources.ModalPopup.CancelButton),f.innerHTML=e.toString(),this._appendModalPanel(f),this._filterPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"$FilterPopup",PopupControlID:f.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]),s=f.getElementsByTagName("input"),o=0;o<s.length;o++)a=s[o],l=this._createFieldInputExtender("Filter",u,a,o),l&&Array.add(this._filterExtenders,l);this._saveTabIndexes();this._filterPopup.show();Sys.UI.DomElement.setFocus(s[0]);$(f).find("input:text").keydown(function(n){n.which==13&&(n.preventDefault(),$(f).find("button:first").click())})},closeFieldFilter:function(n){var e=this._filterElement.getElementsByTagName("input"),o=[],r,i,t,u,f;if(n)for(r=this._allFields[this._filterFieldIndex],i=0;i<e.length;i++){if(t=e[i],String.isBlank(t.value)){alert(Web.DataViewResources.Validator.RequiredField);Sys.UI.DomElement.setFocus(t);return}if(this._formatSearchField(t,this._filterFieldIndex),u={NewValue:t.value.trim()},f=this._validateFieldValueFormat(r,u),f){alert(f);Sys.UI.DomElement.setFocus(t);return}Array.add(o,r.Type.startsWith("DateTime")?t.value.trim():u.NewValue)}this._disposeFieldFilter();this._restoreTabIndexes();n&&this.applyFieldFilter(null,null,o)},_disposeSearchBarExtenders:function(){if(this._searchBarExtenders){for(var n=0;n<this._searchBarExtenders.length;n++)this._searchBarExtenders[n].dispose();Array.clear(this._searchBarExtenders)}},_disposeFieldFilter:function(){if(this._filterExtenders){for(var n=0;n<this._filterExtenders.length;n++)this._filterExtenders[n].dispose();Array.clear(this._filterExtenders)}this._filterElement&&(this._filterPopup.hide(),this._filterPopup.dispose(),this._filterPopup=null,this._filterElement.parentNode.removeChild(this._filterElement),delete this._filterElement)},_showSearchBarFilter:function(n,t){if(this._searchBarVisibleIndex=t,n==-1){var i=this._get("$SearchBarValue$",t);i.value="";this._searchBarFuncChanged(t);this._searchBarVisibleIndex=null}else this.showCustomFilter(n)},_appendModalPanel:function(n){this.get_element().appendChild(n)},showCustomFilter:function(n){var r=this._allFields[n],i=this._customFilterPanel=document.createElement("div"),t,u;this._appendModalPanel(i);i.className="CustomFilterDialog";i.id=this.get_id()+"_CustomFilterPanel";t=new Sys.StringBuilder;t.appendFormat('<div><span class="Highlight">{0}<\/span> {1}:<\/div>',Web.DataView.htmlEncode(r.Label),Web.DataViewResources.Data.Filters.Labels.Includes);t.append('<table cellpadding="0" cellspacing="0">');t.appendFormat('<tr><td colspan="2"><div id="{0}$CustomFilterItemList${1}" class="CustomFilterItems">{2}<\/div><\/td><\/tr>',this.get_id(),n,Web.DataViewResources.Common.WaitHtml);t.appendFormat('<tr><td><\/td><td align="right"><button id="{0}Ok">{1}<\/button> <button id="{0}Cancel">{2}<\/button><\/td><\/tr>',this.get_id(),Web.DataViewResources.ModalPopup.OkButton,Web.DataViewResources.ModalPopup.CancelButton);t.append("<\/table>");i.innerHTML=t.toString();t.clear();this._customFilterField=r;this._customFilterModalPopupBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{OkControlID:this.get_id()+"Ok",CancelControlID:this.get_id()+"Cancel",OnOkScript:String.format('$find("{0}").applyCustomFilter()',this.get_id()),OnCancelScript:String.format('$find("{0}").closeCustomFilter()',this.get_id()),PopupControlID:i.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]);this._customFilterModalPopupBehavior.show();$addHandler(document.body,"keydown",this._bodyKeydownHandler);u=this.findFieldUnderAlias(r);this._loadFilterListOfValues(r.Name)},_loadFilterListOfValues:function(n){this._busy(!0);var t=this.get_lookupContext();this._invoke("GetListOfValues",this._createArgsForListOfValues(n),Function.createDelegate(this,this._onGetFilterListOfValuesComplete),{fieldName:n})},_renderFilterOption:function(n,t,i,r,u){var f=this._findItemByValue(t,i);f&&(i=f[1]);n.appendFormat('<tr><td class="Input"><input type="checkbox" id="{0}$CustomFilterItem{1}${2}"{4}/><\/td><td class="Label"><label for="{0}$CustomFilterItem{1}${2}">{3}<\/label><\/td><\/tr>',this.get_id(),t.Index,r,i,u?' checked="checked"':"")},_onGetFilterListOfValuesComplete:function(n,t){var u,s,a,h,i,e,f,c,r,o,w,k;if(this._busy(!1),u=this.findField(t.fieldName),n[n.length-1]==null&&(Array.insert(n,0,n[n.length-1]),Array.removeAt(n,n.length-1)),s=this._get("$CustomFilterItemList$",u.Index),s){for(a=this._searchBarVisibleIndex!=null?this._createSearchBarFilter(!0):this._filter,h=null,this.findFieldUnderAlias(u)._listOfValues=n,i=0;i<a.length;i++)if(e=a[i].match(Web.DataView._fieldFilterRegex),e[1]==u.Name){h=e[2];break}if(f=null,c="$in$",h&&(e=h.match(Web.DataView._filterRegex),e))for(e[1].match(/\$(in|notin|between)\$/)?(c=e[1],f=e[3].split(Web.DataView._listRegex)):f=[e[3]],i=0;i<f.length;i++)r=f[i],String.isJavaScriptNull(r)?f[i]=Web.DataViewResources.HeaderFilter.EmptyValue:(r=this.convertStringToFieldValue(u,r),f[i]=u.format(r));o=new Sys.StringBuilder;o.appendFormat('<table class="FilterItems" cellpadding="0" cellspacing="0"><tr><td><input type="CheckBox" onclick="$find(\'{0}\')._selectAllFilterItems({1})" id="{0}$CustomFilterItemList$SelectAll"/><\/td><td><label for="{0}$CustomFilterItemList$SelectAll">{2}<\/label><\/td><\/tr>',this.get_id(),u.Index,Web.DataViewResources.Data.Filters.Labels.SelectAll);var v=[],l=[],b=[],y=[],p=this.findFieldUnderAlias(u);for(i=0;i<n.length;i++)r=n[i],w=r,r==null?r=Web.DataViewResources.HeaderFilter.EmptyValue:(r=Web.DataView.htmlEncode(u.format(r)),r==""&&(r=Web.DataViewResources.HeaderFilter.BlankValue)),k=f&&(c=="$in$"&&Array.contains(f,r)||c=="$notin$"&&!Array.contains(f,r)),k?(Array.add(l,r),Array.add(v,w)):(Array.add(y,r),Array.add(b,w));for(i=0;i<l.length;i++)this._renderFilterOption(o,u,l[i],i,!0);for(i=0;i<y.length;i++)this._renderFilterOption(o,u,y[i],i+l.length,!1);o.append("<\/table>");s.innerHTML=o.toString();Sys.UI.DomElement.setFocus(s.getElementsByTagName("input")[0]);v.length>0&&(p._listOfValues=[],Array.addRange(p._listOfValues,v),Array.addRange(p._listOfValues,b))}},_selectAllFilterItems:function(n){for(var r=this._get("$CustomFilterItemList$",n),t=r.getElementsByTagName("input"),i=1;i<t.length;i++)t[i].checked=t[0].checked},applyCustomFilter:function(){var r=this._customFilterField,u=this._searchBarVisibleIndex!=null?this._get("$SearchBarValue$",this._searchBarVisibleIndex):null,s=u?this._get("$SearchBarFunction$",this._searchBarVisibleIndex):null,t,o;this.removeFromFilter(r);var n=null,h=this._get("$CustomFilterItemList$",r.Index),i=h.getElementsByTagName("input"),e=this.findFieldUnderAlias(r),f=0;for(t=1;t<i.length;t++)i[t].checked&&(n?n+="$or$":n="",n+=this.convertFieldValueToString(r,e._listOfValues[t-1]),f++);if(n&&(f<=10||f!=i.length-1))if(f<=10||f<=(i.length-1)/2)u?s.value="$in,true":Array.add(this._filter,String.format('{0}:$in${1}\0',this._customFilterField.Name,n));else{for(n=null,t=1;t<i.length;t++)i[t].checked||(n?n+="$or$":n="",n+=this.convertFieldValueToString(r,e._listOfValues[t-1]));u?s.value="$notin,true":Array.add(this._filter,String.format('{0}:$notin${1}\0',this._customFilterField.Name,n))}else n=null;for(t=0;t<this._allFields.length;t++)o=this._allFields[t],o!=e&&(o._listOfValues=null);u?(u.value=n?n:"",this._searchBarFuncChanged(this._searchBarVisibleIndex)):(this._forceSync(),this.refreshData());this.closeCustomFilter()},closeCustomFilter:function(){this._customFilterModalPopupBehavior&&(this._customFilterModalPopupBehavior.dispose(),this._customFilterModalPopupBehavior=null,this._customFilterField=null);this._customFilterPanel&&(this._customFilterPanel.parentNode.removeChild(this._customFilterPanel),delete this._customFilterPanel);$removeHandler(document.body,"keydown",this._bodyKeydownHandler);this._customFilterField=null;this._searchBarVisibleIndex=null},convertFieldValueToString:function(n,t){return typeof t=="string"&&(t.match(Web.DataView._listRegex)||t.startsWith("%js%"))?t:(n.Type!="String"&&t!=null&&typeof t=="string"&&(t=this.convertStringToFieldValue2(n,t)),Date.isInstanceOfType(t)&&(t=new Date(t-t.getTimezoneOffset()*6e4)),String.format("%js%{0}",Sys.Serialization.JavaScriptSerializer.serialize(t)))},convertFieldValueToString2:function(n,t){return n.Type.startsWith("DateTime")&&!String.isNullOrEmpty(n.DataFormatString)?t==null?null:String.localeFormat(n.DataFormatString,t):n.Type=="Boolean"?t==null?null:t.toString():t.toString()},convertStringToFieldValue:function(n,t){return t!=null&&t.startsWith("%js%")?(t=Sys.Serialization.JavaScriptSerializer.deserialize(t.substring(4)),Date.isInstanceOfType(t)&&(t=new Date(t.getTime()+t.getTimezoneOffset()*6e4)),t):this.convertStringToFieldValue2(n,t)},convertStringToFieldValue2:function(n,t){var i,r;if(t==null)return t;switch(n.Type){case"DateTime":if(i=n.DataFormatString&&n.DataFormatString.length?Date.parseLocale(t,n.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]):Date.parse(t),!isNaN(i)&&i!=null)return i;break;case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":if(r=Number.parseLocale(t),!isNaN(r))return r}return t},goToView:function(n){var o,s,r,t,u,f,e;if(!String.isNullOrEmpty(this._replaceTriggerViewId)&&this._replaceTriggerViewId==n){this._skipTriggeredView&&(this._skipTriggeredView=!1);location.replace(location.href);return}if(o=this._ditto&&this._ditto.slice(0),this._clearCache(!0),this._ditto=o,s=this.get_filter(),r=this.get_view().Group,n=="form")for(t=0;t<this.get_views().length;t++)if(this.get_views()[t].Type=="Form"){n=this.get_views()[t].Id;break}this._detachBehaviors();this.get_isForm()||(this._lastViewId=this.get_viewId(),this._selectedRowIndex=0);var c=this.get_view().Id,i=c!=n,h,l=this.extension();i&&(this._focusedFieldName=null,h=this.get_isForm(),this.get_isGrid()||this.writeContext("vitals",null));this.set_viewId(n);u=this.get_view();u.Type!="Form"&&(this._lastViewId=n,this._restorePosition(),i&&h&&$app.mobile&&l._dispose(!0));this.set_pageIndex(-1);f=u.Type=="Form"?this.get_selectedKeyFilter():!String.isNullOrEmpty(r)&&this.get_view().Group==r||!i?s:[];this._requestedFilter&&(f=this._requestedFilter,this._requestedFilter=null);e=i?null:this.get_sortExpression();this._requestedSortExpression&&(e=this._requestedSortExpression,this._requestedSortExpression=null);this.set_filter(f);this.set_sortExpression(e);this._loadPage();this._raiseSelectedDelayed=!0;i&&(this._scrollIntoView=!0,this._focusedCell=null)},filterOf:function(n){for(var i,r=(String.isNullOrEmpty(n.AliasName)?n.Name:n.AliasName)+":",t=0;t<this._filter.length;t++)if(i=this._filter[t],i.startsWith(r)&&!i.match(":~"))return this._filter[t].substr(r.length);return null},findField:function(n){return this._mapOfAllFields[n]},findCategory:function(n){for(var i,t=0;t<this._categories.length;t++)if(i=this._categories[t],i.Id==n)return i;return null},_isInInstantDetailsMode:function(){return location.href.match(Web.DataView.DetailsRegex)},_closeInstantDetails:function(){return this._isInInstantDetailsMode()&&Web.DataViewResources.Lookup.ShowDetailsInPopup?(close(),!0):!1},_confirm:function(n,t){var v=/(_(\w+))\s*=\s*(.+?)(\s*\r|;|\n|$)/gi,u=n.action.Confirmation,o=!0,s=v.exec(u),i,f,e,r,w,c,h;if(!s||__tf!=4)u=this._parseText(u,this.get_currentRow()),t?t(u):confirm(u)||(o=!1);else{for(var l=null,y="",a="New",p="";s;)i=s[2],f=s[3],i=="controller"&&(l=f),i=="view"&&(y=f),i=="commandName"&&(a=a),i=="commandArgument"&&(p=f),i=="width"&&(n.MaxWidth=f),i=="title"&&(n.WindowTitle=f),s=v.exec(u);if(e=this.get_isModal()?null:Web.DataView.find(l,"Controller"),e&&!e.get_isModal())r=e._collectFieldValues(),o=e._validateFieldValues(r,!0),o&&(this._convertValuesToParameters(r),this._paramValues=r);else{for(r=this._collectFieldValues(),w=n.Values=[],c=0;c<r.length;c++)h=r[c],Array.add(w,{Name:"Context_"+h.Name,Value:h.Modified?h.NewValue:h.OldValue});e=Web.DataView.showModal(this,l,y,a,p,this.get_baseUrl(),this.get_servicePath(),[],{confirmContext:n,showSearchBar:this.get_showSearchBar()});o=!1}}return o},executeAction:function(n,t,i,r,u,f){var s,e,o;if(!this._isBusy){if(Web.DataView.hideMessage(),!f){if(s=this.get_lookupField()!=null,e=s&&this._lookupActionProcessing()?null:n=="ActionBar"?this.get_actionGroups(n)[r].Actions:this.get_actions(n),t<0&&e){for(o=0;o<e.length;o++)if(this._isActionAvailable(e[o],i)){t=o;break}if(t<0)return}f=e?e[t]:null}if(!f||String.isNullOrEmpty(f.Confirmation)||(!this.get_isGrid()||this.get_isDataSheet()||this.get_lastCommandName()=="BatchEdit"||s||this.executeRowCommand(i,"Select"),u||this._confirm({action:f,scope:n,actionIndex:t,rowIndex:i,groupIndex:r}))){var h=f?f.CommandName:"Select",c=f?f.CommandArgument:null,l=f?f.CausesValidation:!0,a=f?f.Path:null;this.executeRowCommand(i,h,c,l,a)}}},executeRowCommand:function(n,t,i,r,u){var f=this.extension(),e,o;(n!=null&&n>=0&&(this._selectedRowIndex=n,this._raiseSelectedDelayed=!(t=="Select"&&String.isNullOrEmpty(i)),f&&(this._selectedRow=this._rows[n]),this._selectKeyByRowIndex(n)),e={commandName:t,commandArgument:i?i:"",path:u,causesValidation:r?!0:!1},!$app.mobile&&this.get_isDataSheet()&&t.match(/Select|New|Edit|Duplicate/)&&this._rows.length>0&&(f==null||Web.DataView.Extensions.active(f)?this._get_focusedCell()||this._startInputListenerOnCell(0,0):Web.DataView.Extensions.active(f,!0)),this.executeCommand(e))&&(t=="ClientScript"?this._raiseSelectedDelayed||(o=this,setTimeout(function(){o.refresh(!0)},10)):t!="Select"||i!=null||this.get_isGrid()||this._render())},rowCommand:function(n,t,i,r,u){var e,f,o;(this._raiseSelectedDelayed=!(t=="Select"&&String.isNullOrEmpty(i)),this._selectKeyByRow(n),e={commandName:t,commandArgument:i?i:"",path:u,causesValidation:r?!0:!1},this.get_isDataSheet()&&t.match(/Select|New|Edit|Duplicate/)&&(f=this.extension(),f==null||Web.DataView.Extensions.active(f)||Web.DataView.Extensions.active(f,!0)),this.executeCommand(e))&&(t=="ClientScript"?this._raiseSelectedDelayed||(o=this,setTimeout(function(){o.refresh(!0)},10)):t!="Select"||i!=null||this.get_isGrid()||this._render())},_get_dataRequestForm:function(){var n=$get("_dataRequest_form");return n||(n=document.createElement("form"),n.id="_dataRequest_form",n.method="post",n.innerHTML='<input type="hidden" name="q" id="q"/><input type="hidden" name="aa" id="aa"/><input type="hidden" name="c" id="c"/><input type="hidden" name="a" id="a"/>',document.body.appendChild(n)),n},_applySelectionFilter:function(n){this.multiSelect()&&this._selectedKeyList.length>0&&this._keyFields.length==1&&(n.Filter=Array.clone(n.Filter),Array.add(n.Filter,String.format("{0}:$in${1}",this._keyFields[0].Name,this._selectedKeyList.join("$or$"))))},get_appRootPath:function(){var n=this.get_servicePath();return typeof __cothost!="undefined"&&(__cothost=="DotNetNuke"&&n.match(/DesktopModules\//i)||__cothost=="SharePoint"&&n.match(/_layouts\//i))?n.replace(/Service\.asmx$/i,""):"~/"},executeReport:function(n){var t,i,u,o,f,e,c,s,r,h;if(this._cancelConfirmation(),t=this._createParams(!0),t.Controller=this.get_controller(),t.View=this.get_viewId(),i=this._get_dataRequestForm(),i.target="",i.action=this.resolveClientUrl(this.get_appRootPath()+"Report.ashx"),$get("c",i).value=n.commandName,u=n.commandArgument,String.isNullOrEmpty(u)||(u.startsWith("_")&&(i.target=u),o=u.split(Web.DataView._simpleListRegex),u=o[0],o.length==3&&(t.Controller=o[1],t.View=o[2])),$get("a",i).value=u,t.Filter.length>0&&this.get_viewType()!="Form"){if(f=new Sys.StringBuilder,this.useCase("$app"))f.append(this._filterDetailsText);else if(this._renderFilterDetails(f,t.Filter),e=this.get_master(),e)for(c=e.get_selectedRow(),s=0;s<e._allFields.length;s++)r=e._allFields[s],r.ShowInSummary&&!r.OnDemand&&(r=e._allFields[r.AliasIndex],f.isEmpty()||f.append(" "),f.appendFormat("{0} {1} {2}.",r.HeaderText,Web.DataViewResources.Data.Filters.Labels.Equals,r.format(c[r.Index])));t.FilterDetails=f.toString()}this._viewMessages&&(t.FilterDetails=String.format("{0} {1}",this._viewMessages[this.get_viewId()],t.FilterDetails));t.FilterDetails&&(t.FilterDetails=t.FilterDetails.replace(/(<b class=\"String\">([\s\S]*?)<\/b>)/g,'"$2"').replace(/(&amp;)/g,"&").replace(/(<.+?>)|&nbsp;/g,""));this._applySelectionFilter(t);$get("q",i).value=Sys.Serialization.JavaScriptSerializer.serialize(t);h=this._createArguments(n);this._validateFieldValues(h.Values,!0);h.ExternalFilter=t.ExternalFilter;$get("aa",i).value=Web.DataView.htmlEncode(Sys.Serialization.JavaScriptSerializer.serialize(h));this._showDownloadProgress();i.submit()},_showDownloadProgress:function(){var n,t,i;$app.isSaaS()||(this._busy(!0),n=this,t="APPFACTORYDOWNLOADTOKEN",document.cookie=String.format("{0}={1}; path=/",t,encodeURIComponent(this.get_id())),i=setInterval(function(){var u,r,f,e,o;if(!String.isNullOrEmpty(document.cookie))for(u=document.cookie.split(";"),r=0;r<u.length;r++)f=u[r].trim(),f.startsWith(t)&&(e=f.substring(t.length+1).split(","),e.length==2&&e[0]==n.get_id()&&(document.cookie=String.format("{0}=; expires={1}; path=/",t,new Date(0).toUTCString()),n._busy(!1),clearInterval(i),o=n._pendingExecuteComplete,n._pendingExecuteComplete&&(n._pendingExecuteComplete=null,n._onExecuteComplete(o.result,o.context))))},500))},executeExport:function(n){var t=this._get_dataRequestForm(),i;t.target=n.commandName=="ExportRss"?"_blank":"";t.action=this.resolveClientUrl(this.get_appRootPath()+"Export.ashx");i=this._createParams(!0);this._applySelectionFilter(i);n.Controller=this.get_controller();n.View=this.get_viewId();n.Filter=i.Filter;n.SortExpression=i.SortExpression;$get("c",t).value=n.commandName;$get("a",t).value=n.commandArgument;$get("q",t).value=Sys.Serialization.JavaScriptSerializer.serialize(n);t.submit()},_clearDynamicItems:function(){for(var t,n=0;n<this._allFields.length;n++)t=this._allFields[n],t.DynamicItems&&(t.DynamicItems=null)},_copyLookupValues:function(n,t,i,r){var o,f;if(!String.isNullOrEmpty(t.Copy)){for(var e=r?r:[],s=/(\w+)\s*=\s*(\w+)/g,u=s.exec(t.Copy);u;){if(t._dataView.findField(u[1]))if(u[2]=="null")Array.add(e,{name:u[1],value:null});else if(n)o=this.findField(u[2]),o&&Array.add(e,{name:u[1],value:n[o.Index]});else if(i)for(f=0;f<i.length;f++)if(i[f].Name==u[2]){Array.add(e,{name:u[1],value:i[f].NewValue});break}u=s.exec(t.Copy)}r||(t._dataView.refresh(!0,e),t._dataView._focus())}},_copyExternalLookupValues:function(){var n,r,u,t,i;if(this.get_filterSource()&&this.get_filterSource()!="Context"&&(n=this.get_master(),n)){for(r=[],u=this.get_externalFilter(),t=0;t<u.length;t++)i=this.findField(u[t].Name),i&&!String.isNullOrEmpty(i.Copy)&&n._copyLookupValues(n.get_currentRow(),i,null,r);this._ditto=r}},_processSelectedLookupValues:function(){var i=[],u=[],f=this.get_lookupField(),o=this.findField(f.ItemsDataValueField),e=this.findField(f.ItemsDataTextField),r=this.get_selectedRow(),n,t;if(o)Array.add(i,r[o.Index]);else for(n=0;n<this._allFields.length;n++)this._allFields[n].IsPrimaryKey&&Array.add(i,r[this._allFields[n].Index]);if(e)Array.add(u,e.format(r[e.Index]));else{for(n=0;n<this.get_fields().length;n++)if(t=this.get_fields()[n],!t.Hidden&&t.Type=="String"){Array.add(u,t.format(r[t.AliasIndex]));break}if(u.length==0)for(n=0;n<i.length;n++)if(t=this.get_fields()[n],!t.Hidden){Array.add(u,t.format(r[t.AliasIndex]));break}}this._copyLookupValues(r,f);f._dataView.changeLookupValue(f.Index,i.length==1?i[0]:i,u.join(";"))},_showModal:function(n){this.set_lastCommandName(null);this.set_lastCommandArgument(null);this._render();n.commandName=="Duplicate"&&(n.commandName="New");var t=Web.DataView.showModal(this,this.get_controller(),n.commandArgument,n.commandName,n.commandArgument,this.get_baseUrl(),this.get_servicePath(),this.get_hasParent()?this._externalFilter:null,{filter:this.get_selectedKeyFilter(),ditto:this.get_ditto(),lastViewId:this.get_lastViewId(),transaction:this.get_transaction(),filterSource:this.get_filterSource(),filterFields:this.get_filterFields(),showSearchBar:this.get_showSearchBar(),tag:this.get_tag(),showActionButtons:this.get_showActionButtons()});this.set_ditto(null);this._savePosition();t.get_isInserting()||(t._position=this._position);this._restorePosition()},_savePosition:function(){this.get_isForm()||this._selectedRowIndex==null||(this._position={index:this._pageSize*this._pageIndex+this._selectedRowIndex,count:this._totalRowCount,filter:this.get_filter(),sortExpression:this.get_sortExpression(),key:Array.clone(this._selectedKey),keyFilter:this._selectedKeyFilter,active:!1})},_restorePosition:function(){this._position&&(this._selectedKey=this._position.key,this._selectedKeyFilter=this._position.keyFilter,this._position=null)},_advance:function(n){this._isBusy||!this._position||n==-1&this._position.index==0||n==1&&this._position.index==this._position.count-1||(this._position.index+=n,this._position.changing=!0,this._position.changed=!0,this._loadPage(),this._position.changing=!1)},cancel:function(){if(!this._closeInstantDetails()){if(this.endModalState("Cancel"))return;this.get_backOnCancel()||!String.isNullOrEmpty(this._replaceTriggerViewId)?(this.goBack(!1),setTimeout(function(){location.replace(location.href)},500)):(this.set_lastCommandName("Cancel"),this._pendingSelectedEvent=!0,this.get_isForm()||this.get_isInserting()?(this._forceSync(),this.goToView(this._lastViewId)):this._totalRowCount<0?this.goToPage(-1):(this._clearDynamicItems(),this._render(),_body_performResize()))}},_convertValuesToParameters:function(n){for(var i=0,t;i<n.length;)t=n[i],t.ReadOnly=!0,t.Name.match("PrimaryKey")?Array.removeAt(n,i):(t.Name="Parameters_"+t.Name,i++)},_actionConfirmed:function(n){var r=this._createArguments(n),f=this._validateFieldValues(r.Values,n.causesValidation==null||n.causesValidation),t,i,u;f&&(t=this.get_confirmContext(),i=this.get_parentDataView(),t&&i&&(u=i._paramValues=r.Values,this._convertValuesToParameters(u),i._confirmDataViewId=this.get_id(),i._lookupActionProcessing(!1),i.executeAction(t.scope,t.actionIndex,t.rowIndex,t.groupIndex,!0,t.action),i._lookupActionProcessing(!0)))},executeCommand:function(n){var t,a,o,s,h,u,r,p,e,c,l;if(!this._isBusy){if(t=new Web.BusinessRules(this),a=$app.mobile,t.before(n),t.canceled())return t.dispose(),this._valid=n.commandName=="Calculate",this._valid;switch(n.commandName){case"Select":case"":this.set_lastCommandName(n.commandName);this.set_lastCommandArgument(n.commandArgument);this.get_lookupField()&&n.commandArgument==""?this._processSelectedLookupValues():(String.isBlank(n.commandArgument)?this._render():(this._savePosition(),this.get_showModalForms()&&this.get_isForm(n.commandArgument)?this._showModal(n):this.goToView(n.commandArgument)),__designer()&&__designer_notifySelected(this));break;case"Edit":case"BatchEdit":case"New":case"Duplicate":if(a||(this._allowModalAutoSize(),this._fixHeightOfRow(!1),n.commandName=="Edit"?this._savePosition():this._restorePosition()),n.commandName=="Duplicate"&&(o=this.get_selectedRow(),o)){for(s=[],i=0;i<this._allFields.length;i++)h=this._allFields[i],Array.add(s,{name:h.Name,value:o[h.Index],duplicated:!0});this._ditto=s}u=this._get_focusedCell();r=this.extension();(n.commandName=="New"||n.commandName=="Duplicate")&&(String.isNullOrEmpty(n.commandArgument)&&(n.commandArgument=this.get_viewId()),r&&r.clearSelection?r.clearSelection(!0):this._forgetSelectedRow(!1,u),n.commandName=="New"&&this._copyExternalLookupValues());this.set_lastCommandName(n.commandName);this.set_lastCommandArgument(n.commandArgument);this._clearDynamicItems();String.isBlank(n.commandArgument)?r&&r.stateChanged?r.stateChanged():(this.get_isModal()&&(this._container.style.height=""),this.get_isDataSheet()&&!this._pendingChars&&this._startInputListenerOnCell(this._selectedRowIndex,u==null?0:u.colIndex),this._render()):this.get_showModalForms()&&this.get_isForm(n.commandArgument)&&!this.get_isModal()?this._showModal(n):this.goToView(n.commandArgument);__designer()&&__designer_notifySelected(this);break;case"Navigate":this.navigate(n.commandArgument);break;case"Cancel":this.cancel();break;case"Confirm":this._actionConfirmed(n);break;case"Back":history.go(String.isNullOrEmpty(n.commandArgument)?-1:parseInt(n.commandArgument));break;case"Report":case"ReportAsPdf":case"ReportAsImage":case"ReportAsExcel":case"ReportAsWord":this.executeReport(n);break;case"ExportCsv":case"ExportRowset":case"ExportRss":this.executeExport(n);break;case"_ViewDetails":this._viewDetails(n.commandArgument);break;case"ClientScript":Web.HoverMonitor._instance.close();eval(n.commandArgument);break;case"SelectModal":case"EditModal":this.set_lastCommandName(null);this.set_lastCommandArgument(null);this._render();var w=n.commandName.match(/^(\w+)Modal$/),f=n.commandArgument.split(","),b=f.length==1?this.get_controller():f[0],v=f.length==1?n.commandArgument:f[1],y=[];for(i=0;i<this.get_selectedKey().length;i++)Array.add(y,{Name:this._keyFields[i].Name,Value:this.get_selectedKey()[i]});p=Web.DataView.showModal(this,b,v,w[1],v,this.get_baseUrl(),this.get_servicePath(),y);p._parentDataViewId=this.get_id();break;case"Import":this._showImport(n.commandArgument);break;case"DataSheet":this.writeContext("GridType","DataSheet");this._forceFocusDataSheet=!0;this.changeViewType("DataSheet");this.refreshAndResize();break;case"Grid":this.writeContext("GridType","Grid");this.changeViewType("Grid");this.refreshAndResize();break;case"Status":this._changeStatus(n);break;case"Search":this._executeSearch(n.path);break;case"None":return!0;default:e=null;c=n.commandArgument.match(/^view:(.+)$/);n.commandName=="Insert"&&c&&(e=c[1],Array.clear(this._selectedKey),this.updateSummary(),this.set_lastCommandName("New"),this.set_lastCommandArgument(e));l=this._createArguments(n,e);this._valid=this._validateFieldValues(l.Values,n.causesValidation==null||n.causesValidation);this._valid&&this._execute(l)}return t.after(n),t.dispose(),!t.canceled()}},_forgetSelectedRow:function(n,t){t||(t=this._get_focusedCell());this.get_isDataSheet()&&t&&(t.colIndex=0);this._lastSelectedRowIndex=!this._ignoreSelectedKey&&this._selectedKey.length>0&&this._rowIsSelected(this._selectedRowIndex)?this._selectedRowIndex:-1;this._ignoreSelectedKey=!1;Array.clear(this._selectedKey);this.updateSummary();n&&this.raiseSelected()},_changeStatus:function(n){var r,i,t,u;(!n.causesValidation||(r=this._collectFieldValues(),n.values&&(r=Array.clone(n.values)),this._validateFieldValues(r,!0)))&&(i=this.findField("Status"),i)&&(this.get_isEditing()?(t=this._get("_Item",i.Index),t||(t=document.createElement("input"),t.type="hidden",t.id=String.format("{0}_Item{1}",this._id,i.Index),this._container.appendChild(t)),t.value=n.commandArgument):(u=this.get_selectedRow(),u[i.Index]=n.commandArgument),this._updateVisibility())},_notifyDesigner:function(n){if(__designer()&&n){var t=this._lastArgs;external.ExplorerNodeChanged(this.get_controller(),this.get_viewId(),t.CommandName,t.CommandArgument,Sys.Serialization.JavaScriptSerializer.serialize(t.Values))}},goBack:function(n){Web.DataView._navigated=!0;this._notifyDesigner(n);var t=location;t.href.match(/_explorerNode=/)?t.replace(t.href):history.go(-1)},_viewDetails:function(n){var t=this.findField(n),f,i,e,r,u,o;if(t){if(f=t.Name,t.ItemsDataController==this.get_controller())for(i=0;i<this._allFields.length;i++)if(this._allFields[i].IsPrimaryKey){f=this._allFields[i].Name;break}if(e=this.get_contextFilter(t),__designer()){for(r=String.format("{0}&{1}={2}",t.ItemsDataController,String.isNullOrEmpty(t.ItemsDataValueField)?f:t.ItemsDataValueField,this.get_selectedRow()[t.Index]),i=0;i<e.length;i++)u=e[i],r=String.format("{0}&{1}={2}",r,u.Name,u.Value);r=this.resolveClientUrl(String.format("~/Details.{0}?l={1}",__designer()?"htm":"aspx",encodeURIComponent(r)));location.href=r;Web.DataView._navigated=!1}else u=[{Name:String.isNullOrEmpty(t.ItemsDataValueField)?f:t.ItemsDataValueField,Value:this.fieldValue(t.Name)}],Array.addRange(u,e),o=$app.showModal(this,t.ItemsDataController,"editForm1","Select","editForm1",this.get_baseUrl(),this.get_servicePath(),u,{useCase:"ObjectRef"}),o.set_showSearchBar(this.get_showSearchBar()),o._parentDataViewId=this.get_id(),o._closeViewDetails=!0}},changeViewType:function(n){this.cancelDataSheet();this._viewTypes||(this._viewTypes=[]);this._viewTypes[this.get_viewId()]=n;this._clearCache()},_parseLocation:function(n,t,i){var e,o,c,s;if(t||(t=this.get_selectedRow()),!n)return null;n=this.resolveClientUrl(n);for(var h=/([\s\S]*?)\{(\w+)?\}/g,u="",f=-1,r=h.exec(n);r;){if(u+=r[1],i&&this._lastArgs){for(e=0;e<i.length;e++)if(o=i[e],o.Name==r[2]){u+=this._lastArgs.CommandName.match(/Insert/i)?o.NewValue:o.OldValue;break}}else c=r[2].match(/^\d+$/)?this.get_fields()[parseInt(r[2])]:this.findField(r[2]),c&&(s=t[c.Index],s!=null&&(u+=r.index==0?s:encodeURIComponent(s)));f=h.lastIndex;r=h.exec(n)}return f!=-1&&(n=u+(f<n.length?n.substr(f):"")),n.startsWith("?")&&(n=location.pathname+n),n},_parseText:function(n,t){var f,r;if(t||(t=this.get_selectedRow()),!n)return null;for(var e=/([\s\S]*?)\{(\w+)?\}/g,o="",u=-1,i=e.exec(n);i;)o+=i[1],f=i[2].match(/^\d+$/)?this.get_fields()[parseInt(i[2])]:this.findField(i[2]),f&&(r=t[f.Index],r!=null&&(r=f.format(r),o+=r)),u=e.lastIndex,i=e.exec(n);return u!=-1&&(n=o+(u<n.length?n.substr(u):"")),n},_showImport:function(n){n||(n=this.get_viewId());this._importView=n;this._importElement=document.createElement("div");this._importElement.id=this.get_id()+"$Import";this._importElement.className="Import";var t=new Sys.StringBuilder,i=String.format("<a href=\"javascript:\" onclick=\"$find('{0}')._downloadImportTemplate('{1}');return false;\">{2}<\/a>",this.get_id(),n,Web.DataViewResources.Data.Import.DownloadTemplate);t.appendFormat('<div id="{0}$ImportStatus" class="Status"><span>{1}<\/span> {2}<\/div>',this.get_id(),Web.DataViewResources.Data.Import.UploadInstruction,i);t.appendFormat('<div id="{0}$ImportMap" class="Map" style="display:none"><\/div>',this.get_id());t.appendFormat('<iframe src="{1}?parentId={0}&controller={2}&view={3}" frameborder="0" scrolling="no" id="{0}$ImportFrame" class="Import"><\/iframe>',this.get_id(),this.resolveClientUrl(this.get_appRootPath()+"Import.ashx"),this.get_controller(),n);t.appendFormat('<div class="Email">{1}:<br/><input type="text" id="{0}$ImportEmail"/><\/div>',this.get_id(),Web.DataViewResources.Data.Import.Email);t.appendFormat('<div class="Buttons"><button id="{0}$StartImport" onclick="$find(\'{0}\')._startImportProcessing();return false" style="display:none">{1}<\/button><button id="{0}$CancelImport" onclick="$find(\'{0}\')._closeImport();return false">{2}<\/button><\/div>',this.get_id(),Web.DataViewResources.Data.Import.StartButton,Web.DataViewResources.ModalPopup.CancelButton);this._importElement.innerHTML=t.toLocaleString();this._appendModalPanel(this._importElement);this._importPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"$ImportPopup",PopupControlID:this._importElement.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]);this._saveTabIndexes();this._importPopup.show()},_closeImport:function(){this._disposeImport();this._restoreTabIndexes()},_disposeImport:function(){this._importElement&&(this._importPopup.hide(),this._importPopup.dispose(),this._importPopup=null,this._importElement.parentNode.removeChild(this._importElement),delete this._importElement)},_downloadImportTemplate:function(n){this.executeExport({commandName:"ExportTemplate",commandArgument:String.format("{0},{1}",this.get_controller(),n)})},_initImportUpload:function(n){var t=n.createElement("div");t.innerHTML=String.format('<form method="post" enctype="multipart/form-data"><input type="file" id="ImportFile" name="ImportFile" style="font-size:8.5pt;font-family:tahoma;padding:2px 0px 4px 0px;" onchange="parent.window.$find(\'{0}\')._startImportUpload(this.value);this.parentNode.submit()"/><\/form>',this.get_id());n.body.appendChild(t);Sys.UI.DomElement.setFocus(n.getElementById("ImportFile"))},_get_importStatus:function(){return $get(this.get_id()+"$ImportStatus")},_get_importFrame:function(){return $get(this.get_id()+"$ImportFrame")},_startImportUpload:function(n){var t=n.split(/\\/);this._importFileName=t[t.length-1];Sys.UI.DomElement.setVisible(this._get_importFrame(),!1);$(this._get_importStatus()).addClass("Wait");this._get_importStatus().innerHTML=Web.DataViewResources.Data.Import.Uploading},_finishImportUpload:function(n){var o,h,t,i,c,u,f,e,a,l;if(Sys.UI.DomElement.removeCssClass(this._get_importStatus(),"Wait"),Sys.UI.DomElement.addCssClass(this._get_importStatus(),"Ready"),o=n.getElementById("Errors"),o)this._get_importStatus().innerHTML=o.value;else{var y=n.getElementById("FileName"),v=n.getElementById("NumberOfRecords"),r=n.getElementById("AvailableImportFields").value.trim().split(/\r?\n/),s=n.getElementById("FieldMap").value.trim().split(/\r?\n/);for(this._get_importStatus().innerHTML=String.format(Web.DataViewResources.Data.Import.MappingInstruction,v.value,this._importFileName),this._importFileName=n.getElementById("FileName").value,h=$get(this.get_id()+"$StartImport"),Sys.UI.DomElement.setVisible(h,!0),Sys.UI.DomElement.setFocus(h),t=new Sys.StringBuilder,t.append("<table>"),i=0;i<s.length;i++){for(c=s[i].match(/^(.+?)=(.+?)?$/),t.appendFormat('<tr><td>{2}<\/td><td><select id="{0}$ImportField{1}"><option value="">{3}<\/option>',this.get_id(),i,Web.DataView.htmlEncode(c[1]),Web.DataViewResources.Data.Import.AutoDetect),u=0;u<r.length;u++)f=r[u].split("="),f[0]==c[2]&&(t.appendFormat('<option value="{0}"',f[0]),t.append(' selected="selected"'),t.appendFormat(">{0}<\/option>",Web.DataView.htmlEncode(f[1])));t.append("<\/select><\/td><\/tr>")}t.append("<\/table>");e=$get(this.get_id()+"$ImportMap");Sys.UI.DomElement.setVisible(e,!0);e.innerHTML=t.toString();a=$(e).find("select").change(function(){l()});l=function(){var i=Array.clone(s),t=[],n=0;a.each(function(){$(this).css("width","auto");this.value!=""&&Array.add(t,this.value)}).each(function(){var u=this,n,i;for($(u).find("option").filter(function(){return u.value!=this.value&&this.value!=""}).remove(),n=0;n<r.length;n++)i=r[n].split("="),Array.contains(t,i[0])||$(this).append($("<option>",{value:i[0]}).text(i[1]))}).each(function(){var t=$(this).outerWidth();t>n&&(n=t)}).css("width",n)};l()}this._importPopup.show();this._get_importFrame().parentNode.removeChild(this._get_importFrame())},_startImportProcessing:function(){var r=$get(this.get_id()+"$ImportEmail"),u=r.value.replace(/;/g,","),n,t,i;if(String.isBlank(u)&&!confirm(Web.DataViewResources.Data.Import.EmailNotSpecified)){Sys.UI.DomElement.setFocus(r);return}for(n=new Sys.StringBuilder,n.appendFormat("{0};{1};{2};{3};",this._importFileName,this.get_controller(),this._importView,u),t=0;;){if(i=$get(this.get_id()+"$ImportField"+t),!i)break;n.append(i.value);n.append(";");t++}this.executeCommand({commandName:"ProcessImportFile",commandArgument:n.toString()});this._closeImport();alert(Web.DataViewResources.Data.Import.Processing);this.refresh()},navigate:function(n,t){this.set_selectedValue(this.get_selectedKey());var r=null,u=Web.HoverMonitor._instance;for(u&&u.close(),n=this._parseLocation(n,null,t),i=0;i<this.get_views().length;i++)if(this.get_views()[i].Id==n){r=this.get_views()[i];break}r?this.goToView(n):this._navigate(n)},_navigate:function(n,t){Web.DataView._navigated=!0;var i=n.match(Web.DataView.LocationRegex);typeof __dauh!="undefined"?i?this.encodePermalink(i[2],i[1],t):this.encodePermalink(n):i?(Web.DataView._navigated=!1,open(i[2],i[1],t?t:"")):window.location.href=n},get_contextFilter:function(n,t){var f=[],e,u,i,h,o,l;if(!String.isNullOrEmpty(n.ContextFields))for(var s=t?t:this._collectFieldValues(!0),c=/(\w+)(\s*=\s*(.+?)){0,1}\s*(,|$)/g,r=c.exec(n.ContextFields);r;){if(e=String.isNullOrEmpty(r[3])?r[1]:r[3],u=e.match(/^\'(.+)\'$/),u||(u=e.match(/^(\d+)$/)),u){for(i=0;i<f.length;i++)if(f[i].Name==r[1]){f[i].Value+='\0='+u[1];u=null;break}u&&Array.add(f,{Name:r[1],Value:u[1]})}else if(h=this.findField(e),h)for(i=0;i<s.length;i++)if(s[i].Name==h.Name){o=s[i];l=o.Modified?o.NewValue:o.OldValue;Array.add(f,{Name:r[1],Value:l});break}r=c.exec(n.ContextFields)}return f},showLookup:function(n){var t,f,i,r,u;this.get_enabled()&&(t=this._allFields[n],t._lookupModalBehavior?t._lookupDataControllerBehavior._render():(f=$get(this.get_id()+"_Item"+t.Index+"_ShowLookupLink"),f&&(i=t._lookupModalPanel=document.createElement("div"),this._appendModalPanel(i),i.className="ModalPanel",i.id=this.get_id()+"_ItemLookupPanel"+t.Index,i.innerHTML=String.format('<table style="width:100%;height:100%"><tr><td valign="middle" align="center"><table cellpadding="0" cellspacing="0"><tr><td class="ModalTop"><div style="height:1px;font-size:1px"><\/div><\/td><td><div style="height:1px;font-size:1px"><\/div><\/td><\/tr><tr><td align="left" valign="top" id="{0}_ItemLookupPlaceholder{1}"  class="ModalPlaceholder"><\/td><td class="RightSideShadow"><\/td><\/tr><tr><td colspan="2"><div class="BottomShadow"><\/div><\/td><\/tr><\/table><\/td><\/tr><\/table>',this.get_id(),t.Index),t._lookupModalBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"_ItemLookup"+t.Index,PopupControlID:i.id,BackgroundCssClass:"ModalBackground"},null,null,f))),r=this.get_contextFilter(t),u=!0,t._lookupDataControllerBehavior?r.length>0&&(t._lookupDataControllerBehavior.set_externalFilter(r),t._lookupDataControllerBehavior.goToPage(-1),u=!0):(u=!1,t._lookupDataControllerBehavior=$create(Web.DataView,{id:this.get_id()+"_LookupView"+n,baseUrl:this.get_baseUrl(),pageSize:t.ItemsPageSize?t.ItemsPageSize:Web.DataViewResources.Pager.PageSizes[0],showFirstLetters:t.ItemsLetters,servicePath:this.get_servicePath(),controller:t.ItemsDataController,viewId:t.ItemsDataView,showActionBar:Web.DataViewResources.Lookup.ShowActionBar,lookupField:t,externalFilter:r,filterSource:r.length>0?"Context":null,showSearchBar:this.get_showSearchBar(),searchOnStart:this.get_showSearchBar()&&t.SearchOnStart,description:t.ItemsDescription},null,null,$get(this.get_id()+"_ItemLookupPlaceholder"+t.Index))),this._saveTabIndexes(),t._lookupModalBehavior.show(),u&&t._lookupDataControllerBehavior._focusQuickFind(!0),$addHandler(document.body,"keydown",t._lookupDataControllerBehavior._bodyKeydownHandler),t._lookupDataControllerBehavior._adjustLookupSize(),this._lookupIsActive=!0)},changeLookupValue:function(n,t,i){var u=this._allFields[n],r=this;setTimeout(function(){var f,o,e;r._restoreTabIndexes();f=r.get_id()+"_Item"+n;o=r.get_id()+"_Item"+u.AliasIndex;Sys.UI.DomElement.setVisible($get(f+"_ClearLookupLink"),!0);e=$get(f+"_ShowLookupLink");e.innerHTML=r.htmlEncode(u,i);Sys.UI.DomElement.setFocus(e);t&&(t=u.format(t));$get(f).value=t;f!=o&&($get(o).value=i);$(e).closest("table").css("width","");r._updateLookupInfo(t,i);r._valueChanged(n);r._adjustModalHeight()},0);r._closeLookup(u)},clearLookupValue:function(n){var t=this._allFields[n],i=this.get_id()+"_Item"+n,e=this.get_id()+"_Item"+t.AliasIndex;if(Sys.UI.DomElement.setVisible($get(i+"_ClearLookupLink"),!1),$get(i+"_ShowLookupLink").innerHTML=Web.DataViewResources.Lookup.SelectLink,$get(i).value="",$get(e).value="",!String.isNullOrEmpty(t.Copy)){for(var u=[],f=/(\w+)=(\w+)/g,r=f.exec(t.Copy);r;)r[2]=="null"&&Array.add(u,{name:r[1],value:null}),r=f.exec(t.Copy);u.length>0&&this.refresh(!0,u)}this._updateLookupInfo("",Web.DataViewResources.Lookup.SelectLink);$get(i+"_ShowLookupLink").focus();this._valueChanged(n);this._adjustModalHeight()},_updateLookupInfo:function(n,t){var i=$get(this.get_id()+"_Text0"),r,u;i&&(i.value=t,i.name=i.id,r=$get(this.get_id()+"_Item0"),r.value=n,r.name=r.id,this.get_lookupPostBackExpression()&&(u=Sys.WebForms.PageRequestManager.getInstance(),u?eval("Sys.WebForms.PageRequestManager.getInstance()._doPostBack"+this.get_lookupPostBackExpression().match(/\w+(.+)/)[1]):eval(this.get_lookupPostBackExpression())))},createNewLookupValue:function(n){var t=this._newLookupValueField=this._allFields[n],i=this._createNewView=Web.DataView.showModal(this,t.ItemsDataController,t.ItemsNewDataView,"New",t.ItemsNewDataView,this.get_baseUrl(),this.get_servicePath(),this.get_contextFilter(t));i._parentDataViewId=this.get_id();i.add_executed(Function.createDelegate(this,this._saveNewLookupValueCompleted));i.set_showSearchBar(this.get_showSearchBar());this._lookupIsActive=!0},_saveNewLookupValueCompleted:function(n,t){var r,o,f;if(!(t.result.Errors.length>0)){t.handled=!0;Web.DataView.hideMessage();var s=null,u=this._newLookupValueField,e=u.ItemsDataValueField;for(String.isNullOrEmpty(e)&&(e=n._keyFields[0].Name),t.result.Values.length==0&&(t.result.Values=n._lastArgs.Values),r=0;r<t.result.Values.length;r++)if(t.result.Values[r].Name==e){s=t.result.Values[r].NewValue;break}for(o=null,f=u.ItemsDataTextField,String.isNullOrEmpty(f)&&(f=n._fields[0].Name),i=0;i<n._lastArgs.Values.length;i++)if(n._lastArgs.Values[i].Name==f){o=n._lastArgs.Values[i].NewValue;break}this._createNewView.endModalState("Cancel");this._copyLookupValues(null,u,n._lastArgs.Values);this.changeLookupValue(u.Index,s,o);this._lookupIsActive=!1}},hideLookup:function(n){var i=n?this._allFields[n]:this.get_lookupField(),t=this.get_lookupField()._dataView;t._closeLookup(i);t._restoreTabIndexes();$get(t.get_id()+"_Item"+i.Index+"_ShowLookupLink").focus()},closeLookupAndCreateNew:function(){this.hideLookup();var n=this.get_lookupField();n._dataView.createNewLookupValue(n.Index)},htmlEncode:function(n,t){var i=this._allFields[n.AliasIndex];return i.HtmlEncode?i.Type=="String"?Web.DataView.htmlEncode(t):t:t},filterIsExternal:function(n){var t,r,u,i;if(this._externalFilter.length==0)return!1;for(t=0;t<this._filter.length;t++){if(r=this._filter[t].match(/(\w+):/)[1],u=!1,!n||n==r)for(i=0;i<this._externalFilter.length;i++)if(this._externalFilter[i].Name==r){u=!0;break}if(!u)return!1}return!0},updateSummary:function(){var n,u,t,l,r,s,h,f,e,c,o;if(this.get_showInSummary()&&(n=null,this._summaryId||(u=$getSideBar(),u?(this._summaryId="PageSummary_"+this.get_id(),n=$get("PageSummaryBox"),n||(n=document.createElement("div"),n.id="PageSummaryBox",n.className="TaskBox Summary",n.innerHTML=String.format('<div class="Inner"><div class="Summary">{0}<\/div><\/div>',Web.DataViewResources.Menu.Summary),u.insertBefore(n,u.childNodes[u._hasActivators?1:0]),n._numberOfVisibleSummaries=0),t=$get(this._summaryId),t||(t=document.createElement("div"),t.id=this._summaryId,n.childNodes[0].appendChild(t))):this._summaryId=""),this._summaryId.length>0)){if(n||(n=$get("PageSummaryBox")),!this._rows||this._rows.length==0){Sys.UI.DomElement.setVisible(n,!1);return}l=this.get_selectedRow();t=$get(this._summaryId);var i=new Sys.StringBuilder,a=this._lastCommandName,v=this.get_view().Type;if(this.get_view().Type="Grid",this._lastCommandName=null,r=!0,this._selectedKey.length>0)for(s=!0,h=0,f=0;f<this._allFields.length;f++)if(e=this._allFields[f],e.ShowInSummary&&(r=!1,i.append('<div class="Field">'),s?s=!1:i.append('<div class="Divider"><\/div>'),i.appendFormat('<div class="Label">{0}<\/div>',String.trimLongWords(this._allFields[e.AliasIndex].Label)),i.append('<div class="Value">'),this._renderItem(i,e,l,!1,!1,!1,!1,!0),i.append("<\/div><\/div>"),h++,this.get_summaryFieldCount()>0&&h>=this.get_summaryFieldCount()))break;Sys.UI.DomElement.setVisible(t,!r);r&&this._summaryIsVisible?n._numberOfVisibleSummaries--:(r||this._summaryIsVisible)&&(r||this._summaryIsVisible!=null)||n._numberOfVisibleSummaries++;this._summaryIsVisible=!r;Sys.UI.DomElement.setVisible(n,n._numberOfVisibleSummaries>0);c=i.toString();t.innerHTML=c;o=this._lastArgs!=this._lastClearArgs&&this._lastArgs.CommandName=="Delete";$app.mobile||r&&!o||this.get_filterSource()!=null||typeof Web.Membership=="undefined"||(o&&(this._lastClearArgs=this._lastArgs),Web.Membership._instance.addPermalink(String.format("{0}&_controller={1}&_commandName=Select&_commandArgument=editForm1",this.get_keyRef(),this.get_controller()),o?null:String.format('<div class="TaskBox" style="width:{2}px"><div class="Inner"><div class="Summary">{0}<\/div>{1}<\/div><\/div>',document.title,c,t.offsetWidth==0?135:t.offsetWidth)));i.clear();this._lastCommandName=a;this.get_view().Type=v}},get_hasDetails:function(){return this._hasDetails==!0},get_hasParent:function(){return this._hasParent==!0},get_usesTransaction:function(){return this._usesTransaction==!0},get_inTransaction:function(){return this.get_transaction()!=null},add_selected:function(n){this._hasDetails=!0;this.get_events().addHandler("selected",n)},remove_selected:function(n){this.get_events().removeHandler("selected",n)},raiseSelected:function(){if(!Web.DataView._navigated){var n=this.get_events().getHandler("selected");n&&n(this,Sys.EventArgs.Empty);this.multiSelect()||this.set_selectedValue(this.get_selectedKey())}},add_executed:function(n){this.get_events().addHandler("executed",n)},remove_executed:function(n){this.get_events().removeHandler("executed",n)},raiseExecuted:function(n){var t=this.get_events().getHandler("executed");t&&t(this,n)},_closeLookup:function(n){if($closeHovers(),n&&n._lookupModalBehavior&&(n._lookupModalBehavior.hide(),$removeHandler(document.body,"keydown",n._lookupDataControllerBehavior._bodyKeydownHandler)),this._lookupIsActive=!1,window.event){var t=new Sys.UI.DomEvent(event);t.stopPropagation();t.preventDefault()}},_collectFieldValues:function(n){var r,f,e,b,nt,u,o,c,a,k,p,d,v,l;n=!0;var s=[],y=this.get_selectedRow(),h=this.get_isInserting(),w=this.extension();if(w&&w.collect)s=w.collect();else{if(!y&&!h)return s;for(r=0;r<this._allFields.length;r++){var t=this._allFields[r],g=t.ItemsStyle=="RadioButtonList",i=this._get("_Item",r);if(t.ReadOnly&&!n)i=null;else if(g)for(f=0,e=$get(this.get_id()+"_Item"+r+"_"+f);e;){if(e.checked){i=e;break}else i=null;f++;e=$get(this.get_id()+"_Item"+r+"_"+f)}else if(t.ItemsStyle=="CheckBoxList"&&i&&(f=0,e=$get(this.get_id()+"_Item"+r+"_"+f),e))for(i.value="";e;)e.checked&&(i.value.length>0&&(i.value+=","),i.value+=e.value),f++,e=$get(this.get_id()+"_Item"+r+"_"+f);t.ClientEditor&&i?t.ClientEditor=="Web$DataView$RichText"&&(b=Web.DataView.EditorFactories[t.ClientEditor.replace(".","$")],b.persist&&b.persist(i)):t.Editor&&i&&(nt=$get(i.id+"$Frame"),nt&&(editor=Web.DataView.Editors[t.EditorId],editor&&(i.value=editor.GetValue())));u=i?i.value:null;u&&(t.Type.startsWith("Date")?(o=Date.tryParseFuzzyDate(u,t.DataFormatString),o!=null&&i.type=="text"&&(u=i.value=t.DateFmtStr?String.format(t.DateFmtStr,o):t.format(o))):!String.isBlank(t.DataFormatString)&&t.isNumber()&&(c=Number.tryParse(u),c!=null&&(t.DataFormatString.match(/\{0:p\}/i)&&c>1&&(c=c/100),u=i.value=t.format(c))));t.TimeFmtStr&&(a=this._get("_Item$Time",r),a&&(o=Date.tryParseFuzzyTime(a.value),o!=null&&(a.value=String.localeFormat(t.TimeFmtStr,o),u+=" "+a.value)));!t.OnDemand&&(i||t.IsPrimaryKey||!t.ReadOnly||n)&&(k=!0,p=!1,this._lastCommandName=="BatchEdit"&&(d=$get(String.format("{0}$BatchSelect{1}",this.get_id(),t.Index)),p=t.TextMode==4||t.Hidden||t.ReadOnly,k=t.IsPrimaryKey||p||d&&d.checked),k&&Array.add(s,{Name:t.Name,OldValue:h?null:y[t.Index],NewValue:i&&u!=null?t.Type=="Boolean"&&u.length>0?u=="true":u.length==0?null:u:!h&&(t.TextMode==4||t.Hidden||t.ReadOnly)?y[t.Index]:null,Modified:i!=null&&!(!h&&t.Type=="String"&&String.isNullOrEmpty(u)&&String.isNullOrEmpty(y[t.Index]))||g&&h&&!t.AllowNulls,ReadOnly:t.ReadOnly&&!(t.IsPrimaryKey&&h)||p}))}}for(r=0;r<this._externalFilter.length;r++)for(v=this._externalFilter[r],f=0;f<s.length;f++)if(l=s[f],l.Name.toLowerCase()==v.Name.toLowerCase()&&l.NewValue==null){l.NewValue=typeof v.Value=="string"?this.convertStringToFieldValue(this.findField(l.Name),v.Value):v.Value;l.Modified=!0;break}return s},_enumerateExpressions:function(n,t,i){var f=[],u,r;if(this._expressions)for(u=0;u<this._expressions.length;u++)r=this._expressions[u],r.Scope==t&&(n==Web.DynamicExpressionType.Any||r.Type==Web.DynamicExpressionType.RegularExpression)&&r.Target==i&&Array.add(f,r);return f},_prepareJavaScriptExpression:function(n){var t,f,u,e;if(!n._variables){for(var i=[],o=/(\[(\w+)\])|(\$row\.(\w+))/g,r=o.exec(n.Test);r;){for(t=r[2]||r[4],f=!1,u=0;u<i.length;u++)if(i[u].name==t){f=!0;break}f||(e=this.findField(t),e&&Array.add(i,{name:t,regex:new RegExp("(\\["+t+"\\])|(\\$row\\."+t+")","g"),replace:String.format("this._javaScriptRowValue({0})",e.Index)}));r=o.exec(n.Test)}n._variables=i;n.Test=n.Test.replace(/\[(\w+)\.(\w+)\]/gi,"this.fieldValue('$2','$1')")}},_javaScriptRowValue:function(n){return this._javaScriptRow[n]},_evaluateJavaScriptExpressions:function(n,t,i){for(var r,u,e,s,h,f=i?"":null,o=0;o<n.length;o++)if(r=n[o],r.Type==Web.DynamicExpressionType.ClientScript){if(this._prepareJavaScriptExpression(r),u=r._script,!u){for(u=r.Test,e=0;e<r._variables.length;e++)s=r._variables[e],u=u.replace(s.regex,s.replace);r._script=eval("(function(){return "+u+"})");r._script==null?r._script=u:u=r._script}if(u){this._javaScriptRow=t;try{if(h=typeof u=="string"?eval(u):u.call(this),i)h&&(f==null?f=r.Result:f+=" "+r.Result);else return r.Result==null?h:r.Result}catch(c){}finally{this._javaScriptRow=null}}}return f},_validateFieldValueFormat:function(n,t){var r=null,u=Web.DataViewResources.Validator,i;switch(n.Type){case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":i=t.NewValue;typeof i!="number"&&(i=Number.tryParse(i));isNaN(i)||i==null?r=u.NumberIsExpected:t.NewValue=i;break;case"Boolean":try{t.NewValue=String.isInstanceOfType(t.NewValue)?Boolean.parse(t.NewValue):t.NewValue}catch(f){r=u.BooleanIsExpected}break;case"DateTime":typeof t.NewValue=="string"?(i=String.isNullOrEmpty(n.DataFormatString)?Date.parse(t.NewValue):Date.parseLocale(t.NewValue,n.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]),i?t.NewValue=i:r=u.DateIsExpected,r||t.NewValue==null||(t.NewValue=new Date(t.NewValue-t.NewValue.getTimezoneOffset()*6e4))):isNaN(t.NewValue.getTime())&&(r=u.DateIsExpected)}return r},validate:function(n){for(var t=0;t<n.length;t++)if(n[t].Error)return!1;return!0},_validateFieldValues:function(n,t,i){for(var r,u,f,k,y,c,s,p,w,b,o,h,l,e=!0,a=new Sys.StringBuilder,v=0;v<n.length;v++)if(r=n[v],u=this.findField(r.Name),u&&(!i||u.ColIndex==i.colIndex)){if(u.Type=="DateTime"&&r.OldValue!=null&&r.OldValue.getTimezoneOffset&&(r.OldValue=new Date(r.OldValue-r.OldValue.getTimezoneOffset()*6e4)),f=null,u.ReadOnly&&u.IsPrimaryKey)r.NewValue==null&&r.OldValue!=null&&(r.NewValue=r.OldValue);else if(r.Modified){if(u.AllowNulls||u.HasDefaultValue&&!Web.DataViewResources.Validator.EnforceRequiredFieldsWithDefaultValue||!String.isBlank(r.NewValue)||u.Hidden||u.isReadOnly()||(f=Web.DataViewResources.Validator.RequiredField),!f&&String.isBlank(r.NewValue)&&(r.NewValue=null),f||r.NewValue==null||u.IsMirror||u.Hidden&&!r.Modified||(k=this._validateFieldValueFormat(u,r),u.isReadOnly()||(f=k)),!f)for(y=this._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,r.Name),c=0;c<y.length;c++){s=y[c];p=r.NewValue?r.NewValue:"";try{w=new RegExp(s.Test);b=w.exec(p);s.Result.match(/\$(\d|\'\`)/)?b&&(r.NewValue=p.replace(w,s.Result)):b||(f=f?f+=s.Result:s.Result)}catch(d){}}r.Modified=u.Type.startsWith("DateTime")?(r.NewValue==null?null:r.NewValue.toString())!=(r.OldValue==null?null:r.OldValue.toString()):r.NewValue!=r.OldValue}if(r.Error=f,$app.mobile)f&&t&&(this._focus(u.Name,f),e=!1);else{if(o=$get(this.get_id()+"_Item"+u.Index+"_Error"),o&&t)for(Sys.UI.DomElement.setVisible(o,!1),o.innerHTML=f,f!=null&&e&&this._showFieldError(u,f),h=o.parentNode;h&&h.tagName!="BODY";){if(!$common.getVisible(h)){o=null;break}h=h.parentNode}f&&t&&(e&&(l=this._lastFocusedCell,l&&(this._focusCell(-1,-1,!1),this._focusCell(l.rowIndex,l.colIndex,!0),this._lastFocusedCell=null),this._focus(u.Name)),e=!1,o||a.append(Web.DataView.formatMessage("Attention",u.Label+": "+f)))}}return t||(e=!0),e||Web.DataView.showMessage(a.toString()),a.clear(),e},_fieldIsInExternalFilter:function(n){return this._findExternalFilterItem(n)!=null},_findExternalFilterItem:function(n){for(var i,t=0;t<this._externalFilter.length;t++)if(i=this._externalFilter[t],n.Name.toLowerCase()==i.Name.toLowerCase())return i;return null},_internalFocus:function(){var n=$get(this._focusId);if(n)try{n.value="";n.value=this._focusText;Sys.UI.DomElement.setCaretPosition(n,this._focusText.length)}catch(t){}},_showFieldError:function(n,t){var i=this._get("_Item",n.Index+"_Error"),u,s,r,e;if(i&&(Sys.UI.DomElement.setVisible(i,t!=null),t))if(this._skipErrorReset=!0,i.style.marginLeft="0px",i.style.marginTop="0px",i.innerHTML=String.format('{0} <a href="javascript:" onclick="Sys.UI.DomElement.setVisible(this.parentNode, false);$find(\'{2}\')._focus(\'{3}\');return false" class="Close" title="{1}"><span>&nbsp;<\/span><\/a>',t,Web.DataViewResources.ModalPopup.Close,this.get_id(),n.Name),this.get_isForm())u=$common.getPaddingBox(i.previousSibling?i.previousSibling:i),i.style.marginLeft=u.left+"px",i.style.marginTop="1px";else{var h=$app.scrolling(),c=$common.getClientBounds(),o=$common.getBounds(i),f=o.x+o.width-(h.x+c.width);for(f<0&&(f=0),s=$common.getBounds(i.parentNode),u=$common.getPaddingBox(i.parentNode),r=i.nextSibling;r&&r.nodeType!=1;)r=r.nextSibling;e=$common.getBounds(r?r:i);i.style.marginLeft=-(e.x-s.x+1+f)+"px";i.style.marginTop=e.height+u.bottom+"px"}},_focus:function(n,t){var i,u,r,c,o,f,l,e,v,a,h;if($app.mobile){$app.mobile.focus(n,t);return}if(t)for(i=0;i<this.get_fields().length;i++)this._showFieldError(this.get_fields()[i]);if(u=this._get_focusedCell(),u&&this.get_isEditing()&&this._id==Web.DataView._activeDataSheetId){if(!String.isNullOrEmpty(n)){for(r=null,c=!1,i=0;i<this._fields.length;i++)if(r=this._fields[i],r.Name==n){this._focusCell(u.rowIndex,u.colIndex,!1);c=u.colIndex!=i;u={rowIndex:this._selectedRowIndex,colIndex:i};this._continueAfterScript||(this._saveAndNew=!1);break}!String.isNullOrEmpty(t)&&r&&(c&&(this._focusCell(u.rowIndex,u.colIndex,!0),this.refresh(!0)),this._showFieldError(r,t))}if(o=this._focusCell(u.rowIndex,u.colIndex,!0),o){for(f=o.getElementsByTagName("input"),l=!1,i=0;i<f.length;i++)if(f[i].type!="hidden"){l=!0;break}for(l||(f=o.getElementsByTagName("textarea")),f.length==0&&(f=o.getElementsByTagName("select")),f.length==0&&(f=o.getElementsByTagName("a")),i=0;i<f.length;i++)if(e=f[i],e.tagName!="INPUT"||e.type!="hidden"){(e.tagName=="INPUT"||e.tagName=="TEXTAREA")&&this._pendingChars!=null?(this._focusText=this._pendingChars,this._focusId=e.id,v=this,setTimeout(function(){v._internalFocus()},50)):Sys.UI.DomElement.setFocus(e);break}}this._pendingChars=null;return}for(String.isNullOrEmpty(n)&&!String.isNullOrEmpty(this._focusedFieldName)&&(r=this.findField(this._focusedFieldName),r&&(n=r.Name)),this._focusedFieldName=n,i=0;i<this.get_fields().length;i++)if(r=this.get_fields()[i],a=r.ItemsStyle=="AutoComplete"&&(r.Name==n||r.AliasName==n||String.isNullOrEmpty(n)),!r.ReadOnly&&(n==null||r.Name==n||a)){h=this.get_id()+"_Item"+(a?r.AliasIndex:r.Index);switch(r.ItemsStyle){case"RadioButtonList":case"CheckBoxList":h+="_0";break;case"Lookup":h+="_ShowLookupLink"}var y=$get(h),p=$get(String.format("{0}_ItemContainer{1}",this.get_id(),r.Index)),w=this._categories[r.CategoryIndex],s=Array.indexOf(this._tabs,w.Tab);if(n&&s>=0&&this.set_categoryTabIndex(s),this._toggleCategoryVisibility(r.CategoryIndex,!0),y&&(!p||Sys.UI.DomElement.getVisible(p))&&(n||s==this.get_categoryTabIndex()||this._tabs.length==0)){s>=0&&this.set_categoryTabIndex(s);try{t&&this._showFieldError(r,t);Sys.UI.DomElement.setFocus(y)}catch(b){}break}}},_serverFocus:function(n,t){this._focus(n,t);this.get_isDataSheet()&&(this.refresh(!0),this._focus(n,t))},_saveTabIndexes:function(){var n,r,t,i;for(this._lastSavedTabIndexes=this._savedTabIndexes,this._savedTabIndexes=[],n=0;n<Web.DataView._tagsWithIndexes.length;n++)for(r=document.getElementsByTagName(Web.DataView._tagsWithIndexes[n]),t=0;t<r.length;t++)i=r[t],i&&Array.add(this._savedTabIndexes,{element:i,tabIndex:i.tabIndex})},_restoreTabIndexes:function(){if(this._savedTabIndexes){for(var n=0;n<this._savedTabIndexes.length;n++)this._savedTabIndexes[n].element.tabIndex=this._savedTabIndexes[n].tabIndex,delete this._savedTabIndexes[n].element;Array.clear(this._savedTabIndexes)}this._savedTabIndexes=this._lastSavedTabIndexes;this._lastSavedTabIndexes=null},_selectKeyByRowIndex:function(n){this._selectKeyByRow(this._rows[n])},_selectKeyByRow:function(n){var i,t,r;for(this._selectedRow=n,i=this._selectedKey,this._selectedKey=[],this._selectedKeyFilter=[],t=0;t<this._keyFields.length;t++)r=this._keyFields[t],Array.add(this._selectedKey,n[r.Index]),Array.add(this._selectedKeyFilter,r.Name+":="+this.convertFieldValueToString(r,n[r.Index])),i&&(i.length<t||i[t]!=this._selectedKey[t])&&(i=null);this.updateSummary();i||this._raiseSelectedDelayed||this.raiseSelected()},_showWait:function(n){var i,t,r;$app.mobile||(i=Web.DataViewResources.Common.WaitHtml,this.get_fields()==null||n?(this._container.innerHTML=this.get_isModal()||this.get_lookupField()?i:'<div class="dataview-busy-whitespace"><\/div>',$(this._container).find(".Wait").addClass("dataview")):(t=$get(this.get_id()+"_Wait"),t&&(this._oldWaitHTML=t.innerHTML,t.innerHTML=i)),r=this.extension(),r&&r.wait())},_hideWait:function(){if(this._oldWaitHTML!=null){var n=$get(this.get_id()+"_Wait");n&&(n.innerHTML=this._oldWaitHTML)}},_get_colSpan:function(){return this.get_isForm()?2:this.get_fields().length+(this.multiSelect()?1:0)+(this.get_showIcons()?1:0)+(this.get_isDataSheet()?1:0)+(this._actionColumn?1:0)},_renderCreateNewBegin:function(n,t){String.isNullOrEmpty(t.ItemsNewDataView)||n.append('<table cellpadding="0" cellspacing="0"><tr><td>')},_renderCreateNewEnd:function(n,t){String.isNullOrEmpty(t.ItemsNewDataView)||(n.append("<\/td><td>"),this.get_enabled()&&n.appendFormat('<a href="#" class="CreateNew" onclick="$find(\'{0}\').createNewLookupValue({1});return false" id="{0}_Item{1}_CreateNewLookupLink" title="{2}"{3}>&nbsp;<\/a>',this.get_id(),t.Index,String.format(Web.DataViewResources.Lookup.NewToolTip,t.Label),String.format(' tabindex="{0}"',$nextTabIndex())),n.append("<\/td><\/tr><\/table>"))},_raisePopulateDynamicLookups:function(){this._hasDynamicLookups&&this.get_isEditing()&&this._skipPopulateDynamicLookups!=!0&&this.executeCommand({commandName:"PopulateDynamicLookups",commandArgument:"",causesValidation:!1});this._skipPopulateDynamicLookups=!1},_raiseCalculate:function(n,t){this.executeCommand({commandName:"Calculate",commandArgument:n.Name,causesValidation:!1,trigger:t.Name})},get_currentRow:function(){return this.get_isInserting()?this._newRow?this._newRow:[]:this.get_selectedRow()},fieldValue:function(n,t){var i=!t||t.length==0?this:t.match(/^master$/i)?this.get_master():$find(t),u,r;return i?i._allFields?(u=i.findField(n),!u)?null:(r=i._clonedRow,r==null&&(r=i._cloneChangedRow()),r?r[u.Index]:null):null:null},_useLEVs:function(n){var r,t,e,u;if(n&&this._allowLEVs&&(r=this._get_LEVs(),r.length>0))for(i=0;i<r[0].length;i++)if(t=r[0][i],f=this.findField(t.Name),f&&f.AllowLEV){if(this._lastCommandName=="New"&&t.Modified&&t.NewValue!=null){for(e=!0,u=0;u<this._externalFilter.length;u++)if(this._externalFilter[u].Name.toLowerCase()==t.Name.toLowerCase()){e=!1;break}e&&(n[f.Index]=t.NewValue)}f._LEV=t.Modified?t.NewValue:null}},_configure:function(n){var r,t,u,i,f,e;if(this._requiresConfiguration&&(n||(n=this.get_currentRow()),n))for(r=0;r<this._allFields.length;r++)if(t=this._allFields[r],!String.isNullOrEmpty(t.Configuration))for(u=/\s*(\w+)=(\w+)\s*?($|\n)/g,i=u.exec(t.Configuration);i;)f=this.findField(i[2]),f&&(e=n[f.Index],e&&(t[i[1]]=e)),i=u.exec(t.Configuration)},_focusQuickFind:function(n){if(!this._quickFindFocused||n==!0){this._lostFocus=!0;try{Sys.UI.DomElement.setFocus(this.get_quickFindElement())}catch(t){}this._quickFindFocused=!0}},_restoreEmbeddedViews:function(){var t,n;if(this._embeddedViews){for(t=0;t<this._embeddedViews.length;t++)n=this._embeddedViews[t],n.parent.appendChild(n.view._element),delete n.parent,n.view=null;Array.clear(this._embeddedViews)}},_incorporateEmbeddedViews:function(){var n;if(this._embeddedViews)for(n=0;n<this._embeddedViews.length;n++){var t=this._embeddedViews[n],r=$get("v_"+t.view.get_cookie().replace(/-/g,"")),i=t.view._element;t.parent=i.parentNode;r.appendChild(i)}},_render:function(n){var i,r,t;$app.mobile?n&&this._refreshExtension():(this._restoreEmbeddedViews(),this._detachBehaviors(),this._disposeSearchBarExtenders(),this._useLEVs(),this._configure(),this._internalRender(),this._viewMessages&&this.showViewMessage(this._viewMessages[this.get_viewId()]),this._raisePopulateDynamicLookups(),!this.get_modalAnchor()&&this.get_lookupField()&&this._focusQuickFind(),this._raiseSelectedDelayed&&(this._raiseSelectedDelayed=!1,this.raiseSelected(),this._forceChanged=!1),this._scrollIntoView&&(this._scrollIntoView=!1,i=$common.getBounds(this._element),r=$app.scrolling(),i.y<r.y&&this._element.scrollIntoView(!0)),this._incorporateEmbeddedViews(),this.get_isModal()&&this._adjustModalPopupSize(),this.get_searchOnStart()&&this.get_isGrid()&&(this._focusSearchBar(),this.set_searchOnStart(!1)),this.get_isDataSheet()&&(t=this._get_focusedCell(),this.get_isInserting()&&!t?this._startInputListenerOnCell(0,0):t&&this._id==Web.DataView._activeDataSheetId&&(this._skipCellFocus=!0,this._focusCell(-1,-1,!0))),this.get_isGrid()&&this._synced&&(this._synced=!1,this._selectedRowIndex==null&&(this._forgetSelectedRow(!0),this.refresh(!0))),this._syncKeyFilter())},_syncKeyFilter:function(){var i=this.get_selectedKey(),n,t;if(i.length>0&&this._selectedKeyFilter.length==0)for(n=0;n<this._keyFields.length;n++)t=this._keyFields[n],Array.add(this._selectedKeyFilter,t.Name+":="+this.convertFieldValueToString(t,i[n]))},_mergeRowUpdates:function(n){var u,f,i,r,t;if(this._lastCommandName=="BatchEdit"&&(u=this._batchEdit=[],f=this._allFields,$(this._element).find(".BatchSelect input:checkbox:checked").each(function(){var n=this.id.match(/BatchSelect(\d+)$/),t;n&&(t=f[parseInt(n[1])],Array.add(u,t.Name))})),this._originalRow=null,this._useLEVs(n),this.get_isEditing()&&this._ditto){for(this._originalRow=Array.clone(n),i=0;i<this._ditto.length;i++)r=this._ditto[i],t=this.findField(r.name),!t||t.ReadOnly&&t.IsPrimaryKey||(n[t.Index]=r.value);delete this._ditto}this._configure(n);this._mergedRow=n},_removeRowUpdates:function(){var t=this._mergedRow,n;if(t){if(this._originalRow)for(n=0;n<this._originalRow.length;n++)t[n]=this._originalRow[n];this._mergedRow=null}},_internalRender:function(){var f,n,t,i,e,o,r,u,l;if(this._multipleSelection=null,this._dynamicActionButtons=!1,f=this.get_viewType(),n=new Sys.StringBuilder,this.get_mode()==Web.DataViewMode.Lookup)t=this._fields[0],i=this.get_lookupText(),i==null&&(i=Web.DataViewResources.Lookup.SelectLink),e=t.format(i),this._renderCreateNewBegin(n,t),n.appendFormat('<table cellpadding="0" cellspacing="0" class="DataViewLookup"><tr><td><a href="javascript:" onclick="$find(\'{0}\').showLookup({1});return false" class="Select" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{7}"{8}>{2}<\/a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{5}" tabindex="{7}">&nbsp;<\/a><\/td><\/tr><\/table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Text{1}" value="{6}"/>',this.get_id(),t.Index,this.htmlEncode(t,e),String.format(Web.DataViewResources.Lookup.SelectToolTip,t.Label),this.get_lookupValue(),String.format(Web.DataViewResources.Lookup.ClearToolTip,t.Label),Web.DataView.htmlAttributeEncode(e),$nextTabIndex(),this.get_enabled()?"":' disabled="true" class="Disabled"'),this._renderCreateNewEnd(n,t),this.get_element().appendChild(this._container),this._container.innerHTML=n.toString(),this.get_lookupValue()!=""&&this.get_enabled()||($get(this.get_id()+"_Item0_ClearLookupLink").style.display="none");else{if(o=f=="Form",n.appendFormat('<table class="DataView {1}_{2}{3}{4} {5}Type" cellpadding="0" cellspacing="0"{0}>',this.get_isModal()?String.format(' style="width:{0}px"',this._container.offsetWidth-20):"",this.get_controller(),this.get_viewId(),this._numberOfColumns>0?" MultiColumn":"",this._tabs.length>0?" Tabbed":"",f),o?this._renderFormView(n):this._renderGridView(n),n.append("<\/table>"),this._mergedRow){var s=this._get_focusedCell(),h=this.get_isInserting(),c=this.get_isDataSheet();for(r=0;r<this._allFields.length;r++)u=this._allFields[r],l=s&&r!=this._fields[s.colIndex].Index,(u.Hidden&&(!u.IsPrimaryKey||h)||l||!s&&h&&c)&&(i=this._mergedRow[r],(i!=null||c&&!h)&&n.appendFormat('<input id="{0}_Item{1}" type="hidden" value="{2}"/>',this.get_id(),r,Web.DataView.htmlAttributeEncode(i!=null?u.format(i):"")))}this._container.innerHTML=n.toString();this._multipleSelection!=null&&this._multipleSelection==!0&&($get(this.get_id()+"_ToggleButton").checked=!0);this._attachBehaviors();this._updateVisibility();this.get_isEditing()&&(this._lastCommandName=="BatchEdit"&&$(this._element).find("div.BatchSelect input:checkbox:checked").each(function(){Web.DataView._updateBatchSelectStatus(this,o)}),this._focus())}n.clear();this._updateChart();this._updateSearchBar();this._removeRowUpdates();this._fixWidthOfColumns();this._fixHeightOfRow(!0);this._refreshExtension()},_refreshExtension:function(){var n=this.extension(),t=this._lastExtension;n!=t&&(t&&t.hide(),n&&n.show(),this._lastExtension=n);n&&n.refresh()},_get_headerRowElement:function(){for(var t=this._container.childNodes[0].childNodes[0].childNodes,n=0;n<t.length;){if(Sys.UI.DomElement.containsCssClass(t[n],"HeaderRow"))return t[n];n++}return null},_fixWidthOfColumns:function(){var t,i,n,u,f,h,e;if((this.get_isDataSheet()||this.get_isGrid())&&!this.extension()&&(t=this._get_headerRowElement(),t)){if(this._viewColumnSettings||(this._viewColumnSettings=[]),i=this._viewColumnSettings[this.get_viewId()],!i){for(i=[],$(t).addClass("Fixed"),n=0;n<t.childNodes.length;n++){if(u=t.childNodes[n],f=$common.getBounds(u),f.width==0){Sys.UI.DomElement.removeCssClass(t,"Fixed");return}var o=$common.getPaddingBox(u),s=$common.getBorderBox(u),r={w:f.width-o.horizontal-s.horizontal,h:f.height-o.vertical-s.vertical};Array.add(i,r)}for(h=$common.getBounds(t),n=0;n<i.length;n++)i[n].h=h.height;this._viewColumnSettings[this.get_viewId()]=i;Sys.UI.DomElement.removeCssClass(t,"Fixed")}for(n=0;n<t.childNodes.length;n++)r=i[n],r&&(e=t.childNodes[n],e.style.height=r.h+"px",e.style.width=r.w+"px")}},_fixHeightOfRow:function(n){var i,e,f,r,t,u,o;if((this.get_isDataSheet()||this.get_isGrid())&&(!n||this.get_isEditing())){if(i=this._get_headerRowElement(),!i)return;if(e=this._get_focusedCell(),f=this.get_isGrid()?this._selectedRowIndex:e.rowIndex,f>=0){for(r=i.parentNode,t=0;t<r.childNodes.length;t++)if(r.childNodes[t]==i)break;u=r.childNodes[t+f+1];u&&(n?this._selectedRowHeight&&(u.style.height=this._selectedRowHeight+"px"):(o=$common.getBounds(u),this._selectedRowHeight=o.height))}}},_updateChart:function(){var t,i,n;if(this.get_isChart()){t=this._get("$Chart");i=t.offsetWidth;i<100&&(i=t.parentNode.offsetWidth);n=this._createParams();delete n.Transaction;delete n.LookupContextFieldName;delete n.LookupContextController;delete n.LookupContextView;delete n.LookupContext;delete n.LastCommandName;delete n.LastCommandArgument;delete n.Inserting;delete n.DoesNotRequireData;var u=Sys.Serialization.JavaScriptSerializer.serialize(n),f=$common.getBounds(t),r=this;r._chartHeight&&(t.style.height=r._chartHeight+"px");$(t).one("load",function(){try{r._chartHeight=$(this).height()}catch(n){}}).attr("src",String.format("{0}ChartHost.aspx?c={1}_{2}&w={3}&r={4}",this.get_baseUrl(),this.get_controller(),this.get_viewId(),i,encodeURIComponent(u)))}},_toggleCategoryVisibility:function(n,t){var r=$get(String.format("{0}$Category${1}",this.get_id(),n)),u,i;r&&(u=this.get_categories()[n],t||(t=!Sys.UI.DomElement.getVisible(r)),Sys.UI.DomElement.setVisible(r,t),i=$get(String.format("{0}$CategoryButton${1}",this.get_id(),n)),u.Collapsed=!t,t?(Sys.UI.DomElement.removeCssClass(i,"Maximize"),i.childNodes[0].title=Web.DataViewResources.Form.Minimize):($(i).addClass("Maximize"),i.childNodes[0].title=Web.DataViewResources.Form.Maximize),_body_performResize())},_processTemplatedText:function(n,t){var e,r,i,u,f,o,s;if(t||(t=""),e=/\{(\w+)\}/g,r=e.exec(t),!r)return t;for(i=new Sys.StringBuilder,u=0;r;)i.append(t.substring(u,r.index)),f=r[1],u=r.index+f.length+2,o=this.findField(f),o?(i.append('<span class="FieldPlaceholder">'),this._renderItem(i,o,n,!1,!1,!1,!1,!1,!0),i.append("<\/span>")):i.appendFormat("[{0}]",f),r=e.exec(t);return s=t.length-1,u<s&&i.append(t.substring(u,s)),i.toString().replace(/ (id|for)=\".+?\"/g,"")},_get_selectedTab:function(){return this._tabs.length>0?this._tabs[this.get_categoryTabIndex()]:null},_renderFormView:function(n){var g=this.get_isEditing(),r,e,a,d,v,h,y,l,t,s,w,b,u,k;if(this._renderStatusBar(n),this._renderViewDescription(n),Web.DataViewResources.Form.ShowActionBar&&this._renderActionBar(n),r=this.get_currentRow(),this._mergeRowUpdates(r),this._updateVisibility(r),this.get_isInserting()&&this._expressions)for(i=0;i<this._expressions.length;i++)e=this._expressions[i],e.Scope==Web.DynamicExpressionScope.DefaultValues&&e.Type==Web.DynamicExpressionType.ClientScript&&(f=this.findField(e.Target),f&&(String.isNullOrEmpty(e.Test)?r[f.Index]=e.Result:(a=eval(e.Test),a&&(r[f.Index]=String.isNullOrEmpty(e.Result)?a:e.Result))));for(d=0,i=0;i<this._allFields.length;i++)this._allFields[i].Hidden||d++;if(v=r!=null,v&&this._renderActionButtons(n,"Top","Form"),h=this._get_selectedTab(),this._tabs.length>0){for(n.appendFormat('<tr class="TabsRow"><td colspan="{0}" class="TabsBar{1}">',this._get_colSpan(),v?"":" WithMargin"),n.append('<table cellpadding="0" cellspacing="0" class="Tabs"><tr>'),i=0;i<this._tabs.length;i++)n.appendFormat('<td id="{2}_Tab{3}" class="Tab{1}" onmouseover="$hoverTab(this,true)" onmouseout="$hoverTab(this,false)"><span class="Outer"><span class="Inner"><span class="Tab"><a href="javascript:" onclick="$find(&quot;{2}&quot;).set_categoryTabIndex({3});return false;" onfocus="$hoverTab(this,true)" onblur="$hoverTab(this,false)" tabindex="{4}">{0}<\/a><\/span><\/span><\/span><\/td>',Web.DataView.htmlEncode(this._tabs[i]),i==this.get_categoryTabIndex()?" Selected":"",this.get_id(),i,$nextTabIndex());n.append("<\/tr><\/table><\/td><\/tr>")}if(r)if(y=this._get_template(),y)n.appendFormat('<tr class="CategoryRow"><td valign="top" class="Fields" colspan="{0}">',this._get_colSpan()),this._renderTemplate(y,n,r,!0,!1),n.append("<\/td><\/tr>");else{var c=this.get_categories(),o=this.get_fields(),p=this._numberOfColumns;if(p>0){for(n.appendFormat('<tr class="Categories"><td class="Categories" colspan="{0}"><table class="Categories"><tr class="CategoryRow">',this._get_colSpan()),l=0;l<p;l++){for(l>0&&n.append('<td class="CategorySeparator">&nbsp;<\/td>'),n.appendFormat('<td class="CategoryColumn" valign="top" style="width:{0}%">',100/p),i=0;i<c.length;i++)if(t=c[i],t.ColumnIndex==l||this._ignoreColumnIndex){for(this.get_isModal()&&(t.Collapsed=!1),n.appendFormat('<div id="{0}_Category{1}" class="Category {3}" style="display:{2}">',this.get_id(),i,!h||h==t.Tab?"block":"none",t.Id),s=this._processTemplatedText(r,t.Description),w=this._formatViewText(Web.DataViewResources.Views.DefaultCategoryDescriptions[s],!0,s),n.appendFormat('<table class="Category {8}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText"><span class="Text">{0}<\/span><a href="javascript:" class="MinMax{6}" onclick="$find(\'{2}\')._toggleCategoryVisibility({3});return false;" id="{2}$CategoryButton${3}" style="{5}"><span title="{4}"><\/span><\/a><div style="clear:both;height:1px;margin-top:-1px;"><\/div><\/td><\/tr><tr><td class="Description" id="{2}$CategoryDescription${3}" style="display:{7}">{1}<\/td><\/tr><\/table>',t.HeaderText,w,this.get_id(),i,t.Collapsed?Web.DataViewResources.Form.Maximize:Web.DataViewResources.Form.Minimize,c.length>1&&!this.get_isModal()?"":"display:none",t.Collapsed?" Maximize":"",String.isNullOrEmpty(w)?"none":"block",t.Id),b=!0,j=0;j<o.length;j++)if(u=o[j],!u.Hidden&&u.CategoryIndex==t.Index){b=!1;break}if(!b){if(n.appendFormat('<table class="Fields" id="{0}$Category${1}" style="{2}"><tr class="FieldsRow"><td class="Fields" valign="top" width="100%">',this.get_id(),i,t.Collapsed?"display:none":""),String.isNullOrEmpty(t.Template))for(j=0;j<o.length;j++)u=o[j],u.Hidden||u.CategoryIndex!=t.Index||(k=u.Name.match(/^(_[A-Za-z_]+)\d/),n.appendFormat('<table cellpadding="0" cellspacing="0" class="FieldWrapper {0}"><tr class="FieldWrapper"><td class="Header" valign="top">',k?k[1]:u.Name),this._renderItem(n,u,r,!0,!1,!1,!0),n.appendFormat('<\/td><td class="Item{0}" valign="top">',g&&!u.isReadOnly()?"":" ReadOnly"),this._renderItem(n,u,r,!0),n.append("<\/td><\/tr><\/table>"));else this._renderTemplate(t.Template,n,r,!0,!1);n.append("<\/td><\/tr><\/table>")}n.append("<\/div>")}n.append("<\/td>")}n.append("<\/tr><\/table><\/td><\/tr>")}else for(i=0;i<c.length;i++){if(t=c[i],s=this._processTemplatedText(r,t.Description),n.appendFormat('<tr class="CategoryRow {5}" id="{2}_Category{3}" style="display:{4}"><td valign="top" class="Category {5}"><table class="Category {5}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText">{0}<\/td><\/tr><tr><td class="Description" id="{2}$CategoryDescription${3}">{1}<\/td><\/tr><\/table><\/td><td valign="top" class="Fields {5}">',t.HeaderText,this._formatViewText(Web.DataViewResources.Views.DefaultCategoryDescriptions[s],!0,s),this.get_id(),i,!h||h==t.Tab?"block":"none",t.Id),String.isNullOrEmpty(t.Template))for(j=0;j<o.length;j++)u=o[j],u.Hidden||u.CategoryIndex!=t.Index||this._renderItem(n,u,r,!0);else this._renderTemplate(t.Template,n,r,!0,!1);n.append("<\/td><\/tr>")}}else this._renderNoRecordsWhenNeeded(n);r&&this._renderActionButtons(n,"Bottom","Form")},_updateTabbedCategoryVisibility:function(){var i,n,t,r;if(this._tabs&&this._tabs.length>0){for(i=this._tabs[this.get_categoryTabIndex()],n=0;n<this._tabs.length;n++)t=this._get("_Tab",n),t&&(n==this.get_categoryTabIndex()?$(t).addClass("Selected"):$(t).removeClass("Selected"));for(n=0;n<this._categories.length;n++)r=this._categories[n],t=this._get("_Category",n),t&&Sys.UI.DomElement.setVisible(t,r.Tab==i);this._updateVisibility()}this._adjustModalHeight()},_renderItem:function(n,t,i,r,u,f,e,o,s){var y=Web.DataViewResources.Data,a=this.get_isForm()||u,h=i[t.Index],ht,ot,st,gt,ct,yt,pt,lt,w,k,ft,d,g,nt,v,p,ii,bt,ri,c,ui,fi,at,kt,vt,dt,it;h!=null&&(h=h.toString());var b=null,rt=t.ItemsStyle=="CheckBoxList",tt=this.get_isEditing(),et=t.Index!=t.AliasIndex;if(tt&&t.ItemsStyle=="CheckBox"&&t.Items.length==2&&(ht=t.Items[0][0],ot=t.Items[1][0],ht=="true"&&(ht="false",ot="true"),h==null&&(h=t.Items[0][0]),b=String.format('<input type="checkbox" id="{0}_Item{1}"{2} tabindex="{3}" value="{4}" onclick="this.value=this.checked?\'{6}\':\'{5}\';$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{7}"/>',this.get_id(),t.Index,ot&&(h=="true"||h==ot)?" checked":"",$nextTabIndex(),h,ht,ot,t.ToolTip)),st=t.isReadOnly(),a){if(gt=String.format('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),t.Index),e||n.appendFormat('<div class="Item {2}" id="{0}_ItemContainer{1}">',this.get_id(),t.Index,t.Name),ct=this._allFields[t.AliasIndex].HeaderText,b&&e&&!(tt&&st)){n.append('<div class="Header">&nbsp;<\/div>');return}if(ct.length>0&&(s&&b&&this._numberOfColumns>0?n.append('<div class="Header">&nbsp;<\/div>'):n.appendFormat('<div class="Header {5}">{3}<label for="{0}_Item{1}">{2}{4}<\/label><\/div>',this.get_id(),t.Index,ct,this._numberOfColumns>0||s?"":b,tt&&!t.AllowNulls&&!b&&!st&&Web.DataViewResources.Form.RequiredFieldMarker?Web.DataViewResources.Form.RequiredFieldMarker:"",t.Name)),e)return;(b==null||this._numberOfColumns>0)&&n.append('<div class="Value">')}if(yt=!tt&&!String.isNullOrEmpty(t.ItemsDataController)&&!rt&&!f&&h&&this._disableObjectRef!=!0&&!t.tagged("lookup-details-hidden"),yt&&!a&&n.append('<table width="100%" cellpadding="0" cellspacing="0" class="ObjectRef"><tr><td>'),tt&&r&&!st){pt=t;t._LEV!=null&&n.append('<table cellpadding="0" cellspacing="0"><tr><td>');!a&&b&&n.append(b);var ni=!String.isNullOrEmpty(t.ItemsStyle),wt=t.ItemsStyle=="Lookup",ti=!String.isNullOrEmpty(t.ContextFields),ut=t.ItemsStyle=="AutoComplete",l=t.DynamicItems?t.DynamicItems:t.Items;if(!ni||wt||ut||l.length!=0||rt||!ti){if(t.DynamicItems&&!rt){for(lt=!1,w=0;w<l.length;w++)if(l[w][0]==h){lt=!0;break}lt||(h=null);!t.AllowNulls&&lt||String.isNullOrEmpty(l[0][0])||Array.insert(l,0,["",y.NullValueInForms])}}else l=[],(t.AllowNulls||ti)&&Array.add(l,["",y.NullValueInForms]),h!=null&&Array.add(l,[h,i[t.AliasIndex]]);if(b!=null)(this._numberOfColumns>0||s)&&(n.append(b),n.appendFormat('<label for="{0}_Item{1}" title="{3}">{2}<\/label>',this.get_id(),t.Index,ct,t.ToolTip));else if(l.length>0||rt||ni&&!wt&&!ut)if(t.ItemsStyle=="RadioButtonList"){for(n.appendFormat('<table cellpadding="0" cellspacing="0" class="RadioButtonList" title="{0}">',t.ToolTip),k=t.Columns==0?1:t.Columns,ft=Math.floor(l.length/k)+(l.length%k>0?1:0),d=0;d<ft;d++){for(n.append("<tr>"),g=0;g<k;g++)nt=g*ft+d,nt<l.length?(v=l[nt],p=v[0]==null?"":v[0].toString(),h==null&&(h=""),n.appendFormat('<td class="Button"><input type="radio" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}" onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/><\/td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label><\/td>',this.get_id(),t.Index,nt,p,p==h?" checked":"",this.htmlEncode(t,v[1]),$nextTabIndex())):n.append('<td class="Button">&nbsp;<\/td><td class="Option"><\/td>');n.append("<\/tr>")}n.append("<\/table>")}else if(rt)if(ii=h?h.split(","):[],bt=!String.isNullOrEmpty(t.ContextFields)&&!t.DynamicItems,n.appendFormat('<input type="hidden" id="{0}_Item{1}" name="{0}_Item{1}" value="{2}"/>',this.get_id(),t.Index,bt?h:""),bt)n.append(Web.DataViewResources.HeaderFilter.Loading);else{for(n.appendFormat('<table cellpadding="0" cellspacing="0" class="RadioButtonList" title="{0}">',t.ToolTip),k=t.Columns==0?1:t.Columns,ft=Math.floor(l.length/k)+(l.length%k>0?1:0),d=0;d<ft;d++){for(n.append("<tr>"),g=0;g<k;g++)nt=g*ft+d,nt<l.length?(v=l[nt],p=v[0]==null?"":v[0].toString(),h==null&&(h=""),n.appendFormat('<td class="Button"><input type="checkbox" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}"  onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/><\/td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label><\/td>',this.get_id(),t.Index,nt,p,Array.indexOf(ii,p)!=-1?" checked":"",this.htmlEncode(t,v[1]),$nextTabIndex())):n.append('<td class="Button">&nbsp;<\/td><td class="Option"><\/td>');n.append("<\/tr>")}n.append("<\/table>")}else{for(n.appendFormat('<select id="{0}_Item{1}" size="{2}" tabindex="{3}" onchange="$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{4}">',this.get_id(),t.Index,t.ItemsStyle=="ListBox"?t.Rows==0?5:t.Rows:"1",$nextTabIndex(),t.ToolTip),h==null&&(h=""),h=h.toString(),w=0;w<l.length;w++)v=l[w],p=v[0],ri=p==null&&!t.AllowNulls?Web.DataViewResources.Lookup.SelectLink:v[1],p==null&&(p=""),p=p.toString(),n.appendFormat('<option value="{0}"{1}>{2}<\/option>',p,p==h?" selected":"",this.htmlEncode(t,ri));n.append("<\/select>")}else!String.isNullOrEmpty(t.ItemsDataController)&&wt?(h=i[t.AliasIndex],h==null&&(h=Web.DataViewResources.Lookup.SelectLink),c=this._allFields[t.AliasIndex].format(h),this._renderCreateNewBegin(n,t),n.appendFormat('<table cellpadding="0" cellspacing="0" class="Lookup"><tr><td><a href="#" onclick="$find(\'{0}\').showLookup({1});return false" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{5}">{2}<\/a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{7}" tabindex="{6}" style="display:{8}">&nbsp;<\/a><\/td><\/tr><\/table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Item{9}" value="{2}"/>',this.get_id(),t.Index,this.htmlEncode(t,c),String.isNullOrEmpty(t.ToolTip)?String.format(Web.DataViewResources.Lookup.SelectToolTip,t.Label):t.ToolTip,i[t.Index],$nextTabIndex(),$nextTabIndex(),String.format(Web.DataViewResources.Lookup.ClearToolTip,t.Label),i[t.Index]!=null?"display":"none",t.AliasIndex),this._renderCreateNewEnd(n,t)):t.OnDemand?this._renderOnDemandItem(n,t,i,r,a):t.Editor?(ui=t.Editor,n.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),t.Index,Web.DataView.htmlAttributeEncode(h)),n.appendFormat('<iframe src="{0}?id={1}_Item{2}&control={3}" frameborder="0" scrolling="no" id="{1}_Item{2}$Frame" class="FieldEditor {3}" tabindex="{4}"><\/iframe>',this.resolveClientUrl(this.get_appRootPath()+"ControlHost.aspx"),this.get_id(),t.Index,ui,$nextTabIndex())):t.Rows>1?(n.appendFormat('<textarea id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{3}" style="',this.get_id(),t.Index,$nextTabIndex(),t.ToolTip),t.TextMode!=3||String.isNullOrEmpty(h)||n.append("display:none;"),a?n.appendFormat('" cols="{0}"',t.Columns>0?t.Columns:50):n.append('display:block;width:100%;"'),n.appendFormat(' rows="{0}"',t.Rows),$app.supportsPlaceholder&&!String.isNullOrEmpty(t.Watermark)&&n.appendFormat(' placeholder="{0}"',Web.DataView.htmlAttributeEncode(t.Watermark)),n.append(">"),n.append(t.HtmlEncode?this.htmlEncode(t,h):h),n.append("<\/textarea>"),t.TextMode!=3||String.isNullOrEmpty(h)||n.appendFormat("<div>{2}<div><a href=\"javascript:\" onclick=\"var o=$get('{0}_Item{1}');o.style.display='block';o.focus();this.parentNode.parentNode.style.display='none';return false;\">{3}<\/a> | <a href=\"javascript:\" onclick=\"if(!confirm('{5}'))return;$get('{0}_Item{1}').value='';this.parentNode.parentNode.parentNode.parentNode.style.display='none';return false;\">{4}<\/a><\/div><\/div>",this.get_id(),t.Index,this.htmlEncode(t,h).replace(/((\r\n*)|\n)/g,"<br/>"),y.NoteEditLabel,y.NoteDeleteLabel,y.NoteDeleteConfirm)):(k=t.Columns>0?t.Columns:50,fi=t.ToolTip,ut&&(!et||tt)&&(h=i[t.Index],n.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),t.Index,Web.DataView.htmlAttributeEncode(h)),t=this._allFields[t.AliasIndex]),t.TimeFmtStr&&n.append('<table cellpadding="0" cellspacing="0" class="DateTime"><tr><td class="Date">'),n.appendFormat('<input type="{3}" id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',this.get_id(),t.Index,$nextTabIndex(),t.TextMode!=1?"text":"password"),a?n.appendFormat(' size="{0}"',k):n.append(' style="display:block;width:90%;"'),t.Len>0&&n.appendFormat(' maxlength="{0}"',t.Len),ut&&n.appendFormat(' title="{0}"',fi),h=i[t.Index],h==null?c=ut?y.NullValueInForms:"":et?c=h.toString():(t.DateFmtStr&&(typeof h=="string"&&(h=Date.parseLocale(h,t.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])),t.DataFormatString=t.DateFmtStr),c=t.format(h),t.DateFmtStr&&(t.DataFormatString=t.DataFmtStr)),n.appendFormat(' value="{0}" {1}',Web.DataView.htmlAttributeEncode(c),a?' class="TextInput"':String.format('class="TextInput {0}Type"',t.Type)),n.appendFormat(' title="{0}"',t.ToolTip),$app.supportsPlaceholder&&!String.isNullOrEmpty(t.Watermark)&&n.appendFormat(' placeholder="{0}"',Web.DataView.htmlAttributeEncode(t.Watermark)),n.append("/>"),t.Type.startsWith("DateTime")&&a&&Web.DataViewResources.Form.ShowCalendarButton&&!t.TimeFmtStr&&n.appendFormat('<a id="{0}_Item{1}_Button" href="#" onclick="return false" class="Calendar">&nbsp;<\/a>',this.get_id(),t.Index),t.TimeFmtStr&&(n.appendFormat('<\/td><td class="Time"><input type="text" id="{0}_Item$Time{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',this.get_id(),t.Index,$nextTabIndex()),a?n.appendFormat(' size="{0}"',k):n.append(' style="display:block;width:90%;"'),h==null?c=ut?y.NullValueInForms:"":et?c=h.toString():(t.DataFormatString=t.TimeFmtStr,c=t.format(h),t.DataFormatString=t.DataFmtStr),n.appendFormat(' value="{0}" {1}/><\/td><\/table>',Web.DataView.htmlAttributeEncode(c),a?"":'class="TimeType"')));t._LEV!=null&&(at=this._allFields[t.AliasIndex]._LEV,at==null&&(at=""),n.appendFormat('<\/td><td class="UseLEV"><a href="javascript:" onclick="$find(\'{0}\')._applyLEV({1});return false" tabindex="{2}" title="{3}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),t.Index,$nextTabIndex(),Web.DataView.htmlAttributeEncode(String.format(y.UseLEV,this._allFields[t.AliasIndex].format(at)))));this._lastCommandName=="BatchEdit"&&n.appendFormat('<div class="BatchSelect"><table cellpadding="0" cellspacing="0"><tr><td><input type="checkbox" id="{0}$BatchSelect{1}" onclick="Web.DataView._updateBatchSelectStatus(this,{3})"{4}/><\/td><td><label for="{0}$BatchSelect{1}">{2}<\/a><\/td><\/tr><\/table><\/div>',this.get_id(),pt.Index,y.BatchUpdate,a==!0,this._batchEdit&&Array.contains(this._batchEdit,pt.Name)?' checked="checked"':"")}else if(t.OnDemand)this._renderOnDemandItem(n,t,i,r,a);else{if(h=this.htmlEncode(t,i[t.AliasIndex]),tt&&st&&r&&(kt=i[t.Index],n.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),t.Index,kt!=null?Web.DataView.htmlAttributeEncode(this._allFields[t.AliasIndex].format(kt)):"")),vt=t.DynamicItems?t.DynamicItems:t.Items,vt.length==0)t.Type=="String"&&h!=null&&h.length>y.MaxReadOnlyStringLen&&!(t.TextMode==3||t.TextMode==2)&&(h=h.substring(0,y.MaxReadOnlyStringLen)+"..."),h&&t.TextMode==3&&(h=h.replace(/((\r\n*)|\n)/g,"<br/>")),c=String.isBlank(h)?a?y.NullValueInForms:y.NullValue:this._allFields[t.AliasIndex].format(h);else if(rt){for(l=h?h.split(","):[],dt=!0,w=0;w<vt.length;w++)v=vt[w],p=v[0]==null?"":v[0].toString(),Array.contains(l,p)&&(dt?dt=!1:n.append(", "),n.append(Web.DataView.htmlEncode(v[1])));c=l.length==0?y.NullValueInForms:""}else et&&!r?c=h:(v=this._findItemByValue(t,et?i[t.Index]:h),c=v[1],a||c!=y.NullValueInForms||(c=y.NullValue));String.isNullOrEmpty(t.HyperlinkFormatString)||h==null||(it=this._parseLocation(t.HyperlinkFormatString,i),c=it&&it.match(/^mailto\:/)?String.format('<a href="{0}" title="{2}">{1}<\/a>',it,c,t.ToolTip):it.match(/^javascript\:/)?String.format('<a href="javascript:" onclick="{0};return false;" title="{2}">{1}<\/a>',it.substring(11),c,t.ToolTip):String.format('<a href="javascript:" onclick="$find(\'{2}\')._navigate(\'{0}\');" title="{3}">{1}<\/a>',it,c,this.get_id(),t.ToolTip));t.TextMode==1&&(c="**********");o==!0&&(c=String.trimLongWords(c));__designer()&&c&&(c=c.replace(/\^\w+\^/g,""));n.append(c)}yt&&(a||n.append('<\/td><td align="right">'),n.appendFormat('<span class="ObjectRef" title="{0}" onclick="$find(&quot;{1}&quot;).executeCommand({{commandName: &quot;_ViewDetails&quot;, commandArgument: &quot;{2}&quot;}})">&nbsp;<\/span>',String.format(Web.DataViewResources.Lookup.DetailsToolTip,Web.DataView.htmlAttributeEncode(this._allFields[t.AliasIndex].HeaderText)),this.get_id(),t.Name),a||n.append("<\/td><\/tr><\/table>"));a&&((b==null||this._numberOfColumns>0)&&n.append("<\/div>"),n.append(gt),String.isNullOrEmpty(t.FooterText)||n.appendFormat('<div class="Footer">{0}<\/div>',t.FooterText),n.append("<\/div>"))},_renderOnDemandItem:function(n,t,i,r,u){var f=Web.DataViewResources.Data,e=i[t.Index],h=e!=null?e.toString().match(/^null\|(.+)$/):null,o=h!=null||e==null,s;h&&(e=h[1]);o&&!r&&t.OnDemandStyle==1?n.append(u?f.NullValueInForms:f.NullValue):(s=this.resolveClientUrl(this.get_appRootPath()+f.BlobHandler),r&&!o&&n.appendFormat('<a href="{0}?{1}=o|{2}" title="{3}" onclick="$find(&quot;{4}&quot;)._showDownloadProgress();open(this.href, &quot;_blank&quot;,&quot;height={5},width={6},resizable=yes&quot;);return false">',s,t.OnDemandHandler,e,f.BlobDownloadHint,this.get_id(),$(window).height()/2,$(window).width()/2),t.OnDemandStyle==1?o?n.append(u?f.NullValueInForms:f.NullValue):n.append(r?f.BlobDownloadLink:f.BlobDownloadLinkReadOnly):o?n.append(u?f.NullValueInForms:f.NullValue):n.appendFormat('<img src="{0}?{1}=t|{2}" class="Thumbnail"/>',s,t.OnDemandHandler,e),r&&!o&&n.append("<\/a>"),!t.ReadOnly&&this.get_isEditing()&&r&&n.appendFormat('<iframe src="{0}?{1}=u|{2}&owner={3}&index={4}" frameborder="0" scrolling="no" id="{3}_Frame{4}" tabindex="{6}"><\/iframe><div style="display:none" id="{3}_ProgressBar{4}" class="UploadProgressBar">{5}<\/div>',s,t.OnDemandHandler,e,this.get_id(),t.Index,"Uploading...",$nextTabIndex()))},_showUploadProgress:function(n,t){var f=$get(String.format("{0}_Frame{1}",this.get_id(),n)),i=$get(String.format("{0}_ProgressBar{1}",this.get_id(),n)),e,u,c,r;if(f!=null&&i!=null){e=$(t).find("input:file");u=e.val().split(/(\\|\/)/);u=u.length>0?u[u.length-1]:null;var l=this.get_isInserting(),o=$(i).show().text(u).focus(),s=$common.getPaddingBox(i),h=$common.getBorderBox(i);i.style.width=f.offsetWidth-s.horizontal-h.horizontal+"px";i.style.height=f.offsetHeight-s.vertical-h.vertical+"px";c=$(f).hide();l?(r=this._pendingUploads,r||(r=this._pendingUploads=[]),r.push({form:t,progress:i}),o.find("a").button("destroy"),o.addClass("dataview-insert").append($(String.format("<a>{0}<\/a>",Web.DataViewResources.Data.Filters.Labels.Clear)).button({icons:{primary:"ui-icon-close"},text:!1}).click(function(){o.hide();c.show();for(var n=0;n<r.length;n++)if(r[n].form==t){Array.removeAt(r,n);break}e.replaceWith(e.clone(!0))}))):(this._showDownloadProgress(),t.submit())}},_internalRenderActionButtons:function(n,t,i,r){var u,f,e;for(r||(r=this._actionButtonsInScope(i)),this._clonedRow=this._cloneChangedRow(),u=0;u<r.length;u++)action=r[u],this._isActionAvailable(action)&&(f=String.isNullOrEmpty(action.CssClass)?"":action.CssClass,action.HeaderText&&action.HeaderText.length>10&&(f.length>0&&(f+=" "),f+="AutoWidth"),e=action.CommandName=="None",n.appendFormat('<button onclick="{6}$find(\'{0}\').executeAction(\'{5}\', {1},-1);return false" tabindex="{3}" class="{8}{4}"{7}>{2}<\/button>',this.get_id(),u,action.HeaderText,$nextTabIndex(),f,i,e?"return false;":"",e?' disabled="disabled"':"",action.CssClassEx)),action._whenClientScript!=null&&(this._dynamicActionButtons=!0);this._clonedRow=null},_actionButtonsInScope:function(n){var t=this.get_actions(n),r,i;if(t.length!=0){if(n=="Row"){for(r=!1,i=0;i<t.length;i++)if(this._isActionAvailable(t[i])){r=!0;break}if(!r)return null}return t}},_renderActionButtons:function(n,t,i){var e,o,s,h;if(this.get_showActionButtons().indexOf(t)!=-1&&(e=this._actionButtonsInScope(i),e)){if(o=this._get_colSpan(),s="",i=="Row"&&this._actionColumn&&(o--,s='<td class="ActionColumn">&nbsp;<\/td>'),n.appendFormat('<tr class="ActionButtonsRow {0}ButtonsRow {2}Scope">{3}<td colspan="{1}" class="ActionButtons {2}ActionButtons">',t,o,i,s),n.append('<table style="width:100%" cellpadding="0" cellspacing="0" class="ActionButtons"><tr>'),h=String.format(' id="{0}$ActionButtons${1}"',this.get_id(),t),i=="Form"){var r=this._position,c=r&&r.count>1&&!this.get_isInserting(),l=r&&r.index>0,a=r&&r.index<r.count-1,u=this._get_specialAction("Print"),f=this.get_isModal()?this._get_specialAction("Annotate"):null;n.appendFormat('<td class="Left"><table class="FormNav"><tr><td class="Previous{5}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(-1);return false;" title="{3}"><span><\/span><\/a><\/td><td class="Next{6}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(1);return false;" title="{4}"><span><\/span><\/a><\/td><td class="Print{9}"><a href="javascript:" onclick="{10};return false;" title="{8}"><span><\/span><\/a><\/td><td class="Annotate{12}"><a href="javascript:" onclick="{13};return false;" title="{11}"><span><\/span><\/a><\/td><td class="Instruction" id="{0}_Wait" align="left">{1}<\/td><\/tr><\/table><\/td><td class="Right" align="right"{14}>&nbsp;',t=="Bottom"?this.get_id():"",this.get_isEditing()&&Web.DataViewResources.Form.RequiredFieldMarker?Web.DataViewResources.Form.RequiredFiledMarkerFootnote:"",this.get_id(),Web.DataViewResources.Pager.Previous,Web.DataViewResources.Pager.Next,l?"":" Disabled",a?"":" Disabled",c?"":" Hidden",u?u.text:"",u?"":" Hidden",u?u.script:null,f?f.text:"",f?"":" Hidden",f?f.script:null,h)}else n.appendFormat("<td{0}>",h);this._internalRenderActionButtons(n,t,i,e);this._lastActionButtonsScope=i;n.append("<\/td><\/tr><\/table>");n.append("<\/td><\/tr>")}},_isActionMatched:function(n){n._csInitialized||(String.isNullOrEmpty(n.WhenClientScript)||(n._whenClientScript=this._prepareJavaScriptExpressionEx(n.WhenClientScript)),n._csInitialized=!0);return(n.WhenViewRegex==null||n.WhenViewRegex.exec(this.get_viewId())!=null==n.WhenViewRegexResult)&&(n.WhenTagRegex==null||n.WhenTagRegex.exec(this.get_tag())!=null==n.WhenTagRegexResult)&&(n.WhenHRefRegex==null||n.WhenHRefRegex.exec(location.pathname)!=null==n.WhenHRefRegexResult)&&(n._whenClientScript==null||eval(n._whenClientScript)==!0)},_isActionAvailable:function(n,t){var i=n.WhenLastCommandName?n.WhenLastCommandName:"",u,f,r,e;if(i=="Any"&&(i=this.get_lastCommandName()),u=n.WhenLastCommandArgument?n.WhenLastCommandArgument:"",f=i.length==0||i==this.get_lastCommandName()&&(u.length==0||u==this.get_lastCommandArgument()),f){if(r=this.get_isEditing(),n.CommandName=="DataSheet")return!r&&this.get_isGrid()&&this.get_viewType()!="DataSheet"&&this._isActionMatched(n);if(n.CommandName=="Grid")return!r&&this.get_isGrid()&&this.get_viewType()!="Grid"&&this._isActionMatched(n);if(r)return e=this._rowIsSelected(t==null?this._selectedRowIndex:t),e?(i=="New"||i=="Edit"||i=="BatchEdit"||i=="Duplicate")&&this._isActionMatched(n):e||t!=null||i!="New"&&i!="Duplicate"?i.length==0&&t!=null&&this._isActionMatched(n):this._isActionMatched(n)}return f&&(!n.WhenKeySelected||n.WhenKeySelected&&this._selectedKey&&this._selectedKey.length>0)&&this._isActionMatched(n)&&(n.CommandName!="New"||this._hasKey())},_hasKey:function(){return this._keyFields&&this._keyFields.length>0},_rowIsSelected:function(n){if(!this._hasKey())return this.get_isModal()&&this.get_isForm();var t=this._rows[n];return this.rowIsSelected(t)},rowIsSelected:function(n){var u=this._keyFields,f=this._selectedKey,t;if(n&&u.length==f.length&&u.length){if(n==this._mergedRow)return!0;for(t=0;t<u.length;t++){var e=u[t],i=f[t],r=n[e.Index];if(e.Type.startsWith("DateTime")){if(!(i||r))return!1;i=i.toString();r=r.toString()}if(i!=r&&!(r==null&&String.isNullOrEmpty(i)))return!1}return!0}return!1},_get_template:function(n){return this.get_isDataSheet()?null:$get(this.get_controller()+"_"+this.get_viewId()+(n?"_"+n:""))},_renderTemplate:function(n,t,i,r,u){for(var e=typeof n=="string"?n:n.innerHTML,c=/([\s\S]*?)\{([\w\d]+)(\:([\S\s]+?)){0,1}\}/g,h=0,f=c.exec(e),o,s;f;)h=f.index+f[0].length,t.append(f[1]),o=this.findField(f[2]),o?f[4]&&f[4].length>0?t.appendFormat("{0:"+f[4]+"}",i[o.Index]):this._renderItem(t,o,i,r,u,null,null,null,!0):(s=Web.DataView.find(f[2]),s&&(this._embeddedViews||(this._embeddedViews=[]),Array.add(this._embeddedViews,{view:s}),t.appendFormat('<div id="v_{0}" class="EmbeddedViewPlaceholder"><\/div>',s.get_cookie().replace(/-/g,"")))),f=c.exec(e);h<e.length&&t.append(e.substring(h))},_renderNewRow:function(n){var e,o,s,u,t;if(this.get_isInserting()){var r=this.get_isDataSheet(),l=this._actionColumn&&!r,f=this._get_focusedCell();if(f||(f={colIndex:0}),e=r?null:this._gridTemplates.New,n.appendFormat('<tr class="Row Selected{0}{1}">',e?" InlineFormRow":"",r?" Inserting":""),o=this.multiSelect(),o&&n.append('<td class="Cell Toggle First">&nbsp;<\/td>'),s=this.get_showIcons(),s&&n.appendFormat('<td class="Cell Icons{0}"><span>&nbsp;<\/span><\/td>',o?"":" First"),this.get_isDataSheet()&&n.appendFormat('<td class="Cell Gap"><div class="Icon"><\/div><\/td>',!o&&!s?" First":""),l&&n.append('<td class="Cell ActionColumn">&nbsp;<\/td>'),u=this._newRow?this._newRow:[],this._mergeRowUpdates(u),this._updateVisibility(u),e)n.appendFormat('<td class="Cell" colspan="{0}">',this.get_fields().length),this._renderTemplate(e,n,u,!0,!0),n.append("<\/td>");else for(t=0;t<this._fields.length;t++){var i=this._fields[t],h=this._allFields[i.AliasIndex],c="";r&&(this._editing=f&&f.colIndex==i.ColIndex,this._editing||(c=String.format(" onclick=\"$find('{0}')._dataSheetCellFocus(event,-1,{1})\"",this.get_id(),t)));n.appendFormat('<td class="Cell {0} {1}Type{2}{3}"{4}>',h.Name,h.Type,t==0?" FirstColumn":"",t==this._fields.length-1?" LastColumn":"",c);i.ReadOnly||n.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),i.Index);this._renderItem(n,i,u,!i.OnDemand,null);this._editing=null;n.append("<\/td>")}n.append("<\/tr>");r||this._renderActionButtons(n,"Bottom","Row")}},_iconClicked:function(n){this.get_isDataSheet()||this.get_lookupField()!=null||this._icons&&this._icons[n]=="Attachment"&&(this._lastClickedIcon="Attachment",this.set_autoSelectFirstRow(!0),this._autoSelect(n))},_renderRows:function(n,t,i){var c=this.get_lookupField()!=null,l=this.get_isDataSheet(),nt=!c&&this._actionColumn&&!l,vt=nt?this.get_actionGroups("ActionColumn",!0):null,yt=this._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,this.get_viewId()),w,tt,b,r,u,a,o,k,ut,d,g,v,y,at;for(n.append('<tr class="HeaderRow">'),w=this.get_showIcons(),i&&(n.appendFormat('<th class="Toggle First"><input type="checkbox" onclick="$find(&quot;{0}&quot;).toggleSelectedRow()" id="{0}_ToggleButton"/><\/th>',this.get_id()),this._multipleSelection=!1),w&&n.appendFormat('<th class="Icons{0}">&nbsp;<\/th>',i?"":" First"),l&&n.appendFormat('<th class="Gap{0}">&nbsp;<\/th>',!i&&!w?" First":""),nt&&n.appendFormat('<th class="FieldHeaderSelector ActionColumn"><span>{0}<\/span><\/th>',this._actionColumn),tt=this.get_sortExpression(),b=tt?tt.match(/^\s*(\w+)((\s+(asc|desc))|(\s*(,|$)))/i):null,r=0;r<this._fields.length;r++)u=this._fields[r],a=u.Name,u=this._allFields[u.AliasIndex],u.Name==a&&(a=""),n.appendFormat('<th class="FieldHeaderSelector {4} {0} {1}Type{2}{3}"',u.Name,u.Items.length>0?"String":u.Type,r==0?" FirstColumn":"",r==this._fields.length-1?" LastColumn":"",a),(u.AllowSorting||u.AllowQBE)&&n.appendFormat(' onmouseover="$showHover(this,\'{0}$FieldHeaderSelector${1}\',\'FieldHeaderSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()"',this.get_id(),r),n.append(">"),u.AllowSorting?(n.appendFormat('<a href="#" onclick="$find(\'{0}\').sort(\'{1}\');$preventToggleHover();return false" title="{3}" onfocus="$showHover(this,\'{0}$FieldHeaderSelector${4}\',\'FieldHeaderSelector\',1)" onblur="$hideHover(this)" tabindex="{5}">{2}<\/a>',this.get_id(),u.Name,u.HeaderText,String.format(Web.DataViewResources.HeaderFilter.SortBy,u.HeaderText),r,$nextTabIndex()),b&&b[1]==u.Name&&n.append(String.format('<span class="{0}">&nbsp;<\/span>',b[4]?b[4].toLowerCase()=="asc"?"SortUp":"SortDown":"SortUp")),this.filterOf(u)!=null&&n.append('<span class="Filter">&nbsp;<\/span>')):n.appendFormat("<span>{0}<\/span>",u.HeaderText),n.append("<\/th>");n.append("<\/tr>");var e=this._get_focusedCell(),s=this.get_isEditing(),ft=this.get_isInserting(),it=this._lastSelectedRowIndex;this._gridTemplates||(o={Default:this._get_template(),Edit:this._get_template("edit"),New:this._get_template("new")},o.Default&&(o.Default=o.Default.innerHTML),o.Edit=o.Edit?o.Edit.innerHTML:o.Default,o.New=o.New?o.New.innerHTML:o.Default,this._gridTemplates=o);var rt=l?null:this._gridTemplates.Edit,et=l?null:this._gridTemplates.Default,h=null;this._registerRowSelectorItems();var pt=this.get_showRowNumber(),ot=!1;for(r=0;r<this.get_rows().length;r++){var p=this.get_rows()[r],st=" "+this._evaluateJavaScriptExpressions(yt,p,!0),f=this._rowIsSelected(r);if(f&&(ot=!0),f&&(this._selectedRowIndex=r),k=null,ut="",i&&(d=Array.indexOf(this._selectedKeyList,this._createRowKey(r))!=-1,d&&(this._multipleSelection=!0),k=String.format('<td class="Cell Toggle First"><input type="checkbox" id="{0}_CheckBox{1}" onclick="$find(&quot;{0}&quot;).toggleSelectedRow({1})"{2} class="MultiSelect{3}"/><\/td>',this.get_id(),r,d?' checked="checked"':null,d?" Selected":""),d&&(ut=" MultiSelectedRow")),g=w?String.format('<td class="Cell Icons {0}{1}"><span onclick="$find(\'{3}\')._iconClicked({4});">{2}<\/span><\/td>',this._icons?this._icons[r]:"",i?"":" First",pt?this.get_pageSize()*this.get_pageIndex()+r+1+(this._pageOffset?this._pageOffset:0):"&nbsp;",this.get_id(),r):"",l&&(g+=String.format('<td class="Cell Gap{2}" onclick="$find(\'{0}\')._dataSheetCellFocus(event,{1},-1)"><div class="Icon"><\/div><\/td>',this.get_id(),r,!i&&!w?" First":"")),nt&&(g+=this._renderActionColumnCell(p,r,f,vt)),s&&f&&(this._mergeRowUpdates(p),this._updateVisibility(p)),f&&(s&&rt||et))n.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3} Selected{7}">{5}{6}<td class="Cell" colspan="{4}">',this.get_id(),r,r%2==0?"":"Alternating"," InlineFormRow",this.get_fields().length,k,g,s?" Editing":""),this._renderTemplate(s&&rt?rt:et,n,p,!0,!0),n.append("<\/td>");else for(n.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3}{4}{7}" {6}>',this.get_id(),r,r%2==0?"":"Alternating",f?" Selected"+st:st,ut,t?"":" ReadOnlyRow",l&&!c?"":"onmouseover=\"$(this).addClass('Highlight');\" onmouseout=\"$(this).removeClass('Highlight')\"",f&&s?" Editing":""),k&&n.append(k),n.append(g),j=0;j<this._fields.length;j++){u=this._fields[j];v=this._allFields[u.AliasIndex];a=u.Name==v.Name?"":u.Name;e&&(this._editing=s&&e.rowIndex==r&&e.colIndex==u.ColIndex);y=j==0&&t;y&&(h=Web.HoverMonitor.Families[String.format("{0}$RowSelector${1}",this.get_id(),r)],h&&h.items.length!=0||(y=!1));var ht=j==0?" FirstColumn":"",ct=String.format(" onclick=\"$find('{0}')._{3}CellFocus(event,{1},{2})\"",this.get_id(),r,j,l&&!c?"dataSheet":"gridView"),lt=j==this._fields.length-1?" LastColumn":"";y&&!c||f&&s||u.OnDemand&&f?n.appendFormat('<td class="Cell {5} {0} {1}Type{2}{4}"{3}>',v.Name,u.Items.length>0?"String":v.Type,ht,f&&s&&(!l||e&&e.colIndex==u.ColIndex)?"":ct,lt,a):n.appendFormat('<td class="Cell {7} {2} {3}Type{4}{6}" style="cursor:default;"{5}>',this.get_id(),r,v.Name,v.Type=="Byte[]"?"Binary":u.Items.length>0?"String":v.Type,ht,ct,lt,a);f&&s&&!u.ReadOnly&&n.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),u.Index);y&&(!c&&h&&h.items.length>1&&n.appendFormat('<div id="{0}_RowSelector{1}" class="RowSelector" onmouseover="$showHover(this, \'{0}$RowSelector${1}\', \'RowSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()">',this.get_id(),r),f&&s||(at=c||!h||h.items.length==1?"":String.format(" onfocus=\"$showHover(this, '{0}$RowSelector${1}', 'RowSelector', 1)\" onblur=\"$hideHover(this)\" ",this.get_id(),r),c?n.appendFormat('<a href="javascript:" onclick="return false" tabindex="{0}">',$nextTabIndex()):n.appendFormat('<a href="#" onclick="$hoverOver(this, 2);$find(\'{0}\').executeAction(\'Grid\',-1,{1});$preventToggleHover();return false" tabindex="{2}"{3}>',this.get_id(),r,$nextTabIndex(),at)));this._renderItem(n,u,p,f,null,y);y&&!s&&(f&&s||n.append("<\/a>"),!c&&h&&h.items.length>1&&n.append("<\/div>"));n.append("<\/td>");e&&(this._editing=null)}n.append("<\/tr>");f&&e==null&&this._renderActionButtons(n,"Bottom","Row");ft&&it==r&&(it=-2,this._renderNewRow(n));this._syncFocusedCell&&e&&f&&(e.rowIndex=r)}ft&&it!=-2&&this._renderNewRow(n);this._saveAndNew&&(this._saveAndNew=!1,this._syncFocusedCell?this.newDataSheetRow():(e=this._get_focusedCell(),e&&(e.colIndex=0,this._moveFocusToNextRow(e,this.get_pageSize()))));this._syncFocusedCell=!1;ot||(this._selectedRowIndex=null)},_renderActionColumnCell:function(n,t,i,r){var c,l,u,s,f,h,e,o,a;for(this._clonedRow=n,i||(c=this.get_lastCommandName(),l=this.get_lastCommandArgument(),this.set_lastCommandName("Select"),this.set_lastCommandArgument(null)),u=new Sys.StringBuilder,u.append('<td class="Cell ActionColumn">'),s=!0,f=0;f<r.length;f++)for(h=r[f],e=0;e<h.Actions.length;e++)o=h.Actions[e],this._isActionAvailable(o)&&(s?s=!1:u.append('<span class="Divider">&nbsp;<\/span>'),u.appendFormat('<a href="javascript:" onclick="var dv=$find(\'{0}\');dv.executeAction(\'ActionColumn\',{2},{4},{3});return false;" class="{6}"><span class="Outer"><span class="Inner"><span class="Self" title="{5}">{1}<\/span><\/span><\/span><\/a>',this.get_id(),Web.DataView.htmlEncode(o.HeaderText),e,f,t,Web.DataView.htmlEncode(o.Description),o.CssClass));return s&&u.append("&nbsp;"),u.append("<\/td>"),a=u.toString(),u.clear(),this._clonedRow=null,i||(this.set_lastCommandName(c),this.set_lastCommandArgument(l)),a},extension:function(){var n=null,r=Web.DataView.Extensions,t,i,u;return r&&(t=this.get_viewType(),i=this._extensions,i==null&&(i=this._extensions={}),n=i[t],n==null&&(u=r?r[t]:null,n=this._extensions[t]=u?new u(this):0,n&&n.initialize())),n},_renderGridView:function(n){var o,t,r,i,u,f,e;if(this._renderViewDescription(n),this._renderActionBar(n),this._renderSearchBar(n),o=this.get_showPager(),t=this.extension(),this._renderPager(n,"Top"),this.get_isChart()){for(this._renderInfoBar(n),this._sortingDisabled=!1,r=!1,i=0;i<this._fields.length;i++)u=this._fields[i],u.Aggregate!=0?this._sortingDisabled=!0:r||(r=!0,this.set_sortExpression(null),this.set_sortExpression(u.Name));t||n.appendFormat('<tr class="ChartRow"><td colspan="{1}" class="ChartCell"><img id="{0}$Chart" class="Chart" onload="if(this.readyState==\'complete\'){{this.style.height=\'\';_body_performResize()}}"/><\/td><\/tr>',this.get_id(),this._get_colSpan())}else f=this._hasKey(),e=this.multiSelect()&&f,this.get_searchOnStart()||(this._renderInfoBar(n),t||this._renderRows(n,f,e)),t||(this._renderAggregates(n,e),this._renderNoRecordsWhenNeeded(n));t||this._renderPager(n,"Bottom")},_renderAggregates:function(n,t){var e=this.get_aggregates(),f,i,r,u,o;if(this._totalRowCount!=0&&e!=null){for(n.append('<tr class="AggregateRow">'),t&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this.get_showIcons()&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this.get_isDataSheet()&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this._actionColumn&&n.append('<td class="Aggregate">&nbsp;<\/td>'),f=0;f<this.get_fields().length;f++)i=this.get_fields()[f],i.Aggregate==0?n.append('<td class="None">&nbsp;<\/td>'):(r=e[i.Index],r=r==null?Web.DataViewResources.Data.NullValue:i.format(r),u=this._allFields[i.AliasIndex],u.IsMirror&&(r=e[i.AliasIndex]),o=Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[i.Aggregate]],n.appendFormat('<td class="Aggregate {0} {1}Type" title="',u.Name,u.Type),n.appendFormat(o.ToolTip,u.HeaderText),n.append('">'),n.appendFormat(o.FmtStr,r),n.append("<\/td>"));n.append("<\/tr>")}},_renderSearchBar:function(n){this.get_showSearchBar()&&__tf==4&&(this._searchBarInitialized=!1,n.appendFormat('<tr class="SearchBarRow" id="{0}$SearchBar" style="{2}"><td colspan="{1}" class="SearchBarCell" id="{0}$SearchBarContent">Search bar goes here.<br/><br/><br/><br/><\/td><\/tr>',this.get_id(),this._get_colSpan(),this.get_searchBarIsVisible()?"":"display:none"))},_renderNoRecordsWhenNeeded:function(n){if(this._totalRowCount==0){var t=this.get_isDataSheet()&&this._keyFields.length>0&&this.executeActionInScope(["Row","ActionBar"],"New",null,null,!0)?String.format(' <a href="javascript:" class="NewRowLink" onclick="$find(\'{0}\').newDataSheetRow();return false;" title="{2}">{1}<\/a>',this.get_id(),Web.DataViewResources.Grid.NewRowLink,Web.DataViewResources.Lookup.GenericNewToolTip):"";n.appendFormat('<tr class="Row NoRecords"><td colspan="{0}" class="Cell">{1}{2}<\/td><\/tr>',this._get_colSpan(),Web.DataViewResources.Data.NoRecords,t)}},_attachBehaviors:function(){if(!$app.mobile){this._detachBehaviors();this._attachFieldBehaviors();var n=this.get_quickFindElement();n&&$addHandlers(n,this._quickFindHandlers,this)}},_get:function(n,t){return t==null?$get(this.get_id()+n):$get(this.get_id()+n+t)},_attachTimeOptions:function(n,t){var u=$create(Web.AutoComplete,{completionInterval:500,contextKey:"",delimiterCharacters:"",id:this.get_id()+"_AutoComplete$Time"+n.Index,minimumPrefixLength:n.AutoCompletePrefixLength,typeCssClass:"AutoComplete"},null,null,t),r,e;Sys.UI.DomElement.addCssClass(u._completionListElement,"Time");var o=Sys.CultureInfo.CurrentCulture.dateTimeFormat,i=null,f=n.DataFormatString&&n.DataFormatString.replace(/\W/g,"_")||"Default";if(n.Type=="TimeSpan"){if($app._timeSpanOptions||($app._timeSpanOptions={}),i=$app._timeSpanOptions[f],!i){for(i=[],r=new Date,e=n.DataFormatString||"{0:HH:mm}",r.setHours(0,0,0,0);i.length<96;)Array.add(i,String.localeFormat(e,r)),r.setMinutes(r.getMinutes()+15);$app._timeSpanOptions[f]=i}}else if(i=Web.DataView._timeOptions,!i){for(i=[],r=new Date,r.setHours(r.getHours(),0,0,0);i.length<48;)Array.add(i,String.localeFormat("{0:"+o.ShortTimePattern+"}",r)),r.setMinutes(r.getMinutes()+30);Web.DataView._timeOptions=i}return(u._cache=[])["%"]=i,u},_executeClientEditorFactories:function(n,t,i){var s=t==null?n.Editor:n.ClientEditor,f,u,o,h;if(!String.isNullOrEmpty(s))for(f=s.split(Web.DataView._simpleListRegex),u=0;u<f.length;u++){var c=f[u],e=c.replace(/\W/g,"$"),r=Web.DataView.EditorFactories[e];if(r==null){try{r=eval(String.format('typeof {0}!="undefined"?new {0}():""',e))}catch(l){r=""}Web.DataView.EditorFactories[e]=r}if(t==null)return r!="";if(r!=""){if(!i&&Web.DataView._customInputElements.indexOf(t.id)<0)return;if(o=this.get_viewType(),h=i?r.attach(t,o):r.detach(t,o),h)return i?Array.add(Web.DataView._customInputElements,t.id):Array.remove(Web.DataView._customInputElements,t.id),!0}}return!1},_attachFieldBehaviors:function(){var u,e,o;if(this.get_isEditing())for(u=0;u<this.get_fields().length;u++){var n=this.get_fields()[u],t=this._get("_Item",n.Index),i=null;if(t&&!n.ReadOnly&&!this._executeClientEditorFactories(n,t,!0)){if(t.tagName=="TEXTAREA"&&n.Len>0&&(t.setAttribute("maxlength",n.Len),$addHandler(t,"keyup",this._checkMaxLengthHandler),$addHandler(t,"blur",this._checkMaxLengthHandler)),!String.isNullOrEmpty(n.Mask)){var r=Sys.CultureInfo.CurrentCulture,f=r.dateTimeFormat.ShortDatePattern.toUpperCase().split(r.dateTimeFormat.DateSeparator),s=$create(AjaxControlToolkit.MaskedEditBehavior,{CultureAMPMPlaceholder:r.dateTimeFormat.AMDesignator+";"+r.dateTimeFormat.PMDesignator,CultureCurrencySymbolPlaceholder:r.numberFormat.CurrencySymbol,CultureDateFormat:f[0].substring(0,1)+f[1].substring(0,1)+f[2].substring(0,1),CultureDatePlaceholder:r.dateTimeFormat.DateSeparator,CultureDecimalPlaceholder:r.numberFormat.NumberDecimalSeparator,CultureName:r.name,CultureThousandsPlaceholder:r.numberFormat.NumberGroupSeparator,CultureTimePlaceholder:r.dateTimeFormat.TimeSeparator,DisplayMoney:n.DataFormatString=="{0:c}",Mask:n.Mask,MaskType:n.MaskType,ClearMaskOnLostFocus:n.MaskType>0,id:this.get_id()+"_MaskedEdit"+n.Index},null,null,t);n.MaskType==2&&s.set_InputDirection(1);Array.add(n.Behaviors,s)}n.Type.startsWith("Date")?(i=$create(AjaxControlToolkit.CalendarBehavior,{id:this._get("_Calendar",n.Index)},null,null,t),i.set_format((n.DateFmtStr?n.DateFmtStr:n.DataFormatString).match(/\{0:([\s\S]*?)\}/)[1]),e=$get(t.id+"_Button"),e&&i.set_button(e),n.TimeFmtStr&&(t=this._get("_Item$Time",n.Index),t&&(Array.add(n.Behaviors,i),i=this._attachTimeOptions(n,t)))):n.Type=="TimeSpan"?i=this._attachTimeOptions(n,t):t.type=="text"&&n.AutoCompletePrefixLength>0?i=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0},{1},{2}",this.get_controller(),this.get_viewId(),n.Name),delimiterCharacters:",;",id:this.get_id()+"_AutoComplete"+n.Index,minimumPrefixLength:n.AutoCompletePrefixLength,serviceMethod:"GetCompletionList",servicePath:this.get_servicePath(),useContextKey:!0,typeCssClass:"AutoComplete"},null,null,t):n.ItemsStyle=="AutoComplete"&&(o=this._allFields[n.AliasIndex],t=this._get("_Item",o.Index),t&&t.type=="text"&&(i=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("Field:{0},{1}",this.get_id(),o.Name),delimiterCharacters:"",id:this.get_id()+"_AutoComplete"+n.Index,minimumPrefixLength:n.AutoCompletePrefixLength==0?1:n.AutoCompletePrefixLength,serviceMethod:"GetPage",servicePath:this.get_servicePath(),useContextKey:!0,fieldName:n.Name,enableCaching:!1,typeCssClass:"Lookup"},null,null,t)));i&&Array.add(n.Behaviors,i)}}},_detachBehaviors:function(){var u,n,t,r;if(!$app.mobile&&(u=this.get_quickFindElement(),u&&$clearHandlers(u),this.get_fields()!=null))for(i=0;i<this.get_fields().length;i++)if(n=this.get_fields()[i],t=this._get("_Item",n.Index),!t||!this._executeClientEditorFactories(n,t,!1)){for(n.Len>0&&n.Rows>1&&t&&t.tagName=="TEXTAREA"&&t._events&&($removeHandler(t,"keyup",this._checkMaxLengthHandler),$removeHandler(t,"blur",this._checkMaxLengthHandler)),n._lookupModalBehavior!=null&&(n._lookupModalBehavior.dispose(),n._lookupModalPanel.parentNode.removeChild(n._lookupModalPanel),delete n._lookupModalPanel,n._lookupModalBehavior=null),n._lookupDataControllerBehavior!=null&&(n._lookupDataControllerBehavior.dispose(),n._lookupDataControllerBehavior=null),r=0;r<n.Behaviors.length;r++)n.Behaviors[r].dispose();Array.clear(n.Behaviors);n.Editor&&(Web.DataView.Editors[n.EditorId]=null)}},_registerDataTypeFilterItems:function(n,t,i,r,u){for(var f,o,e=null,s=0;s<i.length;s++)if(f=i[s],f){if(!f.Hidden&&(!u.SearchOptions||Array.indexOf(u.SearchOptions,f.Function)>=0)&&(e=new Web.Item(n,f.Prompt?f.Text+"...":f.Text),t.addChild(e),f.List?this._registerDataTypeFilterItems(n,e,f.List,r,u):f.Prompt?e.set_script('$find("{0}").showFieldFilter({1},"{2}","{3}")',this.get_id(),u.Index,f.Function,f.Text):e.set_script('$find("{0}").applyFieldFilter({1},"{2}")',this.get_id(),u.Index,f.Function),r&&f.Function==r))for(o=e;o;)o.set_selected(!0),o=o.get_parent()}else u.SearchOptions||(e=new Web.Item(n),t.addChild(e))},_registerFieldHeaderItems:function(n,t,i,r){var it=n==null?0:n,rt=n==null?this.get_fields().length-1:n,v=this.get_sortExpression(),y,p,w,k,d,u,b,g,c,nt;for(v&&(v=v.match(/^(\w+)\s+(asc|desc)/)),y=it;y<=rt;y++){var e=null,o=[],h=t?t:String.format("{0}$FieldHeaderSelector${1}",this.get_id(),y),l=this.get_fields()[y],f=this._allFields[l.AliasIndex];if(!r||f.Aggregate==0){if(f.AllowSorting||f.AllowQBE){p=Web.DataViewResources.HeaderFilter.GenericSortAscending;w=Web.DataViewResources.HeaderFilter.GenericSortDescending;switch(f.FilterType){case"Text":p=Web.DataViewResources.HeaderFilter.StringSortAscending;w=Web.DataViewResources.HeaderFilter.StringSortDescending;break;case"Date":p=Web.DataViewResources.HeaderFilter.DateSortAscending;w=Web.DataViewResources.HeaderFilter.DateSortDescending}if(k=f.AllowSorting&&!this._sortingDisabled,k&&(d=v&&v[1]==f.Name,u=new Web.Item(h,p),d&&v[2]=="asc"?u.set_selected(!0):u.set_cssClass("SortAscending"),u.set_script('$find("{0}").sort("{1} asc")',this.get_id(),f.Name),Array.add(o,u),u=new Web.Item(h,w),d&&v[2]=="desc"?u.set_selected(!0):u.set_cssClass("SortDescending"),u.set_script('$find("{0}").sort("{1} desc")',this.get_id(),f.Name),Array.add(o,u)),f.AllowQBE&&(e=this.filterOf(f),k&&Array.add(o,new Web.Item),u=new Web.Item(h,String.format(Web.DataViewResources.HeaderFilter.ClearFilter,f.HeaderText)),u.set_cssClass("FilterOff"),e||u.set_disabled(!0),u.set_script('$find("{0}").applyFilterByIndex({1},-1)',this.get_id(),l.AliasIndex),Array.add(o,u),b=null,__designer()||(g=Web.DataViewResources.Data.Filters[f.FilterType],f.Items.length==0&&(u=new Web.Item(h,g.Text),Array.add(o,u),b=this.get_fieldFilter(f,!0),this._registerDataTypeFilterItems(h,u,g.List,b,f)),f.FilterType!="Boolean"&&(!f.SearchOptions||Array.indexOf(f.SearchOptions,"$in")>=0)&&f.AllowMultipleValues!=!1&&(u=new Web.Item(h,Web.DataViewResources.HeaderFilter.CustomFilterOption),e&&e.match(/\$(in|out)\$/)?u.set_selected(!0):u.set_cssClass("CustomFilter"),u.set_script('$find("{0}").showCustomFilter({1})',this.get_id(),l.AliasIndex),Array.add(o,u))),l.AllowSamples!=!1))if(l._listOfValues)for(e&&e.startsWith("=")&&(e=e.substring(1),e.endsWith('\0')&&(e=e.substring(0,e.length-1))),c=0;c<l._listOfValues.length;c++){c==0&&Array.add(o,new Web.Item);var a=l._listOfValues[c],tt=!1,s=a;a==null?s=Web.DataViewResources.HeaderFilter.EmptyValue:f.Items.length>0?(u=this._findItemByValue(f,a),s=u[1]):f.Type=="String"&&a.length==0?s=Web.DataViewResources.HeaderFilter.BlankValue:String.isNullOrEmpty(f.DataFormatString)||(s=f.Type.startsWith("DateTime")?String.localeFormat("{0:d}",a):f.format(a));a=this.convertFieldValueToString(f,a);tt=b=="="&&e&&a==e;s.length>Web.DataViewResources.HeaderFilter.MaxSampleTextLen&&(s=s.substring(0,Web.DataViewResources.HeaderFilter.MaxSampleTextLen)+"...");typeof s!="string"&&(s=s.toString());u=new Web.Item(h,s);tt&&u.set_selected(!0);u.set_script("$find('{0}').applyFilterByIndex({1},{2});",this.get_id(),l.AliasIndex,c);u.set_group(1);Array.add(o,u)}else(!f.SearchOptions||Array.indexOf(f.SearchOptions,"=")>=0)&&(u=new Web.Item(h,Web.DataViewResources.HeaderFilter.Loading),u.set_dynamic(!0),u.set_script('$find("{0}")._loadListOfValues("{1}","{2}","{3}")',this.get_id(),h,l.Name,f.Name),Array.add(o,u))}if(t){for(u=new Web.Item(t,f.HeaderText),Array.add(i,u),c=0;c<o.length;c++)nt=o[c],u.addChild(nt);nt.get_selected()&&u.set_selected(!0);e&&u.set_selected(!0)}else $registerItems(h,o,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}}},_get_specialAction:function(n){if(!this._specialActions)return null;var i=this._specialActions[n+"Text"],t=this._specialActions[n+"Script"];return String.isNullOrEmpty(t)?null:{text:i,script:t}},_registerSpecialAction:function(n,t,i,r){if(!this._specialActions.PrintText&&n.CommandName.match(/^Report/)){if(r==null&&!this._isActionAvailable(n))return;this._specialActions.PrintText=n.HeaderText;this._specialActions.PrintScript=String.format("$find('{0}').executeAction('ActionBar',{1},-1,{2})",this.get_id(),i,t)}else if(n.CssClass=="AttachIcon"){if(r==null&&!this._isActionAvailable(n))return;this._specialActions.AnnotateText=n.HeaderText;this._specialActions.AnnotateScript=String.format("$find('{0}').executeAction('ActionBar',{1},0,{2})",this.get_id(),i,t)}},_registerActionBarItems:function(){var o=this.get_actionGroups("ActionBar"),s=this.get_isChart(),r,u,i,f,n,t,e;for(s&&!this.get_showViewSelector()&&(r=String.format("{0}${1}$ActionGroup$Chart",this.get_id(),this.get_viewId()),u=[],this._registerFieldHeaderItems(null,r,u,!0),$registerItems(r,u,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.None)),this._specialActions={PrintText:null,PrintScript:null,AnnotateText:null,AnnotateScript:null},i=0;i<o.length;i++)if(f=o[i],r=String.format("{0}${1}$ActionGroup${2}",this.get_id(),this.get_viewId(),i),f.Flat)for($unregisterItems(r),n=0;n<f.Actions.length;n++)this._registerSpecialAction(f.Actions[n],i,n);else{for(u=[],n=0;n<f.Actions.length;n++)t=f.Actions[n],this._isActionAvailable(t)&&(e=new Web.Item(r,t.HeaderText,t.Description),e.set_cssClass(t.CssClassEx+(String.isNullOrEmpty(t.CssClass)?t.CommandName+"LargeIcon":t.CssClass)),Array.add(u,e),e.set_script(String.format("$find('{0}').executeAction('ActionBar',{1},null,{2})",this.get_id(),n,i)),this._registerSpecialAction(t,i,n,!0));$registerItems(r,u,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.Inline)}Array.clear(o)},_registerViewSelectorItems:function(){for(var t,i,r=[],n=this,u=n.get_id()+"$ViewSelector",f=0;f<n.get_views().length;f++)t=n.get_views()[f],(t.Type!="Form"&&t.ShowInSelector||t.Id==n.get_viewId())&&(i=new Web.Item(u,t.Label),t.Id==this.get_viewId()&&i.set_selected(!0),i.set_script(function(t){n.executeCommand({commandName:"Select",commandArgument:t.Id})}),i.context(t),Array.add(r,i));n.get_isChart()&&(Array.add(r,new Web.Item),n._registerFieldHeaderItems(null,u,r,!0));$registerItems(u,r,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Right,Web.ItemDescriptionStyle.None)},_registerRowSelectorItems:function(){var r=this.get_actions("Grid"),n,u,e,i,t,f;if(r&&r.length>0)for(n=0;n<this._rows.length;n++){for(u=[],e=String.format("{0}$RowSelector${1}",this.get_id(),n),i=0;i<r.length;i++)t=r[i],this._isActionAvailable(t,n)&&(f=new Web.Item(e,t.HeaderText,t.Description),f.set_cssClass(t.CssClassEx+(String.isNullOrEmpty(t.CssClass)?t.CommandName+"Icon":t.CssClass)+(u.length==0?" Default":"")),Array.add(u,f),f.set_script(String.format('$find("{0}").executeAction("Grid", {1},{2})',this.get_id(),i,n)));$registerItems(e,u,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}else for(n=0;n<this._rows.length;n++)$unregisterItems(String.format("{0}$RowSelector${1}",this.get_id(),n))},_get_searchBarSettings:function(){var f,t,c,n,g,u,nt,r,p,k,i,e,o,s,l,a,w,v,d;if(this._searchBarSettings||(this._searchBarSettings=[]),f=this._searchBarSettings[this.get_viewId()],!f){var b=[],h=[],y=this.get_filter();if(y.length>0&&!this.filterIsExternal())for(t=0;t<y.length;t++)(c=y[t].match(Web.DataView._fieldFilterRegex),n=this.findField(c[1]),n&&!this._fieldIsInExternalFilter(n))&&(g=this._allFields[n.AliasIndex],u=c[2].match(Web.DataView._filterRegex),c[2].startsWith("~")||(n._renderedOnSearchBar=!0,nt=this._findItemByValue(n,u[3]),r=u[3],r=="null"&&(r=""),p=r.match(/^([\s\S]+?)\0?$/),p&&(r=p[1]),k=n.Items.length==0?u[1]:"$in",i=this._findFilterDefByFunction(Web.DataViewResources.Data.Filters[n.FilterType].List,n.FilterType=="Boolean"&&u[3].length>1?u[3]=="%js%true"?"$true":"$false":k),i&&(e=r.match(/^(.+?)\$and\$(.+?)$/),Array.add(h,{Index:n.Index,Function:String.format("{0},{1}",i.Function,i.Prompt?"true":"false"),Value:e?e[1]:r,Value2:e?e[2]:""}))));for(o=!1,t=0;t<this._allFields.length;t++)if(n=this._allFields[t],o=n.Search==Web.FieldSearchMode.Required||n.Search==Web.FieldSearchMode.Suggested,o)break;for(t=0;t<this._allFields.length;t++)if(s=this._allFields[t],n=this._allFields[s.AliasIndex],n.AllowQBE&&n.Search!=Web.FieldSearchMode.Forbidden&&(!s.Hidden||n.Search!=Web.FieldSearchMode.Default)){if(l=!o&&h.length<Web.DataViewResources.Grid.VisibleSearchBarFields||o&&(s.Search==Web.FieldSearchMode.Required||s.Search==Web.FieldSearchMode.Suggested),!n._renderedOnSearchBar){for(a=n.Items.length==0||n.FilterType=="Boolean"?null:"$in",n.SearchOptions&&(a=n.SearchOptions[0]),w=Web.DataViewResources.Data.Filters[n.FilterType].List,v=0;v<w.length;v++)if(i=w[v],a==null||i.Function==a)break;d={Index:n.Index,Function:String.format("{0},{1}",i.Function,i.Prompt?"true":"false")};(l||this.findFieldUnderAlias(n)==n||n.VisibleOnSearchBar==null)&&Array.add(l?h:b,d);n.VisibleOnSearchBar=l}n._renderedOnSearchBar=!1}f={visibleFields:h,availableFields:b};this._searchBarSettings[this.get_viewId()]=f}return f},_lookupActionProcessing:function(n){return n!=null&&(this._standardActionProcessing=!n),this._standardActionProcessing!=!0},search:function(n){var t=this,r=[],i,f;if(n){if(n.sortExpression&&(t._sortExpression=n.sortExpression,i=t.readContext("vitals"),i&&(i.SortExpression=n.sortExpression)),n.filter){function u(n){return Date.isInstanceOfType(n)&&(n=new Date(n-n.getTimezoneOffset()*6e4)),String.format("%js%{0}",Sys.Serialization.JavaScriptSerializer.serialize(n))}$(n.filter).each(function(){var t=this,n=t.value||t.values,i=t.operator,f;i.match(/\w/)&&(i="$"+i+"$");Array.isInstanceOfType(n)?(f=new Sys.StringBuilder,$(n).each(function(n){n>0&&f.append(i=="$between$"?"$and$":"$or$");f.append(u(this))}),n=f.toString()):n=u(n);r.push(String.format("{0}:{1}{2}",t.name||t.field,i,n))});t._filter=r}n._init||t.sync()}else return t._lookupActionProcessing(!1),f=t._hasSearchAction&&t.executeActionInScope(["ActionBar","Form"],"Search",null,-1),t._lookupActionProcessing(!0),f},_toggleSearchBar:function(){this._hasSearchShortcut&&this.search()||(this.set_searchBarIsVisible(!this.get_searchBarIsVisible()),this._updateSearchBar(),this.get_searchBarIsVisible()&&(this.get_lookupField()&&this._adjustLookupSize(),this._focusSearchBar()),_body_performResize())},_renderSearchBarFieldNameOptions:function(n,t,i){var r,u,f;if(t.Search!=Web.FieldSearchMode.Required)for(r=0;r<i.availableFields.length;r++)u=i.availableFields[r],f=this._allFields[u.Index],n.appendFormat('<option value="{0}">{1}<\/option>',r,Web.DataView.htmlEncode(f.HeaderText))},_renderSearchBarFunctionOptions:function(n,t,i,r,u){for(var f,o,e=0;e<i.length;e++)if(f=i[e],f)if(f.List)this._renderSearchBarFunctionOptions(n,t,f.List,r);else if(u==null||f.Function==u){var s=String.format("{0},{1}",Web.DataView.htmlAttributeEncode(f.Function),f.Prompt?"true":"false"),c=s==r.Function?' selected="selected"':"",h=String.format('<option value="{0}"{1}>{2}{3}<\/option>',s,c,f.Prompt?"":Web.DataViewResources.Data.Filters.Labels.Equals+" ",f.Function.match(Web.DataView._keepCapitalization)?f.Text:f.Text.toLowerCase());t.SearchOptions?(o=Array.indexOf(t.SearchOptions,f.Function),o>=0&&(t.SearchOptionSet[o]=h)):n.append(h)}},_renderSearchBarField:function(n,t,i){var h=t.visibleFields[i],r=this._allFields[h.Index],b=r.Items.length==0||r.FilterType=="Boolean"?null:"$in",c=h.Function.match(/^(.+?),(true|false)$/),f,o,s,p,e,w,a,l;if(n.appendFormat('<tr id="{0}$SearchBarField${1}"><td class="Control"><select id="{0}$SearchBarName${1}" tabindex="{3}" onchange="$find(\'{0}\')._searchBarNameChanged({1})"><option value="{1}" selected="selected">{2}<\/option>',this.get_id(),i,Web.DataView.htmlEncode(r.HeaderText),$nextTabIndex()),this._renderSearchBarFieldNameOptions(n,r,t),n.append("<\/select><\/td>"),n.appendFormat('<td class="Control"><select id="{0}$SearchBarFunction${1}" class="Function" tabindex="{2}" onchange="$find(\'{0}\')._searchBarFuncChanged({1})">',this.get_id(),i,$nextTabIndex()),r.SearchOptions&&(r.SearchOptionSet=[]),this._renderSearchBarFunctionOptions(n,r,Web.DataViewResources.Data.Filters[r.FilterType].List,h,b),r.SearchOptions)for(f=0;f<r.SearchOptionSet.length;f++)n.append(r.SearchOptionSet[f]);n.append("<\/select><\/td>");var v=r.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;<\/a>':"",y=c[1]=="$in"||c[1]=="$notin",u=h.Value;if(y){if(o=new Sys.StringBuilder,s=!String.isNullOrEmpty(u),o.appendFormat('<table class="FilterValues{3}" cellpadding="0" cellspacing="0" onmouseover="Web.DataView.highlightFilterValues(this,true,\'Active\')" onmouseout="Web.DataView.highlightFilterValues(this,false,\'Active\')"><tr><td class="Values" valign="top"><div><a class="Link" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false;" tabindex="{4}" href="javascript:" onfocus="Web.DataView.highlightFilterValues(this,true,\'Focused\')" onblur="Web.DataView.highlightFilterValues(this,false,\'Focused\')" title="{5}">',this.get_id(),r.Index,i,s?"":" Empty",$nextTabIndex(),Web.DataViewResources.Data.Filters.Labels.FilterToolTip),s)for(p=u.split(/\$or\$/),f=0;f<p.length;f++)f>0&&o.append('<span class="Highlight">, <\/span>'),e=p[f],String.isJavaScriptNull(e)?e=Web.DataViewResources.HeaderFilter.EmptyValue:(e=this.convertStringToFieldValue(r,e),w=this._findItemByValue(r,e),e=w?w[1]:r.format(e)),o.append(e);else o.append(Web.DataViewResources.Lookup.SelectLink);o.appendFormat('<\/a><\/div><\/td><td class="Button{5}" valign="top"><a href="javascript:" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false" title="{3}" tabindex="{4}" onfocus="Web.DataView.highlightFilterValues(this,true,\'Focused\')" onblur="Web.DataView.highlightFilterValues(this,false,\'Focused\')" >&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),s?-1:r.Index,i,s?Web.DataViewResources.Data.Filters.Labels.Clear:Web.DataViewResources.Data.Filters.Labels.FilterToolTip,$nextTabIndex(),s?" Clear":"");v=o.toString()}else String.isNullOrEmpty(u)||(u=u.split(/\$or\$/)[0]);c[2]=="true"?(typeof u!="string"||y||(u=r.format(this.convertStringToFieldValue(r,u))),n.appendFormat('<td class="Control"><input id="{0}$SearchBarValue${1}" type="{6}" class="{2} {7}" value="{3}" tabindex="{4}"/>{5}<\/td>',this.get_id(),i,r.FilterType,Web.DataView.htmlAttributeEncode(u=="null"?Web.DataViewResources.HeaderFilter.EmptyValue:u),$nextTabIndex(),v,y?"hidden":"text",r.AllowAutoComplete!=!1?" AutoComplete":"")):n.append("<td>&nbsp;<\/td>");a=$nextTabIndex();c[1]=="$between"&&(a=$nextTabIndex());n.appendFormat('<td class="FieldAction"><a href="javascript:" tabindex="{1}" title="{2}" class="Remove" onclick="$find(\'{0}\')._searchBarNameChanged({3}, true)"><span><\/span<\/a><\/td>',this.get_id(),a,Web.DataViewResources.Grid.RemoveCondition,i);n.append("<\/tr>");r.FilterType!="Text"&&c[1]=="$between"&&(l=h.Value2,typeof l=="string"&&(l=r.format(this.convertStringToFieldValue(r,l))),n.appendFormat('<tr><td colspan="2" class="Control AndLabel">{4}<\/td><td><input id="{0}$SearchBarValue2${1}" type="text" class="{2}" value="{3}" tabindex="{5}"/>{6}<\/td><td>&nbsp;<\/td><\/tr>',this.get_id(),i,r.FilterType,Web.DataView.htmlAttributeEncode(l),Web.DataViewResources.Data.Filters.Labels.And,a-1,v))},_focusSearchBar:function(n){var u=n!=null,i,t,r;u||(n=0);i=this._get_searchBarControl("Function",n);i||(n=0,i=this._get_searchBarControl("Function",0));t=this._get_searchBarControl("Value",n);t?t.type=="hidden"?(r=t.parentNode.getElementsByTagName("a")[0],r.focus(),u&&this._searchBarVisibleIndex==null&&String.isNullOrEmpty(t.value)&&r.click()):Sys.UI.DomElement.setFocus(t):i&&i.focus()},_searchBarNameChanged:function(n,t){var i,u,f,r;this._saveSearchBarSettings();i=this._get_searchBarSettings();u=i.visibleFields[n];t?Array.removeAt(i.visibleFields,n):(f=this._get_searchBarControl("Name",n),r=parseInt(f.value),i.visibleFields[n]=i.availableFields[r],Array.removeAt(i.availableFields,r));Array.insert(i.availableFields,0,u);this._renderSearchBarControls(!0);this._focusSearchBar(n)},_searchBarFuncChanged:function(n){this._saveSearchBarSettings();var t=this._get_searchBarSettings(),i=t.visibleFields[n],r=this._get_searchBarControl("Function",n);i.Function=r.value;this._renderSearchBarControls(!0);this._focusSearchBar(n)},_searchBarAddField:function(){this._saveSearchBarSettings();var n=this._get_searchBarSettings();Array.add(n.visibleFields,n.availableFields[0]);Array.removeAt(n.availableFields,0);this._renderSearchBarControls(!0);this._focusSearchBar(n.visibleFields.length-1)},_createSearchBarFilter:function(n){for(var c,i,r,a,u,f,e,o,v,y,p=Array.clone(this._filter),l=this._get_searchBarSettings(),s=[],h=!0,t=0;t<l.visibleFields.length;t++)if(c=l.visibleFields[t],i=this._allFields[c.Index],this.removeFromFilter(i),r=c.Function.match(/^(.+?),(true|false)$/),a=[],r[2]=="true"){if(u=this._get_searchBarControl("Value",t),f=this._get_searchBarControl("Value2",t),String.isBlank(u.value)&&(!f||String.isBlank(f.value))&&i.Search!=Web.FieldSearchMode.Required)continue;if(r[1]=="$in"||r[1]=="$notin"){Array.add(s,{Index:i.Index,Function:r[1],Values:[u.value]});continue}if(String.isBlank(u.value)){if(n)continue;else alert(Web.DataViewResources.Validator.RequiredField),Sys.UI.DomElement.setFocus(u),h=!1;break}if(e={NewValue:u.value.trim()},o=this._validateFieldValueFormat(i,e),o)if(n)continue;else{alert(o);Sys.UI.DomElement.setFocus(u);h=!1;break}else Array.add(a,i.Type.startsWith("DateTime")?u.value.trim():e.NewValue);if(r[1]=="$between"){if(String.isBlank(f.value)){if(n)continue;else alert(Web.DataViewResources.Validator.RequiredField),Sys.UI.DomElement.setFocus(f),h=!1;break}if(e={NewValue:f.value.trim()},o=this._validateFieldValueFormat(i,e),o)if(n)continue;else{alert(o);Sys.UI.DomElement.setFocus(f);h=!1;break}else Array.add(a,i.Type.startsWith("DateTime")?f.value.trim():e.NewValue)}Array.add(s,{Index:i.Index,Function:r[1],Values:a})}else Array.add(s,{Index:i.Index,Function:r[1],Values:null});if(!h)return null;for(t=0;t<l.availableFields.length;t++)c=l.availableFields[t],i=this._allFields[c.Index],this.removeFromFilter(i);for(t=0;t<s.length;t++)v=s[t],this.applyFieldFilter(v.Index,v.Function,v.Values,!0);return y=this._filter,this._filter=p,y},_executeSearch:function(n){var u=this.get_action(n),f,i,t,r,e;if(!u||u.Confirmation&&u.Confirmation.match(/_controller\s*=/))this._clearSelectedKey(),this._cancelConfirmation(),this.refreshAndResize();else for(f=Sys.Application.getComponents(),i=0;i<f.length;i++)t=f[i],Web.DataView.isInstanceOfType(t)&&t._hasSearchAction&&(r=t.get_action(t._hasSearchAction),r&&r.Confirmation&&(e=r.Confirmation.match(/_controller\s*=\s*(\w+)/),e&&e[1]==this._controller&&t.search()))},_performSearch:function(){if(!this._isBusy){this._saveSearchBarSettings();var n=this._createSearchBarFilter(!1);n&&(this.set_filter(n),this.refreshData(),this._setFocusOnSearchBar=!0);this._forgetSelectedRow(!0)}},_resetSearchBar:function(){this._isBusy||(this.clearFilter(),this._searchBarSettings[this.get_viewId()]=null,this._renderSearchBarControls(!0),this._focusSearchBar())},_get_searchBarControl:function(n,t){return $get(String.format("{0}$SearchBar{1}${2}",this.get_id(),n,t))},_saveSearchBarSettings:function(){for(var r=this._get_searchBarSettings(),n=0;n<r.visibleFields.length;n++){var t=r.visibleFields[n],f=this._get_searchBarControl("Function",n),i=this._get_searchBarControl("Value",n),u=this._get_searchBarControl("Value2",n);t.Function=f.value;i&&(i.value==Web.DataViewResources.HeaderFilter.EmptyValue?"null":i.value,t.Value=this._formatSearchField(i,t.Index));u&&(t.Value2=this._formatSearchField(u,t.Index))}},_formatSearchField:function(n,t){var i=this._allFields[t],r,u;return i.Type.startsWith("Date")?(r=Date.tryParseFuzzyDate(n.value,i.DataFormatString),r!=null&&(n.value=i.format(r))):i.Type!="String"&&(u=Number.tryParse(n.value,i.DataFormatString),u!=null&&(n.value=i.format(u))),n.value},_renderSearchBarControls:function(n){var s,i,u,t,a,f,h,e,r,o,l;if(!this._searchBarInitialized||n){for(s=$get(this.get_id()+"$SearchBarContent"),this._searchBarInitialized=!0,i=new Sys.StringBuilder,i.append('<table class="SearchBarFrame">'),u=this._get_searchBarSettings(),t=0;t<u.visibleFields.length;t++)this._renderSearchBarField(i,u,t);for(u.availableFields.length>0&&i.appendFormat('<tr><td colspan="3" class="AddConditionText"><a href="javascript:" onclick="$find(\'{0}\')._searchBarAddField();return false;">{3}<\/a><\/td><td class="FieldAction"><a href="javascript:" class="Add" tabindex="{1}" title="{2}" onclick="$find(\'{0}\')._searchBarAddField();return false;"><span><\/span><\/a><\/td>',this.get_id(),$nextTabIndex(),Web.DataViewResources.Grid.AddCondition,Web.DataViewResources.Grid.AddConditionText),i.appendFormat('<tr><td><div id="{0}$SearchBarNameStub" class="Stub"><\/div><\/td><td><div id="{0}$SearchBarFuncStub" class="Stub"><\/div><\/td><td><\/td><\/tr>',this.get_id()),i.append("<\/table>"),a=Web.DataViewResources.Grid,i.appendFormat('<div class="SearchButtons"><button onclick="$find(\'{0}\')._performSearch();return false" tabindex="{3}" class="Search">{1}<\/button><br/><button onclick="$find(\'{0}\')._resetSearchBar();return false" tabindex="{4}" class="Reset">{2}<\/button><\/div>',this.get_id(),a.PerformAdvancedSearch,Web.DataViewResources.Data.Filters.Labels.Clear,$nextTabIndex(),$nextTabIndex()),s.innerHTML=i.toString(),i.clear(),f=$get(this.get_id()+"$SearchBarNameStub"),f.style.width=f.offsetWidth+"px",f=$get(this.get_id()+"$SearchBarFuncStub"),f.style.width=f.offsetWidth+"px",h=s.getElementsByTagName("select"),t=0;t<h.length;t++)h[t].style.width="100%";for(this._searchBarExtenders||(this._searchBarExtenders=[]),t=0;t<u.visibleFields.length;t++){var v=u.visibleFields[t],y=this._allFields[v.Index],c=this._get_searchBarControl("Value",t);if(c)if(v.Function.match(/\$(in|notin),/)==null)e=this._createFieldInputExtender("SearchBar",y,c,t),e&&Array.add(this._searchBarExtenders,e);else{for(r=c;r&&r.tagName!="TR";)r=r.parentNode;for(o=0;o<r.childNodes.length;o++)r.childNodes[o].vAlign="top"}l=this._get_searchBarControl("Value2",t);l&&(e=this._createFieldInputExtender("SearchBar",y,l,t+"$2"),e&&Array.add(this._searchBarExtenders,e))}}},_updateSearchBar:function(){var r=this._get("$SearchBar"),n,t,u,i;r&&(n=this.get_searchBarIsVisible(),t=this._get("$SearchBarActivator"),t&&(n?Sys.UI.DomElement.addCssClass(t,"Activated"):Sys.UI.DomElement.removeCssClass(t,"Activated")),Sys.UI.DomElement.setVisible(r,n),n&&this._renderSearchBarControls(r),t&&(Sys.UI.DomElement.setVisible(this._get("$QuickFind"),!n),u=this._get("$SearchToggle"),u.title=this._hasSearchAction&&this._hasSearchShortcut?Web.DataViewResources.Grid.PerformAdvancedSearch:this.get_searchBarIsVisible()?Web.DataViewResources.Grid.HideAdvancedSearch:Web.DataViewResources.Grid.ShowAdvancedSearch),i=this._get("$InfoRow"),i&&(n?Sys.UI.DomElement.addCssClass(i,"WithSearchBar"):Sys.UI.DomElement.removeCssClass(i,"WithSearchBar")),this._setFocusOnSearchBar&&(this._setFocusOnSearchBar=!1,this._focusSearchBar()))},_renderSearchBarActivator:function(n){this.get_showSearchBar()&&(this.get_showQuickFind()||!this.get_searchOnStart())&&(n.appendFormat('<td class="SearchBarActivator{1}" id="{0}$SearchBarActivator"><a href="javascript:" onclick="$find(\'{0}\')._toggleSearchBar();return false;" id="{0}$SearchToggle"><span><\/span><\/a><\/td>',this.get_id(),this._hasSearchAction&&this._hasSearchShortcut?" Search":""),this.get_showQuickFind()||n.append('<td class="Divider"><div><\/div><\/td>'))},_internalRenderActionBar:function(n){var e=this.get_actionGroups("ActionBar"),o,s,h,u,r,f,c,i,t;if(n.append('<table cellpadding="0" cellspacing="0" class="Groups"><tr>'),o=this.get_isGrid(),o&&this._renderSearchBarActivator(n),o&&this.get_showQuickFind()?(s=this.get_quickFindText(),n.appendFormat('<td class="QuickFind" title="{2}" id="{0}$QuickFind"><div class="QuickFind"><table cellpadding="0" cellspacing="0"><tr><td><input type="text" id="{0}_QuickFind" value="{1}" class="{3}" tabindex="{4}"/><\/td><td class="Button"><a href="#" onclick="$find(\'{0}\').quickFind();return false;"><span>&nbsp;<\/span><\/a><\/td><\/tr><\/table><\/div><\/td>',this.get_id(),Web.DataView.htmlAttributeEncode(s),Web.DataViewResources.Grid.QuickFindToolTip,s==Web.DataViewResources.Grid.QuickFindText?"Empty":"NonEmpty",$nextTabIndex()),n.append('<td class="Divider"><div><\/div><\/td>'),this.get_lookupField()&&!String.isNullOrEmpty(this.get_lookupField().ItemsNewDataView)&&n.appendFormat('<td class="QuickCreateNew"><a href="javascript:" onclick="$find(\'{0}\').closeLookupAndCreateNew();return false;" class="CreateNew" title="{1}" tabindex="{2}><span class="Placeholder"><\/span><\/a><\/td>',this.get_id(),Web.DataViewResources.Lookup.GenericNewToolTip,$nextTabIndex())):(e.length==0||this.get_lookupField())&&n.append('<td class="Divider"><div style="visibility:hidden"><\/div><\/td>'),!this.get_lookupField())for(this._registerActionBarItems(),h=this.get_isChart()&&!this.get_showViewSelector(),h&&n.appendFormat('<td class="Group Main" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{3}" onclick="$hoverOver(this, 2);return false;">{2}<\/a><\/span><\/td>',this.get_id(),this.get_viewId(),Web.DataView.htmlEncode(this.get_view().Label),$nextTabIndex()),u=0;u<e.length;u++)if((u>0||h)&&n.append('<td class="Divider"><div><\/div><\/td>'),r=e[u],r.Flat){for(f=-1,c=-1,i=0;i<r.Actions.length;i++)t=r.Actions[i],t._isAvailable=this._isActionAvailable(t)&&!String.isNullOrEmpty(t.HeaderText),t._isFirst=!1,t._isLast=!1,t._isAvailable&&(f==-1&&(f=i),c=i);for(f>=0&&(r.Actions[f]._isFirst=!0,r.Actions[c]._isLast=!0),i=0;i<r.Actions.length;i++)t=r.Actions[i],t._isAvailable&&n.appendFormat('<td class="{7}Group FlatGroup{6}{8}{9}" onmouseover="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="if(this._skip)this._skip=null;else $find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2})" title="{10}"><span class="Outer">{5}<a href="javascript:" tabindex="{4}" onclick="this.parentNode.parentNode._skip=true;$find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2});return false;" onfocus="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)">{3}<\/a><\/span><\/td>',this.get_id(),i,u,Web.DataView.htmlEncode(t.HeaderText),$nextTabIndex(),String.isNullOrEmpty(t.CssClass)?"":String.format('<span class="FlatGroupIcon {0}">&nbsp;<\/span>',t.CssClass),String.isNullOrEmpty(t.CssClass)?"":" FlatGroupWithIcon",t.CssClassEx,t._isFirst?" First":"",t._isLast?" Last":"",t.Description)}else n.appendFormat('<td class="{5}Group" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{4}" onclick="$hoverOver(this, 2);return false;">{3}<\/a><\/span><\/td>',this.get_id(),this.get_viewId(),u,r.HeaderText,$nextTabIndex(),r.CssClassEx);n.append("<\/tr><\/table>")},_renderActionBar:function(n){if(!this.get_showActionBar()){this._registerActionBarItems();return}n.appendFormat('<tr class="ActionRow"><td colspan="{0}"  class="ActionBar">',this._get_colSpan());n.appendFormat('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="width:100%" id="{0}$ActionBar">',this.get_id());this._internalRenderActionBar(n);this._registerViewSelectorItems();n.append('<\/td><td class="ViewSelectorControl">');this.get_showViewSelector()&&(n.appendFormat('<table cellpadding="0" cellspacing="0"><tr><td class="ViewSelectorLabel">{0}:<\/td><td>',Web.DataViewResources.ActionBar.View),n.appendFormat('<span class="ViewSelector" onmouseover="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><span class="Inner"><a href="javascript:" class="Link" tabindex="{2}" onfocus="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;,3)" onblur="$hideHover(this)">{1}<\/a><\/span><\/span><\/span>',this.get_id(),Web.DataView.htmlEncode(this.get_view().Label),$nextTabIndex()),n.append("<\/td><\/tr><\/table>"));n.append("<\/td><\/tr><\/table>");n.append("<\/td><\/tr>")},get_statusBar:function(){return this._statusBar},_renderStatusBar:function(n){n.appendFormat('<tr class="StatusBarRow" style="display:none"><td colspan="{1}" class="StatusBar" id="{0}$StatusBar"><\/td><\/tr>',this.get_id(),this._get_colSpan())},statusBar:function(){var l=this.get_statusBar(),f,r,n,e,i,u,o,s,t;if(!String.isNullOrEmpty(l))for(r=/((\w+)\.)?((\w+)\.)?(\w+):\s*(.+?)\s*\n\s*(((.+?)\s*>\s*)+)/g,n=r.exec(l);n;){if(e=this.fieldValue(n[5]),e==null&&(e="null"),(n[6]==e||n[6]=="*")&&(String.isNullOrEmpty(n[2])||n[2]==this.get_controller())&&(String.isNullOrEmpty(n[3])||n[4]==this.get_viewId())){for(r=/(\[)?\s*(.+?)\s*(\])?\s*>\s*/g,i=[],u=r.exec(n[7]);u;)Array.add(i,{Text:u[2],Current:u[1]=="["&&u[3]=="]"}),u=r.exec(n[7]);if(i.length>0&&!(__tf!=4)){for(f=new Sys.StringBuilder('<ul class="StatusBar">'),o=!1,s=!0,t=0;t<i.length;t++)if(i[t].Current){o=!0;s=!1;break}for(t=0;t<i.length;t++){var h=i[t],c=h.Current?"Current":o?"Past":s?"Future":"",a=t<i.length-1?i[t+1]:null,v="";a&&(a.Current?v=c+"ToCurrent":h.Current&&(v=a.Current?c+"ToCurrent":c+"ToFuture"));h.Current&&(o=!1,s=!0);f.appendFormat('<li class="Segment {1}{2}{3} {4}"><span class="Outer"><span class="Inner"><span class="Self">{0}<\/span><\/span><\/span><\/li>',Web.DataView.htmlEncode(h.Text),c,t==0?" First":"",t==i.length-1?" Last":"",v)}f.append("<\/ul>")}break}n=r.exec(l)}return f?f.toString():null},_updateStatusBar:function(){var i=this.get_statusBar(),t,n;String.isNullOrEmpty(i)||(n=$(this._get("$StatusBar")),n.length&&(t=this.statusBar(),t?n.html(t).parent().show():n.parent().hide()))},filterByFirstLetter:function(n){var t=this._firstLetters[0],i=this._firstLetters[n];this.applyFieldFilter(this.findField(t).Index,"$beginswith",[i])},_renderViewDescription:function(n){var c=this._firstLetters&&this._firstLetters.length>2,s=this.get_showDescription(),r,f,u,e,h,t,i,l,o;if(s||c){if(r=s?this.get_description():"",f=null,c){for(u=new Sys.StringBuilder,u.append('<div class="Letters">'),e=this.findField(this._firstLetters[0]),h=null,t=0;t<this._filter.length;t++)if(i=this._filter[t].match(Web.DataView._fieldFilterRegex),i&&i[1]==e.Name){i=i[2].match(/^\$beginswith\$(.+?)\0$/);i&&(h=this.convertStringToFieldValue(e,i[1]));break}for(l=String.format("{0} {1} ",Web.DataView.htmlAttributeEncode(e.Label),Web.DataViewResources.Data.Filters.Text.List[2].Text.toLowerCase()),t=1;t<this._firstLetters.length;t++)o=this._firstLetters[t],u.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').filterByFirstLetter({1});return false;" class="Letter{5}" title="{3}{4}">{2}<\/a> ',this.get_id(),t,o,l,Web.DataView.htmlAttributeEncode(o),h==o?" Selected":"");u.append("<\/div>");f=u.toString();u.clear()}s&&String.isNullOrEmpty(r)&&(r=this.get_view().HeaderText);(!String.isNullOrEmpty(r)||this.get_lookupField()||f)&&(n.appendFormat('<tr class="HeaderTextRow"><td colspan="{0}" class="HeaderText">',this._get_colSpan()),this.get_lookupField()!=null&&n.append('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="padding:0px">'),n.appendFormat('<div id="{0}$HeaderText">',this.get_id()),n.append(this._formatViewText(Web.DataViewResources.Views.DefaultDescriptions[r],!0,r)),n.append("<\/div>"),f&&n.append(f),this.get_lookupField()!=null&&n.appendFormat('<\/td><td align="right" style="padding:0px"><a href="javascript:" class="Close" onclick="$find(\'{0}\').hideLookup();return false" tabindex="{2}" title="{1}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),Web.DataViewResources.ModalPopup.Close,$nextTabIndex()),n.append("<\/td><\/tr>"))}},_renderInfoBar:function(n){var i=this.get_filter(),t;i.length>0&&!this.filterIsExternal()&&(t=new Sys.StringBuilder,this.get_viewType()!="Form"&&this._renderFilterDetails(t,i),this.get_viewType()=="Form"||t.isEmpty()||(n.appendFormat('<tr class="InfoRow {2}" id="{0}$InfoRow"><td colspan="{1}">',this.get_id(),this._get_colSpan(),this.get_viewType()),n.append(t.toString()),n.append("<\/td><\/tr>")),t.clear())},_findFilterDefByFunction:function(n,t){var r,i,u;for(t.endsWith("$")&&(t=t.substring(0,t.length-1)),r=0;r<n.length;r++)if(i=n[r],i)if(i.List){if(u=this._findFilterDefByFunction(i.List,t),u)return u}else if(i.Function==t)return i;return null},_renderFilterDetails:function(n,t,i){for(var s,e,f,o,y,h,p=!1,l=0;l<t.length;l++){var c=t[l].match(Web.DataView._fieldFilterRegex),a=c[1]=="_quickfind_",r=a?this._fields[0]:this.findField(c[1]);if(r&&!this._fieldIsInExternalFilter(r)){p||(i!=!1&&n.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').clearFilter();return false" class="Close" tabindex="{3}" title="{2}">&nbsp;<\/a><span class="Details"><span class="Information">&nbsp;<\/span>{1} ',this.get_id(),Web.DataViewResources.InfoBar.FilterApplied,Web.DataViewResources.ModalPopup.Close,$nextTabIndex()),p=!0);for(var w=r&&this._allFields[r.AliasIndex],u=Web.DataView._filterIteratorRegex.exec(c[2]),v=!0;u&&(u[1].startsWith("~")||!(r.Index==r.AliasIndex&&r.IsPrimaryKey&&r.Hidden));){if(v?n.appendFormat('<span class="FilterElement" onclick="$find(\'{0}\').removeFromFilterByIndex({1})" title="{2}">',this.get_id(),a?-1:r.Index,a?Web.DataViewResources.Data.Filters.Labels.Clear:Web.DataView.htmlAttributeEncode(String.format(Web.DataViewResources.HeaderFilter.ClearFilter,r.Label))):n.append(", "),u[1].startsWith("~"))n.appendFormat(String.format('{0} <b class="String">{1}<\/b>',Web.DataViewResources.InfoBar.QuickFind,this.convertStringToFieldValue(r,u[3])));else if(n.appendFormat('<span class="Highlight">{0}<\/span>',w.HeaderText),s=this._findFilterDefByFunction(Web.DataViewResources.Data.Filters[r.FilterType].List,r.FilterType=="Boolean"&&u[3].length>1?u[3]=="%js%true"?"$true":"$false":u[1]),s)if(s.Prompt){if(n.appendFormat(" {0} ",s.Text.toLowerCase()),f=u[3],o=f.split(Web.DataView._listRegex),String.isJavaScriptNull(o[0])&&(o[0]=Web.DataViewResources.InfoBar.Empty),!String.isJavaScriptNull(u[2]))for(y=o[0].match(/^([\s\S]+?)\0?$/),y&&(o[0]=y[1]),f=this.convertStringToFieldValue(r,o[0]),e=this._findItemByValue(r,f),n.appendFormat("<b>{0}<\/b>",String.htmlEncode(e?e[1]:r.format(f))),h=1;h<o.length;h++)if(n.appendFormat("{0} ",u[1]=="$between$"?" "+Web.DataViewResources.Data.Filters.Labels.And:", "),f=this.convertStringToFieldValue(r,o[h]),f==null?f=Web.DataViewResources.HeaderFilter.EmptyValue:(e=this._findItemByValue(r,f),f=e?e[1]:r.format(f)),n.appendFormat('<b class="{1}">{0}<\/b>',String.htmlEncode(f)),h>5){n.append(", ..");break}}else n.appendFormat(" {0} <b>{1}<\/b>",Web.DataViewResources.Data.Filters.Labels.Equals,s.Function.match(Web.DataView._keepCapitalization)?s.Text:s.Text.toLowerCase());else{switch(u[1]){case"=":n.append(String.isJavaScriptNull(u[2])?Web.DataViewResources.InfoBar.Empty:Web.DataViewResources.InfoBar.EqualTo);break;case"<":n.append(Web.DataViewResources.InfoBar.LessThan);break;case"<=":n.append(Web.DataViewResources.InfoBar.LessThanOrEqual);break;case">":n.append(Web.DataViewResources.InfoBar.GreaterThan);break;case">=":n.append(Web.DataViewResources.InfoBar.GreaterThanOrEqual);break;case"*":n.append(u[2].startsWith("%")?Web.DataViewResources.InfoBar.Like:Web.DataViewResources.InfoBar.StartsWith)}e=this._findItemByValue(r,this.convertStringToFieldValue(r,u[3]));f=e==null?u[3]:e[1];f=String.isJavaScriptNull(u[3])||String.isBlank(f)?Web.DataViewResources.InfoBar.Empty:this.convertStringToFieldValue(r,f);n.appendFormat("<b>{0}<\/b>",String.htmlEncode(f))}u=Web.DataView._filterIteratorRegex.exec(c[2]);v=!1}v||n.append(".");n.append("<\/span> ")}}n.append("<\/span>")},_findItemByValue:function(n,t){var u=n.DynamicItems?n.DynamicItems:n.Items,i,r,f;if(u.length==0)return null;for(t=t==null?"":t.toString(),i=0;i<u.length;i++)if(r=u[i],f=r[0]==null?"":r[0].toString(),f==t)return r;return[null,this.get_isForm()?Web.DataViewResources.Data.NullValueInForms:Web.DataViewResources.Data.NullValue]},_renderPager:function(n,t){var c,u,f,e,o,s,h,l;if(this.get_showPager().indexOf(t)!=-1){if(c=this.get_isChart(),n.appendFormat('<tr class="FooterRow {2}PagerRow"><td colspan="{0}" class="Footer"><table cellpadding="0" cellspacing="0" style="width:100%"><tr><td align="left" class="Pager PageButtons{1}">',this._get_colSpan(),c?" Print":"",t),u=this.get_pageCount(),f=this.get_pageSize(),c&&(u=1,f=this._totalRowCount,e=this._get_specialAction("Print"),e&&n.appendFormat('<a href="javascript:" onclick="{1};return false;" title="{0}" class="Print"><span><\/span><\/a><\/td><td>',e.text,e.script)),u>1){var r=this._firstPageButtonIndex,a=this.get_pagerButtonCount(),v=a;for(this.get_pageIndex()>0?n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',this.get_pageIndex()-1,this.get_id(),Web.DataViewResources.Pager.Previous,$nextTabIndex()):n.appendFormat('<span class="Disabled">{0}<\/span>',Web.DataViewResources.Pager.Previous),n.appendFormat(" | {0}: ",Web.DataViewResources.Pager.Page),r>0&&n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage(0,true);return false" class="PaddedLink" tabindex="{2}">1<\/a><a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">...<\/a>',r-1,this.get_id(),$nextTabIndex(),$nextTabIndex());v>0&&r<u;)r==this.get_pageIndex()?n.appendFormat('<span class="Selected">{0}<\/span>',r+1):n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',r,this.get_id(),r+1,$nextTabIndex()),r++,v--;r<=u-1&&n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{2}">...<\/a><a href="#" onclick="$find(\'{1}\').goToPage({3}-1,true);return false" class="PaddedLink" tabindex="{4}">{3}<\/a>',this._firstPageButtonIndex+a,this.get_id(),$nextTabIndex(),u,$nextTabIndex());n.append(" | ");this.get_pageIndex()<u-1?n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',this.get_pageIndex()+1,this.get_id(),Web.DataViewResources.Pager.Next,$nextTabIndex()):n.appendFormat('<span class="Disabled">{0}<\/span>',Web.DataViewResources.Pager.Next)}if(n.append('<\/td><td align="right" class="Pager PageSize">&nbsp;'),o=this.get_showPageSize(),s=this._pageSizes,o&&this._totalRowCount>f){for(n.append(Web.DataViewResources.Pager.ItemsPerPage),i=0;i<s.length;i++)i>0&&n.append(", "),f==s[i]?n.appendFormat("<b>{0}<\/b>",f):n.appendFormat('<a href="#" onclick="$find(\'{0}\').set_pageSize({1},true);return false" tabindex="{2}">{1}<\/a>',this.get_id(),s[i],$nextTabIndex());n.append(" | ")}this._totalRowCount>0&&(h=(this.get_pageIndex()+1)*f,h>this._totalRowCount&&(h=this._totalRowCount),o&&n.appendFormat(Web.DataViewResources.Pager.ShowingItems,this.get_pageIndex()*f+1,h,this._totalRowCount),l=this.multiSelect(),l&&(n.appendFormat('<span id="{0}$SelectionInfo">',this.get_id()),this._selectedKeyList.length>0&&n.appendFormat(Web.DataViewResources.Pager.SelectionInfo,this._selectedKeyList.length),n.append("<\/span>")),(o||l)&&n.append(" | "));n.appendFormat('<\/td><td align="center" class="Pager Refresh" id="{0}_Wait">',this.get_id());this.get_searchOnStart()||n.appendFormat('<a href="#" onclick="$find(\'{0}\').{3}();return false" tabindex="{2}" title="{1}"><span>&nbsp;<\/span><\/a>',this.get_id(),Web.DataViewResources.Pager.Refresh,$nextTabIndex(),this._hasSearchAction?"search":"sync");n.append("<\/td><\/tr><\/table>");n.append("<\/td><\/tr>")}},refreshAndResize:function(){this.cancelDataSheetEdit();this.goToPage(-1);delete this._viewColumnSettings},refreshData:function(){this._clearCache();this.set_pageIndex(-2);this._loadPage()},_dittoCollectedValues:function(n,t){var r,i,f,s;if(this.get_isEditing()){var e=t?new RegExp(String.format("^{0}(Length|ContentType|FileName|FullFileName)?$",t)):null,o=this._collectFieldValues(!0),u=[];for(r=0;r<o.length;r++)i=o[r],e&&i.Name.match(e)||Array.add(u,{name:i.Name,value:i.Modified?i.NewValue:i.OldValue});if(n)for(r=0;r<n.length;r++){for(i=n[r],f=0;f<u.length;f++)if(s=i.Name?i.Name:i.name,u[f].name==s){Array.removeAt(u,f);break}Array.add(u,i.Name?{name:i.Name,value:i.NewValue}:i)}this._ditto=u}},refresh:function(n,t,i){this._dittoCollectedValues(t,i);this._lastSelectedCategoryTabIndex=this.get_categoryTabIndex();n?this._render():this.goToView(this.get_viewId())},_cname:function(n){var t=this.get_viewId();return t==null&&(t="grid1"),String.format("{0}${1}${2}",this._id,t,n)},readContext:function(n){return Web.PageState.read(this._cname(n))},writeContext:function(n,t){Web.PageState.write(this._cname(n),t)},_saveViewVitals:function(){this.writeContext("vitals",{PageIndex:this.get_pageIndex(),PageSize:this.get_pageSize(),Filter:this.get_filter(),SortExpression:this.get_sortExpression(),Tag:this.get_tag()})},_restoreViewVitals:function(n){var t,u,i,r,e,h,o;if(!(n.PageIndex>=0)&&(t=this.readContext("vitals"),t!=null)&&(n.RequiresRowCount=!0,n.RequiresMetaData=!0,n.PageIndex==-1&&t.Filter&&n.Filter)){if(n.Tag=t.Tag,n.PageIndex=t.PageIndex,n.PageSize=t.PageSize,n.FilterIsExternal){for(u=n.Filter,i=0;i<t.Filter.length;i++){var f=t.Filter[i],c=f.substring(0,f.indexOf(":")),s=!1;for(r=0;r<n.Filter.length;r++)if(e=n.Filter[r],h=e.substring(0,e.indexOf(":")),h==c){s=!0;break}s||Array.add(u,f)}n.Filter=Array.clone(u)}else(n.Filter==null||n.Filter.length==0)&&(n.Filter=Array.clone(t.Filter));n.SortExpression=t.SortExpression;this.get_isDataSheet()&&this._get_focusedCell()||(o=this.readContext("GridType"),o!=null&&this.changeViewType(o))}},_useSearchParams:function(n){var t=this._paramValues,r,i,u;if(t?(this._searchParamValues=t,this._paramValues=null):t=this._searchParamValues,t){for(r=Array.clone(n.ExternalFilter),i=0;i<t.length;i++)u=t[i],Array.add(r,{Name:u.Name,Value:u.NewValue});n.ExternalFilter=r}},_forceSync:function(){this._skipSync?this._skipSync=!1:this._syncKey=this.get_selectedKey()},sync:function(n){var i,t,r;if(this._clearCache(),n!=null){for(Array.isInstanceOfType(n)||(n=[n]),i=[],t=0;t<this._keyFields.length;t++)r=this._keyFields[t],i[this._keyFields[t].Index]=n[t];this._raiseSelectedDelayed=!0;this._pendingSelectedEvent=!0;this._selectKeyByRow(i)}this._forceSync();this.refreshAndResize();this._synced=!0},_sync:function(){var n=this._viewColumnSettings;this._viewColumnSettings=[];this.sync();this._viewColumnSettings=n},_createParams:function(n){var i=this.get_lookupContext(),r=this.get_viewType(),u;String.isNullOrEmpty(r)&&(r=this.readContext("GridType"));var f=this.extension(),t={PageIndex:this.get_pageIndex(),PageSize:this.get_pageSize(),PageOffset:this.get_pageOffset(),SortExpression:this.get_sortExpression(),Filter:this.get_filter(),ContextKey:this.get_id(),Cookie:this.get_cookie(),FilterIsExternal:this._externalFilter.length>0,LookupContextFieldName:i?i.FieldName:null,LookupContextController:i?i.Controller:null,LookupContextView:i?i.View:null,LookupContext:i,Inserting:this.get_isInserting(),LastCommandName:this.get_lastCommandName(),LastCommandArgument:this.get_lastCommandArgument(),ExternalFilter:this.get_externalFilter(),Transaction:this.get_transaction(),DoesNotRequireData:this.get_searchOnStart(),LastView:this.get_lastViewId(),Tag:this.get_tag(),RequiresFirstLetters:this.get_showFirstLetters(),ViewType:r,SupportsCaching:Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>7,SystemFilter:f?f.systemFilter():null,RequiresRowCount:this._requiresRowCount==!0},e=this.get_confirmContext();return e&&(u=Array.clone(t.ExternalFilter),Array.addRange(u,e.Values),t.ExternalFilter=u),this._useSearchParams(t),this._position&&(this._position.changing&&(t.PageIndex=this._position.index,t.PageSize=1,t.Filter=this._position.filter,t.SortExpression=this._position.sortExpression,t.RequiresMetaData=!0),n&&(t.Filter=this._selectedKeyFilter)),t.SyncKey=this._syncKey,this._syncKey&&(this._syncKey=null),this.useCase("$app")&&(t.RequiresMetaData=!0),t},_createArguments:function(n,t,i){var r,u,f;if(i||(i=this._collectFieldValues()),t||(t=this.get_viewId()),n.values&&(i=Array.clone(n.values)),this._paramValues&&(i=Array.clone(i),Array.addRange(i,this._paramValues),delete this._paramVlaues),r={CommandName:n.commandName,CommandArgument:n.commandArgument,Path:n.path,LastCommandName:this.get_lastCommandName(),Values:i,ContextKey:this.get_id(),Cookie:this.get_cookie(),Controller:this.get_controller(),View:t,LastView:this.get_lastViewId(),Tag:this.get_tag(),Trigger:n.trigger},r.Filter=this.get_filter(),r.SortExpression=this.get_sortExpression(),r.SelectedValues=this.get_selectedValues(),r.ExternalFilter=Array.clone(this.get_externalFilter()),r.Transaction=this.get_transaction(),n.commandName=="PopulateDynamicLookups")for(u=0;u<this._allFields.length;u++)f=this.get_contextFilter(this._allFields[u],i),f.length>0&&Array.addRange(r.ExternalFilter,f);return String.isNullOrEmpty(r.Transaction)||this.get_isModal()||this.get_filterSource()||!r.CommandName.match(/Insert|Update|Delete/)||(r.Transaction+=":complete"),r.SaveLEVs=this._allowLEVs==!0,r},_loadPage:function(){var n,t,i;(this._isBusy&&this._cancelWSRequest(),this._delayedLoading=!1,this._source)||(this.get_mode()!=Web.DataViewMode.View?(this._allFields=[{Index:0,Label:"",DataFormatString:"",AliasIndex:0,ItemsDataController:this.get_controller(),ItemsNewDataView:this.get_newViewId(),ItemsDataView:this.get_viewId(),_dataView:this,Behaviors:[],format:_field_format,isReadOnly:_field_isReadOnly,isNumber:_field_isNumber}],this._fields=this._allFields,this._render()):(this._busy(!0),this._detachBehaviors(),this._showWait(),n=this._createParams(),this._restoreViewVitals(n),t={controller:this.get_controller(),view:this.get_viewId(),request:n},i=new Web.BusinessRules(this),i.before({commandName:"Select",commandArgument:t.view}),i.dispose(),this._invoke("GetPage",t,Function.createDelegate(this,this._onGetPageComplete))))},_cancelWSRequest:function(){var n=this._wsRequest;n&&(this._wsRequest=null,n.get_executor&&!n.completed()&&(!Sys.Browser.agent==Sys.Browser.InternetExplorer||Sys.Browser.version>9)&&n.get_executor().abort())},_invoke:function(n,t,i,r){function e(o,s,h){o.get_statusCode()==0?$app.confirm(Web.DataViewResources.Data.ConnectionLost,function(){u._wsRequest=Sys.Net.WebServiceProxy.invoke(f,n,!1,t,i,e,r)},function(){u._onMethodFailed(o,s,h)}):u._onMethodFailed(o,s,h)}var u=this,f=this.get_servicePath();if(u._autoRefresh(!0),f.startsWith("http")){switch(n){case"GetPage":case"GetListOfValues":t.request.Controller=t.controller;t.request.View=t.view;t=t.request;break;case"Execute":t=t.args}$.ajax({url:this.get_baseUrl()+"appservices/_invoke",type:"GET",cache:!1,data:{method:n,args:Sys.Serialization.JavaScriptSerializer.serialize(t)},dataType:"jsonp",success:function(n){i(n,r)},error:function(n){u._onMethodFailed(n.message,n.response,r)}})}else u._wsRequest=Sys.Net.WebServiceProxy.invoke(f,n,!1,t,i,e,r)},_disposeFields:function(){var n,t;if(this._allFields)for(n=0;n<this._allFields.length;n++)t=this._allFields[n],t._dataView=null,t._listOfValues&&Array.clear(t._listOfValues)},_formatViewText:function(n,t,i){var r=this._views.length>0?this._views[0].Label:this._view?this._view.Label:"";return String.isNullOrEmpty(n)?i:String.format(n,t==!0?r.toLowerCase():r)},_autoRefresh:function(n){if(this._refreshInterval>0&&(this._riTimeout&&(clearTimeout(this._riTimeout),this._riTimeout=null),!n)){var t=this;this._riTimeout=setTimeout(function(){t.get_isForm()||t.sync()},this._refreshInterval*1e3)}},_clearCache:function(n){var t=this._cachedPages,i,r,u;if(t){for(i=0;i<t.length;i++)r=t[i],Array.clear(r.rows),delete r.rows;Array.clear(t);delete this._cachedPages}u=this.extension();u&&u.reset(n==null||n==!0)},_supportsCaching:function(n){return n=="DataSheet"||n=="Grid"&&$app.mobile},_cacheResult:function(n){var s=n.PageSize,o=n.PageSize<n.Rows.length,l=this.get_viewType(),t,p,e,i,f,v,r,u,y;if(o||l||(l=this.readContext("GridType")),o||(o=this._supportsCaching(l)),!o&&!l&&n.Views)for(t=0;t<n.Views.length;t++)if(p=n.Views[t],p.Id==n.View){o=this._supportsCaching(p.Type);break}if(o&&n.SupportsCaching){e=n.Rows;n.Rows=[];i=this._cachedPages;i||(i=this._cachedPages=[]);var a=n.PageIndex,h=0,c=s-1;for(a>0&&(e.length<=s*2?(h=s,c=e.length-1):(h+=s,c+=s)),f={index:a,rows:[]},t=h;t<=c;t++)v=e[t],v&&(Array.add(n.Rows,Array.clone(v)),Array.add(f.rows,v));if(r=null,h>0)for(r={index:a-1,rows:[]},t=0;t<h;t++)Array.add(r.rows,e[t]);if(u=null,c<e.length-1)for(u={index:a+1,rows:[]},t=c+1;t<e.length;t++)Array.add(u.rows,e[t]);for(t=0;t<i.length;)y=i[t],f!=null&&y.index==f.index?(i[t]=f,f=null):r!=null&&y.index==r.index?(i[t]=r,r=null):u!=null&&y.index==u.index?(i[t]=u,u=null):t++;(f||r||u)&&(i.length>100&&(Array.removeAt(i,0),Array.removeAt(i,0),Array.removeAt(i,0)),f&&Array.add(i,f),r&&Array.add(i,r),u&&Array.add(i,u))}},_onGetPageComplete:function(n){var bt=this,y,p,i,t,b,ut,ni,ti,ft,u,ii,f,et,k,ri,c,ot,l,d,st,s,g,ht,r,nt,o,a,h,e,ct,lt,it,at,vt,yt,rt,pt,fi,ei,wt;if(bt._busy(!1),Sys.Services&&Sys.Services.AuthenticationService&&Sys.Services.AuthenticationService.get_isLoggedIn&&Sys.Services.AuthenticationService.get_isLoggedIn()&&!n.IsAuthenticated){location.replace($app.unanchor(location.href));return}if(this._containerIsHidden&&(Sys.UI.DomElement.setVisible(this._container,!0),this._containerIsHidden=!1),this.set_tag(n.Tag),n.FirstLetters!=""&&(this._firstLetters=n.FirstLetters?n.FirstLetters.split(/,/):null),y=this._position&&this._position.changed,this._cacheResult(n),this._pageIndex<0||y){if(this._pageIndex==-1||y){if(this._disposeFields(),this._expressions=n.Expressions,this._detachBehaviors(),this._allFields=n.Fields,this._mapOfAllFields={},this._fields=[],p=[],this._keyFields&&this._selectedKey.length>0){for(i=0;i<this._keyFields.length;i++)p[i]={name:this._keyFields[i].Name,value:this._selectedKey[i]};this._selectedKey=[]}this._keyFields=[];var kt=!1,w=!1,dt=[],gt=0;for(i=0;i<n.Fields.length;i++)t=n.Fields[i],t.Index=i,t.Name=="Status"&&(kt=!0);for(kt||(n.Fields[n.Fields.length]={Name:"Status",ReadOnly:!0,Type:"String",AllowNulls:!0,Hidden:!0,Index:n.Fields.length,_system:!0}),$(n.Fields).each(function(){bt._mapOfAllFields[this.Name]=this}),b=Web.DataView._commandLine.match(/\W_display=(.+?)(&|$)/),i=0;i<n.Fields.length;i++)t=n.Fields[i],ut=String.isNullOrEmpty(t.AliasName)?null:this.findField(t.AliasName),t.AliasIndex=ut?ut.Index:i,(!t.Hidden||b)&&this._fieldIsInExternalFilter(t)&&this.get_hideExternalFilterFields()&&(ni=t.Hidden,t.Hidden=!0,b&&Array.indexOfCaseInsensitive(b[1].split(","),t.Name)!=-1&&(ni||(t.Hidden=!1),this.get_isInserting()&&(ti=new RegExp(String.format("\\W{0}=(.*?)(&|$)",t.Name)),ft=Web.DataView._commandLine.match(ti),ft&&(n.NewRow||(n.NewRow=[]),n.NewRow[i]=decodeURIComponent(ft[1]))))),String.isNullOrEmpty(t.ToolTip)||(t.ToolTip=Web.DataView.htmlAttributeEncode(t.ToolTip)),t.Watermark||t.AllowNulls||(t.Watermark=Web.DataViewResources.Validator.Required),t.Behaviors=[];if(n.NewRow&&this._ditto)for(i=0;i<n.Fields.length;i++)if(t=n.Fields[i],n.NewRow[i]!=null)for(u=0;u<this._ditto.length;u++)if(this._ditto[u].name==t.Name&&!this._ditto[u].duplicated){Array.removeAt(this._ditto,u);break}for(this._ignoreNewRow=!0,this._hasDynamicLookups=!1,this._requiresConfiguration=!1,ii=0,i=0;i<n.Fields.length;i++){if(t=n.Fields[i],t._dataView=this,t.Hidden||Array.add(this._fields,t),t.IsPrimaryKey)for(Array.add(this._keyFields,t),u=0;u<p.length;u++)if(p[u].name==t.Name){Array.add(this._selectedKey,p[u].value);break}String.isNullOrEmpty(t.HeaderText)&&(t.HeaderText=t.Label);String.isNullOrEmpty(t.HeaderText)&&(t.HeaderText=t.Name);t.FilterType="Number";switch(t.Type){case"Time":case"String":t.FilterType="Text";break;case"DateTime":case"DateTimeOffset":t.FilterType="Date";break;case"Boolean":t.FilterType="Boolean"}if(String.isBlank(t.SearchOptions)||__tf!=4)t.SearchOptions=null;else{for(f=t.SearchOptions.replace(/\s+/g,",").split(/,/),t.AllowAutoComplete=!Array.contains(f,"$disableautocomplete"),t.AllowAutoComplete||Array.remove(f,"$disableautocomplete"),t.AllowSamples=!Array.contains(f,"$disablesamples"),t.AllowSamples||Array.remove(f,"$disablesamples"),t.AllowMultipleValues=!Array.contains(f,"$disablemultiplevalues"),t.AllowMultipleValues||Array.remove(f,"$disablemultiplevalues"),t.AutoCompleteAnywhere=Array.contains(f,"$autocompleteanywhere"),t.AutoCompleteAnywhere&&(Array.remove(f,"$autocompleteanywhere"),n.Fields[t.AliasIndex].AutoCompleteAnywhere=!0),u=0,et=!1;u<f.length;)k=f[u]=f[u].trim(),k=="*"&&(et=!0),k.length>0&&k!="*"?u++:Array.removeAt(f,u);et&&f.length>0&&(ri=Web.DataViewResources.Data.Filters[t.FilterType],this._enumerateMissingSearchOptions(f,ri.List));Array.contains(f,"$in")&&!Array.contains(f,"$notin")&&Array.add(f,"$notin");t.SearchOptions=f.length==0?null:f}t.format=_field_format;t.isReadOnly=_field_isReadOnly;t.isNumber=_field_isNumber;t.text=_field_text;t.trim=_field_trim;t.htmlEncode=_field_htmlEncode;t.tagged=function(){var t=this.Tag,i,r,u="",n,f;if(t)for(n=0;n<arguments.length;n++)if(r=arguments[n],i=t.indexOf(r),i>=0){for(n=i+r.length;n<t.length;)if(f=t[n].match(/\d/),f)u+=t[n++];else break;return Web.DataView.tagSuffix=u,!0}return!1};t.tag=function(n){this.Tag=(this.Tag||"")+","+n};_field_prepareDataFormatString(this,t);t.Type=="Boolean"&&t.Items.length==0&&(t.Items=Array.clone(t.AllowNulls?Web.DataViewResources.Data.BooleanOptionalDefaultItems:Web.DataViewResources.Data.BooleanDefaultItems),t.ItemsStyle||(t.ItemsStyle=Web.DataViewResources.Data.BooleanDefaultStyle));t.Items&&t.Items.length>0&&(t.AllowNulls||t.ItemsStyle=="DropDownList")&&!String.isNullOrEmpty(t.Items[0][0])&&t.ItemsStyle!="CheckBoxList"&&Array.insert(t.Items,0,[null,Web.DataViewResources.Data.NullValueInForms]);String.isNullOrEmpty(t.ItemsStyle)||(String.isNullOrEmpty(t.ContextFields)||t.ItemsStyle=="Lookup"||t.ItemsStyle=="AutoComplete"||String.isNullOrEmpty(t.ItemsDataController)?t.ItemsStyle=="UserNameLookup"?(t.ItemsStyle="Lookup",t.ItemsDataController="aspnet_Membership",t.ItemsDataTextField="UserUserName",t.ItemsDataValueField="UserUserName",t.ItemsValueSyncDisabled=!0,Web.Menu.findNode("/Membership.aspx")&&(t.ItemsNewDataView="createForm1")):t.ItemsStyle=="UserIdLookup"&&(t.ItemsStyle="Lookup",t.ItemsDataController="aspnet_Membership",t.ItemsDataTextField="UserUserName",t.ItemsDataValueField="UserId",Web.Menu.findNode("/Membership.aspx")&&(t.ItemsNewDataView="createForm1")):(this._hasDynamicLookups=!0,t.ItemsAreDynamic=!0));String.isNullOrEmpty(t.Configuration)||(this._requiresConfiguration=!0);t.AllowLEV&&(this._allowLEVs=!0);t.TextMode==2&&String.isNullOrEmpty(t.Editor)&&!$app.mobile&&(Sys.Extended.UI.HtmlEditorExtenderBehavior||typeof CKEDITOR!="undefined"?t.ClientEditor="Web$DataView$RichText":t.Editor="RichEditor",t.HtmlEncode=!1);t.Editor&&(this._executeClientEditorFactories(t)?(t.ClientEditor=t.Editor,t.Editor=null):t.EditorId=String.format("{0}_Item{1}",this.get_id(),t.Index));t.ColIndex=t.Hidden?-1:ii++;c=Web.DataView.Geo;t.tagged("modified-","created-")&&t.tagged("modified-latitude","modified-longitude","modified-coords","created-latitude","created-longitude","created-coords")&&((!c||c.latitude<0)&&(c=Web.DataView.Geo={latitude:-1,longitude:-1},ot=navigator.geolocation,ot&&ot.watchPosition(function(n){c.latitude=n.coords.latitude;c.longitude=n.coords.longitude},function(n){c.error=n})),t.TextMode=4);w||(t.tagged("map-")&&!t.tagged("map-none")?w=!0:(l=t.Name.match(/\b(address|city|state|region|postal(.*?)code|zip(.*?)code|zip|country)\b/i),l&&!t.tagged("map-none")&&(l=l[1].toLowerCase(),dt.push({field:t,tag:l}),l.match(/address|city/)&&gt++)))}for(this.untag("supports-view-style-map"),w||gt!=2||(w=!0,$(dt).each(function(){this.field.tag("map-"+this.tag);this.tag=="address"&&this.field.tag("action-location")})),w&&this.tag("supports-view-style-map"),n.LEVs&&this._recordLEVs(n.LEVs),this._views=n.Views,this._view=null,this._lastViewId||this.get_isForm()||(this._lastViewId=n.View),this._actionGroups=n.ActionGroups?n.ActionGroups:[],this._statusBar=n.StatusBar,d=/^(true|false)\:(.+)$/,st=0,this._actionColumn=null,i=0;i<this._actionGroups.length;i++)for(s=this._actionGroups[i],g=Web.DataViewResources.Actions.Scopes[s.Scope],g._Self&&(ht=g._Self[s.HeaderText],ht&&(s.HeaderText=ht.HeaderText)),s.Scope=="ActionColumn"&&(this._actionColumn=String.isNullOrEmpty(s.HeaderText)?Web.DataViewResources.Grid.ActionColumnHeaderText:s.HeaderText),s.Id||(s.Id="auto"+st++),s.CssClassEx=String.format("Actions-g-{0} ",s.Id),u=0;u<s.Actions.length;u++)r=s.Actions[u],r.Id||(r.Id="auto"+st++),r.Path=String.format("{0}/{1}",s.Id,r.Id),nt=r.Confirmation,r.CommandName=="Search"&&(this._hasSearchAction=r.Path,this._hasSearchShortcut=nt&&nt.match(/_shortcut\s*=\s*true/)),r.CssClassEx=String.format("Actions-g-{0}-a-{1} ",s.Id,r.Id),String.isNullOrEmpty(r.HeaderText)&&(o=g[r.CommandName],o?(o.CommandArgument&&(a=o.CommandArgument[r.CommandArgument],a&&(o=a)),o.WhenLastCommandName&&(a=o.WhenLastCommandName[r.WhenLastCommandName],a&&(o=a)),r.HeaderText=o.HeaderText,!String.isNullOrEmpty(o.HeaderText)&&o.HeaderText.indexOf("{")>=0&&(r.HeaderText=o.VarMaxLen!=null&&n.Views[0].Label.length>o.VarMaxLen?o.HeaderText2:this._formatViewText(o.HeaderText)),String.isNullOrEmpty(r.Description)&&(r.Description=this._formatViewText(o.Description)),String.isNullOrEmpty(nt)&&(r.Confirmation=o.Confirmation)):r.HeaderText=r.CommandName),String.isNullOrEmpty(r.WhenView)?r.WhenViewRegex=null:(h=d.exec(r.WhenView),r.WhenViewRegex=new RegExp(h?h[2]:r.WhenView),r.WhenViewRegexResult=h?h[1]!="false":!0),String.isNullOrEmpty(r.WhenTag)?r.WhenTagRegex=null:(h=d.exec(r.WhenTag),r.WhenTagRegex=new RegExp(h?h[2]:r.WhenTag),r.WhenTagRegexResult=h?h[1]!="false":!0),String.isNullOrEmpty(r.WhenHRef)?r.WhenHRefRegex=null:(h=d.exec(r.WhenHRef),r.WhenHRefRegex=new RegExp(h?h[2]:r.WhenHRef),r.WhenHRefRegexResult=h?h[1]!="false":!0);var tt=1,ui=!1,v=this._categories=n.Categories;for(this._tabs=[],i=0;i<v.length;i++)if(e=v[i],e.Index=i,String.isNullOrEmpty(e.Tab)||Array.contains(this._tabs,e.Tab)||Array.add(this._tabs,e.Tab),e.NewColumn&&(i>0&&tt++,ui=!0),e.ColumnIndex=tt-1,e.Id&&(ct=$get(String.format("{0}_{1}_{2}",n.Controller,n.View,e.Id)),ct&&(e.Template=ct.innerHTML)),e.Floating&&String.isNullOrEmpty(e.Template)){for(lt=new Sys.StringBuilder('<div class="FloatingCategoryHeader"><\/div>'),u=0;u<this._allFields.length;u++)it=this._allFields[u],it.Hidden||i!=it.CategoryIndex||lt.appendFormat('<div class="FieldPlaceholder">{{{0}}}<\/div>',it.Name);e.Template=lt.toString()}if(this._tabs.length>0){for(i=0;i<v.length;i++)e=v[i],String.isNullOrEmpty(e.Tab)&&(String.isNullOrEmpty(v[0].Tab)?(e.Tab=Web.DataViewResources.Form.GeneralTabText,this._tabs[0]!=Web.DataViewResources.Form.GeneralTabText&&Array.insert(this._tabs,0,Web.DataViewResources.Form.GeneralTabText)):e.Tab=v[0].Tab),e.ColumnIndex=0;this._lastSelectedCategoryTabIndex!=null?(at=this._focusedFieldName,this.set_categoryTabIndex(!(this._lastSelectedCategoryTabIndex>=0)||at&&at.startsWith("_Annotation_")?this._tabs.length-1:0),delete this._lastSelectedCategoryTabIndex):this.set_categoryTabIndex(0);vt=this.get_parentDataView(this);vt._lastClickedIcon=="Attachment"&&this.set_categoryTabIndex(this._tabs.length-1);vt._lastClickedIcon=null;tt=1}else this.set_categoryTabIndex(-1);this._numberOfColumns=ui&&!this._get_template()?tt:0}this._filter=n.Filter;this._sortExpression=n.SortExpression;this._updatePageCount(n,y);yt=this.get_pagerButtonCount(!0);this._firstPageButtonIndex=Math.floor(n.PageIndex/yt)*yt}else this._requiresRowCount&&(this._requiresRowCount=!1,this._updatePageCount(n,!1));for(i=0;i<n.Fields.length;i++)t=n.Fields[i],rt=n.Fields[t.AliasIndex],t.AllowAutoComplete==!1&&(rt.AllowAutoComplete=!1),t.AllowSamples==!1&&(rt.AllowSamples=!1),t.AllowMultipleValues==!1&&(rt.AllowMultipleValues=!1);if(this._icons=n.Icons,!this.get_isInserting()){if(pt=!1,this._rows){for((this._rows.length==0||n.Rows.length==0)&&delete this._viewColumnSettings,i=0;i<this._rows.length;i++)Array.clear(this._rows[i]);Array.clear(this._rows);pt=this.get_isGrid()}if(this._rows=n.Rows,pt)for(this._selectedRowIndex=null,i=0;i<this._rows.length;i++)if(this._rowIsSelected(i)){this._selectedRowIndex=i;break}}this._newRow=n.NewRow?n.NewRow:[];n.Aggregates&&(this._aggregates=n.Aggregates);this.get_isForm()&&this._selectedRowIndex==null&&this._totalRowCount>0&&(this._selectedRowIndex=0,this._selectKeyByRowIndex(0));y&&(this._position.changed=!0,this._selectKeyByRowIndex(0));this._render(!0);$app.mobile||(this.get_lookupField()&&this._adjustLookupSize(),this._isInInstantDetailsMode()&&(fi=$common.getClientBounds(),ei=$common.getContentSize(document.body),resizeBy(0,ei.height-fi.height)),this._saveViewVitals(),this._pendingSelectedEvent&&(this._pendingSelectedEvent=!1,this.updateSummary()),this._registerFieldHeaderItems(),_body_performResize());this._executeSecondCommand();this._autoRefresh();this._autoSelect();String.isNullOrEmpty(n.ClientScript)||eval(n.ClientScript);wt=new Web.BusinessRules(this);wt.after({commandName:n.NewRow?"New":"Select",commandArgument:n.View});wt.dispose()},_updatePageCount:function(n,t){this._totalRowCount=n.TotalRowCount;this._position&&this._position.count==-1&&(this._position.count=n.TotalRowCount);this._pageIndex=n.PageIndex;t||(this._pageSize=n.PageSize,this._pageCount=Math.floor(n.TotalRowCount/n.PageSize),n.TotalRowCount%n.PageSize!=0&&this._pageCount++)},_autoSelect:function(n){var t=null,f=null,e,s=!1,i,r,u,o;if(this.get_autoHighlightFirstRow()&&(this.set_autoHighlightFirstRow(!1),t="Select",e="highlight"),this.get_autoSelectFirstRow()&&(this.set_autoSelectFirstRow(!1),e="select",i=this.get_actionGroups("Grid"),i.length>0))for(r=0;r<i[0].Actions.length;r++)if(u=i[0].Actions[r],u.CommandName){t=u.CommandName;f=u.CommandArgument;s=!String.isNullOrEmpty(f)&!this.get_showModalForms()&&n==null;break}t&&this.get_viewType()!="Form"&&this._rows.length>0&&(s&&this._hideContainer(),o=this.extension(),o?o._autoSelect={row:this._rows[n||0],action:e}:this.executeRowCommand(n||0,t,f));(!this._tryFocusDataSheet||this._forceFocusDataSheet)&&(this._tryFocusDataSheet=!0,this.get_isDataSheet()&&!this.get_lookupField()&(!this.get_filterSource()||this._forceFocusDataSheet)&&this._rows.length>0&&!$app.mobile&&this.executeRowCommand(this.get_selectedKey().length>0?null:0,"Select"),this._forceFocusDataSheet=!1)},_hideContainer:function(){this._containerIsHidden=!0;this._container.style.display="none"},_enumerateMissingSearchOptions:function(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i&&!i.Hidden&&(i.List?this._enumerateExpressions(n,t):Array.contains(n,i.Function)||Array.add(n,i.Function))},_executeSecondCommand:function(n){var t,i;n?(t=Web.DataView._commandLine.match(/_commandName2=(\w+)(.*?_commandArgument2=(.*?)(&|$))?/),t&&this.executeActionInScope([this.get_viewType(),"ActionBar"],t[1],t[3])):this._trySecondCommand&&(this._trySecondCommand=!1,(this.get_viewType()!="Form"||this._totalRowCount>0)&&(i=this,setTimeout(function(){i._executeSecondCommand(!0)},50)))},_skipNextInputListenerClickEvent:function(){(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)&&(this._skipClickEvent=!0)},_gridViewCellFocus:function(n,t){try{var r=new Sys.UI.DomEvent(n),i=r.target;if((i.tagName=="A"||i.parentNode.tagName=="A")&&!this.get_lookupField()||Sys.UI.DomElement.containsCssClass(i,"RowSelector")||i.tagName=="SPAN"&&i.className=="ObjectRef")return!1;this.get_lookupField()&&(r.stopPropagation(),r.preventDefault());this._skipNextInputListenerClickEvent()}catch(u){}return this.executeRowCommand(t,"Select"),!0},_dataSheetCellFocus:function(n,t,i){var r=this._get_focusedCell(),u=this.get_isInserting(),f;if(u&&t!=-1&&(t=-1),i==-1&&(i=r!=null?r.colIndex:0),this.get_isEditing()&&r){this._focusCell(-1,-1,!1);this._focusCell(t,i);f=t==r.rowIndex||u&&t==-1;(f||this._updateFocusedRow(r))&&this._updateFocusedCell(r)?f&&t!=this._selectedRowIndex&&!u&&this.cancelDataSheetEdit():(this._focusCell(t,i,!1),this._focusCell(r.rowIndex,r.colIndex));this._skipNextInputListenerClickEvent();return}if(n){if(!this._gridViewCellFocus(n,t,i))return}else this._skipNextInputListenerClickEvent();r==null||r.rowIndex!=t||r.colIndex!=i||this.get_isEditing()||this.get_lookupField()?this._startInputListenerOnCell(t,i):(document.selection&&document.selection.clear(),this._skipEditOnClick!=!0&&this._allowEdit()&&this.editDataSheetRow(r.rowIndex));this._skipEditOnClick=!1},_startInputListenerOnCell:function(n,t){if(this._startInputListener(),this._focusCell(-1,-1,!1),this._focusCell(n,t),!this.get_lookupField()){if(Web.DataView._activeDataSheetId!=this.get_id()){var i=$find(Web.DataView._activeDataSheetId);i&&i.cancelDataSheet();Web.DataView._activeDataSheetId=this.get_id()}this._lostFocus=!1}},_startInputListener:function(){this._stopInputListener();this._inputListenerKeyDownHandler||(this._inputListenerKeyDownHandler=Function.createDelegate(this,this._inputListenerKeyDown),this._inputListenerKeyPressHandler=Function.createDelegate(this,this._inputListenerKeyPress),this._inputListenerClickHandler=Function.createDelegate(this,this._inputListenerClick),this._inputListenerDblClickHandler=Function.createDelegate(this,this._inputListenerDblClick),this._focusedCell=null);$addHandler(document,"keydown",this._inputListenerKeyDownHandler);$addHandler(document,"keypress",this._inputListenerKeyPressHandler);$addHandler(document,"click",this._inputListenerClickHandler);$addHandler(document,"dblclick",this._inputListenerDblClickHandler);this._trackingInput=!0},_stopInputListener:function(){this._trackingInput&&($removeHandler(document,"keydown",this._inputListenerKeyDownHandler),$removeHandler(document,"keypress",this._inputListenerKeyPressHandler),$removeHandler(document,"click",this._inputListenerClickHandler),$removeHandler(document,"dblclick",this._inputListenerDblClickHandler),this._lostFocus=!0,this._trackingInput=!1)},_allowEdit:function(){return this._findActionsByCommandName("Edit").length>0},_allowNew:function(){return this._findActionsByCommandName("New").length>0},get_interactiveActionGroups:function(){var n=this.get_actionGroups("Grid");return Array.addRange(n,this.get_actionGroups("ActionBar")),Array.addRange(n,this.get_actionGroups("Form")),Array.addRange(n,this.get_actionGroups("ActionColumn")),n},_findActionsByCommandName:function(n){for(var t,r,u=[],f=this.get_interactiveActionGroups(),i=0;i<f.length;i++)for(actions=f[i].Actions,t=0;t<actions.length;t++)r=actions[t],r.CommandName==n&&Array.add(u,r);return u},_inputListenerKeyPress:function(n){var t,i;if((!n.rawEvent||n.rawEvent.charCode!=0)&&!this._lostFocus){if(this.get_isEditing()){this._pendingChars&&(this._pendingChars+=String.fromCharCode(n.charCode));return}this._isBusy||(t=this._get_focusedCell(),t!=null)&&((i=this._fields[t.colIndex],i.ReadOnly)||this._allowEdit()&&(this.executeRowCommand(t.rowIndex,"Select"),i.isReadOnly()||(this._pendingChars=String.fromCharCode(n.charCode),this.editDataSheetRow(t.rowIndex))))}},cancelDataSheet:function(){this.get_isDataSheet()&&(this._focusCell(-1,-1,!1),this._stopInputListener(),this.set_ditto(null),Web.DataView._activeDataSheetId=null,this.cancelDataSheetEdit(),this._lostFocus=!1,this._focusedCell=null)},_inputListenerKeyDown:function(n){var i,e,f,s;if(!this._lookupIsActive&&!this._lostFocus&&!Web.HoverMonitor._instance.get_isOpen()){if(this._isBusy){if(this._pendingChars)return;n.preventDefault();n.stopPropagation();return}if(!this._isBusy&&(i=this._get_focusedCell(),i!=null)){var t={rowIndex:i.rowIndex,colIndex:i.colIndex},r=!1,o=!1,u=this.get_pageSize();this._rows.length<u&&(u=this._rows.length);switch(n.keyCode){case 83:case Sys.UI.Key.enter:if(n.keyCode==83&&!n.ctrlKey)return;if(this.get_isEditing()){if(e=n.target&&n.target.tagName,(e=="TEXTAREA"||e=="A")&&!n.ctrlKey)return;r=!0;this._updateFocusedRow(i);n.preventDefault();n.stopPropagation();return}n.ctrlKey&&!this.get_isEditing()||this.get_lookupField()?(r=!0,this.executeRowCommand(i.rowIndex,"Select")):n.shiftKey?t.rowIndex>0&&t.rowIndex--:this._moveFocusToNextRow(t,u)&&(r=!0);break;case Sys.UI.Key.down:if(this.get_isEditing()||n.ctrlKey)return;this._moveFocusToNextRow(t,u)&&(r=!0);break;case Sys.UI.Key.up:if(this.get_isEditing()||n.ctrlKey)return;t.rowIndex>0?t.rowIndex--:(this._pageOffset==0&&this.get_pageIndex()==0?(this._pageOffset=null,r=!0):this._pageOffset==null?this.get_pageIndex()>0&&(this._pageOffset=-1):this._pageOffset--,r=!0,this._pageOffset==-u?(this._pageOffset=null,this.get_pageIndex()>0&&this.goToPage(this.get_pageIndex()-1)):this.goToPage(this.get_pageIndex()));break;case Sys.UI.Key.tab:case Sys.UI.Key.right:case Sys.UI.Key.left:if(f=!0,(n.keyCode==Sys.UI.Key.right||n.keyCode==Sys.UI.Key.left)&&this.get_isEditing())return;if(!n.shiftKey&&n.target.parentNode.className=="Date")return;if(n.shiftKey&&n.target.id&&n.target.id.match(/\$Time\d+/))return;if(s=this._pageOffset,n.shiftKey||n.keyCode==Sys.UI.Key.left)if(t.colIndex>0){if(t.colIndex--,n.keyCode==Sys.UI.Key.tab)while(t.colIndex>0&&this._fields[t.colIndex].isReadOnly())t.colIndex--}else this.get_isEditing()&&(r=!0);else if(t.colIndex<this._fields.length-1){if(t.colIndex++,n.keyCode==Sys.UI.Key.tab)while(t.colIndex<this._fields.length-1&&this._fields[t.colIndex].isReadOnly())t.colIndex++}else{if(this.get_isEditing()){if(this._updateFocusedRow(i,n.keyCode==Sys.UI.Key.tab))f=!1;else{n.preventDefault();n.stopPropagation();return}r=!0}f&&this._moveFocusToNextRow(t,u)&&(r=!0);(t.rowIndex!=i.rowIndex||this._pageOffset!=s)&&(t.colIndex=0,r=!1)}f&&this.get_isEditing()&&(o=!0);break;case Sys.UI.Key.home:if(this.get_isEditing())return;n.ctrlKey?this.get_pageIndex()>0?(r=!0,this._pageOffset=0,this.goToPage(0),i.rowIndex=0,i.colIndex=0):(t.rowIndex=0,t.colIndex=0):t.colIndex=0;break;case Sys.UI.Key.end:if(this.get_isEditing())return;n.ctrlKey?(r=!0,i.colIndex=this._fields.length-1,i.rowIndex=this._totalRowCount%this.get_pageSize()-1,i.rowIndex<0&&(i.rowIndex=this.get_pageSize()),this._pageOffset=null,this.goToPage(this.get_pageCount()-1)):t.colIndex=this._fields.length-1;break;case Sys.UI.Key.pageUp:if(this.get_isEditing())return;r=!0;this.get_pageIndex()>0?this.goToPage(this.get_pageIndex()-1):this._pageOffset!=null&&(this._pageOffset=null,this.goToPage(this.get_pageIndex()));break;case Sys.UI.Key.pageDown:if(this.get_isEditing())return;r=!0;this.get_pageIndex()<this.get_pageCount()-1&&this.goToPage(this.get_pageIndex()+1);break;case Sys.UI.Key.esc:this.cancelDataSheetEdit()||this.cancelDataSheet();r=!0;break;case Sys.UI.Key.del:if(this.get_isEditing()||n.shiftKey||n.altKey)return;r=!0;n.ctrlKey?this.deleteDataSheetRow():(this._pendingChars="",this.editDataSheetRow(i.rowIndex));break;case 45:this.get_isEditing()||(r=!0,this._allowNew()&&this.newDataSheetRow());break;case 32:if(n.ctrlKey&&this.multiSelect()&&!this.get_isInserting())r=!0,this.toggleSelectedRow(i.rowIndex);else return;break;case 113:if(this.get_isEditing())return;r=!0;this._allowEdit()&&this.editDataSheetRow(i.rowIndex)}i.rowIndex==t.rowIndex&&i.colIndex==t.colIndex||r||(this._focusCell(i.rowIndex,i.colIndex,!1),this._focusCell(t.rowIndex,t.colIndex,!0),r=!0);r&&(n.preventDefault(),n.stopPropagation());o&&(this._updateFocusedCell(i)||(this._focusCell(t.rowIndex,t.colIndex,!1),this._focusCell(i.rowIndex,i.colIndex,!0)))}}},_updateFocusedCell:function(n){var u=this._collectFieldValues(),e=this._validateFieldValues(u,!0,n),t=this._fields[n.colIndex],f,r,i;if(e)f=!0,t.Index<u.length&&u[t.Index].Modified&&(f=!this._performValueChanged(t.Index)),f&&this.refresh(!0);else if(t.Behaviors)for(r=0;r<t.Behaviors.length;r++)i=t.Behaviors[r],AjaxControlToolkit.CalendarBehavior.isInstanceOfType(i)&&i.get_isOpen()&&(i.hide(),i.show());return e},_updateFocusedRow:function(n,t){return Web.DataView.showMessage(),this._syncFocusedCell=this.get_isInserting(),this._lastFocusedCell=n,this._skipSync=!0,this.executeRowCommand(n.rowIndex,this._syncFocusedCell?"Insert":"Update",null,!0),this._valid&&(this._saveAndNew=t),this._valid},_get_selectedDataRowIndex:function(n){return this.get_pageIndex()*this.get_pageSize()+this.get_pageOffset()+(n!=null?n:this._selectedRowIndex)},executeActionInScope:function(n,t,i,r,u){var o,l,s,f,h,e,c;for(r==null&&(r=this._selectedRowIndex),o=0;o<n.length;o++)if(l=n[o],s=this.get_actionGroups(l),s)for(f=0;f<s.length;f++)if(h=s[f].Actions,h)for(e=0;e<h.length;e++)if(c=h[e],c.CommandName==t&&(String.isNullOrEmpty(i)||c.CommandArgument==i)&&this._isActionAvailable(c,r))return u!=!0&&this.executeAction(l,e,r,f),!0;return!1},newDataSheetRow:function(){var n=this;setTimeout(function(){n.executeCommand({commandName:"New",commandArgument:n.get_viewId()})},100)},editDataSheetRow:function(n){this.get_isDataSheet()&&this.executeRowCommand(n,"Edit","",!1)},deleteDataSheetRow:function(){var n=this._get_focusedCell(),t;n&&(this.executeRowCommand(n.rowIndex,"Select"),t=this,setTimeout(function(){t.executeActionInScope(["Row","ActionBar"],"Delete",null,n.rowIndex)},100))},_moveFocusToNextRow:function(n,t){var i=!1,r=this._get_selectedDataRowIndex(n.rowIndex),u=this._pageOffset;return n.rowIndex<t-1?n.rowIndex++:this._get_selectedDataRowIndex(n.rowIndex)<this._totalRowCount-1&&(this._pageOffset==null?this._pageOffset=1:this._pageOffset++,i=!0,this._pageOffset==t?(this._pageOffset=null,this.goToPage(this.get_pageIndex()+1)):this.goToPage(this.get_pageIndex())),r==this._get_selectedDataRowIndex(n.rowIndex)&&!this.get_isEditing()&&this._allowNew()&&(this._ignoreSelectedKey=!0,this.newDataSheetRow(),i=!0),i},_scrollToRow:function(){return},cancelDataSheetEdit:function(){if(this.get_isEditing()){var n=this._get_focusedCell();return n!=null&&this.executeRowCommand(n.rowIndex,"Cancel",null,!1),!0}return!1},_inputListenerClick:function(n){if(this._skipClickEvent){this._skipClickEvent=!1;return}if(!this._lookupIsActive){for(var t=n.target,r=!1,i=!1,u=!0;t!=null;){if(t==this._container){r=!0;break}t.className!=null&&(t.className.match(/Cell|Group|InfoRow|FieldHeaderSelector|Toggle|FooterRow|ActionRow\s*/)?i=!0:t.className.match(/QuickFind|SearchBarFrame\s*/)&&(u=!1));t=t.parentNode}r?(this._lostFocus=u?!i:!0,this._skipEditOnClick=!0,i||this.cancelDataSheetEdit()):this.cancelDataSheet()}},_inputListenerDblClick:function(){if(!this._lostFocus){var n=this._get_focusedCell();n&&!this.get_isEditing()&&this._allowEdit()&&(document.selection&&document.selection.clear(),this.editDataSheetRow(n.rowIndex))}},_get_focusedCell:function(){return this._focusedCell},_focusCell:function(n,t,i){var w,v,s,u,e,c,r,l,k,a;if(!this.get_isDataSheet())return this._focusedCell=null,null;if(w=this.get_isInserting(),i==null&&(i=!0),n==-1&&t==-1){if(!this._focusedCell)return null;n=this._focusedCell.rowIndex;t=this._focusedCell.colIndex}for(n>=this._rows.length&&(n=this._rows.length-1),t>=this._fields.length&&(t=this._fields.length-1),v=this._container.childNodes[0].rows,s=-1,u=0;u<v.length;u++)if(e=v[u],(Sys.UI.DomElement.containsCssClass(e,"Row")||Sys.UI.DomElement.containsCssClass(e,"AlternatingRow"))&&s++,w){if(Sys.UI.DomElement.containsCssClass(e,"Inserting"))break}else if(s==n)break;if(s<0)return null;for(c=-1,u=0;u<e.childNodes.length;u++)if(r=e.childNodes[u+this.get_sysColCount()],r&&Sys.UI.DomElement.containsCssClass(r,"Cell")&&c++,c==t)break;if(c<0)return null;var b=r.parentNode.childNodes[this.get_sysColCount()-1],y=this._get_headerRowElement(),o=y.childNodes[t+this.get_sysColCount()];if(i==!0){if(l=$common.getBounds(o),Sys.UI.DomElement.addCssClass(r,"Focused"),Sys.UI.DomElement.addCssClass(b,"CrossHair"),Sys.UI.DomElement.addCssClass(o,"CrossHair"),!this._skipCellFocus){var h=$app.scrolling(),p=$common.getClientBounds(),f=$common.getBounds(r);h.y>f.y?(s==0?o:r).scrollIntoView(!0):h.y+p.height<=f.y+f.height?r.scrollIntoView(!1):(h.x>f.x||h.x+p.width-1<=f.x||h.x+p.width-1<=f.x+f.width)&&r.scrollIntoView(!1);Sys.Browser.agent==Sys.Browser.InternetExplorer&&(k=$common.getBounds(y),y.style.height=k.height+"px")}a=$common.getBounds(o);(l.width!=a.width||l.x!=a.x||l.y!=a.y)&&Sys.UI.DomElement.addCssClass(o,"Narrow");this._skipCellFocus=!1}else Sys.UI.DomElement.removeCssClass(r,"Focused"),Sys.UI.DomElement.removeCssClass(r,"Narrow"),Sys.UI.DomElement.removeCssClass(b,"CrossHair"),Sys.UI.DomElement.removeCssClass(o,"CrossHair");return this._focusedCell={rowIndex:n,colIndex:t},r},_initializeModalPopup:function(){var u;Sys.UI.DomElement.addCssClass(this.get_element(),"ModalPlaceholder");var r=$common.getClientBounds(),n=r.width/5*4,i=Web.DataViewResources.ModalPopup.MaxWidth,t=this.get_confirmContext();t&&t.MaxWidth>0&&t.MaxWidth<n&&(i=t.MaxWidth);n>i&&(n=i);u=r.height/5*4;this._container.style.overflowX!=null?(this._container.style.overflowY="auto",this._container.style.overflowX="hidden"):this._container.style.overflow="auto";this._container.style.height=u+"px";this._container.style.width=n+"px";this._saveTabIndexes();this._modalPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"ModalPopup"+Sys.Application.getComponents().length,PopupControlID:this.get_element().id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this.get_modalAnchor());this._modalPopup.show()},_resizeContainerBounds:function(){this._modalPopup||(this._container.style.height="");var n=$common.getBounds(this._container),i=$common.getClientBounds(),t=Math.ceil(i.height/5*4);return n.height>t&&(this._container.style.height=t+"px",n.skipResizing=!0),n},_adjustModalPopupSize:function(){var e=this.get_confirmContext(),u,f,i,r,o,l;Sys.UI.DomElement.removeCssClass(this._element,"EmptyModalDialog");var n=new Sys.StringBuilder,t=[],c=this._container.getElementsByTagName("table");for(u=c.length-1;u>=0;u--)f=c[u],f.className=="ActionButtons"&&(n.isEmpty()&&(n.append('<table class="DataView" cellSpacing=0 cellPadding=0><tr class="ActionButtonsRow BottomButtonsRow">'),n.append(f.parentNode.parentNode.innerHTML),n.append("<\/tr><\/table>")),Array.add(t,f.parentNode.parentNode));while(t.length>0)t[0].parentNode.removeChild(t[0]),delete t[0],Array.removeAt(t,0);i=this._container.childNodes[0];i.style.width="";i.style.height="";r=$common.getContentSize(i);r.height+=Sys.Browser.agent===Sys.Browser.InternetExplorer&&Sys.Browser.version<8?3:1;this._buttons?this._modalAutoSized||(this._container.style.width="auto",this._modalAutoSized=!0):(this._buttons=document.createElement("div"),this.get_element().appendChild(this._buttons),this._buttons.style.width=r.width+"px",Sys.UI.DomElement.addCssClass(this._buttons,"FixedButtons"),this._title=document.createElement("div"),Sys.UI.DomElement.addCssClass(this._title,"FixedTitle"),this.get_element().insertBefore(this._title,this._container),__designer()||$(this._element).draggable({handle:this._title,drag:function(n,t){var i=$(window),f=i.width(),e=i.height(),r=t.offset.left-i.scrollLeft(),u=t.offset.top-i.scrollTop(),o=t.helper.outerWidth();if(r+o<50||u<5||r>f-50||u>e-75)return!1}}));this._buttons.innerHTML=n.toString();n.clear();o=this._resizeContainerBounds();o.height>r.height&&!o.skipResizing&&(l=$common.getBorderBox(i),r.width+=l.horizontal,$common.setContentSize(this._container,r));i.style.width=this._title.offsetWidth+"px";this._buttons.style.width=this._title.offsetWidth+"px";Sys.UI.DomElement.setVisible(this.get_element(),!0);var a=$common.getBounds(this._container),s=$common.getPaddingBox(this._title),h=$common.getBorderBox(this._title);this._title.style.width=a.width-s.horizontal-h.horizontal+"px";s=$common.getPaddingBox(this._buttons);h=$common.getBorderBox(this._buttons);this._buttons.style.width=a.width-s.horizontal-h.horizontal+"px";this._title.innerHTML=String.format('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td><div class="Text">{1}<\/div><\/td><td align="right"><a href="javascript:" class="Close" onclick="$find(\'{0}\').endModalState(\'Cancel\');return false" tabindex="{3}" title="{2}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),e&&e.WindowTitle?e.WindowTitle:Web.DataView.htmlEncode(this.get_view().Label),Web.DataViewResources.ModalPopup.Close,$nextTabIndex());this._modalPopup.show();this._modalAutoSized&&!this._modalWidthFixed&&(this._modalWidthFixed=!0,this._container.style.width=this._container.offsetWidth+"px");this._adjustModalHeight(!0)},_adjustModalHeight:function(n){var t=this._container,i,o,s,r,f,u,h,e,c;if(this._modalPopup&&this.get_viewType()=="Form")if(n)i=$common.getBounds(t),this._lastContainerHeight=i.height;else if(this._lastContainerHeight!=null){for(o=t.style.height,s=t.scrollTop,t.style.height="",r=null,f=t.getElementsByTagName("tr"),u=0;u<f.length;u++)if(f[u].className=="Categories"){r=f[u].childNodes[0];break}r&&(r.style.paddingBottom="");i=$common.getBounds(t);this._lastContainerHeight>i.height?(h=$common.getPaddingBox(r),r&&(e=this._lastContainerHeight-i.height-h.bottom,Sys.Browser.agent==Sys.Browser.InternetExplorer&&e++,r.style.paddingBottom=e+"px")):(c=$common.getClientBounds(),c.height*.8<=i.height?(t.style.height=o,t.scrollTop=s):this._lastContainerHeight=i.height)}},_allowModalAutoSize:function(){this._modalWidthFixed=!1;this._modalAutoSized=!1},_disposeModalPopup:function(){if(this._modalPopup){this._modalPopup.hide();this._modalPopup.dispose();__designer()||$(this._element).draggable("destroy");delete this._buttons;delete this._title;delete this._modalAnchor;var n=this.get_element();n.parentNode.removeChild(n);this._restoreTabIndexes()}},endModalState:function(n){var t=this.get_parentDataView(),u=Web.HoverMonitor._instance,i,r;if(this.get_isModal()&&(i=this.get_exitModalStateCommands(),i))for(r=0;r<i.length;r++)if(n==i[r])return t&&(t._lookupIsActive=!1,t._skipClickEvent=!0),$app.mobile?$app.mobile.endModalState(t,this):this.dispose(),!0;return t&&!this.get_confirmContext()&&($app.mobile||t.refresh()),u&&u.close(),!1},_adjustLookupSize:function(){if(this.get_lookupField()&&this.get_pageSize()>3){var t=$app.scrolling(),i=$common.getClientBounds(),n=$common.getBounds(this.get_element());n.height+n.y>i.height+t.y&&this.set_pageSize(Math.ceil(this.get_pageSize()*.66))}},_onMethodFailed:function(n){(this._busy(!1),Web.DataView._navigated)||this._wsRequest!=null&&(Web.DataView.showMessage(String.format('<pre style="word-wrap:break-word;margin:0px">Component: {4}\r\nController: {5}; View: {6}; Timed out: {0}; Status Code: {7};\r\nException: {1}\r\nMessage: {2}\r\nStack:\r\n{3}<\/pre>',n.get_timedOut(),n.get_exceptionType(),n.get_message(),n.get_stackTrace(),this.get_id(),this.get_controller(),this.get_viewId(),n.get_statusCode())),this.get_element().style.border="1px red solid")},_createArgsForListOfValues:function(n){var t=this.get_lookupContext(),i=this._searchBarVisibleIndex==null?this.get_filter():this._createSearchBarFilter(!0),r={FieldName:n,Controller:this.get_controller(),View:this.get_viewId(),Filter:i.length==1&&i[0].match(/(\w+):/)[1]==n?null:i,ExternalFilter:this.get_externalFilter(),LookupContextFieldName:t?t.FieldName:null,LookupContextController:t?t.Controller:null,LookupContextView:t?t.View:null,Tag:this.get_tag()};return this._useSearchParams(r),{controller:this.get_controller(),view:this.get_viewId(),request:r}},_loadListOfValues:function(n,t,i,r){this._busy(!0);this._invoke("GetListOfValues",this._createArgsForListOfValues(i),Function.createDelegate(this,this._onGetListOfValuesComplete),{family:n,fieldName:t,callback:r})},_onGetListOfValuesComplete:function(n,t){this._busy(!1);var i=this.findField(t.fieldName);i._listOfValues=n;n[n.length-1]==null&&(Array.insert(n,0,n[n.length-1]),Array.removeAt(n,n.length-1));t.callback?t.callback():(this.get_isChart()?(this.get_showViewSelector()?this._registerViewSelectorItems():this._registerActionBarItems(),Web.HoverMonitor._instance._tempOpenDelay=100):this._registerFieldHeaderItems(Array.indexOf(this.get_fields(),i)),$refreshHoverMenu(t.family),Web.DataView._resized=!0)},get_parentDataView:function(n){var t=n;return String.isNullOrEmpty(this._parentDataViewId)||(t=$find(this._parentDataViewId)),t},get_selectedValues:function(){var t=this.get_parentDataView(this),n=t.get_selectedValue();return n.length==0?[]:t.multiSelect()?n.split(";"):[n]},_execute:function(n){this._busy(!0);this._showWait();this._lastArgs=n;this._invoke("Execute",{controller:n.Controller,view:n.View,args:n},Function.createDelegate(this,this._onExecuteComplete))},_populateDynamicLookups:function(n){for(var i,r,t=0;t<n.Values.length;t++)i=n.Values[t],r=this.findField(i.Name),r&&(r.DynamicItems=i.NewValue);this._skipPopulateDynamicLookups=!0;this.refresh(!0);this._focus()},_updateCalculatedFields:function(n){var i,t,r;for(this._displayActionErrors(n),i=[],t=0;t<n.Values.length;t++)r=n.Values[t],Array.add(i,{name:r.Name,value:r.NewValue});this.refresh(!0,i);this._focus()},_get_LEVs:function(){for(var n,t=0;t<Web.DataView.LEVs.length;t++)if(n=Web.DataView.LEVs[t],n.controller==this.get_controller())return n.records;return n={controller:this.get_controller(),records:[]},Array.add(Web.DataView.LEVs,n),n.records},_recordLEVs:function(n){var t,r,i;if(this._allowLEVs&&(n||this._lastArgs.CommandName.match(/Insert|Update/))&&(this._lastArgs||n)){for(n||(n=this._lastArgs.Values),t=this._get_LEVs(),r=!0,i=0;i<n.length;i++)if(n[i].Modified){r=!1;break}r||(t.length>0&&Array.removeAt(t,t.length-1),Array.insert(t,0,n))}},_applyLEV:function(n){for(var t,r=this._allFields[n],e=this._allFields[r.AliasIndex],u=[],f=this._get_LEVs()[0],i=0;i<f.length;i++)t=f[i],(t.Name==r.Name||t.Name==e.Name)&&Array.add(u,{name:t.Name,value:t.NewValue});this.refresh(!0,u)},_notifyMaster:function(){if(this.get_hasParent()){var n=$find(this.get_filterSource());n&&n._updateDynamicValues(this.get_controller())}},_clearSelectedKey:function(n){var t=this._lookupInfo?this:this.get_parentDataView(this);t._selectedKey=[];t._selectedKeyFilter=[];t._selectedRowIndex=null;t._position=null;n!=!1&&(t._raiseSelectedDelayed=!0);t._selectedRow=null},_refreshSelectedKey:function(n){var r,u,i,f,t;n.length==0&&this._lastArgs&&(n=this._lastArgs.Values);var e=[],o=[];for(r=0;r<this._keyFields.length;r++)for(u=this._keyFields[r],i=0;i<n.length;i++)if(n[i].Name==u.Name){if(f=n[i],f.NewValue==null){this._clearSelectedKey();return}Array.add(e,f.NewValue);Array.add(o,u.Name+":="+this.convertFieldValueToString(u,f.NewValue));break}t=this.get_parentDataView();t||(t=this);e.length>0&&(t._selectedKey=e,t._selectedKeyFilter=o,t._raiseSelectedDelayed=!0)},_cancelConfirmation:function(){if(this._confirmDataViewId){var n=$find(this._confirmDataViewId);n&&(this._confirmDataViewId=null,n.cancel())}},_findKeyValue:function(n){for(var i,r=this._keyFields[0],t=0;t<n.length;t++)if(i=n[t],r.Name==i.Name)return i.NewValue;return null},_onExecuteComplete:function(n,t){var i=this,tt=$app.mobile,r=i._lastArgs.CommandName,o,s,h,c,l,a,p,w,b,e,k,d,g,v,y,nt,u,f,it;if(i._busy(!1),i._hideWait(),o=n.Errors.length==0,s=i._pendingUploads,s&&s.length>0&&o&&r=="Insert"&&n.RowsAffected==1){h=s[0];Array.removeAt(s,0);c=i._findKeyValue(n.Values);c==null&&(c=i._findKeyValue(i._lastArgs.Values));h.form.action=h.form.action.replace(/=u\|&/,String.format("=u|{0}&",c));i._pendingExecuteComplete={result:n,context:t};i._showDownloadProgress();h.form.submit();return}if(l=i._lastFocusedCell,r=="PopulateDynamicLookups"){i._populateDynamicLookups(n);return}if(r=="Calculate"){$app.mobile?this.extension().afterCalculate(n.Values):i._updateCalculatedFields(n);String.isNullOrEmpty(n.ClientScript)||eval(n.ClientScript);return}if(a=!1,p=r=="Custom",o&&i._cancelConfirmation(),w={result:n,context:t,handled:!1},i.raiseExecuted(w),!w.handled){if(b=!r.match(/Insert/),r.match(/Delete/i)&&n.RowsAffected>0)i._clearSelectedKey();else if(r.match(/Custom|SQL|Email/))a=!p&&i.get_isEditing(),n.Values.length>0?(i.refresh(!0,n.Values),p&&!n.ClientScript&&(n.ClientScript="void(0)"),i._refreshSelectedKey(n.Values,o)):a||r!="SQL"||(i._raiseSelectedDelayed=!0,i._forceChanged=!0);else if(b)for(e=0;e<n.Values.length;e++)k=n.Values[e],d=i.findField(k.Name),d&&(i.get_currentRow()[d.Index]=k.NewValue);else i._refreshSelectedKey(n.Values,o);if(o){if(i._forceSync(),g=i.get_parentDataView(),g&&g._forceSync(),i.set_tag(n.Tag),i._requestedFilter=n.Filter,i._requestedSortExpression=n.SortExpression,i._autoRefresh(),i.multiSelect()&&(i._selectedKeyList=[],i.set_selectedValue("")),i._recordLEVs(),i.updateSummary(),i._continueAfterScript=!0,n.ClientScript&&(i._continueAfterScript=!1,n.ClientScript=i.resolveClientUrl(n.ClientScript),eval(n.ClientScript)),i._lastFocusedCell=null,v=i._lastArgs.CommandArgument,y=new Web.BusinessRules(i),y.after({commandName:r,commandArgument:v}),y.canceled()&&(i._continueAfterScript=!1),y.dispose(),i._continueAfterScript){if(n.NavigateUrl)n.NavigateUrl=i.resolveClientUrl(n.NavigateUrl),i.navigate(n.NavigateUrl,b?i._lastArgs.Values:n.Values);else if(!i._closeInstantDetails()&&!i.endModalState(r))if(i.get_backOnCancel()||!String.isNullOrEmpty(i._replaceTriggerViewId))i.goBack(!0);else{for(i._notifyDesigner(!0),nt=i.get_actions(i._get_lastActionScope(),!0),e=0;e<nt.length;e++)if(u=nt[e],u.WhenLastCommandName==r&&(u.WhenLastCommandArgument==""||u.WhenLastCommandArgument==v)&&i._isActionMatched(u)){f=i;it=f._lastArgs.Values;function rt(){f.set_lastCommandName(r);f.set_lastCommandArgument(v);f.executeCommand({commandName:u.CommandName,commandArgument:u.CommandArgument,path:u.Path,causesValidation:u.CausesValidation,values:r.match(/Insert|Custom/)?it:null});f._pendingSelectedEvent=u.CommandName.match(/^(Edit|Select)/)!=null;f._notifyMaster()}tt&&f._parentDataViewId?(f=$app.find(i._parentDataViewId),tt.endModalState(f,i,rt)):rt();return}a||(i._pendingSelectedEvent=r.match(/Update|Custom|SQL/),i.set_lastCommandName(null),i.get_isModal()&&(!i.get_isForm(i._lastViewId)||i._closeViewDetails)?i.endModalState("Cancel"):i.goToView(i._lastViewId))}i._notifyMaster()}}else l&&(i._focusCell(-1,-1,!1),i._focusCell(l.rowIndex,l.colIndex,!0),i._lastFocusedCell=null,i._saveAndNew=!1),n.ClientScript&&(n.ClientScript=i.resolveClientUrl(n.ClientScript),eval(n.ClientScript)),i._displayActionErrors(n)}},_get_lastActionScope:function(){var f=this._lastArgs?this._lastArgs.Path:null,i,r,n,u,t;if(f&&(i=f.match(/^(\w+)\//),i))for(r=this._actionGroups,n=0;n<r.length;n++)if(u=r[n],u.Id==i[1])return u.Scope;return t=this.get_viewType(),t.match(/DataSheet|Tree/)&&(t="Grid"),t},_displayActionErrors:function(n){if(n.Errors.length!=0){var t=new Sys.StringBuilder;for(i=0;i<n.Errors.length;i++)t.append(Web.DataView.formatMessage("Attention",n.Errors[i]));Web.DataView.showMessage(t.toString());t.clear()}},_busy:function(n){var f,c,b,a,s,y,p;if(n==null)return this._isBusy;if(this._isBusy=n,this._enableButtons(!n),!$app.isSaaS()){var u=this,i=$app.mobile,l=u._busyInterval,r=!i&&(u.get_isModal()||u.get_lookupField()!=null||!this._controller)||i!=null||this.get_useCase()=="$app",w=i?i.toolbar():r?document.body:u._container,o=$(w),h=$(u._container);if(i&&!i.toolbar().is(":visible")){i.wait(n);return}if(n&&!l){i||h.is(".dataview-loaded")||h.addClass("dataview-loading");!r;f=o.outerWidth()/5;f>200&&(f=200);var t=u._$busy=$(String.format('<div class="dataview-busy-indicator{0}"><\/div>',r?" modal":"")).css({position:i?"fixed":"absolute",width:f,"z-index":r?i?1e3:3e6:0}).appendTo(document.body),e=-f,v=r?0:t.height();t.hide();c=0;b=!1;this._busyInterval=setInterval(function(){var n,u;if(c!=null)if(c++>(i?35:75))c=null,a=!0;else return;e+=Math.ceil(f/30);a?(r&&$app._busyIndicator?(s=!0,t.hide()):($app._busyIndicator=!0,t.show()),a=!1):s&&!$app._busyIndicator&&(s=!1,$app._busyIndicator=!0,t.show());e>=0?(n=o.outerWidth(),e>=n-f&&e<n?t.width(n-e):e>=n&&(e=-f),s||(u=o.scrollTop(),t.position({my:"left top",at:String.format("left+{0} top{1}{2}",e,r?"+":"-",r?$(window).scrollTop():v),of:o}))):s||(t.width(f+e),t.position({my:"left top",at:String.format("left top{0}{1}",r?"+":"-",r?$(window).scrollTop():v),of:o}))},1e3/60)}else l&&(i||h.is(".dataview-loaded")||h.removeClass("dataview-loading").addClass("dataview-loaded"),clearInterval(l),u._busyInterval=null,t=u._$busy,t&&(y=t.offset(),p=o.offset(),u._$busy=null,t.width(o.outerWidth()-(y.left-p.left)),setTimeout(function(){t.remove();r&&($app._busyIndicator=!1)},500)))}},_enableButtons:function(n){if(!$app.mobile)var t=$("button",this._element).each(function(){$(this).toggleClass("disabled",!n)})},_bodyKeydown:function(n){var t=!1;this._customFilterField?n.keyCode==Sys.UI.Key.enter?(t=!0,this.applyCustomFilter()):n.keyCode==Sys.UI.Key.esc&&(t=!0,this.closeCustomFilter()):this.get_lookupField()&&n.keyCode==Sys.UI.Key.esc&&(t=!0,this.hideLookup());t&&(n.preventDefault(),n.stopPropagation())},_prepareJavaScriptExpressionEx:function(n){return n.replace(/\[((\w+)\.)?(\w+)\]/g,"this.fieldValue('$3','$2')")},_evaluateVisibility:function(){var n=this.get_visibleWhen();return String.isNullOrEmpty(n)?!0:(n=this._prepareJavaScriptExpressionEx(n),eval(n)!=!1)},_filterSourceSelected:function(n,t,i){var f,r,e,o,s,h,c,l,a,u;if(this._hidden=!this._evaluateVisibility(),f=this.readContext("vitals"),f){for(r=0;r<f.Filter.length;){var v=f.Filter[r],p=v.substring(0,v.indexOf(":")),y=!1;if(this._keyFields)for(e=0;e<this._keyFields.length;e++)if(this._keyFields[e].Name==p){y=!0;break}y?Array.removeAt(f.Filter,r):r++}this.writeContext("vitals",f)}for(o=[],r=0;r<this._externalFilter.length;r++)Array.add(o,this._externalFilter[r].Value),this._externalFilter[r].Value=null;for(s=!1,h=!1,Web.DataView.isInstanceOfType(n)?(String.isNullOrEmpty(this._transaction)||this.set_transaction(n.get_transaction()),this._populateExternalViewFilter(n),s=!n.get_showDetailsInListMode()&&n.get_isGrid(),n._forceChanged&&(h=!0)):this._externalFilter.length>0&&(this._externalFilter[0].Value=n.target.value),this.applyExternalFilter($app.mobile),c=!0,l=!1,r=0;r<this._externalFilter.length;r++)a=this._externalFilter[r].Value,a!=null&&(c=!1),a!=o[r]&&(l=!0);this.get_autoHide()!=Web.AutoHideMode.Nothing&&this._updateLayoutContainerVisibility(!c&&!s&&!this._hidden);(l||h)&&(i||this.set_pageIndex(-1),u=this._position,u&&(u.index=0,u.count=-1,u.key=[],u.keyFilter=[],u.filter=this.get_filter()),i||(this._selectedKey=[],this._selectedKeyFilter=[]),this._clearCache(),this.loadPage());this.raiseSelected();this.updateSummary()},_createExternalFilter:function(){var i,t,n;if(this._externalFilter=[],i=/(\w+)(,|$)/g,this.get_filterFields())for(t=this.get_filterFields().split(Web.DataView._simpleListRegex),n=0;n<t.length;n++)Array.add(this._externalFilter,{Name:t[n],Value:null})},_populateExternalViewFilter:function(n){var i,r,f,t,u;if(n._selectedKey&&n._keyFields&&n._selectedKey.length==n._keyFields.length)for(i=0;i<this._externalFilter.length;i++){for(r=this._externalFilter[i],f=!1,t=0;t<n._keyFields.length;t++)if(u=n._keyFields[t],r.Name==u.Name){r.Value=n.convertFieldValueToString(u,n._selectedKey[t]);f=!0;break}if(!f&&this.get_controller()!=n.get_controller())for(t=0;t<n._allFields.length;t++)if(u=n._allFields[t],r.Name==u.Name){r.Value=n.convertFieldValueToString(u,n.get_selectedRow()[n._allFields[t].Index]);f=!0;break}!f&&n._selectedKey.length>=i&&(r.Value=n._selectedKey[i])}},_cloneChangedRow:function(){var t,n,i;if(this.get_isEditing()){var r=this._collectFieldValues(),u=this.get_currentRow(),f=u?Array.clone(u):null,e=__designer();for(t=0;t<r.length;t++)n=r[t],i=this.findField(n.Name),i&&(f[i.Index]=e?n.Modified?n.NewValue:n.OldValue:n.NewValue);return f}return this.get_selectedRow()},_updateVisibility:function(n){var p,s,h,w,u,e,t,i,f,c,r,l,b,g,a,tt,o,it,y,d;if(this._expressions&&(this._readOnlyChanged=!1,p=this.get_isForm(),s=[],n||(n=this._cloneChangedRow()),n)){for(h=!1,w=!1,u=0;u<this._expressions.length;u++)e=s[0]=this._expressions[u],e.Type==Web.DynamicExpressionType.ClientScript&&(e.Scope==Web.DynamicExpressionScope.DataFieldVisibility?(t=this.findField(e.Target),t&&(i=this._get(p?"_ItemContainer":"Item",t.Index),i&&(f=this._evaluateJavaScriptExpressions(s,n,!1),p&&(c=Sys.UI.DomElement.getVisible(i),Sys.UI.DomElement.containsCssClass(i.parentNode,"FieldPlaceholder")?i=i.parentNode:Sys.UI.DomElement.containsCssClass(i.parentNode.parentNode,"FieldWrapper")&&(i=i.parentNode.parentNode.parentNode.parentNode),Sys.UI.DomElement.setVisible(i,f==!0),c!=f&&(h=!0))))):e.Scope==Web.DynamicExpressionScope.CategoryVisibility?(r=this.findCategory(e.Target),r&&(i=this._get("_Category",r.Index),i&&(r.IsVisible=this._evaluateJavaScriptExpressions(s,n,!1),f=r.IsVisible&&(String.isNullOrEmpty(r.Tab)||r.Tab==this._get_selectedTab()),c=Sys.UI.DomElement.getVisible(i),Sys.UI.DomElement.setVisible(i,f==!0),c!=f&&(h=!0),l=this._get("$CategoryDescription$",r.Index),l&&(b=this._processTemplatedText(n,r.Description),l.innerHTML=b,l.style.display=String.isNullOrEmpty(b)?"none":"block"),String.isNullOrEmpty(r.Tab)||(w=!0)))):e.Scope==Web.DynamicExpressionScope.ReadOnly&&(t=this.findField(e.Target),t&&(t.OriginalTextMode==null&&(t.OriginalTextMode=t.TextMode),g=t.isReadOnly(),f=this._evaluateJavaScriptExpressions(s,n,!1),t.TextMode=f==!0?4:t.OriginalTextMode,f!=g&&(h=!0,this._readOnlyChanged=!0))));if(w)for(u=0;u<this._tabs.length;u++){var rt=this._tabs[u],nt=!1,k=!1;for(a=0;a<this._categories.length;a++)if(r=this._categories[a],r.Tab==rt&&r.IsVisible!=null&&(nt=!0,k=r.IsVisible,k))break;nt&&Sys.UI.DomElement.setVisible(this._get("_Tab",u),k)}if(this._dynamicActionButtons&&(this._clonedRow=n,tt=this._get("$ActionButtons$","Top"),tt&&(o=new Sys.StringBuilder,this._internalRenderActionButtons(o,"Top",this._lastActionButtonsScope),this._newTopActionButtons=o.toString(),o.clear()),it=this._get("$ActionButtons$","Bottom"),it&&(o=new Sys.StringBuilder,this._internalRenderActionButtons(o,"Bottom",this._lastActionButtonsScope),this._newBottomActionButtons=o.toString(),o.clear()),y=this,setTimeout(function(){y._refreshActionButtons()},500),this._clonedRow=null),this._updateStatusBar(),h&&(this._adjustModalHeight(),this._modalPopup&&this._modalPopup.show(),_body_performResize()),this.get_isEditing()&&!this._lookupIsActive)for(d=this._get_focusedCell(),u=0;u<this._fields.length;u++)if(t=this._fields[u],!t.ReadOnly&&!t.Hidden&&t.AutoSelect&&t.ItemsStyle=="Lookup"&&(d==null||d.colIndex==t.ColIndex)&&(t.AutoSelect=!1,v=n[t.Index],v==null)){this._lookupIsActive=!0;y=this;setTimeout(function(){y.showLookup(t.Index)},100);break}}},_refreshActionButtons:function(){var t=this._get("$ActionButtons$","Top"),n;t&&this._newTopActionButtons&&(t.innerHTML=this._newTopActionButtons,this._newTopActionButtons=null);n=this._get("$ActionButtons$","Bottom");n&&this._newBottomActionButtons&&(n.innerHTML=this._newBottomActionButtons,this._newBottomActionButtons=null)},_updateDynamicValues:function(n){var t=this,r=!1,o=t._allFields,s=n&&n.Name?n.Name:n,f,i,h,e,u;if(n&&n.CausesCalculate){if(!t.get_isEditing())return t.refresh(),!0;t._raiseCalculate(n,n);r=!0}else for(f=0;f<o.length;f++)if(i=o[f],h=!String.isNullOrEmpty(i.ContextFields),h){for(e=/\s*(\w+)\s*(=\s*(\w+)\s*)?(,|$)/g,u=e.exec(i.ContextFields);u;){if(i.ItemsAreDynamic&&(n==null||u[3]==s)){if(!t.get_isEditing())return t.refresh(),!0;t._raisePopulateDynamicLookups();r=!0}else if(i.Calculated&&u[1]==s){if(!t.get_isEditing())return t.refresh(),!0;t._raiseCalculate(i,n);r=!0}if(r)break;u=e.exec(i.ContextFields)}if(r)break}return r},_valueFocused:function(n){var t=this._allFields[n];this._focusedFieldName=t.Name;Web.DataView._focusedDataViewId=this._id;Web.DataView._focusedItemIndex=n},_resetContextLookupValues:function(n){var t=[],i;return this._enumerateContextFieldValues(n,t,[]),i=t.length>0,i&&this.refresh(!0,t),i},_enumerateContextFieldValues:function(n,t,i){for(var r,f,s,e,h,c=n.Name,o=this._allFields,u=0;u<o.length;u++)if(r=o[u],f=r.ContextFields,!String.isNullOrEmpty(f)&&!i[u]&&!String.isNullOrEmpty(r.ItemsStyle))for(s=/\s*(\w+)\s*(=\s*(\w+)\s*)?(,|$)/g,e=s.exec(f);e;)e[1]==c&&(i[u]=!0,Array.add(t,{name:r.Name,value:null}),h=o[r.AliasIndex],h!=r&&Array.add(t,{name:h.Name,value:null}),r.DynamicItems=null,this._enumerateContextFieldValues(r,t,i)),e=s.exec(f)},_copyStaticLookupValues:function(n){var o,t,r,u,f,i;if(!String.isNullOrEmpty(n.Copy)&&(n.ItemsStyle=="RadioButtonList"||n.ItemsStyle=="ListBox"||n.ItemsStyle=="DropDownList")){for(o=this._collectFieldValues(),t=o[n.Index].NewValue,t!=null&&typeof t!="string"&&(t=t.toString()),r=null,u=0;u<n.Items.length;u++)if(f=n.Items[u],i=f[0],i!=null&&typeof i!="string"&&(i=i.toString()),i==t){r=f;break}if(r){for(var s=[],h=/(\w+)=(\w+)/g,c=2,e=h.exec(n.Copy);e;)Array.add(s,{name:e[1],value:r[c++]}),e=h.exec(n.Copy);return this.refresh(!0,s),!0}}return!1},_replaceFieldValue:function(n){for(var t,o,r=this._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,n.Name),i=0;i<r.length;i++){t=r[i];try{if(t.Result.match(/\$(\d|\'\`)/)){var s=this._collectFieldValues(),u=s[n.Index],f=u.NewValue?u.NewValue.toString():null,h=new RegExp(t.Test),e=f.replace(h,t.Result);e!=f&&(o=[{name:n.Name,value:e}],this.refresh(!0,o))}}catch(c){}}},_valueChanged:function(n){var i=this._allFields[n],t;this._showFieldError(i,null);this._skipErrorReset=!1;t=this;setTimeout(function(){Web.DataView._navigated||t._performValueChanged(n,!0)},200)},_performValueChanged:function(n,t){var i=this._allFields[n],r,u,f;if(i){if(this._skipErrorReset){this._skipErrorReset=!1;return}return this._showFieldError(i,null),this._replaceFieldValue(i),r=this._resetContextLookupValues(i),u=this._copyStaticLookupValues(i),this._updateVisibility(),f=this._updateDynamicValues(i),t&&this._readOnlyChanged&&this.get_isEditing()&&(this.refresh(!0),this._focus()),u||f||r||this._readOnlyChanged}},_quickFind_focus:function(){var n=this.get_quickFindElement();n.value==Web.DataViewResources.Grid.QuickFindText&&(n.value="");Sys.UI.DomElement.removeCssClass(n,"Empty");Sys.UI.DomElement.removeCssClass(n,"NonEmpty");n.select();this._lostFocus=!0},_quickFind_blur:function(){var n=this.get_quickFindElement();String.isBlank(n.value)?(n.value=Web.DataViewResources.Grid.QuickFindText,Sys.UI.DomElement.addCssClass(n,"Empty")):Sys.UI.DomElement.addCssClass(n,"NonEmpty");this._lostFocus=!1},_executeQuickFind:function(n){var t,i;for(this._forceSync(),t=0;t<this._allFields.length;t++)this._allFields[t]._listOfValues=null;for(this.removeQuickFind(),t=0;t<this._allFields.length;t++)if(i=this._allFields[t],!i.Hidden){i=this._allFields[i.AliasIndex];String.isNullOrEmpty(n)?this.refreshData():this.applyFilter(i,"~",n);break}},quickFind:function(n){var t=(String.isNullOrEmpty(n)?this.get_quickFindElement().value:n).match(/^\s*(.*?)\s*$/),i=t[1]==Web.DataViewResources.Grid.QuickFindText?"":t[1];this.set_quickFindText(i);this._executeQuickFind(i);this._lostFocus=!1},_quickFind_keydown:function(n){if(n.keyCode==Sys.UI.Key.enter)n.preventDefault(),n.stopPropagation(),this.quickFind();else if(n.keyCode==Sys.UI.Key.down)return},encodePermalink:function(n,t,i){Sys.Net.WebServiceProxy.invoke(this.get_servicePath(),"EncodePermalink",!1,{link:n,rooted:!1},Function.createDelegate(this,this._encodePermalink_Success),Function.createDelegate(this,this._onMethodFailed),{target:t,features:i})},_encodePermalink_Success:function(n,t){t.target||t.features?open(n,t.target,t.features):location.href=n},showViewMessage:function(n){var r=this._get("$HeaderText"),i,t;r!=null&&n&&(i=String.format('<div class="MsgBox">{1} <a href="javascript:" onclick="$find(\'{0}\').hideViewMessage();return false;" class="Close" title="{2}">&nbsp;<\/a><\/div>',this.get_id(),n,Web.DataViewResources.ModalPopup.Close),t=this.get_view(),t.OriginalHeaderText||(t.OriginalHeaderText=t.HeaderText),t.HeaderText=i,r.innerHTML=i,this._viewMessages||(this._viewMessages={}),this._viewMessages[t.Id]=n)},hideViewMessage:function(){var i=this._get("$HeaderText"),t,n;if(i!=null){if(t=this.get_view(),n=t.OriginalHeaderText,!n)return;t.HeaderText=n;i.innerHTML=this._formatViewText(Web.DataViewResources.Views.DefaultDescriptions[n],!0,n);this._viewMessages[t.Id]=null}}};Web.DataView.registerClass("Web.DataView",Sys.UI.Behavior);Web.AutoComplete=function(n){Web.AutoComplete.initializeBase(this,[n])};Web.AutoComplete.prototype={initialize:function(){Web.AutoComplete.callBaseMethod(this,"initialize");this._textBoxMouseOverHandler=Function.createDelegate(this,this._onTextBoxMouseOver);this._textBoxMouseOutHandler=Function.createDelegate(this,this._onTextBoxMouseOut);this._completionListItemCssClass="Item";this._highlightedItemCssClass="HighlightedItem"},dispose:function(){this._viewPage=null;this._element&&($removeHandler(this._element,"mouseover",this._textBoxMouseOverHandler),$removeHandler(this._element,"mouseout",this._textBoxMouseOutHandler));Web.AutoComplete.callBaseMethod(this,"dispose")},get_fieldName:function(){return this._fieldName},set_fieldName:function(n){this._fieldName=n},updated:function(){var n=document.createElement("div");n.className="AutoCompleteFrame "+this.get_typeCssClass();n.innerHTML=String.format('<table><tr><td class="Input"><\/td><td class="Clear" style="{2}"><span class="Clear" onclick="var e=this.parentNode.parentNode.getElementsByTagName(\'input\')[0];e.value=\'\';e.focus()" title="{1}">&nbsp;<\/span><\/td><td class="Button" onmouseover="if(!Sys.UI.DomElement.containsCssClass(this.parentNode, \'Active\'))$find(\'{0}\')._showDropDown(true)" onmouseout="$find(\'{0}\')._showDropDown(false)"><span class="Button" onclick="$find(\'{0}\')._showFullList();">&nbsp;<\/span><\/td><\/tr><\/table>',this.get_id(),Web.DataViewResources.Data.Filters.Labels.Clear,this.get_contextKey().match(/^(SearchBar|Filter)\:/)!=null?"":"display:none");this._element.setAttribute("autocomplete","off");this._element.parentNode.insertBefore(n,this._element);n.getElementsByTagName("td")[0].appendChild(this._element);Sys.Browser.agent==Sys.Browser.WebKit&&(n.style.marginLeft="2px");this._completionSetCount==10&&(this._completionSetCount=100);$addHandler(this._element,"mouseover",this._textBoxMouseOverHandler);$addHandler(this._element,"mouseout",this._textBoxMouseOutHandler);Web.AutoComplete.callBaseMethod(this,"updated");document.body.appendChild(this._completionListElement);this._completionListElement.className="CompletionList AutoComplete";this._completionListElement.style.display="none"},_showCachedFullList:function(){this._update("%",this._cache["%"],!1)},_showFullList:function(){var t,i,n;if(!this._webRequest&&(t=this._popupBehavior.get_visible(),this._hideCompletionList(),this._element.focus(),!t)){if(this._completionWord="%",this._cache&&this._cache["%"]){i=this;setTimeout(function(){i._showCachedFullList()},50);return}n={prefixText:this._completionWord,count:this._completionSetCount};this._useContextKey&&(n.contextKey=this._contextKey);this._ignoreCompletionWord=!0;this._invoke(n,this._completionWord)}},_showDropDown:function(n){for(var t=this._element;t.tagName!="TR";)t=t.parentNode;n?Sys.UI.DomElement.addCssClass(t,"Active"):this._textBoxHasFocus?Sys.UI.DomElement.addCssClass(t,"Active"):Sys.UI.DomElement.removeCssClass(t,"Active")},_onKeyDown:function(n){var i,t;n.keyCode==Sys.UI.Key.down&&n.altKey&&(n.preventDefault(),n.stopPropagation(),this._showFullList());i=this._popupBehavior._visible;Web.AutoComplete.callBaseMethod(this,"_onKeyDown",[n]);(n.keyCode==Sys.UI.Key.enter||n.keyCode==Sys.UI.Key.esc)&&(t=this._get_fieldDataView(!0),t&&(t.get_isDataSheet()&&i?(n.preventDefault(),n.stopPropagation()):t.get_searchBarIsVisible()&&(n.preventDefault(),n.stopPropagation(),i||setTimeout(function(){t._performSearch()},100))))},_update:function(n,t,i){var r,u,f,e;if(Web.AutoComplete.callBaseMethod(this,"_update",[n,t,i]),t){for(r=-1,u=this._currentCompletionWord().toLowerCase(),f=0;f<t.length;f++)if(e=t[f],e!=null&&(e=e.toLowerCase(),r==-1&&e.startsWith(u)&&(r=f),e==u)){r=f;break}r>=0&&r<this._completionListElement.childNodes.length&&(this._selectIndex=r,u=this._completionListElement.childNodes[r],this._highlightItem(u),this._handleScroll(u,r+5))}},_get_fieldDataView:function(n){var i=null,t=this._get_contextInfo();return t&&(t.type=="Field"||n&&t.type=="SearchBar")&&(i=Web.DataView.find(t.controller)),i},_setText:function(n){var u,h,t,o,v,c,r;if(Web.AutoComplete.callBaseMethod(this,"_setText",[n]),this._updateClearButton(),u=this._get_fieldDataView(),u){var f=u.findField(this.get_fieldName()),l=this.get_element().value,e=[];if(l!=Web.DataViewResources.Data.NullValueInForms&&(h=this._enumerateViewPageItems(l),h!=-1)){var i=this._viewPage,a=i.Rows[h],s=[];for(t=0;t<i.Fields.length;t++)o=i.Fields[t],o.Name==f.ItemsDataValueField&&Array.add(s,o);if(s.length==0)for(t=0;t<i.Fields.length;t++)if(o=i.Fields[t],o.IsPrimaryKey){Array.add(s,o);break}for(t=0;t<s.length;t++)v=a[s[0].Index],Array.add(e,v)}if($get(u.get_id()+"_Item"+f.Index).value=e.toString(),this._originalElementText=this.get_element().value,this._get_isInLookupMode()){if(!String.isNullOrEmpty(f.Copy)){for(e=[],c=/(\w+)=(\w+)/g,r=c.exec(f.Copy);r;){if(r[2]=="null")Array.add(e,{name:r[1],value:null});else for(t=0;t<i.Fields.length;t++)i.Fields[t].Name==r[2]&&Array.add(e,{name:r[1],value:a[t]});r=c.exec(f.Copy)}u.refresh(!0,e)}u._valueChanged(f.Index)}}},_get_isInLookupMode:function(){var n=this._get_contextInfo();return n!=null&&n.type=="Field"},_updateClearButton:function(){var n=this._element.parentNode.parentNode;String.isBlank(this._element.value)?Sys.UI.DomElement.removeCssClass(n,"Filtered"):Sys.UI.DomElement.addCssClass(n,"Filtered")},_onGotFocus:function(n){if(Web.AutoComplete.callBaseMethod(this,"_onGotFocus",[n]),this._showDropDown(!0),this._updateClearButton(),this._get_isInLookupMode()){var t=this.get_element();this._originalElementText=t.value;this._originalElementText==Web.DataViewResources.Data.NullValueInForms&&(t.value="",t.select())}},_onLostFocus:function(n){Web.AutoComplete.callBaseMethod(this,"_onLostFocus",[n]);this._showDropDown(!1);this._updateClearButton();this._get_isInLookupMode()&&this._originalElementText!=null&&(this.get_element().value=this._originalElementText)},_onTextBoxMouseOver:function(){this._showDropDown(!0)},_onTextBoxMouseOut:function(){this._showDropDown(!1)},_currentCompletionWord:function(){if(this._completionWord){var n=this._completionWord;return this._completionWord=null,n}return Web.AutoComplete.callBaseMethod(this,"_currentCompletionWord")},_onTimerTick:function(n,t){var i,r;if(this._timer.set_enabled(!1),this._servicePath&&this._serviceMethod){if(i=this._currentCompletionWord(),i.trim().length<this._minimumPrefixLength){this._currentPrefix=null;this._update("",null,!1);return}if(this._currentPrefix!==i||i==""&&this._minimumPrefixLength==0){if(this._currentPrefix=i,i!=""&&this._cache&&this._cache[i]){this._update(i,this._cache[i],!1);return}if(t=new Sys.CancelEventArgs,this.raisePopulating(t),t.get_cancel())return;r={prefixText:this._currentPrefix,count:this._completionSetCount};this._useContextKey&&(r.contextKey=this._contextKey);this._webRequest&&(this._webRequest.get_executor().abort(),this._webRequest=null);this._invoke(r,i);$common.updateFormToRefreshATDeviceBuffer()}}},_get_contextInfo:function(){var n=this.get_contextKey().match(/^(\w+)\:(\w+),(\w+)$/);return n?{type:n[1],controller:n[2],fieldName:n[3]}:null},_invoke:function(n,t){var u=this,e=u._get_contextInfo(),f,s,w,r,h,y;if(e){var i=Web.DataView.find(e.controller),o=[],a=e.fieldName,p="beginswith";if(e.type=="SearchBar"?o=i._createSearchBarFilter(!0):e.type=="Filter"?o=i.get_filter():(f=i.findField(this.get_fieldName()),a=String.isNullOrEmpty(f.ItemsDataTextField)?f.Name:f.ItemsDataTextField),!this._ignoreCompletionWord){for(s=0;s<o.length;s++)if(w=o[s].match(/^(\w+):/),w[1]==e.fieldName){Array.removeAt(o,s);break}f||(f=i.findField(a));f&&f.AutoCompleteAnywhere&&(p="contains");Array.add(o,String.format('{0}:${1}${2}\0',a,p,this._currentCompletionWord()))}var v=null,c=null,l=null;if(e.type=="Field"){for(c=f.ItemsDataController,l=f.ItemsDataView,r={FieldName:f.Name,Controller:i.get_controller(),View:i.get_viewId()},h=i.get_contextFilter(f),s=0;s<h.length;s++)y=h[s],Array.add(o,String.format('{0}:={1}\0',y.Name,y.Value));v={PageIndex:0,RequiresMetaData:!0,RequiresRowCount:!1,PageSize:300,SortExpression:f.ItemsDataTextField,Filter:o,ContextKey:i.get_id(),Cookie:i.get_cookie(),FilterIsExternal:h.length>0,Transaction:i.get_transaction(),LookupContextFieldName:r?r.FieldName:null,LookupContextController:r?r.Controller:null,LookupContextView:r?r.View:null,LookupContext:r,View:i.get_viewId(),Tag:i.get_tag(),ExternalFilter:h}}else c=i.get_controller(),l=i.get_viewId(),v={FieldName:e.fieldName,Filter:o,LookupContextFieldName:r?r.FieldName:null,LookupContextController:r?r.Controller:null,LookupContextView:r?r.View:null,AllowFieldInFilter:this._ignoreCompletionWord!=!0,Controller:c,View:l,Tag:i.get_tag(),ExternalFilter:i.get_externalFilter()};i._busy(!0);u._webRequest=i._invoke(u.get_serviceMethod(),{controller:c,view:l,request:v},function(n,t){e.type=="Field"?(i._busy(!1),u._onGetPageComplete(n,t)):(i._busy(!1),u._onGetListOfValuesComplete(n,t))},t);u._ignoreCompletionWord=!1}else u._webRequest=Sys.Net.WebServiceProxy.invoke(u.get_servicePath(),u.get_serviceMethod(),!1,n,Function.createDelegate(u,u._onMethodComplete),Function.createDelegate(u,u._onMethodFailed),t)},_onGetListOfValuesComplete:function(n,t){n.length>0&&n[0]==null&&(n[0]=Web.DataViewResources.HeaderFilter.EmptyValue);this._webRequest=null;this._update(t,n,!0)},_onGetPageComplete:function(n,t){if(this._element){this._viewPage=n;var i=this._enumerateViewPageItems();this._onGetListOfValuesComplete(i,t)}},_enumerateViewPageItems:function(n){for(var i,f,e,r=this._viewPage,s=this._get_fieldDataView(),o=s.findField(this.get_fieldName()),u=[],t=0;t<r.Fields.length;t++)i=r.Fields[t],i.Index=t,i.Name==o.ItemsDataTextField&&Array.add(u,i);if(u.length==0)for(t=0;t<r.Fields.length;t++)if(i=r.Fields[t],!i.Hidden&&i.Type=="String"){Array.add(u,i);break}if(u.length==0)for(t=0;t<r.Fields.length;t++)if(i=r.Fields[t],!i.Hidden){Array.add(i);break}for(f=[],o.AllowNulls&&Array.add(f,Web.DataViewResources.Data.NullValueInForms),t=0;t<r.Rows.length;t++)if(e=r.Rows[t][u[0].Index],n!=null){if(e==n)return t}else Array.add(f,e);return n!=null?-1:f},get_typeCssClass:function(){return this._typeCssClass},set_typeCssClass:function(n){this._typeCssClass=n}};Web.DataView.hideMessage=function(){Web.DataView.showMessage()};Web.DataView.formatMessage=function(n,t){return String.format('<table cellpadding="0" cellspacing="0" ><tr><td class="{0}" valign="top">&nbsp;<\/td><td class="Message">{1}<\/td><\/tr><\/table>',n,t)};Web.DataView.showMessage=function(n){var i,s,t,r,e,o,u,f;String.isBlank(n)&&(n=null);i=document.getElementsByTagName("body")[0];s=!1;Web.DataView.MessageBar||(t=document.createElement("div"),t.id="DataView_MessageBar",i.appendChild(t),Sys.UI.DomElement.setVisible(t,!1),Sys.UI.DomElement.addCssClass(t,"MessageBar"),Web.DataView.MessageBar=$create(AjaxControlToolkit.AlwaysVisibleControlBehavior,{VerticalOffset:AjaxControlToolkit.VerticalSide.Top},null,null,t),r=Sys.UI.DomElement.getBounds(i),r.y<0&&(r.y=0),Web.DataView.OriginalBodyTopOffset=r.y);t=$get("DataView_MessageBar");e=Sys.UI.DomElement.getVisible(t);t.innerHTML=n?String.format('<div>{0}<\/div><div class="Stub"><\/div>',n):"";Sys.UI.DomElement.setVisible(t,n!=null);o=Sys.UI.DomElement.getBounds(t);u=n?Web.DataView.OriginalBodyTopOffset+o.height:Web.DataView.OriginalBodyTopOffset;i.style.paddingTop=u+"px";f=$get("Membership_Login");f&&(f.style.marginTop=u+"px");Sys.UI.DomElement.getVisible(t)!=e&&_body_performResize()};Web.DataView._tagsWithIndexes=["A","AREA","BUTTON","INPUT","OBJECT","SELECT","TEXTAREA","IFRAME"];Web.DataView._delayedLoadingViews=[];Web.DataView._performDelayedLoading=function(){for(var t=0,n;t<Web.DataView._delayedLoadingViews.length;)n=Web.DataView._delayedLoadingViews[t],n.get_isDisplayed()?(Array.remove(Web.DataView._delayedLoadingViews,n),n._delayedLoading&&n._loadPage()):t++};Web.DataView.unanchor=function(n){var t=n.match(/^(.+?)#.*$/);return t?t[1]:n};Web.DataView.execute=function(n){function i(){t.dispose();u.remove()}function r(){t._busy(!1)}var u=$("<div/>").appendTo($("body")).hide(),t=$create(Web.DataView,{controller:n.controller,viewId:n.view||"grid1",servicePath:__servicePath,baseUrl:__baseUrl,useCase:"$app"},null,null,u.get(0));t._onGetPageComplete=function(u){r();var f={totalRowCount:u.TotalRowCount,pageIndex:u.PageIndex,pageSize:u.PageSize},o=f[n.controller]=[],e=n.format;e&&$(u.Fields).each(function(){var n=this;_field_prepareDataFormatString(t,n);n.format=_field_format});$(u.Rows).each(function(){var t=this,n={};o.push(n);$(u.Fields).each(function(i){var r=this,u=t[i];e&&r.DataFormatString&&r.FormatOnClient&&(u=r.format(u));n[r.Name]=u})});n.success&&n.success(f);i()};t._onMethodFailed=function(t,u){r();n.error&&n.error(t,u);i()};t._pendingExecuteComplete={};t._onExecuteComplete=function(t){if(r(),n.success){var u=t?{rowsAffected:t.RowsAffected,canceled:t.Canceled,clientScript:t.ClientScript,navigateUrl:t.NavigateUrl,errors:t.Errors}:{},f=u[n.controller]={};$(n.values).each(function(){var n=this;f[n.name]=typeof n.newValue=="undefined"?typeof n.oldValue=="undefined"?n.value:n.oldValue:n.newValue});t&&$(t.Values).each(function(){f[this.Name]=this.Value});n.success(u)}i()};t._collectFieldValues=function(){var t=[];return $(n.values).each(function(){var n=this;t.push({Name:n.name||n.field,NewValue:typeof n.newValue=="undefined"?typeof n.oldValue=="undefined"?n.value:n.oldValue:n.newValue,OldValue:typeof n.oldValue=="undefined"?n.value:n.oldValue,Modified:n.modified==!0,ReadOnly:n.readOnly==!0})}),t};t._validateFieldValues=function(){return!0};n.pageIndex!=null&&(t._pageIndex=n.pageIndex);n.pageSize!=null&&(t._pageSize=n.pageSize);n.selectedValues&&(t.SelectedValues=n.selectedValues);n._init=!0;t.search(n);t._filterDetailsText=n.filterDetails;n.command||(n.command="Select");n.command=="Select"?t._loadPage():t.executeCommand({commandName:n.command,commandArgument:n.argument||"",causesValidation:!1})};Web.DataView.find=function(n,t){for(var i,f="_"+n,u=Sys.Application.getComponents(),r=0;r<u.length;r++)if(i=u[r],t){if(Web.DataView.isInstanceOfType(i)&&(t=="Controller"&&i._controller==n||t=="Tag"&&i.get_isTagged(n)))return i}else if(i._id==n||Web.DataView.isInstanceOfType(i)&&i._id.endsWith(f))return i;return null};Web.DataView.confirm=function(n,t,i){window.confirm(n)?t&&t():i&&i()};Web.DataView.alert=function(n,t){window.alert(n);t&&t()};Web.DataView.showModal=function(n,t,i,r,u,f,e,o,s){var w=Web.DataView.isInstanceOfType(n),c=n,v=$app.mobile,y,l,h,p;if(!$app.mobile){if(w&&n._container&&(c=n._container.getElementsByTagName("a")[0]),!c)for(y=document.getElementsByTagName("a","input","button"),l=y.length-1;l>=0;l--)if(y[l].tabIndex>=0){c=y[l];break}if(c==null){alert("Cannot find an anchor for a modal popup.");return}Web.HoverMonitor._instance.close()}v&&v.modalDataView();f||(f=Web.DataView._baseUrl);e||(e=Web.DataView._servicePath);var a=this._placeholder=document.createElement("div"),k=Sys.Application.getComponents().length,b=t.toLowerCase();return $find(b)&&(b+=k),a.id=String.format("{0}_{1}_Placeholder{2}",t,i,k),w?n._appendModalPanel(a):document.body.appendChild(a),a.className="ModalPlaceholder FixedDialog EmptyModalDialog",h={id:b,baseUrl:f,servicePath:e,controller:t,viewId:i,showActionBar:!1,modalAnchor:c,startCommandName:r,startCommandArgument:u,exitModalStateCommands:["Cancel"],externalFilter:o},s&&(s.useCase||(s.useCase=$app._defaultUseCase,$app._defaultUseCase=null),h.filter=s.filter,h.ditto=s.ditto,h.lastViewId=s.lastViewId,h.transaction=s.transaction,h.filterSource=s.filterSource,h.filterFields=s.filterFields,h.confirmContext=s.confirmContext,h.showSearchBar=s.showSearchBar,h.useCase=s.useCase,h.tag=s.tag,h.showActionButtons=s.showActionButtons),p=$create(Web.DataView,h,null,null,a),w&&(p._parentDataViewId=n.get_id(),p._hasDetails=n._hasDetails),v&&setTimeout(function(){v.modalDataView(h.id)},0),p};Web.DataView.alert=function(n,t){alert(n);t&&t()};Web.DataView.isSaaS=function(){var n=this;return n._isSaaS==null&&(n._isSaaS=!1,$("script").each(function(){this.src.match(/\/factory(.*?)\.js/)&&(n._isSaaS=!0)})),n._isSaaS};Web.DataView._resizeInterval=null;Web.DataView._resizing=!1;Web.DataView._resized=!1;Web.DataView._customInputElements=[];var $appfactory=Web.DataView,$app=$appfactory;$app.contentFrameworks={bootstrap:{hasSelectors:[{name:"navbar-fixed-top",selector:".navbar-fixed-top"},{name:"navbar-fixed-bottom",selector:".navbar-fixed-bottom"},{name:"navbar-static-top",selector:".navbar-static-top"},{name:"footer",selector:"footer"}],footer:{container:"> .container:last",selector:"footer,.footer",html:"<footer/>"},fixedTop:{selector:".navbar-fixed-top"},fixedBottom:{selector:".navbar-fixed-bottom"}}};$app._invoke=function(n,t,i){var r=$("<div/>").appendTo($("body")).hide(),u=$create(Web.DataView,{servicePath:__servicePath,baseUrl:__baseUrl,useCase:"$app"},null,null,r.get(0));u._invoke(n,t,function(n){i&&i(n);u.dispose();r.remove()},null)};$app.callWithFeedback=function(n,t){$app.mobile?$app.mobile.callWithFeedback(n,t):t()};$app.userName=function(){return __settings.appInfo.split("|")[1]};$app.loggedIn=function(){return!!$app.userName()};$app.login=function(n,t,i,r,u){$app._invoke("Login",{username:n,password:t,createPersistentCookie:i},function(n){n?r&&r():u&&u()})};$app.logout=function(n){$app._invoke("Logout",{},function(){n&&n()})};$app.roles=function(n){$app._invoke("Roles",{},function(t){n&&n(t)})};$app.configureFramework=function(n,t,i){$($app.contentFrameworks[n]).each(function(){var n=this;$(n.hasSelectors).each(function(){t.find(this.selector).length&&t.addClass("has-"+this.name)});n.footer&&!t.find(n.footer.container).find(n.footer.selector).length&&$(n.footer.html).appendTo(t.find(n.footer.container)).append($("#PageFooterBar").html());i&&i(n)})};Web.DataView.borderBox=function(n){var t=$(n);return{horizontal:t.outerWidth()-t.innerWidth(),vertical:t.outerHeight()-t.innerHeight()}};Web.DataView.paddingBox=function(n){var t=$(n);return{horizontal:t.innerWidth()-t.width(),vertical:t.innerHeight()-t.height()}};Web.DataView.marginBox=function(n){var t=$(n);return{horizontal:t.outerWidth(!0)-t.outerWidth(),vertical:t.outerHeight(!0)-t.outerHeight()}};Web.DataView.bounds=function(n){var t=$(n),i=t.offset();return{x:i.left,y:i.top,width:t.outerWidth(),height:t.outerHeight()}};Web.DataView.scrolling=function(){var n=$(window);return{x:n.scrollLeft(),y:n.scrollTop()}};Web.DataView.clientBounds=function(){var n=$(window);return{width:n.width(),height:n.height()}};Web.DataView._activate=function(n,t,i){var a=new RegExp("^\\s*"+i+"\\s*\\|"),r=$get(t),f,e,u,s,o,h;if(i=="SideBarTask"){for(f=r;f&&String.isNullOrEmpty(this.prototype.dataAttr(f,"flow"));)f=f.parentNode;for(e=f.getElementsByTagName("div"),u=0;u<e.length;u++)s=this.prototype.dataAttr(e[u],"activator"),!String.isNullOrEmpty(s)&&a.exec(s)&&$(e[u]).hide()}if(Sys.UI.DomElement.setVisible(r,i=="SideBarTask"?!0:!Sys.UI.DomElement.getVisible(r)),r._activated=!0,i=="SiteAction"&&r.childNodes[0].className!="CloseSiteAction"&&(o=document.createElement("div"),o.className="CloseSiteAction",o.innerHTML=String.format("<a href=\"javascript:\" onclick=\"Web.DataView._activate(null,'{0}','SiteAction')\">{1}<\/a>",t,Web.DataViewResources.ModalPopup.Close),r.insertBefore(o,r.childNodes[0])),Sys.UI.DomElement.getVisible(r)){var c=$common.getBounds(r),v=$common.getClientBounds(),l=$app.scrolling();(c.y<l.y||c.y>l.y+v.height)&&r.scrollIntoView(!1)}if(n){while(n&&!Sys.UI.DomElement.containsCssClass(n,"Task"))n=n.parentNode;for(u=0;u<n.parentNode.childNodes.length;u++)h=n.parentNode.childNodes[u],h.className&&Sys.UI.DomElement.removeCssClass(h,"Selected");Sys.UI.DomElement.addCssClass(n,"Selected")}_body_performResize()};Web.DataView._partialUpdateBeginRequest=function(n,t){for(var i,f,s,e=t.get_request(),o=Sys.Application.getComponents(),r=[],u=0;u<o.length;u++)i=o[u],i._controller&&i._viewId&&Web.DataView.isInstanceOfType(i)&&(f=i.get_tag(),String.isNullOrEmpty(f)||(Array.add(r,f),Array.add(r,i.get_selectedKey())));s=Sys.Serialization.JavaScriptSerializer.serialize(r);e.set_body(e.get_body()+"&"+encodeURIComponent("__WEB_DATAVIEWSTATE")+"="+encodeURIComponent(s))};Web.DataView._load=function(){var s,t,u,it,e,i,h,rt,n,y,p,c,w,l,ut,b,a,ft,v,et,ot;if(!Web.DataView._loaded){Sys.WebForms&&Sys.WebForms.PageRequestManager._instance&&Sys.WebForms.PageRequestManager._instance.add_beginRequest(Web.DataView._partialUpdateBeginRequest);Web.DataView._loaded=!0;updateACT();typeof __baseUrl=="undefined"&&(__baseUrl="../");$("#PageHeaderSideBar .PageLogo").attr("src",__baseUrl+"app_themes/_shared/placeholder.gif");Web.DataView.supportsPlaceholder="placeholder"in document.createElement("input");var k=$get("PageContent"),st,ht=[],ct=$("body");if(k){for(ct.find('div[data-app-role="page"]').each(function(){$(this).attr("data-content-framework")&&ht.push($(this).attr("id"))}).each(function(){var n=$(this),f=n.attr("id"),i=location.search.match(/_hash=(\w+)/),r=n.attr("data-content-framework"),u,t;if(r&&!st&&(!i||i[1]==f)){t=$(k).closest("table");n.insertAfter(t);ct.addClass("app-sidebar-undocked").addClass("app-theme-"+__settings.theme.toLowerCase());st=!0;u=n.find("> div").addClass("app-bootstrap app-content-desktop");$app.configureFramework(r,u);n.css({position:"absolute",top:t.offset().top,width:"100%"});t.hide();n.find("a").each(function(){var i=$(this),n=i.attr("href"),t=n&&n.startsWith("#")&&n.length>1&&n.substring(1);t&&Array.indexOf(ht,t)!=-1&&i.attr("href","?_hash="+t)});$("#PageFooterBar").hide();return}n.remove()}),s=document.body.getElementsByTagName("div"),t=0;t<s.length;t++)if(s[t].className.match(/Loading/)){Sys.UI.DomElement.removeCssClass(s[t],"Loading");break}s=k.getElementsByTagName("div");var f=[],d=0,lt=!1,g=!1,o=null,nt=[];for(Web.DataView._numberOfContainers=0,u=Web.DataView.prototype.dataAttr,t=0;t<s.length;t++){var r=s[t],tt=u(r,"width"),at=u(r,"flow");if(!String.isNullOrEmpty(tt)||!String.isNullOrEmpty(at)){if($(r).find("div[data-flow]").length)continue;for(at!="NewColumn"&&(r.style.clear="left",d++),String.isNullOrEmpty(r.id)&&(r.id="_lc"+f.length),Sys.UI.DomElement.addCssClass(r,"LayoutContainer"),Web.DataView._numberOfContainers++,tt!="100%"&&(r.style.overflow="hidden"),Array.add(f,{id:r.id,width:tt,rowIndex:d,peersWithoutWidth:0}),it=r.getElementsByTagName("div"),e=[],i=0;i<it.length;i++)h=it[i],rt=u(h,"activator"),String.isNullOrEmpty(rt)||(h.id=String.isNullOrEmpty(h.id)?r.id+"$a"+i:h.id,n={elem:h,activator:rt.split("|"),id:h.id},n.activator[0]=n.activator[0].trim(),n.activator.length==1&&(n.activator[1]=i.toString()),Array.add(e,n));for(i=1;i<e.length;){for(n=e[i],y=0;y<i;y++)if(p=e[y],p.activator[0]==n.activator[0]&p.activator[1]==n.activator[1]){while(n.elem.childNodes.length>0)p.elem.appendChild(n.elem.childNodes[0]);delete n.elem;Array.removeAt(e,i);n=null;break}n&&i++}if(e.length>0){for(lt=!0,c=[],w=!0,i=0;i<e.length;i++)n=e[i],n.activator[0]=="Tab"?(c.length==0&&(l=document.createElement("div"),l.className="TabBar",r.insertBefore(l,n.elem)),ut={title:n.activator[1],elementId:n.id,selected:c.length==0,description:u(n.elem,"description"),hidden:u(n.elem,"hidden")},Array.add(c,ut),Sys.UI.DomElement.setVisible(n.elem,ut.selected),n.elem._activated=!0,Sys.UI.DomElement.addCssClass(n.elem,"TabBody TabContainer")):n.activator[0]=="SideBarTask"?(o||(o=new Sys.StringBuilder,o.appendFormat('<div class="TaskBox TaskList"><div class="Inner"><div class="Header">{0}<\/div>',Web.DataViewResources.Menu.Tasks)),n.elem._activated=w,w&&(w=!1),Sys.UI.DomElement.setVisible(n.elem,n.elem._activated),o.appendFormat("<div class=\"Task{1}\"{4}><a href=\"javascript:\" onclick=\"Web.DataView._activate(this,'{2}','SideBarTask');return false;\" title='{3}'>{0}<\/a><\/div>",n.activator[1],g?"":" Selected",n.id,Web.DataView.htmlAttributeEncode(u(n.elem,"description")),u(n.elem,"hidden")=="true"?' style="display:none"':""),g=!0):n.activator[0]=="SiteAction"&&Web.Menu.get_siteActionsFamily()?(b=new Web.Item(Web.Menu.get_siteActionsFamily(),n.activator[1],u(n.elem,"description")),b.set_cssClass(u(n.elem,"cssClass")),b.set_script('Web.DataView._activate(null,"{0}","SiteAction")',n.id),Array.add(nt,b),Sys.UI.DomElement.setVisible(n.elem,!1)):Sys.UI.DomElement.setVisible(n.elem,!1),n.elem=null;c.length>0&&($create(Web.Menu,{id:r.id+"$ActivatorMenu",nodes:c},null,null,l),c.length<2&&t==0&&Sys.UI.DomElement.addCssClass(l,"EmptyTabBar"))}}}for(lt&&Web.DataView._performDelayedLoading(),g&&o&&(a=$getSideBar(),a&&(o.append("<\/div><\/div>"),ft=document.createElement("div"),ft.innerHTML=o.toString(),o.clear(),a.insertBefore(ft,a.childNodes[0]),a._hasActivators=!0)),nt.length>0&&Web.Menu.set_siteActions(nt),v=d;f.length>0&&v>=f[0].rowIndex;){for(et=0,ot=0,t=0;t<f.length;t++)lc=f[t],lc.rowIndex==v&&(ot++,String.isNullOrEmpty(lc.width)&&et++);for(t=0;t<f.length;t++)lc=f[t],lc.rowIndex==v&&(lc.peersWithoutWidth=et,ot==1&&String.isNullOrEmpty(lc.width)&&(lc.width="100%"));v--}Web.DataView._layoutContainers=f;_body_performResize();$addHandler(window,"resize",_body_resize);$addHandler(window,"scroll",_body_scroll)}Web.DataView._startDelayedLoading();$addHandler(document.body,"keydown",_body_keydown)}};Web.DataView._unload=function(){this._state&&(Array.clear(this._state),delete this._state);Web.DataView._delayedLoadingTimer&&(clearInterval(Web.DataView._delayedLoadingTimer),Array.clear(Web.DataView._delayedLoadingViews),delete Web.DataView._delayedLoadingViews);$get("PageContent")&&($removeHandler(window,"resize",_body_resize),$removeHandler(window,"scroll",_body_scroll));$removeHandler(document.body,"keydown",_body_keydown)};Web.DataView._startDelayedLoading=function(){Web.DataView._delayedLoadingViews.length>0&&!Web.DataView._delayedLoadingTimer&&(Web.DataView._delayedLoadingTimer=setInterval(function(){Web.DataView._performDelayedLoading()},1e3))};Web.DataView._updateBatchSelectStatus=function(n,t){for(var r=t?"Item":"Cell",i=n.parentNode;i!=null&&!Sys.UI.DomElement.containsCssClass(i,r);)i=i.parentNode;i&&(n.checked?Sys.UI.DomElement.addCssClass(i,"BatchEditFrame"):Sys.UI.DomElement.removeCssClass(i,"BatchEditFrame"))};Web.DataView.highlightFilterValues=function(n,t,i){while(n&&n.tagName!="TABLE")n=n.parentNode;n&&(t&&!n.className.match(i)?Sys.UI.DomElement.addCssClass(n,i):!t&&n.className.match(i)&&Sys.UI.DomElement.removeCssClass(n,i))};Web.DataView.get_commandLine=function(){var n=Web.DataView._commandLine;return n||(typeof __dacl!="undefined"&&(n=__dacl),n||(n=typeof Web.Membership!="undefined"?Web.Membership._instance.get_commandLine():null,n=n?location.pathname+"?"+n:location.href),Web.DataView._commandLine=$app.unanchor(n)),n};Web.DataView._parse=function(){this._parsed||(this._parsed=!0,$("div[data-controller]").each(function(){var n=$(this),i=n.attr("data-controller"),t,r,u;i&&(t=n.attr("id"),t||(t=i),r={id:t,controller:i,baseUrl:__baseUrl,servicePath:__servicePath,showSearchBar:!0},u=[{name:"autoHide",aliases:["nothing","self","container"],values:[0,1,2]},{name:"autoSelectFirstRow",type:"bool"},{name:"autoHighlightFirstRow",type:"bool"},{name:"filterSource"},{name:"filterFields"},{name:"pageSize",type:"int"},{name:"refreshInterval",type:"int"},{name:"searchByFirstLetter",type:"bool",propName:"showFirstLetters"},{name:"searchOnStart",type:"bool"},{name:"selectionMode",aliases:["single","multiple"],values:["Single","Multiple"]},{name:"showActionBar",type:"bool"},{name:"showActionButtons",aliases:["none","top","bottom","top-and-bottom"],values:["None","Top","Bottom","TopAndBottom"]},{name:"showDetailsInListMode",type:"bool"},{name:"showDescription",type:"bool"},{name:"showInSummary",type:"bool"},{name:"showModalForms",type:"bool"},{name:"showQuickFind",type:"bool"},{name:"showPageSize",type:"bool"},{name:"showPager",aliases:["none","top","bottom","top-and-bottom"],values:["None","Top","Bottom","TopAndBottom"]},{name:"showRowNumber",type:"bool"},{name:"showSearchBar",type:"bool"},{name:"showViewSelector",type:"bool"},{name:"startCommandName"},{name:"startCommandArgument"},{name:"summaryFieldCount",type:"int"},{name:"tag"},{name:"view",propName:"viewId"},{name:"visibleWhen"}],$(u).each(function(){var t=this,i=n.attr("data-"+t.name.replace(/([A-Z])/g,"-$1"));i&&(t.aliases&&(i=t.values[Array.indexOf(t.aliases,i.toString().toLowerCase())]),t.type=="bool"&&(i=i=="true"),t.type=="int"&&(i=parseInt(i)),r[t.propName||t.name]=i)}),n.attr("id",null),$create(Web.DataView,r,null,null,this))}))};Web.DataView.DetailsRegex=/\/Details\.aspx\?/i;Web.DataView.LocationRegex=/^(_.+?):(.+)$/;Web.DataView.LEVs=[];Web.DataView.Editors=[];Web.DataView.EditorFactories={},function(){var n=Sys.CultureInfo.CurrentCulture.dateTimeFormat;Web.DataView.dateFormatStrings={"{0:g}":n.ShortDatePattern+" "+n.ShortTimePattern,"{0:G}":n.ShortDatePattern+" "+n.LongTimePattern,"{0:f}":n.LongDatePattern+" "+n.ShortTimePattern,"{0:u}":n.SortableDateTimePattern,"{0:U}":n.UniversalSortableDateTimePattern}}();Sys.Application.add_load(function(){Web.DataView._parse()});$.mobile||(Sys.Application.add_load(Web.DataView._load),Sys.Application.add_unload(Web.DataView._unload));Sys.UI.DomElement.setFocus=function(n){var t=document.selection;t&&t.type!="Text"&&t.type!="None"&&t.clear();n&&(n.focus(),n.select&&n.select(),document.focus&&document.focus())};Sys.UI.DomElement.getCaretPosition=function(n){var t=0,i;return document.selection?(n.focus(),i=document.selection.createRange(),i.moveStart("character",-n.value.length),t=i.text.length):(n.selectionStart||n.selectionStart=="0")&&(t=n.selectionStart),t};Sys.UI.DomElement.setCaretPosition=function(n,t){if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",t);i.select()}};Array.indexOfCaseInsensitive=function(n,t){t=t.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==t)return i;return-1};Number.tryParse=function(n){var t,i,r;return typeof n!="string"?null:String.isNullOrEmpty(n)?null:(t=Number.parseLocale(n),isNaN(t)&&(i=Sys.CultureInfo.CurrentCulture.numberFormat,i._simplifyRegex||(i._simplifyRegex=new RegExp(String.format("({0}|\\{1})",i.CurrencySymbol.replace(/(\W)/g,"\\$1"),i.CurrencyGroupSeparator),"gi")),r=n.match(/\(/)!=null,n=n.replace(i._simplifyRegex,"").replace(/\(|\)/g,""),n=n.replace(i.CurrencyDecimalSeparator,i.NumberDecimalSeparator),t=Number.parseLocale(n),isNaN(t)&&(t=Number.parseLocale(n.replace(i.PercentSymbol,"")),isNaN(t)||(t/=100))),!isNaN(t))?(r&&(t*=-1),t):null};Date.tryParseFuzzyDate=function(n,t){var r,i,v,u,f,s,o,h,c,l,e,a;if(String.isNullOrEmpty(n))return null;if(r=Sys.CultureInfo.CurrentCulture.dateTimeFormat,i=Date.parseLocale(n,r.ShortDatePattern),i==null&&(i=Date.parseLocale(n,r.LongDatePattern)),i!=null||String.isNullOrEmpty(t)||(v=t.match(/\{0:([\s\S]*?)\}/),v&&(i=Date.parseLocale(n,v[1]))),i)return i;if(i=new Date,u=n.match(/^\s*(\w+)\s*$/),u&&(f=Array.indexOfCaseInsensitive(r.DayNames,u[1]),f==-1&&(f=Array.indexOfCaseInsensitive(r.AbbreviatedDayNames,u[1])),f==-1&&(f=Array.indexOfCaseInsensitive(r.ShortestDayNames,u[1])),f>=0)){while(i.getDay()!=f)i.setDate(i.getDate()+1);return i}if(u=n.match(/^\s*(\w+|\d+)[^\w\d]*(\w+|\d+)\s*$/),u&&(s=u[1],o=u[2],s.match(/\d+/)&&(s=o,o=u[1]),u=o.match(/\d+/),o=u?u[0]:1,f=Array.indexOfCaseInsensitive(r.MonthNames,s),f==-1&&(f=Array.indexOfCaseInsensitive(r.AbbreviatedMonthNames,s)),f>=0)){for(i.setDate(1);i.getMonth()!=f;)i.setMonth(i.getMonth()+1);return i.setDate(o),i}if(u=n.match(/^\s*(\d\d?)(\D*(\d\d?))?(\D*(\d+))?\s*$/),!u)return null;try{r.LogicalYearPosition||(h=r.ShortDatePattern.indexOf("m"),h<0&&(h=r.ShortDatePattern.indexOf("M")),c=r.ShortDatePattern.indexOf("d"),c<0&&(c=r.ShortDatePattern.indexOf("D")),r.LogicalYearPosition=5,r.LogicalMonthPosition=h<c?1:3,r.LogicalDayPosition=h<c?3:1);l=u[r.LogicalYearPosition];l=String.isNullOrEmpty(l)?i.getFullYear():Number.parseLocale(l);e=u[r.LogicalMonthPosition];String.isNullOrEmpty(e)?e=i.getMonth():(e=Number.parseLocale(e),e--);a=u[r.LogicalDayPosition];a=String.isNullOrEmpty(a)?i.getDay():Number.parseLocale(a);i=new Date(l,e,a)}catch(y){return null}return i};Date.tryParseFuzzyTime=function(n,t){if(String.isNullOrEmpty(n))return null;var u=null,f=Sys.CultureInfo.CurrentCulture.dateTimeFormat,i=n.match(/^\s*(\d\d?)(\D*(\d\d?))?(\s*(\w+))?\s*$/);if(i||(i=n.match(/^\s*(\d\d?)(\D*(\d\d?))?(\D*(\d\d?))?(\D*(\d+))?(\s*([\S\s]+))?\s*$/)),i){u=new Date;var r=i[1],e=i[3],o=i.length==10?i[5]:"",s=i.length==10?i[7]:"",h=i[i.length-1];String.isNullOrEmpty(r)||(r=Number.parseLocale(r),String.isNullOrEmpty(h)?t!=!1&&!String.isNullOrEmpty(f.PMDesignator)&&f.ShortTimePattern.indexOf("tt")>0&&(new Date).getHours()>=12&&(r+=12):h.toLowerCase()==f.PMDesignator.toLowerCase()?r!=12&&(r+=12):r==12&&(r=0),u.setHours(r));String.isNullOrEmpty(e)||u.setMinutes(Number.parseLocale(e));u.setSeconds(String.isNullOrEmpty(o)?0:Number.parseLocale(o));u.setMilliseconds(String.isNullOrEmpty(s)?0:Number.parseLocale(s))}return u};Date._jsonRegex=/(\d{4})\-(\d{2})\-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})\.(\d{3})Z/;Date.fromUTCString=function(n){var t=n.match(Date._jsonRegex),i;return t&&(i=new Date(parseInt(t[1]),parseInt(t[2])-1,parseInt(t[3]),parseInt(t[4]),parseInt(t[5]),parseInt(t[6]),parseInt(t[7]))),i},function(){var n=Sys.Serialization.JavaScriptSerializer,t=n.deserialize;n.deserialize=function(n,i){var r;try{return r=n.replace(/\"(\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}\.\d{3}Z)\"/g,'Date.fromUTCString("$1")'),t(r,i)}catch(u){throw Error.argument("data",Sys.Res.cannotDeserializeInvalidJson);}}}();Date.$addDays=function(n,t){return n?new Date(n.setDate(n.getDate()+t)):n};Date.$now=function(){return new Date};Date.$today=function(){var n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0)};Date.$endOfDay=function(){var n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59)};Date.$within=function(n,t){return n?n<Date.$addDays(Date.$today(),t)&&n>=Date.$today():!1};Date.$pastDue=function(n,t){return t==null&&(t=new Date),t.getHours()==0&&(t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59)),n==null&&(n=new Date),n>t};Web.DataView._blankRegex=/^\s*$/;Web.DataView._fieldFilterRegex=/(\w+):([\s\S]*)/;Web.DataView._filterRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)$/;Web.DataView._filterIteratorRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)/g;Web.DataView._keepCapitalization=/^\$(month|quarter|true|false)/;Web.DataView._listRegex=/\$and\$|\$or\$/;Web.DataView._simpleListRegex=/\s*,\s*/;Web.DataView._htmlTest=/<\w+.*?>/;Web.BusinessRules=function(n){this._dataView=n;this.result=new Web.BusinessRules.Result(this)};Web.BusinessRules.prototype={canceled:function(){return this._canceled==!0},dispose:function(){this.reset(null);this._dataView=null;this.result._rules=null},reset:function(n){this._actionArgs=null;this._args=n},_initialize:function(){if(!this._actionArgs){var n=this._dataView;this._actionArgs=n._createArguments(this._args,null);n.get_isEditing()&&(n._validateFieldValues(this._actionArgs.Values,this._args.causesValidation==null||this._args.causesValidation),this._valid=n.validate(this._actionArgs.Values))}},process:function(n){var e=this._dataView,o=this._args.commandName,u,v,t,r,s,w,c,f,y,l,i,h,p,a;if(o=="Calculate"&&e._lookupIsActive){this.preventDefault();return}if(u=Web.DataView.Geo,u&&!(__tf!=4)&&o.match(/New|Edit/)){for(v=this._dataView._fields,t=0;t<v.length;t++)r=v[t],r.readOnly||(r.tagged("modified-latitude")||r.tagged("created-latitude")&&o=="New"?this.updateFieldValue(r.Name,u.latitude==-1?null:u.latitude):r.tagged("modified-longitude")||r.tagged("created-longitude")&&o=="New"?this.updateFieldValue(r.Name,u.longitude==-1?null:u.longitude):(r.tagged("modified-coords")||r.tagged("created-coords")&&o=="New")&&this.updateFieldValue(r.Name,u.latitude==-1?null:String.format("{0},{1}",u.latitude,u.longitude)));this._newValues&&(e._updateCalculatedFields({Errors:[],Values:this._newValues}),this._newValues=null)}if(s=e._expressions,s&&s.length!=0){if(!this._rules)for(this._rules=[],w=0,t=0;t<s.length;t++)c=s[t],c.Type==Web.DynamicExpressionType.ClientScript&&c.Scope==Web.DynamicExpressionScope.Rule&&(f=c.Result.match(/^<id>(.+?)<\/id><commandName>(.+?)<\/commandName><commandArgument>(.*?)<\/commandArgument><view>(.*?)<\/view><phase>(.*?)<\/phase><script>([\s\S]+?)<\/script>$/),f&&(y=String.format("Web.BusinessRules.{0}_Rule_{1}",e._controller,f[1]?f[1]:w),l=eval(String.format('typeof {0} !="undefined"?{0}:null',y)),l||(l=eval(this._parseRule(y,f[6]))),Array.add(this._rules,{commandName:f[2],commandArgument:f[3],view:f[4],phase:f[5],script:l})));for(t=0;t<this._rules.length;t++)if((i=this._rules[t],i.phase==n)&&(h=!1,String.isNullOrEmpty(i.view)||(p=e.get_viewId(),i.view==p||p.match(new RegExp(i.view))||(h=!0)),String.isNullOrEmpty(i.commandName)||(o=this._args.commandName,i.commandName==o||o.match(new RegExp(i.commandName))||(h=!0)),String.isNullOrEmpty(i.commandArgument)||(a=this._args.commandArgument,i.commandArgument==a||a&&a.match(new RegExp(i.commandArgument))||(h=!0)),!h&&(i.script.call(this),this.canceled())))break;this._newValues?(e._updateCalculatedFields({Errors:[],Values:this._newValues}),delete this._newValues,this._pendingFocus()):this.canceled()&&e.get_isDataSheet()&&(e._updateCalculatedFields({Errors:[],Values:[]}),this._pendingFocus())}},_pendingFocus:function(){this._focusFieldName&&(this._dataView._focus(this._focusFieldName,this._focusMessage),this._focusFieldName=null)},before:function(n){this.reset(n);this.process("Before");this.canceled()||this.process("Execute")},after:function(n){this._dataView._isBusy||(this.reset(n),this.process("After"))},_parseRule:function(n,t){var i=new Sys.StringBuilder,r;return i.appendFormat("{0}=function(){{\n",n),r=/([\s\S]*?)(\[(\w+)(\.(\w+))?\](\s*=([^=][\s\S]+?);)?)/g,this._parseScript(i,r,t),t=i.toString(),i.clear(),this._parseScript(i,r,t),i.append("\n}"),i.toString()},_parseScript:function(n,t,i){for(var f=-1,r=t.exec(i),u,e,o;r;)n.append(r[1]),u=r[3],e=r[5],r[1].match(/\w$/)?n.append(r[2]):u.match(/^master$/i)?n.appendFormat("this.fieldValue('{0}','Master')",e):(o=this._dataView.findField(u),String.isNullOrEmpty(r[7])?n.appendFormat("this.fieldValue('{0}','{1}')",u,e):n.appendFormat("this.updateFieldValue('{0}',{1});",u,r[7])),f=t.lastIndex,r=t.exec(i);f!=-1?n.append(f<i.length?i.substr(f):""):n.append(i)},preventDefault:function(){this._canceled=!0;this._dataView._raiseSelectedDelayed=!1;this._dataView._pendingSelectedEvent=!1},validateInput:function(){return this._initialize(),this._valid==!0},dataView:function(){return this._dataView},arguments:function(){return this._initialize(),this._actionArgs},selectFieldValueObject:function(n){var i,t,r;for(this._initialize(),i=this._actionArgs.Values,t=0;t<i.length;t++)if(r=i[t],n==r.Name)return r;return null},selectFieldValue:function(n){var t=this.selectFieldValueObject(n);return t?t.Modified?t.NewValue:t.OldValue:null},fieldValue:function(n,t){var r,i;if(t=="Master")return r=this._dataView.get_master(),r?r.fieldValue(n):null;if(!t||t=="Value")return this.selectFieldValue(n);i=this.selectFieldValueObject(n);i||this._unknownField(n);switch(t){case"NewValue":return i.NewValue;case"OldValue":return i.OldValue;case"Modified":return i.Modified;case"ReadOnly":return i.ReadOnly;case"Error":return i.Error;default:return i.OldValue}},updateFieldValue:function(n,t){var u=this.selectFieldValueObject(n),i,r;if(u){for(u.NewValue=t,u.Modified=!0,i=this._newValues,i||(i=this._newValues=[]),r=0;r<i.length;r++)if(i[r].Name==n){Array.removeAt(i,r);break}Array.add(i,u)}else this._unknownField(n)},property:function(n,t){if(n="Rules$"+n,arguments.length==1)return this._dataView.readContext(n);this._dataView.writeContext(n,t)},_unknownField:function(n){throw new Error(String.format('Unknown field "{0}" is not defined in  /controllers/{1}/views/{2}.',n,this._dataView._controller,this._dataView._viewId));}};Web.BusinessRules.Result=function(n){this._rules=n};Web.BusinessRules.Result.prototype={focus:function(n){var i=null,r,t,u;arguments.length>1&&(r=Array.clone(arguments),Array.removeAt(r,0),i=String._toFormattedString(!0,r));t=this._rules;u=t._dataView;t._focusFieldName=n;t._focusMessage=i;u._focus(n,i)},showMessage:function(){Web.DataView.showMessage(String._toFormattedString(!0,arguments))},showViewMessage:function(){this._rules._dataView.showViewMessage(String._toFormattedString(!0,arguments))},showAlert:function(){alert(String._toFormattedString(!0,arguments))},confirm:function(){return confirm(String._toFormattedString(!0,arguments))},refresh:function(n){this._rules._dataView(n==!0)},refreshChildren:function(){var n=this._rules._dataView;n._forceChanged=!0;n._raiseSelectedDelayed=!0;this.refresh(!0)}};Web$DataView$RichText=function(){};Web$DataView$RichText.prototype={attach:function(n){var f=$(n),r,t,e,i,u,o;return f.addClass("dataview-rich-text"),r=$("html").attr("lang"),String.isNullOrEmpty(r)&&(r=$("html").attr("xml:lang")),typeof CKEDITOR!="undefined"?($("<div><\/div>").insertAfter(f).width(f.outerWidth()).height(1),CKEDITOR.replace(n.id,{language:r,on:{instanceReady:function(t){var i=CKEDITOR.instances[n.id].getCommand("maximize");i&&(i._old_exec=i.exec,i.exec=function(n){this._old_exec(n);$(t.editor.container.$).find(".cke_maximized").css("z-index",10001)})}}})):(t=Web.DataViewResources.Editor,e=[{CommandName:"Undo",Tooltip:t.Undo},{CommandName:"Redo",Tooltip:t.Redo},{CommandName:"Bold",Tooltip:t.Bold,ElementWhiteList:{b:["style"],strong:["style"]}},{CommandName:"Italic",Tooltip:t.Italic,ElementWhiteList:{i:["style"],em:["style"]}},{CommandName:"Underline",Tooltip:t.Underline,ElementWhiteList:{u:["style"]}},{CommandName:"StrikeThrough",Tooltip:t.Strikethrough,ElementWhiteList:{strike:["style"]}},{CommandName:"Subscript",Tooltip:t.Subscript,ElementWhiteList:{sub:["style"]}},{CommandName:"Superscript",Tooltip:t.Superscript,ElementWhiteList:{sup:["style"]}},{CommandName:"JustifyLeft",Tooltip:t.JustifyLeft,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["left"]},{CommandName:"JustifyCenter",Tooltip:t.JustifyCenter,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["center"]},{CommandName:"JustifyRight",Tooltip:t.JustifyRight,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["right"]},{CommandName:"JustifyFull",Tooltip:t.JustifyFull,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["justify"]},{CommandName:"insertOrderedList",Tooltip:t.InsertOrderedList,ElementWhiteList:{ol:[],li:[]}},{CommandName:"insertUnorderedList",Tooltip:t.InsertUnorderedList,ElementWhiteList:{ul:[],li:[]}},{CommandName:"createLink",Tooltip:t.CreateLink,ElementWhiteList:{a:["href"]}},{CommandName:"UnLink",Tooltip:t.UnLink},{CommandName:"RemoveFormat",Tooltip:t.RemoveFormat},{CommandName:"SelectAll",Tooltip:t.SelectAll},{CommandName:"UnSelect",Tooltip:t.UnSelect},{CommandName:"Delete",Tooltip:t.Delete},{CommandName:"Cut",Tooltip:t.Cut},{CommandName:"Paste",Tooltip:t.Paste},{CommandName:"BackColor",Tooltip:t.BackColor,ElementWhiteList:{font:"style",span:"style"},AttributeWhiteList:{style:"background-color"}},{CommandName:"ForeColor",Tooltip:t.ForeColor,ElementWhiteList:{font:"color"},AttributeWhiteList:{font:"color"}},{CommandName:"FontName",Tooltip:t.FontName,ElementWhiteList:{font:["face"]},AttributeWhitList:{face:[]}},{CommandName:"FontSize",Tooltip:t.FontSize,ElementWhiteList:{font:["size"]},AttributeWhitList:{size:[]}},{CommandName:"Indent",Tooltip:t.Indent,ElementWhiteList:{blockquote:["style","dir"]},AttributeWhitList:{style:["margin","margin-right","padding","border"],dir:["ltr","rtl","auto"]}},{CommandName:"Outdent",Tooltip:t.Outdent},{CommandName:"InsertHorizontalRule",Tooltip:t.InsertHorizontalRule,ElementWhiteList:{hr:["size","width"]},AttributeWhiteList:{size:[],width:[]}},{CommandName:"HorizontalSeparator",Tooltip:""}],navigator.appVersion.match(/MSIE/)&&e.splice(0,2),i=Sys.Extended.UI.HtmlEditorExtenderBehavior,i._customized||(i.prototype.old_executeCommand=i.prototype._executeCommand,i.prototype._executeCommand=function(n){$(this._editableDiv).focus();this.old_executeCommand(n)},i._customized=!0),u=$create(i,{ToolbarButtons:e,id:n.id+"$Editor"},null,null,n),u._noEncoding=!0,u._editableDiv.tabIndex=n.tabIndex,o=$(u._topButtonContainer),o.find("nobr span").hide(),o.find("select").css({"font-family":"","font-size":""})),!0},detach:function(n){if(typeof CKEDITOR!="undefined")CKEDITOR.remove(n.id);else{var t=$find(n.id+"$Editor");t&&t.dispose()}return!0},persist:function(n){if(typeof CKEDITOR!="undefined")n.value=CKEDITOR.instances[n.id].getData();else{var t=$find(n.id+"$Editor");t&&(n.value=t._editableDiv.innerHTML)}}};typeof Sys!="undefined"&&Sys.Application.notifyScriptLoaded()