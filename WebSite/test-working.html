<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Sidebar - Working Version</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .btn { 
            background: #007bff; color: white; border: none; 
            padding: 10px 20px; margin: 5px; border-radius: 5px; 
            cursor: pointer; 
        }
        .btn:hover { background: #0056b3; }
        .output { 
            background: #f8f9fa; border: 1px solid #dee2e6; 
            padding: 15px; margin: 15px 0; border-radius: 5px; 
            font-family: monospace; max-height: 400px; overflow-y: auto;
        }
        .enhanced-sidebar {
            position: fixed; top: 0; right: -400px; width: 350px;
            height: 100vh; background: white; box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease; z-index: 1000;
        }
        .enhanced-sidebar.open { right: 0; }
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); opacity: 0; visibility: hidden;
            transition: all 0.3s ease; z-index: 999;
        }
        .sidebar-overlay.visible { opacity: 1; visibility: visible; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Enhanced Sidebar - Working Test</h1>
    
    <!-- Mock PageMenuBar with the exact structure we need -->
    <div id="PageMenuBar" style="display: none;">
        <table>
            <tr>
                <td>
                    <a href="/hr">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</a>
                    <table>
                        <tr>
                            <td style="padding-left: 20px;">
                                <a href="/hr/employees">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</a>
                                <ul>
                                    <li style="padding-left: 40px;"><a href="/hr/employees/add">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</a></li>
                                    <li style="padding-left: 40px;"><a href="/hr/employees/list">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</a></li>
                                    <li style="padding-left: 40px;"><a href="/hr/employees/reports">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</a></li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;">
                                <a href="/hr/payroll">Ø§Ù„Ø±ÙˆØ§ØªØ¨</a>
                                <ul>
                                    <li style="padding-left: 40px;"><a href="/hr/payroll/calculate">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨</a></li>
                                    <li style="padding-left: 40px;"><a href="/hr/payroll/history">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙˆØ§ØªØ¨</a></li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <a href="/finance">Ø§Ù„Ù…Ø§Ù„ÙŠØ©</a>
                    <table>
                        <tr>
                            <td style="padding-left: 20px;">
                                <a href="/finance/accounts">Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</a>
                                <ul>
                                    <li style="padding-left: 40px;"><a href="/finance/accounts/receivable">Ø§Ù„Ø°Ù…Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</a></li>
                                    <li style="padding-left: 40px;"><a href="/finance/accounts/payable">Ø§Ù„Ø°Ù…Ù… Ø§Ù„Ø¯Ø§Ø¦Ù†Ø©</a></li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding-left: 20px;"><a href="/finance/reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</a></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td><a href="/inventory">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a></td>
            </tr>
        </table>
    </div>

    <!-- Sidebar -->
    <div class="enhanced-sidebar" id="enhanced-sidebar">
        <div style="padding: 20px;">
            <h3>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©</h3>
            <div id="sidebar-menu-list">
                <p>Loading...</p>
            </div>
        </div>
    </div>
    
    <!-- Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div>
        <button class="btn" onclick="checkFunctions()">ğŸ” Check Functions</button>
        <button class="btn" onclick="showPageMenuBar()">ğŸ‘ï¸ Show PageMenuBar</button>
        <button class="btn" onclick="testExtraction()">âš¡ Test Extraction</button>
        <button class="btn" onclick="testInit()">ğŸš€ Test Init</button>
        <button class="btn" onclick="toggleSidebar()">ğŸ“± Toggle Sidebar</button>
    </div>
    
    <div id="output" class="output">
        <strong>Test Output:</strong><br>
        Waiting for tests...
    </div>

    <!-- Load the test sidebar script -->
    <script src="js/test-sidebar.js"></script>
    
    <script>
        function log(message) {
            var output = document.getElementById('output');
            var time = new Date().toLocaleTimeString();
            output.innerHTML += '<br>[' + time + '] ' + message;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        function checkFunctions() {
            log("=== Function Availability Check ===");
            log("toggleLegacyMenu: " + (typeof window.toggleLegacyMenu !== 'undefined'));
            log("extractMenuFromPageMenuBar: " + (typeof window.extractMenuFromPageMenuBar !== 'undefined'));
            log("initializeSidebar: " + (typeof window.initializeSidebar !== 'undefined'));
            log("debugSidebar: " + (typeof window.debugSidebar !== 'undefined'));
            log("EnhancedModernSidebar: " + (typeof window.EnhancedModernSidebar !== 'undefined'));
            
            if (window.debugSidebar) {
                var info = window.debugSidebar();
                log("Debug info: " + JSON.stringify(info, null, 2));
            }
        }
        
        function showPageMenuBar() {
            var pmb = document.getElementById('PageMenuBar');
            log("=== PageMenuBar Analysis ===");
            log("Found: " + !!pmb);
            if (pmb) {
                log("Children: " + pmb.children.length);
                log("Links: " + pmb.querySelectorAll('a').length);
                log("Tables: " + pmb.querySelectorAll('table').length);
                log("List items: " + pmb.querySelectorAll('li').length);
                
                // Show first few links
                var links = pmb.querySelectorAll('a');
                log("Links preview:");
                for (var i = 0; i < Math.min(5, links.length); i++) {
                    var text = (links[i].textContent || '').trim();
                    log("  " + (i + 1) + ". " + text);
                }
                if (links.length > 5) {
                    log("  ... and " + (links.length - 5) + " more");
                }
            }
        }
        
        function testExtraction() {
            log("=== Testing Extraction ===");
            
            if (window.extractMenuFromPageMenuBar) {
                try {
                    var result = window.extractMenuFromPageMenuBar();
                    if (result && result.length > 0) {
                        log("âœ… Extracted " + result.length + " main items");
                        
                        // Show hierarchy
                        result.forEach(function(item, i) {
                            log("Level 1: " + item.title + " (" + (item.children ? item.children.length : 0) + " children)");
                            if (item.children && item.children.length > 0) {
                                item.children.forEach(function(child) {
                                    log("  Level 2: " + child.title + " (" + (child.children ? child.children.length : 0) + " children)");
                                    if (child.children && child.children.length > 0) {
                                        child.children.forEach(function(grandChild) {
                                            log("    Level 3: " + grandChild.title);
                                        });
                                    }
                                });
                            }
                        });
                    } else {
                        log("âŒ No data extracted");
                    }
                } catch (error) {
                    log("âŒ Error: " + error.message);
                    console.error(error);
                }
            } else {
                log("âŒ extractMenuFromPageMenuBar not available");
            }
        }
        
        function testInit() {
            log("=== Testing Initialization ===");
            
            if (window.initializeSidebar) {
                var result = window.initializeSidebar();
                log("Init result: " + result);
            } else {
                log("âŒ initializeSidebar not available");
            }
        }
        
        function toggleSidebar() {
            if (window.toggleLegacyMenu) {
                window.toggleLegacyMenu();
                log("ğŸ”„ Sidebar toggled");
            } else {
                // Manual toggle
                var sidebar = document.getElementById('enhanced-sidebar');
                var overlay = document.getElementById('sidebar-overlay');
                
                if (sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                    overlay.classList.remove('visible');
                    log("ğŸ“± Sidebar closed (manual)");
                } else {
                    sidebar.classList.add('open');
                    overlay.classList.add('visible');
                    log("ğŸ“± Sidebar opened (manual)");
                }
            }
        }
        
        // Auto-run tests
        window.addEventListener('load', function() {
            log("ğŸš€ Page loaded - starting tests...");
            setTimeout(function() {
                checkFunctions();
                showPageMenuBar();
            }, 1000);
        });
    </script>
</body>
</html>